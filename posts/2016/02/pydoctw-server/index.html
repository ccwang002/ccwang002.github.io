<!DOCTYPE html>
<html lang="zh-Hant">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Liang-Bo Wang" />
<meta name="description" content="è¨­å®šä¸€å€‹è‡ªå‹•æ›´æ–° Python èªªæ˜æ–‡ä»¶ä¸­æ–‡ç¿»è­¯ä¸¦ä¸” host ä¸­æ–‡åŒ–ç¶²é ç‰ˆæ–‡ä»¶çš„ serverã€‚ä½¿ç”¨ Django ä½œ web serverã€Django-Q åšç‚º task queueï¼Œdeploy stack ç”¨ nginxã€uWSGIï¼Œhost æ–¼ Amazon EC2 (Debian Jessie)ï¼Œè³‡æ–™åº«ç”¨ PostgreSQLï¼Œä¸¦ç”¨ systemd ç®¡ç†ç›¸é—œçš„ processã€‚" />
<meta name="keywords" content="zh, pydoctw, python, django, postgresql, deploy, debian, systemd, nginx, uwsgi">
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.95em%22 font-size=%2295%22>ğŸ“–</text></svg>">
	<title>è¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Server</title>

	<!-- og -->
<meta property="og:locale" content="zh_TW"/>
<meta property="og:site_name" content="Liang-Bo Wang's Blog"/>
<meta property="og:title" content="è¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Server"/>
<meta property="og:description" content="è¨­å®šä¸€å€‹è‡ªå‹•æ›´æ–° Python èªªæ˜æ–‡ä»¶ä¸­æ–‡ç¿»è­¯ä¸¦ä¸” host ä¸­æ–‡åŒ–ç¶²é ç‰ˆæ–‡ä»¶çš„ serverã€‚ä½¿ç”¨ Django ä½œ web serverã€Django-Q åšç‚º task queueï¼Œdeploy stack ç”¨ nginxã€uWSGIï¼Œhost æ–¼ Amazon EC2 (Debian Jessie)ï¼Œè³‡æ–™åº«ç”¨ PostgreSQLï¼Œä¸¦ç”¨ systemd ç®¡ç†ç›¸é—œçš„ processã€‚"/>
<meta property="og:locale" content=""/>
<meta property="og:url" content="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-02-14 21:00:00-06:00"/>
<meta property="article:modified_time" content="2024-09-08 17:21:08.405205-05:00"/>
<meta property="article:author" content="https://blog.liang2.tw/author/liang-bo-wang.html">
<meta property="article:section" content="Coding"/>
<meta property="article:tag" content="zh"/>
<meta property="article:tag" content="pydoctw"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="django"/>
<meta property="article:tag" content="postgresql"/>
<meta property="article:tag" content="deploy"/>
<meta property="article:tag" content="debian"/>
<meta property="article:tag" content="systemd"/>
<meta property="article:tag" content="nginx"/>
<meta property="article:tag" content="uwsgi"/>
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ccwang002">
<meta name="twitter:title" content="è¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Server">
<meta name="twitter:description" content="è¨­å®šä¸€å€‹è‡ªå‹•æ›´æ–° Python èªªæ˜æ–‡ä»¶ä¸­æ–‡ç¿»è­¯ä¸¦ä¸” host ä¸­æ–‡åŒ–ç¶²é ç‰ˆæ–‡ä»¶çš„ serverã€‚ä½¿ç”¨ Django ä½œ web serverã€Django-Q åšç‚º task queueï¼Œdeploy stack ç”¨ nginxã€uWSGIï¼Œhost æ–¼ Amazon EC2 (Debian Jessie)ï¼Œè³‡æ–™åº«ç”¨ PostgreSQLï¼Œä¸¦ç”¨ systemd ç®¡ç†ç›¸é—œçš„ processã€‚">

	<!-- Feeds -->
	<link href="https://blog.liang2.tw/feeds/all.atom.xml"
		type="application/atom+xml" rel="alternate" title="Liang-Bo Wang's Blog" />

	<link rel="stylesheet" type="text/css" href="https://blog.liang2.tw/theme/styles/styles.css" />
	<link rel="stylesheet" href="https://blog.liang2.tw/theme/styles/pygments/light.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light" />
    <link rel="stylesheet" href="https://blog.liang2.tw/theme/styles/pygments/dark-monokai.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark" />
	<link rel="stylesheet" type="text/css" href="https://blog.liang2.tw/theme/katex-0.16.2/katex.min.css">
</head>

<body class="post-template no-js">
	<script>document.body.classList.remove('no-js');</script>
<svg
	xmlns="http://www.w3.org/2000/svg"
	style="display: none;"
>
	<symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
		<title>Following system color scheme</title>
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
			stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<circle cx="12" cy="12" r="9"></circle>
			<path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
		</svg>
	</symbol>
	<symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
		<title>Selected dark color scheme</title>
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
			stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
			<path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
		</svg>
	</symbol>
	<symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
		<title>Selected light color scheme</title>
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
			stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<circle cx="12" cy="12" r="5"></circle>
			<line x1="12" y1="1" x2="12" y2="3"></line>
			<line x1="12" y1="21" x2="12" y2="23"></line>
			<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
			<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
			<line x1="1" y1="12" x2="3" y2="12"></line>
			<line x1="21" y1="12" x2="23" y2="12"></line>
			<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
			<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
		</svg>
	</symbol>
</svg>

<script>
	document.documentElement.dataset.color_scheme = localStorage.getItem("color_scheme") || "auto"
</script>
	<header class="site-head">
		<h1 class="blog-title"><a href="https://blog.liang2.tw">Liang-Bo Wang's Blog</a></h1>
		<h2 class="blog-description">
			<a href="https://blog.liang2.tw/about-me/">About</a> |
			<a href="https://blog.liang2.tw/talks/">Talks</a> |
			<a href="https://blog.liang2.tw/archives.html">Archives</a> |
			<button id="color-scheme-cycler" onClick="setColorScheme(nextColorScheme())">
                <svg aria-hidden="true" class="color-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="color-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="color-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="sr-only">Toggle light / dark / auto color theme</span>
            </button>
		</h2>
	</header>
	<main id="content" class="content" role="main">
<article class="post">
    <span class="post-meta">
        <time datetime="2016-02-14">Feb 14, 2016</time>
        in <a href="https://blog.liang2.tw/category/coding/">Coding</a>
    </span>
    <h1 class="post-title">
        <a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/" rel="bookmark" title="Permalink to è¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Server">è¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Server</a>
    </h1>
    <span class="post-meta">
                <a href="https://blog.liang2.tw/tag/zh/">zh</a>
                <a href="https://blog.liang2.tw/tag/pydoctw/">pydoctw</a>
                <a href="https://blog.liang2.tw/tag/python/">python</a>
                <a href="https://blog.liang2.tw/tag/django/">django</a>
                <a href="https://blog.liang2.tw/tag/postgresql/">postgresql</a>
                <a href="https://blog.liang2.tw/tag/deploy/">deploy</a>
                <a href="https://blog.liang2.tw/tag/debian/">debian</a>
                <a href="https://blog.liang2.tw/tag/systemd/">systemd</a>
                <a href="https://blog.liang2.tw/tag/nginx/">nginx</a>
                <a href="https://blog.liang2.tw/tag/uwsgi/">uwsgi</a>
    </span>
    <section class="post-content"><p><em>TL;DR</em> å¯è‡³ <a href="http://docs.python.org.tw">http://docs.python.org.tw</a> çœ‹ç·šä¸Šè‡ªå‹•æ›´æ–°çš„<a href="http://docs.python.org.tw/3/">ä¸­æ–‡åŒ–çš„æ–‡ä»¶</a>å’Œ <a href="http://docs.python.org.tw/_build/">build server</a>ã€‚</p>
<p>EDIT 2016-02-16: åŠ ä¸Š language codeã€git sshconfigã€swap çš„è¨­å®šï¼›æ–‡å¥æ½¤é£¾ã€‚<br>
EDIT 2016-02-20: åŠ ä¸Š tmpfiles.d çš„è¨­å®šã€‚</p>
<div class="toc">
<ul>
<li><a href="#python">Python èªªæ˜æ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«</a><ul>
<li><a href="#sphinx">Sphinx æ–‡ä»¶å¤šåœ‹èªè¨€æ¶æ§‹</a></li>
<li><a href="#transifex-po">Transifex ç·šä¸Šæœå‹™è®“å¤šäººå…±åŒç¿»è­¯ po æª”</a></li>
<li><a href="#_1">ç¿»è­¯é«”é©—æ”¹å–„</a></li>
</ul>
</li>
<li><a href="#pydoc-autobuild-server">PyDoc Autobuild Server</a><ul>
<li><a href="#_2">å¯¦ä½œ</a><ul>
<li><a href="#sphinx_1">Sphinx æ–‡ä»¶</a></li>
<li><a href="#autobuild-django-server">Autobuild Django server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#autobuild-server">Autobuild server éƒ¨ç½²</a><ul>
<li><a href="#_3">ä½œæ¥­ç³»çµ±</a><ul>
<li><a href="#python-35-and-apt-pinning">Python 3.5 and APT-pinning</a></li>
<li><a href="#postgresql">è³‡æ–™åº« PostgreSQL</a></li>
<li><a href="#swap">Swap</a></li>
<li><a href="#git-repo-ssh-config">Git repo ssh config</a></li>
<li><a href="#tmpfilesd">tmpfiles.d</a></li>
</ul>
</li>
<li><a href="#django-stack-nginx-uwsgi">Django Stack &ndash; nginx + uWSGI</a><ul>
<li><a href="#nginx">nginx è¨­å®š</a></li>
<li><a href="#uwsgi">uWSGI è¨­å®š</a></li>
</ul>
</li>
<li><a href="#systemd-services">Systemd services</a></li>
</ul>
</li>
<li><a href="#_4">ç¸½çµ</a></li>
</ul>
</div>
<h2 id="python">Python èªªæ˜æ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«</h2>
<p>æœ€è¿‘ä¸€æ®µæ™‚é–“éƒ½åœ¨æº–å‚™ <a href="https://github.com/python-doc-tw/python-doc-tw">Python èªªæ˜æ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«</a>ã€‚ç¿»è­¯æœ¬èº«é›–ç„¶é‚„æ²’å¾ˆç©æ¥µåœ°é€²è¡Œï¼Œä½†ç¶“é<a href="http://www.meetup.com/Taipei-py/events/226558484/">å‰</a><a href="http://www.meetup.com/Taipei-py/events/227001232/">å¹¾æ¬¡</a> Taipei.py Projects On çš„ sprint æ´»å‹•ï¼Œå·²ç¶“æœ‰è »å¤šäººåŠ å…¥ç¿»è­¯çš„è¡Œåˆ—ã€‚å¤§å®¶éƒ½æœ‰å„è‡ªç¿»è­¯çš„ä¸»é¡Œï¼Œåƒæˆ‘è‡ªå·±æ˜¯å¾ <a href="http://docs.python.org.tw/3/tutorial/index.html">Tutorial</a> çš„éƒ¨ä»½é–‹å§‹ç¿»è­¯ã€‚</p>
<h3 id="sphinx">Sphinx æ–‡ä»¶å¤šåœ‹èªè¨€æ¶æ§‹</h3>
<p>å…ˆç°¡ä»‹ä¸€ä¸‹ <a href="https://docs.python.org/3/">CPython Documentation</a>ï¼ˆä¸‹ç¨± pydocï¼‰çš„æ¶æ§‹å’Œç¿»è­¯æ–¹å¼ã€‚pydoc æ˜¯æ¨™æº–çš„ <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> æ–‡ä»¶ï¼Œå› æ­¤ç¿»è­¯ä½¿ç”¨ Sphinx è‡ªå¸¶çš„ <a href="http://www.sphinx-doc.org/en/stable/intl.html">internationalization</a> (i18n or intl) åŠŸèƒ½æŠŠæ–‡ä»¶çš„å…§å®¹è½‰æ›åˆ°åˆ¥çš„èªè¨€ä¸Šã€‚</p>
<p>å¦‚åŒ Django ç­‰å°ˆæ¡ˆï¼Œi18n éƒ½æ˜¯é€é gettextï¼ŒSphinx æœƒæŒ‰ç…§ rst æª”æ¡ˆè¼¸å‡ºåŒæª”åçš„ po æª”ã€‚rst æª”æ¡ˆä¸­çš„æ¯å€‹æ–‡å­—æ®µè½æœƒå°æ‡‰åˆ° po æª”ä¸€å€‹ entryï¼Œä¸ç›¸å¹²çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ç­‰æ®µè½æœƒè¢«è·³éã€‚è¼¸å‡ºçš„ po æª”æ”¾åœ¨å°æ‡‰çš„è·¯å¾‘ä¾‹å¦‚ <code>locale/&lt;lang&gt;/LC_MESSAGES/xxx.po</code>ã€‚</p>
<p><a href="https://en.wikipedia.org/wiki/Gettext">po æª”çš„æ ¼å¼</a>å¾ˆç°¡å–®ï¼Œè·³éæœ‰çš„æ²’çš„ headerï¼Œå¯¦è³ªå…§å®¹é•·é€™æ¨£ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kd">#: ../../tutorial/appetite.rst:50</span>
<span class="nv">msgid</span> <span class="s">&quot;&quot;</span>
<span class="s">&quot;Python enables programs to be written compactly and readably.  Programs &quot;</span>
<span class="s">&quot;written in Python are typically much shorter than equivalent C,  C++, or &quot;</span>
<span class="s">&quot;Java programs, for several reasons:&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
<span class="s">&quot;Python è®“ç¨‹å¼å¯«å¾—ç²¾ç°¡ä¸¦æ˜“è®€ã€‚ç”¨ Python å¯¦ä½œçš„ç¨‹å¼é•·åº¦å¾€å¾€é æ¯”ç”¨ &quot;</span>
<span class="s">&quot;Cã€C++ã€Java å¯¦ä½œçš„çŸ­ã€‚é€™æœ‰ä»¥ä¸‹å¹¾å€‹åŸå› ï¼š&quot;</span>
</code></pre></div>

<p>å¯¦éš›ä¸Š Sphinx æœƒå…ˆè¼¸å‡ºä¸€ä»½ä¹¾æ·¨çš„ po æª”ç¯„æœ¬ï¼ˆç¨±ç‚º pot æª”ï¼‰åˆ° <code>locale/pot/</code>ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åªæœ‰åŸæ–‡çš„ po æª”ã€‚æ¯å¢åŠ ä¸€å€‹æ–°èªè¨€å°±æœƒå¾ pot æª”è£½ä½œä¸€ä»½ po æª”åˆ°å„è‡ªçš„ <code>locale/&lt;lang&gt;/</code> ç›®éŒ„ä¸‹ï¼Œç¿»è­¯æ™‚å°±ä¿®æ”¹é‚£ä»½ po æª”å°±å¯ä»¥ã€‚</p>
<p>ç¿»è­¯å®Œæˆå¾Œï¼Œé¦–å…ˆ Sphinx æœƒå…ˆå‘¼å« gettext æŠŠ po æª”ç·¨è­¯æˆ mo æª”åŠ é€Ÿæœå°‹ç¿»è­¯å­—ä¸²é€Ÿåº¦ã€‚è¼¸å‡ºç¿»è­¯å¾Œçš„æ–‡ä»¶åªè¦è¨­å®šä¸åŒèªè¨€ï¼ŒSphinx å°±æœƒå»æ‰¾è©²èªè¨€çš„ mo æª”ï¼Œä¸¦æŠŠåŸæ–‡å­—ä¸²æ›æˆ mo æª”è£¡çš„å…§å®¹ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸­æ–‡çš„æ–‡ä»¶ã€‚</p>
<h3 id="transifex-po">Transifex ç·šä¸Šæœå‹™è®“å¤šäººå…±åŒç¿»è­¯ po æª”</h3>
<p>æ•´å€‹ Sphinx æ–‡ä»¶ç¿»è­¯æµç¨‹å°±é€™æ¨£ï¼Œæ‰€ä»¥ç¿»è­¯åªè¦ç·¨è¼¯ä¸­æ–‡ (lang code: zh-Hant<sup id="fnref:zh-Hant"><a class="footnote-ref" href="#fn:zh-Hant">1</a></sup>) çš„ po æª”å°±å¥½äº†ã€‚ä¸éè¦ç›´æ¥å¯« po æª”æ ¼å¼é–€æª»é‚„æ˜¯å¤ªé«˜ï¼Œæ–¼æ˜¯å°±æœ‰åƒ <a href="https://www.transifex.com/">Transifex</a> é€™æ¨£çš„ç¶²ç«™ã€‚ä¸Šå‚³ po/pot æª”å°±èƒ½ç·šä¸Šä¿®æ”¹ç¿»è­¯ï¼Œç„¶å¾Œå†æŠŠç¿»å®Œçš„çµæœç”¨ po æª”æ ¼å¼ä¸‹è¼‰ä¸‹ä¾†ã€‚æˆ‘èªç‚ºé€™æ˜¯ç¾åœ¨åƒåŠ ä»¥ gettext-based PO æª”ç¿»è­¯é–€æª»æœ€ä½çš„æ–¹å¼ï¼Œè‡³å°‘æ—¥æœ¬ä¹Ÿæ˜¯é€™éº¼åšã€‚æ–¼æ˜¯æƒ³è¦åƒè€ƒ pydoc ç¿»è­¯çš„äººï¼Œåªè¦ç™»å…¥ Transifex å°±å¯ä»¥é–‹å§‹ç·¨è¼¯ã€‚</p>
<p>ç”¨ Transifex é‚„æœ‰é¡å¤–çš„å¥½è™•ã€‚ä¾‹å¦‚ä»–æœ‰ POS tagging å¯ä»¥æ¨™æ³¨å°ˆæœ‰åè©ï¼Œå®šç¾©çµ±ä¸€çš„è­¯åï¼Œé€™äº›è­¯åæœƒæ•´ç†åœ¨ glossary terms è£¡ï¼Œç¿»è­¯æ™‚å‡ºç¾é€™äº›è©å°±æœƒè‡ªå‹•æç¤ºã€‚é¡ä¼¼çš„åŸæ–‡æ–‡å¥ä¹Ÿæœƒæ”¾åœ¨ suggestion è£¡ï¼Œè®“ç¿»è­¯å®Œçš„ç”¨èªæ–‡æ³•ä¹Ÿèƒ½ä¸€è‡´ã€‚æ­¤å¤–ä¹Ÿæœ‰ä¿®æ”¹æ­·å²ã€é˜²å‘†æç¤ºï¼ˆå¦‚è©²æœ‰çš„æ ¼å¼æ²’åœ¨è­¯æ–‡å‡ºç¾ï¼‰ã€åŠ è¨»è§£ (comment)ã€è©•è«– (issue) ç­‰åŠŸèƒ½ã€‚</p>
<h3 id="_1">ç¿»è­¯é«”é©—æ”¹å–„</h3>
<p>é€™æ®µæ™‚é–“ç¿»è­¯çš„ç”¨è©ã€æµç¨‹ç­‰è¦ç¯„éƒ½æœ‰å€‹é››å‹äº†ï¼Œç›¸é—œçš„å…§å®¹éƒ½å¯ä»¥åœ¨<a href="https://github.com/python-doc-tw/python-doc-tw/wiki">å°ˆæ¡ˆçš„ wiki</a> è£¡æ‰¾åˆ°ã€‚æ‰€ä»¥é–‹å§‹æƒ³è¦æ€éº¼è®“å¤§å®¶æ›´å¥½åƒèˆ‡ç¿»è­¯å’Œçœ‹åˆ°ç¿»è­¯çš„çµæœã€‚</p>
<p>æˆ‘ç™¼ç¾åƒåŠ ç¿»è­¯æœ¬èº«å·²ç¶“ä¸å›°é›£ï¼Œå¤§å®¶æ²’ä»€éº¼ç–‘å•ã€‚ç¶­è­·æ•´é«”çš„ç”¨è©ã€ç¿»è­¯è¨è«–ç”¨ Transifex issue å’Œ comment æ•ˆæœä¸éŒ¯ã€‚æ•´é«”ä¸Šèƒ½ä¿æŒæ¥µåº¦åˆ†æ•£å¼çš„å·¥ä½œå½¢å¼ã€‚</p>
<p>å¹³å¸¸é‡åˆ°æœ€å¤šå•é¡Œæ˜¯å‡ºç¾ rst æ ¼å¼éŒ¯èª¤ã€ç¼ºå°‘å¿…è¦çš„ç©ºç™½ã€å‰å¾Œæ–‡åŠ ä¸Šç¨‹å¼ç¢¼ç¯„ä¾‹ä¹‹å¾Œä¸é€šé †ã€è­¯æ–‡æ›²è§£æˆ–èª¤æœƒåŸæ–‡çš„æ„æ€ã€‚é€™äº›å•é¡Œï¼Œæˆ‘è¦ºå¾—åªè¦è‡ªå·±è®€éç¿»å®Œçš„ pydoc è©²é ã€çœ‹ä¸€ä¸‹è¼¸å‡ºçš„ log å°±èƒ½æ˜ç™½ï¼Œä¹Ÿä¸éœ€è¦æˆ‘å¤šä½œè§£é‡‹ã€‚</p>
<p>å†ä¾†ï¼Œçœ‹ä¸åˆ°è‡ªå·±ç¿»è­¯çš„æˆæœ<strong>å¾ˆæ²’æœ‰æˆå°±æ„Ÿ</strong>ï¼Œéä¸€æ®µæ™‚é–“æˆ‘æ€•æœƒå¤±å»å‹•åŠ›ã€‚</p>
<p>æ–¼æ˜¯è®Šæˆéœ€è¦ä¸€ä»½ä¿æŒæ›´æ–°çš„ç¿»è­¯æˆæœã€‚ç•¶ç„¶è‡ªå·±è¼¸å‡º doc çš„æ–¹æ³•éƒ½æœ‰å¯«åœ¨ <a href="https://github.com/python-doc-tw/python-doc-tw/wiki/How-to-build-the-doc-locally">wiki</a> è£¡ï¼Œä½†æ­¥é©Ÿå¾ˆå¤šï¼Œèªªç°¡å–®ä¹Ÿæ²’å¤šç°¡å–®ï¼Œè€Œä¸”æœ‰éŒ¯æˆ–æœ‰å•é¡Œå¯èƒ½éƒ½è¦ä¾†æ‰¾æˆ‘ï¼Œå°±å¤±å»åˆ†æ•£å¼åˆ†å·¥çš„ç‰¹æ€§äº†ã€‚</p>
<p><strong>ä¸å¦‚åšå€‹ autobuild serverã€‚</strong></p>
<p>æ–¼æ˜¯æœ‰äº†é€™æƒ³æ³•ã€‚ä½†å¯¦åœ¨æ˜¯å€‹å¤§å‘ï¼Œä¸€ç›´åªèƒ½ç”¨æƒ³çš„ã€‚åœ¨éå¹´çš„æ™‚å€™ç¸½ç®—æ‰¾åˆ°æ™‚é–“æŠŠ prototype åšå‡ºä¾†äº†ï¼Œå…¶å¯¦è »æœ‰æˆå°±æ„Ÿçš„ã€‚</p>
<h2 id="pydoc-autobuild-server">PyDoc Autobuild Server</h2>
<p>ç°¡å–®æ•´ç†å¹¾å€‹éœ€æ±‚ï¼š</p>
<ul>
<li>PyDoc çµæœç¶²å€å°æ‡‰æœ¬å®¶ <a href="https://docs.python.org/">https://docs.python.org/</a>ã€‚ä¾‹å¦‚ /3/ å°±æ˜¯ Python 3.x ç‰ˆæœ€æ–°çš„ï¼Œè€Œç¾åœ¨ /3.5/ å°±æœƒè‡ªå‹•è½‰å€åˆ° /3/<sup id="fnref:pydoc-url"><a class="footnote-ref" href="#fn:pydoc-url">6</a></sup>ã€‚</li>
<li>æ¯ä¸€é éƒ½æœ‰å€‹æ›´æ–°ç¿»è­¯é€£çµï¼Œé»ä¸€ä¸‹å°±æœƒå¾ Transifex ä¸ŠæŠ“æ–°çš„ç¿»è­¯ï¼Œä¸¦æ›´æ–°è¼¸å‡ºã€‚</li>
<li>æ›´æ–°æ¯é ç¿»è­¯çš„æŒ‡ä»¤è¼¸å‡ºéƒ½è¦ä¿ç•™ï¼Œæ–¹ä¾¿æª¢æŸ¥ rst èªæ³•ç­‰éŒ¯èª¤ã€‚</li>
<li>æ›´æ–°ç¿»è­¯è¦æœ‰å€‹ queueï¼Œæ‰å¯ä»¥å¤šäººåˆä½œæ™‚ä¸ç‚¸æ‰ autobuild serverã€‚</li>
<li>æ¯æ—¥æ›´æ–°å…¨éƒ¨çš„æ–‡ä»¶ï¼Œä¸¦ä¸”æŠŠæ›´æ–°åŠ åˆ° CPython-tw çš„ git repo ä¸­ã€‚æ›´æ–°çš„éç¨‹ä¸€æ¨£è¦æœ‰è¨˜éŒ„ã€‚</li>
<li>ä¸Šè¿°çš„æ‰€æœ‰åŠŸèƒ½éƒ½èƒ½åœ¨æœ¬æ©Ÿè¼•é¬†åœ°è¨­å®šã€‚</li>
</ul>
<h3 id="_2">å¯¦ä½œ</h3>
<p>ç›®æ¨™å°±æ˜¯å®Œæˆä¸Šè¿°çš„éœ€æ±‚ã€‚pydoc åŸºæœ¬ä¸Šå°±æ˜¯å€‹ static siteï¼Œäº¤çµ¦ nginx è¨­å¥½è·¯å¾‘ host static files å°±å¯ä»¥ã€‚Pydoc Sphinx ç”¨ <a href="http://jinja.pocoo.org/docs/dev/">Jinja2</a> ä½œ HTML templateï¼Œæ‰€ä»¥åªè¦å¤šåŠ ä¸€äº›è®Šæ•¸å°±èƒ½æ§åˆ¶é é¢çš„è¼¸å‡ºï¼Œåœ¨ autobuild server ä¸Šæ™‚å°±å¯ä»¥åŠ ä¸Šé¡å¤–çš„é€£çµã€‚è€Œ Autobuild server æœ¬èº«æ˜¯å€‹ task queueï¼Œå…¶å¯¦åŠŸèƒ½å¾ˆç°¡å–®ï¼Œä½†ç‚ºäº†ç¶­è­·æ–¹ä¾¿ï¼Œä¸¦è€ƒæ…®åˆ° localã€production ç’°å¢ƒéƒ½è¦èƒ½å‹•çš„è©±ï¼Œé¸æ“‡ <a href="https://www.djangoproject.com/">Django</a> ç‚ºåŸºç¤ã€‚çœŸçš„çµ¦ Django ç®¡ç†çš„å°±é¡¯ç¤º task queueã€task resultã€æ¥å— rebuild doc request é€™å¹¾å€‹ viewã€‚</p>
<h4 id="sphinx_1">Sphinx æ–‡ä»¶</h4>
<p>åœ¨ Sphinx æ–‡ä»¶éƒ¨ä»½ä¸æƒ³æå¤ªè¤‡é›œï¼Œå°±åœ¨æ¯ä¸€é åŠ ä¸Šä¸€å€‹è‡ªå·±çš„å°ˆå±¬é€£çµï¼Œæ‰“é€™å€‹ç¶²å€å°±æœƒåŠ å…¥ä¸€å€‹æ›´æ–°è©²é é¢çš„ task åˆ° autobuild server<sup id="fnref:build-link"><a class="footnote-ref" href="#fn:build-link">2</a></sup>ã€‚</p>
<p>åœ¨ autobuild æ™‚åŠ å…¥å°ˆå±¬é€£çµåªè¦ä¿®æ”¹ Sphinx doc template å³å¯ã€‚Sphinx åœ¨ build doc æ™‚å¯ä»¥é€é <a href="http://www.sphinx-doc.org/en/stable/man/sphinx-build.html#options"><code>-A &lt;name=value&gt;</code></a> å¢åŠ  Jinja2 template çš„è®Šæ•¸ï¼Œå°±å¯æ§åˆ¶ template render è¡Œç‚ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c">{# &lt;cpython-src&gt;/Doc/tools/templates/layout.html #}</span>
<span class="cp">{%</span>- <span class="k">if</span> <span class="nv">autobuildi18n</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/_build/update/?source_path=</span><span class="cp">{{</span> <span class="nv">pagename</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>Update Translation<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span>- <span class="k">endif</span> <span class="cp">%}</span>
</code></pre></div>

<ul>
<li><code>sphinx-build -A autobuildi18n=1</code> æ™‚å°±æœƒåŒ…å«é€™å€‹ Jinja2 blockï¼Œå¤šé€™å€‹ Update Translation é€£çµã€‚</li>
<li><a href="http://www.sphinx-doc.org/en/stable/templating.html#pagename"><code>{{ pagename }}</code></a> æ˜¯æ¯é æ–‡ä»¶çš„ rst è·¯å¾‘ã€‚</li>
</ul>
<h4 id="autobuild-django-server">Autobuild Django server</h4>
<p>Django server ç›®æ¨™å°±æ˜¯æ¥å— task request å’Œé¡¯ç¤º task resultã€‚ä¸€å€‹æ¨™æº–çš„ task queue å°±æœ‰é€™äº›åŠŸèƒ½ã€‚</p>
<p>Django ä¸Šçš„ task queue é¸æ“‡å¾ˆå¤šï¼Œå¾ <a href="https://www.djangopackages.com/">Django Packages</a> ä¸Šçš„ <a href="https://www.djangopackages.com/grids/g/workers-queues-tasks/">Workers, Queues, and Tasks</a> ç›¸é—œçš„å¥—ä»¶å¯ä»¥çœ‹åˆ°æœ‰å¹¾å€‹æœ‰åœ¨æ›´æ–°è€Œä¸” up æ•¸å¤šçš„ï¼š</p>
<ul>
<li><a href="http://celery.github.io/django-celery/">django-celery</a></li>
<li><a href="http://huey.readthedocs.org/en/latest/">huey</a></li>
<li><a href="https://github.com/ui/django-rq">django-RQ</a></li>
<li><a href="http://policystat.github.io/jobtastic/">jobtastic</a></li>
<li><a href="https://django-q.readthedocs.org/">django-Q</a></li>
</ul>
<p>æ‰£æ‰ä¸æ”¯æ´ Python 3 çš„å¥—ä»¶<sup id="fnref:python3"><a class="footnote-ref" href="#fn:python3">3</a></sup>å¾Œï¼Œå°±å‰© django-celeryã€django-RQã€django-Q å¯ä»¥é¸ã€‚é€™è£¡é¢æœ€ç´…ä¹Ÿæœ€è€ç‰Œçš„æ˜¯ django-celery ï¼Œå®ƒèˆ‡ <a href="http://www.celeryproject.org/">Celery</a> æ•´åˆï¼ŒåŠŸèƒ½å®Œæ•´ä¸”ç©©å®šï¼Œæˆ‘ç”¨éä¹Ÿè¦ºå¾—ååˆ†ä¸éŒ¯ï¼Œç¼ºé»æ˜¯åŠŸèƒ½å¤ªå¤šæœ‰é»è¤‡é›œï¼ŒåŠ ä¸Šä¸åŒ message queue æ™‚æœƒæœ‰å¾ˆå¤šè¨­å®šè¦èª¿æ•´ï¼Œéœ€è¦ä¸€æ®µæ™‚é–“ä¸Šæ‰‹ã€‚ä¸€èˆ¬ Celery å¸¸è¦‹çš„æ­é…ä½¿ç”¨ <a href="https://www.rabbitmq.com/">Rabbit-MQ</a> å’Œ <a href="http://redis.io/">Redis</a>ï¼Œçš„ç¢ºåœ¨ task å¾ˆå¤šæ™‚æœ‰å¿…è¦ï¼Œä½†æˆ‘å€‘é€™å€‹ build doc ä¸€å¤©å¯èƒ½æ‰åå¹¾æ¬¡ï¼Œåœ¨ä¸éš”é›¢ build doc ç’°å¢ƒçš„æƒ…æ³åŒæ™‚é–“çš„ worker åªèƒ½æœ‰ä¸€å€‹ï¼Œä¸æœƒæœ‰æ•ˆèƒ½ä¸Šçš„å•é¡Œã€‚å› æ­¤æˆ‘å‚¾å‘åªè¦ä½¿ç”¨èˆ‡ Django åŒä¸€å€‹ database å°±å¥½ï¼Œä¸è¦å†æœ‰é¡å¤–é Python çš„ dependencyï¼Œè®“ local é–‹ç™¼ç°¡å–®ä¸€é»ã€‚</p>
<p>æœ€å¾Œé¸æ“‡ <a href="https://django-q.readthedocs.org/">django-Q</a>ã€‚é›–ç„¶å¾ˆæ–°ä½†ä½œè€…ç¶­è­·å¾—å¾ˆå‹¤ï¼Œworker å¯ä»¥åªç”¨ Python å…§å»ºçš„ multiprocessing å®Œæˆã€‚åŠŸèƒ½ç°¡å–®å»å®Œæ•´ï¼ŒåŒ…å« monitorï¼Œè·Ÿ django-admin æ•´åˆï¼Œé‚„å¯ä»¥æ’ç¨‹ã€‚æ‰€ä»¥è¦å•Ÿå‹• django-Q çš„ clusterï¼Œåªè¦å¤šä¸€å€‹ </p>
<div class="highlight"><pre><span></span><code>python manage.py qcluster
</code></pre></div>

<p>å³å¯ï¼Œååˆ†æ–¹ä¾¿ã€‚</p>
<p>æ€éº¼ä½¿ç”¨ django-Q å°±ä¸åœ¨é€™ç¯‡ blog è¨è«–ç¯„åœå…§äº†ã€‚æˆ‘æƒ³æˆ‘æ‡‰è©²æœƒæŠ•ç¨¿ PyCon TW æˆ– Taipei.pyï¼Œåˆ°æ™‚å€™å†æ•´ç†æˆå¦ä¸€ç¯‡ã€‚Django-Q çš„èªªæ˜æ–‡ä»¶å¯«å¾—å¾ˆæ¸…æ¥šï¼Œè®€ä¸€è®€æ‡‰è©²å°±æœƒäº†ã€‚</p>
<h2 id="autobuild-server">Autobuild server éƒ¨ç½²</h2>
<p>ï¼ˆé€™ç¯‡æ–‡çš„é‡é»å…¶å¯¦æ˜¯éƒ¨ç½²ï¼Œèª°æ›‰å¾—èƒŒæ™¯ä»‹ç´¹å¯ä»¥é€™éº¼é•·ï¼‰</p>
<p>éƒ¨ç½² (deploy) æ–¹æ³•ç™¾ç™¾ç¨®ï¼Œæœ‰å¥½æœ‰å£ã€‚ä½†è‡³å°‘è¦æœƒä¸€ç¨®å˜›ï¼Œæ‰€ä»¥é€™é‚Šå°±ç”¨å…¶ä¸­ä¸€ç¨®ï¼š</p>
<blockquote>
<p>nginx &lt;-&gt; uwsgi &lt;-&gt; Django</p>
</blockquote>
<p>ä¹Ÿç®—å¾ˆæµè¡Œçš„çµ„åˆã€‚æ›´å®Œæ•´åœ°ä¾†èªªï¼Œæ•´å€‹è™•ç† request çš„æµç¨‹ç¶“éï¼š</p>
<blockquote>
<p>web client &lt;-&gt; nginx web server &lt;-&gt; socket &lt;-&gt; uwsgi &lt;-&gt; Django server</p>
</blockquote>
<p>åŸºæœ¬çš„è¨­å®šèˆ‡æ•™å­¸ä¾†è‡ª <a href="http://uwsgi-docs.readthedocs.org/en/latest/index.html">uWSGI</a> å®˜ç¶²çš„ <a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html"><em>Setting up Django and your web server with uWSGI and nginx</em></a> ä¸€æ–‡ï¼Œæ­é… <a href="http://uwsgi-docs.readthedocs.org/en/latest/Systemd.html"><em>uWGSI and Systemd</em></a> èˆ‡ <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a> æ•´åˆã€‚</p>
<p>é€™ä¹Ÿæ˜¯ç›®å‰ Pydoc production çš„è¨­å®šï¼Œè¨˜éŒ„ä¸€ä¸‹æ–¹ä¾¿æœªä¾†çš„ç¶­è­·ã€‚</p>
<h3 id="_3">ä½œæ¥­ç³»çµ±</h3>
<p>ä½œæ¥­ç³»çµ±ç”¨ Debian Jessieï¼Œæ¶è¨­æ–¼ Amazon EC2 ä¸Šï¼Œä½¿ç”¨ t2.nano<sup id="fnref:ec2-nano"><a class="footnote-ref" href="#fn:ec2-nano">4</a></sup>ã€‚</p>
<p>Python web deploy éƒ½æœƒæŠŠå¥—ä»¶è£åœ¨è™›æ“¬ç’°å¢ƒä¸­ï¼Œé¿å…ä¸åŒå°ˆæ¡ˆé–“äº’è¡æˆ–èˆ‡ç³»çµ±è¡çªã€‚åœ¨ Debian ä¸Šå¯ä»¥ç”¨ <code>apt buid-dep python3-&lt;pkg&gt;</code> æŠŠ Python <pkg> å¥—ä»¶æ‰€éœ€çš„ header æˆ– library å®‰è£å¥½ï¼Œååˆ†ç°¡å–®ã€‚</p>
<h4 id="python-35-and-apt-pinning">Python 3.5 and APT-pinning</h4>
<p>æˆ‘çš„ code è£¡ç”¨åˆ°äº† <a href="https://docs.python.org/3/library/subprocess.html#subprocess.run"><code>subprocess.run</code></a>ï¼Œé€™æ˜¯ Python 3.5+ æ‰æœ‰çš„ APIã€‚ä½† Jessie åªæœ‰ Python 3.4ï¼Œä½†æˆ‘è¦ºå¾—å¾ˆå¥½ç”¨ä¸€é»éƒ½ä¸æƒ³æ”¹å¯«æˆç›¸å®¹èˆŠç‰ˆçš„ codeã€‚</p>
<p>å› æ­¤éœ€è¦å®‰è£ Debian testing channel ä¸Šæœ€æ–°çš„ Python 3.5ã€‚é€™æ¨£å…¶å¯¦æœ‰å®‰å…¨ä¸Šçš„ç–‘æ…®ï¼Œå› ç‚ºåªæœ‰ stable channel æ‰æœ‰ security supportï¼Œä½†è‡ªå·±ç·¨è­¯çš„å•é¡Œæ›´å¤§ï¼Œæ‰€ä»¥åƒ <a href="https://github.com/yyuu/pyenv">pyenv</a> é€™ç¨®å¤š Python ç‰ˆæœ¬çš„å·¥å…·ä¸åœ¨è€ƒæ…®å…§ã€‚</p>
<p>æ–¼æ˜¯ç”¨ <a href="https://wiki.debian.org/AptPreferences">Apt-Pinning</a> åªè®“ Python 3.5 ç›¸é—œçš„å¥—ä»¶å®‰è£ testing çš„ç‰ˆæœ¬ã€‚é¦–å…ˆæŠŠ testing channel åŠ åˆ° <code>/etc/apt/source.list</code></p>
<div class="highlight"><pre><span></span><code>deb http://cloudfront.debian.net/debian testing main
deb-src http://cloudfront.debian.net/debian testing main
deb http://security.debian.org/ testing/updates main
deb-src http://security.debian.org/ testing/updates main
</code></pre></div>

<p>ç„¶å¾Œä¿®æ”¹ <code>/etc/apt/preferences</code> ç¢ºå®šæˆ‘å€‘ä¸æœƒä¸å°å¿ƒè£åˆ° testing ç›¸é—œçš„å¥—ä»¶ï¼Œä¸¦æŠŠ Python 3.5 ç›¸é—œçš„å¥—ä»¶è¨­å®šæ¬Šé™ &gt;= 990 è®“å®ƒå€‘èƒ½è¢«è‡ªå‹•å®‰è£ã€‚</p>
<div class="highlight"><pre><span></span><code># Specify * rules first so later package-specfic rules can override them
Package: *
Pin: release a=testing
Pin-Priority: -10

Package: python3.5* libpython3.5*
Pin: release a=testing
Pin-Priority: 990
</code></pre></div>

<p>å¯ä»¥ç”¨ <code>sudo apt-cache policy &lt;pkg-name&gt;</code> æª¢æŸ¥ç›®å‰çš„è¦å‰‡æœƒè£åˆ°å“ªå€‹ç‰ˆæœ¬ã€‚</p>
<div class="highlight"><pre><span></span><code>$ sudo apt-get update 
$ sudo apt-get install python3.5 python3.5-venv python3.5-dev
</code></pre></div>

<p>é€™æ¨£åªæœ‰ Python 3.5 ç›¸é—œçš„å¥—ä»¶æ‰æœƒè£åˆ° testingã€‚</p>
<h4 id="postgresql">è³‡æ–™åº« PostgreSQL</h4>
<p>è³‡æ–™åº«ç”¨ PostgreSQL 9.4ã€‚åƒç…§ä¹‹å‰ blog<a href="https://blog.liang2.tw/posts/2016/01/postgresql-install/">ã€Šå®‰è£ PostgreSQL 9 æ–¼ Debian Jessie / OSXã€‹</a>ä¸€æ–‡è¨­å®šã€‚</p>
<h4 id="swap">Swap</h4>
<p>å…¶å¯¦æ˜¯ä¸Šç·šä¸ä¹…æ‰æ³¨æ„åˆ° EC2 é è¨­æ²’æœ‰ swap ç©ºé–“ã€‚æˆ‘å¾ˆçª®æ‰€ä»¥ production server çš„ RAM åªæœ‰ 512 MBï¼Œè§€å¯Ÿä¸€ä¸‹æœ‰æ™‚å€™ build doc RAM å°±å…¨æ»¿äº†ï¼Œæ‰€ä»¥é‚„æ˜¯åŠ å€‹ swap å®‰å¿ƒä¸€é»ã€‚</p>
<p>å› ç‚º Amazon EBS SSD I/O æ•¸ä¸æœƒå¦å¤–æ”¶éŒ¢ï¼ˆæ‡‰è©²å§ï¼Ÿï¼‰ï¼Œå°±å»º swap file åœ¨ä¸»ç¡¬ç¢Ÿè£¡ã€‚</p>
<p>Swap è¨­å®šçš„æ•™å­¸å¾ˆå¤šï¼Œé€™é‚Šå°±åƒè€ƒ <a href="https://wiki.archlinux.org/index.php/swap">Arch Wiki</a> ä¸Šçš„åšæ³•ï¼Œæˆ‘é¸æ“‡æ”¾åœ¨ <code>/var/swap.1</code>ã€‚å¤§å°è¨­å®šç‚º RAM çš„ 2 å€ï¼Œå³ 1GBã€‚</p>
<p>é¦–å…ˆæŠŠé€™å€‹æª”æ¡ˆå»ºå‡ºä¾†ï¼Œæ¬Šé™æ”¹ç‚º 600ã€‚</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>/bin/dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/var/swap.1<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">1024</span>
<span class="c1"># or faster with fallocate</span>
sudo<span class="w"> </span>fallocate<span class="w"> </span>-l<span class="w"> </span>1G<span class="w"> </span>/var/swap.1
</code></pre></div>

<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>/var/swap.1
</code></pre></div>

<p>å†ä¾†æŠŠé€™å€‹æª”æ¡ˆæ”¹æˆ swap æ ¼å¼ä¸¦å•Ÿç”¨å®ƒï¼Œ</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>/sbin/mkswap<span class="w"> </span>/var/swap.1
sudo<span class="w"> </span>/sbin/swapon<span class="w"> </span>/var/swap.1
</code></pre></div>

<p>ä¿®æ”¹ fstab è®“æ¯æ¬¡é–‹æ©Ÿéƒ½æœ‰é€™å€‹ swap è¨­å®šï¼Œ</p>
<div class="highlight"><pre><span></span><code># /etc/fstab
/var/swap.1 none swap defaults 0 0
</code></pre></div>

<p>ç”¨ <code>free -h</code>ã€<code>cat /proc/meminfo</code> æª¢æŸ¥æ­¤æ™‚æ‡‰è©²æœ‰å€‹ 1GB swap äº†ã€‚</p>
<h4 id="git-repo-ssh-config">Git repo ssh config</h4>
<p>å†ä¾†æ˜¯ code çš„åŒæ­¥èˆ‡æ›´æ–°ã€‚autobuild server åªè¦æ›´æ–° source codeï¼Œä½† cpython-tw source éœ€è¦å®šæ™‚ commit æ–°çš„ç¿»è­¯ï¼Œå› æ­¤ deploy server æœƒæœ‰ä¿®æ”¹ git repo çš„æ¬Šé™ã€‚</p>
<p>ä¸æ‡‰è©²ä½¿ç”¨è‡ªå·±çš„ SSH keyï¼Œdeploy server ä¸Šæ‡‰è©²æœ‰å°ˆå±¬çš„ deploy keyï¼Œå…¶ä¸­ cpython-tw çš„ deploy key æœ‰å¯«å…¥æ¬Šé™ï¼ˆå³å¯ä»¥ commitï¼‰ã€‚</p>
<p>æŸ¥äº†ä¸€ä¸‹ï¼Œè¦è®“ä¸åŒ git repo ä½¿ç”¨ä¸åŒçš„ SSH key ä¹Ÿä¸è¤‡é›œã€‚ä»¥é€™é‚Šçš„ä¾‹å­ï¼Œå…ˆä¿®æ”¹ <code>~/.ssh/config</code> åŠ å…¥å…©å€‹æ–°çš„ hostï¼Œä½¿ç”¨ä¸åŒçš„ SSH keyï¼š</p>
<div class="highlight"><pre><span></span><code>Host github-pydoc_autobuild
  HostName github.com
  User git
  IdentityFile /home/pydoc/.ssh/id_rsa.pydoc_autobuild

Host github-cpython_tw
  HostName github.com
  User git
  IdentityFile /home/pydoc/.ssh/id_rsa.cpython_tw
</code></pre></div>

<p>å»ºç«‹å°æ‡‰çš„ SSH keypairï¼Œ</p>
<div class="highlight"><pre><span></span><code>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-f<span class="w"> </span>~/.ssh/id_rsa.pydoc_autobuild
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-f<span class="w"> </span>~/.ssh/id_rsa.cpython_tw
</code></pre></div>

<p>æŠŠå…©å€‹ repo çš„ URL host æ›æ‰ï¼Œ</p>
<div class="highlight"><pre><span></span><code>git remote set-url origin git@github-pydoc_autobuild:python-doc-tw/pydoc_autobuild.git
</code></pre></div>

<p>é€™æ¨£å…©å€‹ repo æœƒé€éçµ¦å®šçš„ ssh key é€£ç·šã€‚GitHub æœƒé¡¯ç¤ºæ¯å€‹ key æœ€è¿‘ä½¿ç”¨çš„æ™‚é–“ï¼Œæª¢æŸ¥æ™‚é–“å°±èƒ½ç¢ºèªè¨­å®šæ­£ç¢ºèˆ‡å¦ï¼ˆè€Œä¸”æ”¹ host æ²’è¨­å®šå°æ‡‰è©²ç›´æ¥é€£ä¸ä¸Šï¼‰ã€‚</p>
<h4 id="tmpfilesd">tmpfiles.d</h4>
<p>ä¹‹å¾Œ nginx å’Œ uwsgi æºé€šç”¨çš„ socket æ‰“ç®—æ”¾åœ¨ <code>/run/django/xxxx.sock</code> <sup id="fnref:/run"><a class="footnote-ref" href="#fn:/run">5</a></sup>ã€‚å› ç‚ºåªéœ€è¦é root çš„æ¬Šé™ï¼Œä¿®æ”¹ <a href="https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html">tmpfiles.d</a> çš„è¨­å®šï¼Œè®“é€™å€‹è³‡æ–™å¤¾èƒ½åœ¨é–‹æ©Ÿæ™‚è‡ªå‹•å»ºç«‹ã€‚å¢åŠ è¨­å®šæª” <code>/etc/tmpfiles.d/pydoc_autobuild.conf</code></p>
<div class="highlight"><pre><span></span><code>d /run/django 0755 pydoc www-data
</code></pre></div>

<h3 id="django-stack-nginx-uwsgi">Django Stack &ndash; nginx + uWSGI</h3>
<p>åœ¨æœ¬åœ°é–‹ç™¼éƒ½ç”¨ <code>python manage.py runserver</code> å•Ÿå‹• Djangoã€‚ä½†ä¸Šç·šæ™‚å…§å»ºçš„ runserver å°±ç„¡æ³•åŒæ™‚é–“æœå‹™å¤ªå¤šäººã€‚å› æ­¤éœ€è¦åƒ nginxã€uWSGI ç­‰å·¥å…·ä¾†å”åŠ©ã€‚</p>
<p>åƒç…§ uWSGI <a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html"><em>Setting up Django and your web server with uWSGI and nginx</em></a> ä¸€æ–‡ä»¥åŠ TP å¯«çš„ ã€Šç‚ºç¨‹å¼äººå¯«çš„ Django Tutorialã€‹ç³»åˆ—æ–‡ä¸­ <a href="https://github.com/uranusjr/django-tutorial-for-programmers/blob/master/25-deploy-to-ubuntu-server.md"><em>Day 27 - Deploy to Ubuntu server</em></a> é—œæ–¼éƒ¨ç½²çš„æ–‡ç« ã€‚</p>
<p>Autobuild server æœ‰ç‰¹åˆ¥ç‚º production å¯«ä¸€ä»½è¨­å®šæª”ï¼Œåˆ‡æ›æ™‚åªè¦è¨­å®šæˆ <code>settings.production</code> å³å¯ã€‚åœ¨ Django è¨­å®šéƒ¨ä»½ï¼Œå»ºè­°æŠŠæ‰€æœ‰è·¯å¾‘éƒ½è¨­æˆçµ•å°è·¯å¾‘ï¼ˆåŒ…å«åŸ·è¡Œæª”ï¼‰ã€‚ä¸ç„¶å¾ŒçºŒåœ¨è¨­å®š systemd è¦èª¿æ•´å¾ˆå¤šç’°å¢ƒè®Šæ•¸ï¼Œsystemd ä¹Ÿä¸æœƒå¸¶å…¥ä½¿ç”¨è€…çš„ PATH è®Šæ•¸ï¼Œä¸ç”¨çµ•å°è·¯å¾‘å…¶å¯¦è »éº»ç…©çš„ä¹Ÿå®¹æ˜“éŒ¯ã€‚</p>
<h4 id="nginx">nginx è¨­å®š</h4>
<p>nginx æœƒæ¥å— incoming HTTP requestï¼Œéœ€è¦è·Ÿ Django server è¯çµ¡æ™‚ï¼Œå°±æœƒæœƒé€£åˆ° uWSGI é–‹çš„ UNIX socketã€‚</p>
<p>æˆ‘å€‘å…ˆå‡è¨­ uWSGI é€™æ®µæ²’å•é¡Œï¼Œé¦–å…ˆè¨­å®š nginx æœ¬èº«ã€‚ç”±æ–¼ static files åœ¨ nginx å°±ç›´æ¥å°åˆ°å°æ‡‰çš„æª”æ¡ˆï¼Œä¸æœƒç¶“é uWSGI ï¼Œæ‰€ä»¥è¨­å®šå¥½ nginx ä¹‹å¾Œ pydoc æ–‡ä»¶æœ¬èº«å°±ä¸Šç·šäº†ã€‚ç”¨é€™å€‹ä¾†æ¸¬è©¦è¨­å®šçš„æ­£ç¢ºæ€§ã€‚</p>
<p>å°æœ¬ç¶²ç«™è€Œè¨€ï¼Œ/static å°åˆ° Django staticfilesï¼›/3/ã€/3.5/ å°åˆ° pydoc build HTML çš„è·¯å¾‘ï¼›å…¶é¤˜è·¯å¾‘å†äº¤çµ¦ Django è™•ç†ã€‚å…¶ä¸­ï¼Œ/3.5/* çš„é€£çµå°‡é‡æ–°å°å‘åˆ° /3/* ä¸Šã€‚</p>
<p>æ•´ç†ä¸Šè¿°çš„éœ€æ±‚ï¼Œå¯«å€‹ nginx è¨­å®šæª”åœ¨ <code>/etc/nginx/sites-available/pydoc_autobuild.conf</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Upstream Django setting; the socket nginx connects to</span>
<span class="k">upstream</span><span class="w"> </span><span class="s">django</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="s">unix:///run/django/pydoc_autobuild.sock</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w">      </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">listen</span><span class="w">      </span><span class="mi">443</span><span class="w"> </span><span class="s">default</span><span class="w"> </span><span class="s">ssl</span><span class="p">;</span>

<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">docs.python.org.tw</span>
<span class="w">                </span><span class="mi">52</span><span class="s">.69.170.26</span>
<span class="w">                </span><span class="p">;</span>
<span class="w">    </span><span class="kn">charset</span><span class="w">     </span><span class="s">utf-8</span><span class="p">;</span>

<span class="w">    </span><span class="kn">client_max_body_size</span><span class="w"> </span><span class="s">10M</span><span class="p">;</span><span class="w">  </span><span class="c1"># max upload size</span>
<span class="w">    </span><span class="kn">keepalive_timeout</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/static</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">alias</span><span class="w"> </span><span class="s">/path/to/code/pydoc_autobuild/assets</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/3</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">alias</span><span class="w"> </span><span class="s">/path/to/code/cpython-tw/Doc/build/html</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">/3\.5/(.*)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">return</span><span class="w"> </span><span class="mi">302</span><span class="w"> </span><span class="s">/3/</span><span class="nv">$1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Finally, send all non-media requests to the Django server.</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">uwsgi_pass</span><span class="w">  </span><span class="s">django</span><span class="p">;</span>
<span class="w">        </span><span class="kn">include</span><span class="w">     </span><span class="s">/etc/nginx/uwsgi_params</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>å†æŠŠæª”æ¡ˆ soft link åˆ° <code>/etc/nginx/sites-enabled/</code>ï¼Œæ›´æ–° nginx è¨­å®šï¼š</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/etc/nginx/sites-available/
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>pydoc_autobuild.conf<span class="w"> </span>../sites-enabled/
sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>nginx
</code></pre></div>

<p>ç¢ºå®š pydoc ä¸Šç·šå°±å¯ä»¥å°ˆå¿ƒè™•ç† uWSGI äº†ã€‚</p>
<h4 id="uwsgi">uWSGI è¨­å®š</h4>
<p>uWSGI åœ¨ VENV å¤–ä¹Ÿè¦è£ï¼Œæˆ‘è¦ºå¾—é‚„æ˜¯ç”¨ pip æ¯”è¼ƒç°¡å–®ï¼Œé›–ç„¶é€™æ¨£å°±è¦è‡ªå·±æ³¨æ„ uWSGI çš„ç‰ˆæœ¬æ›´æ–°äº†ï¼š</p>
<div class="highlight"><pre><span></span><code>sudo python3.5 -m pip install uwsgi
</code></pre></div>

<p>æŠŠ uWSGI è¨­å®šå­˜æˆ <code>pydoc_autobuild_uwsgi.ini</code> ä¸¦ä¸”åœ¨æ¸¬è©¦æ™‚ï¼Œéƒ½ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre><span></span><code>sudo uwsgi --ini pydoc_autobuild_uwsgi.ini
</code></pre></div>

<p>æ¨¡æ“¬å¯¦éš›ä¸Šçš„åŸ·è¡Œæ–¹å¼ï¼Œé€™æ¨£ä¹‹å¾Œæ”¹ç”¨ systemd åŸ·è¡Œæ‰ä¸æœƒåˆä¸Ÿä¸€å †æ¬Šé™çš„å•é¡Œã€‚è¨­å®šæª”çš„å…§å®¹ï¼š</p>
<div class="highlight"><pre><span></span><code>[uwsgi]
chdir        = /path/to/code/pydoc_autobuild
# Django&#39;s wsgi file
module       = pydoc_autobuild.wsgi:application
env          = DJANGO_SETTINGS_MODULE=pydoc_autobuild.settings.production
# the virtualenv (full path)
home         = /path/to/VENV

# process-related settings
# master
master       = true
# maximum number of worker processes
processes    = 4
# the socket (use the full path to be safe
socket       = /run/django/pydoc_autobuild.sock
# ... with appropriate permissions - may be needed
chmod-socket = 664
uid          = pydoc
gid          = www-data
# clear environment on exit
vacuum       = true
</code></pre></div>

<p>æ¬Šé™ä¸Šçš„è¨­å®šå¯èƒ½è¦èŠ±é»æ™‚é–“è™•ç†ä¸€ä¸‹ï¼Œnginx ä½¿ç”¨ www-data/www-data çš„èº«ä»½åŸ·è¡Œï¼Œsocket è¦ç¢ºå®š nginx èƒ½è®€å¯«ï¼Œä½†æˆ‘çš„ code æ”¾åœ¨ pydoc ä½¿ç”¨è€…è·¯å¾‘ä¸‹ï¼Œç”¨ www-data å¯èƒ½æœƒæœ‰æ¬Šé™çš„å•é¡Œã€‚å»ºè­°æŠŠ uidã€gid éƒ½è¨­å®šå¥½ã€‚</p>
<p>éç¨‹ä¸­ï¼Œæ­é… nginx çš„éŒ¯èª¤è¨Šæ¯æ¯”è¼ƒå¥½ debugï¼š</p>
<div class="highlight"><pre><span></span><code>sudo less +F /var/log/nginx/error.log
</code></pre></div>

<p>æˆåŠŸå¾Œï¼Œå†ç”¨ uWSGI çš„ Emperor modeï¼ŒæŠŠè¨­å®šæª”ä¸Ÿåˆ°ä¸€å€‹è·¯å¾‘åº•ä¸‹ï¼ˆè©²è·¯å¾‘ç¨±ç‚º vassalsï¼‰ã€‚uWSGI åœ¨ Emperor mode æ™‚æœƒè‡ªå‹•æŠŠ vassals è·¯å¾‘å…§æ‰€æœ‰è¨­å®šæª”éƒ½è®€é€²ä¾†ä¸¦åŸ·è¡Œã€‚</p>
<p>é€™è£¡ vassals è·¯å¾‘ä½¿ç”¨ <code>/etc/uwsgi/vassals/</code>ã€‚å› ç‚ºæœ‰è¨­ uidã€gidï¼Œè·‘çš„æ™‚å€™å°±ä¸ç”¨å†è¨­äº†ï¼š</p>
<div class="highlight"><pre><span></span><code>sudo uwsgi --emperor /etc/uwsgi/vassals
</code></pre></div>

<p>é€™æ¨£æ‡‰è©² Django ç›¸é—œçš„ view éƒ½æ²’å•é¡Œäº†ã€‚æ¥ä¸‹ä¾†ï¼Œè¦æŠŠå•Ÿå‹• uWSGI çš„æ­¥é©Ÿäº¤çµ¦ç³»çµ±ä¾†ç®¡ç†ã€‚</p>
<h3 id="systemd-services">Systemd services</h3>
<p>Autobuild server åŒ…å«å…©å€‹éƒ¨ä»½ï¼šDjango Server èˆ‡ Django-Q clusterã€‚æ‰€ä»¥å¯«æˆ systemd service æ™‚æœƒæœ‰å…©å€‹æœå‹™ã€‚</p>
<p>Debian system service æ”¾åœ¨ <code>/etc/systemd/system/</code> åº•ä¸‹ï¼Œå› æ­¤å»ºç«‹ <code>uwsgi.service</code> å’Œ <code>qcluster.service</code> åˆ†åˆ¥ç®¡ç† uWSGI Emperor mode å’Œ Django-Q clusterã€‚</p>
<p><code>uwsgi.service</code> åƒè€ƒ uWSGI å®˜ç¶² <a href="http://uwsgi-docs.readthedocs.org/en/latest/Systemd.html"><em>Django and Systemd</em></a> ä¸€æ–‡çš„è¨­å®šï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">uWSGI Emperor</span>
<span class="na">After</span><span class="o">=</span><span class="s">syslog.target</span>

<span class="k">[Service]</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/local/bin/uwsgi --emperor /etc/uwsgi/vassals</span>
<span class="na">RuntimeDirectory</span><span class="o">=</span><span class="s">uwsgi</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">KillSignal</span><span class="o">=</span><span class="s">SIGQUIT</span>
<span class="na">Type</span><span class="o">=</span><span class="s">notify</span>
<span class="na">StandardError</span><span class="o">=</span><span class="s">syslog</span>
<span class="na">NotifyAccess</span><span class="o">=</span><span class="s">all</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>

<p><code>qcluster.service</code> ç®—æ˜¯è‡ªå·±ç¡¬å¯«æ¨¡æ“¬ <code>python manage.py qcluster</code> è¡Œç‚ºã€‚å› æ­¤ç’°å¢ƒè®Šæ•¸éƒ½è¦è¨­å®šå¥½ï¼ˆç•¶ç„¶ç”¨çµ•å°è·¯å¾‘å°±æ²’å•é¡Œäº†ï¼Œæˆ‘åªæ˜¯è¦ºå¾—é€™æ¨£ build log å…§çš„åŸ·è¡Œæª”è·¯å¾‘éƒ½å¾ˆé•·æœƒå¾ˆé†œ xdï¼‰</p>
<div class="highlight"><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">Django-Q Cluster for site pydoc_autobuild</span>
<span class="na">After</span><span class="o">=</span><span class="s">syslog.target</span>
<span class="na">Wants</span><span class="o">=</span><span class="s">uwsgi.service</span>

<span class="k">[Service]</span>
<span class="na">User</span><span class="o">=</span><span class="s">pydoc</span>
<span class="na">Group</span><span class="o">=</span><span class="s">www-data</span>
<span class="na">Environment</span><span class="o">=</span><span class="s">VIRTUAL_ENV=/path/to/VENV</span>
<span class="na">Environment</span><span class="o">=</span><span class="s">PATH=/path/to/VENV/bin:$PATH</span>
<span class="na">Environment</span><span class="o">=</span><span class="s">DJANGO_SETTINGS_MODULE=pydoc_autobuild.settings.production</span>
<span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/path/to/code/pydoc_autobuild</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/path/to/VENV/bin/python manage.py qcluster</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">KillSignal</span><span class="o">=</span><span class="s">SIGQUIT</span>
<span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="na">NotifyAccess</span><span class="o">=</span><span class="s">none</span>
<span class="na">StandardError</span><span class="o">=</span><span class="s">syslog</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>

<p>é€™æ¨£çš„è¨­å®šæª”æ‡‰è©²ä¸æ˜¯ systemd çš„æ…£ä¾‹ï¼Œæˆ‘é‚„åœ¨æƒ³æ˜¯ä¸æ˜¯æ‡‰è©²è¦æ”¹å¯«åˆ° user service å»ï¼ˆä½†æˆ‘ä¸æœƒï¼‰ã€‚</p>
<p>åŠ å…¥åˆ° systemd ä¹‹å¾Œç®¡ç†å°±å¾ˆç°¡å–®ï¼Œå•Ÿå‹•é€™å…©å€‹ serviceï¼š</p>
<div class="highlight"><pre><span></span><code>sudo systemctl enable uwsgi
sudo systemctl enable qcluster
</code></pre></div>

<p>æŸ¥çœ‹ä»–å€‘çš„ç‹€æ…‹ï¼š</p>
<div class="highlight"><pre><span></span><code>sudo systemctl status uwsgi
sudo systemctl status qcluster
</code></pre></div>

<p>æŸ¥çœ‹å®ƒå€‘çš„ log ä¹Ÿè®Šå¾—å¾ˆç°¡å–®ï¼Œå› ç‚ºæœ‰æŠŠå®ƒå€‘çš„ stderr æŠ“èµ·ä¾†ã€‚systemd å¥½è™•æ˜¯ rotation ç­‰ç­‰éƒ½æœƒå¹«ä½ æ³¨æ„ï¼Œçœ‹ log çš„åŠŸèƒ½ä¹Ÿå¾ˆå¤šã€‚</p>
<p>ä¾‹å¦‚è¦æŸ¥æœ€è¿‘ä¸€å°æ™‚ uWSGI çš„é€£ç·šè¨˜éŒ„ï¼Œä¸¦åœ¨æœ‰æ–°é€£ç·šæ™‚æŒçºŒæ›´æ–° logï¼š</p>
<div class="highlight"><pre><span></span><code>sudo journalctl -xef -u uwsgi --since &#39;1 hour ago&#39;
</code></pre></div>

<h2 id="_4">ç¸½çµ</h2>
<p>ä»‹ç´¹äº† <a href="https://github.com/python-doc-tw/python-doc-tw">Python èªªæ˜æ–‡ä»¶ç¿»è­¯è¨ˆç•«</a>ï¼Œç·šä¸Šæ–‡ä»¶autobuild server åŸºæ–¼ Django èˆ‡ Django-Q çš„æ¶æ§‹ï¼Œä»¥åŠåœ¨ Debian ä¸Šçµåˆ nginxã€uWSGIã€systemd çš„éƒ¨ç½²è¨­å®šã€‚</p>
<p>æŸ¥è³‡æ–™æ™‚è¦ºå¾—æ–‡ç« é‚„ä¸å¤šï¼Œåªæœ‰å¹¾ç¯‡åƒ <a href="https://luxagraf.net/src/how-set-django-uwsgi-systemd-debian-8"><em>How to Set Up Django with Nginx, uWSGI &amp; systemd on Debian/Ubuntu</em></a> çš„æ–‡ç« ï¼Œå‰©ä¸‹è¦è‡ªå·±çµ„è£é‚„æ˜¯è¦èŠ±ä¸€é»æ™‚é–“ã€‚åŒæ™‚ä¹ŸæŠŠéƒ¨ç½² pydoc server çš„è¨­å®šéƒ½è¨˜åœ¨é€™ï¼Œå°‡ä¾†è¦é‡å»ºä¹Ÿæ¯”è¼ƒç°¡å–®ã€‚</p>
<p>é—œæ–¼èªªæ˜æ–‡ä»¶ç¿»è­¯ï¼Œæ‡‰è©²æœƒå†èŠ±ç¯‡æ–‡ç« å¥½å¥½å¯«æ•´å€‹è¨ˆç•«æœ¬èº«ã€‚</p>
<p>ï¼ˆæ˜¯èªªå¦‚æœæœ‰äººèƒ½å¾é ­çœ‹åˆ°å°¾çš„è©±ï¼Œçµ¦å€‹å›é¥‹å§ &gt; &lt;ï¼‰</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:zh-Hant">
<p>å…«å¦æ˜¯ï¼Œè‡ºç£ç¹é«”ä¸­æ–‡çš„ language code (or locale identifier) ç©¶ç«Ÿæ˜¯ zh_TWã€zh-Hantã€zh-Hant-TWã€zh-Hant_TWã€zh_Hant é‚„æ˜¯ zh_Hant_TWï¼Ÿé€™å•é¡Œæœ¬èº«å°±å¯ä»¥å¯«ä¸€ç¯‡äº†ã€‚<br><br>æŸ¥åœ‹éš›è¦ç¯„ <a href="http://www.ietf.org/rfc/bcp/bcp47.txt">BCP 47</a> çš„è©±ï¼Œåªæœ‰ <a href="http://www.iana.org/assignments/lang-tags/zh-Hant">zh-Hant</a> å’Œ <a href="http://www.iana.org/assignments/lang-tags/zh-Hant-TW">zh-Hant-TW</a>ï¼Œæ›´å¤šé—œæ–¼æ¨™æº–çš„èªªæ˜èˆ‡å®šç¾©å¯ä»¥åƒè€ƒ <a href="https://www.w3.org/International/articles/bcp47/"><em>Understanding the New Language Tags</em>, W3C</a> ä¸€æ–‡ã€‚<br><br>ä¸éç¾ç‹€æ˜¯å¾ˆå¥‡å¦™çš„ã€‚åƒè€ƒ OSX å®šç¾© <a href="https://developer.apple.com/library/ios/documentation/MacOSX/Conceptual/BPInternational/LanguageandLocaleIDs/LanguageandLocaleIDs.html"><em>Language and Locale IDs</em></a> çš„è©±æ‡‰è©²æ˜¯ zh_TWã€zh-Hant æˆ– zh-Hant_TWã€‚è€Œåœ¨ Debain ä¸­ï¼Œæ‰€æœ‰æ”¯æ´çš„ locale å¯«åœ¨ <code>/usr/share/i18n/SUPPORTED</code>ï¼Œè£¡é¢åªæœ‰ zh_TWï¼Œä¸é Debian åªç”¨ <code>language[_country][.charset]</code> æ‰€ä»¥ä¸æœƒæœ‰å®šç¾©ä¸­ç‚º script çš„ Hantï¼Œé›–ç„¶åœ¨ locale ä¸­ä½¿ç”¨åº•ç·šèˆ‡ <a href="http://www.ietf.org/rfc/bcp/bcp47.txt">BCP 47</a> çš„å®šç¾©ä¸åŒã€‚Sphinx é€é <a href="http://babel.pocoo.org/">Babel</a> è™•ç† localeï¼Œä½†å®ƒä¸å…è¨± locale ä¸­æœ‰ <code>-</code>ï¼Œå› æ­¤åªèƒ½è€ƒæ…® zh_Hant æˆ– zh_Hant_TWã€‚æ›´æœ‰è¶£çš„æ˜¯ï¼Œlocale æ‡‰è©²æ˜¯ case-insensitive æ‰€ä»¥å¤§å°å¯«æ˜¯ä¸é‡è¦çš„ XD&#160;<a class="footnote-backref" href="#fnref:zh-Hant" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:build-link">
<p>é–‹ç™¼æ™‚ä¸€ç›´éƒ½æ˜¯ç”¨ GETï¼Œå³å¦‚æ–‡ä¸­æ‰€èªªï¼Œæœ‰å€‹å°ˆå±¬çš„ linkã€‚ä½†ç™¼ç¾æœƒæœ‰ robot / crawler æ‰“é€™äº›è·¯å¾‘ï¼Œå› æ­¤æœ€å¾Œæ”¹æˆ POSTï¼ŒæŠŠ <code>{{ pagename }}</code> ç”¨ data-* å³ <code>&lt;a href="#" data-pagename="{{ pagename }}"&gt;...&lt;/a&gt;</code> çš„æ–¹å¼å­˜èµ·ä¾†ï¼Œåœ¨ç”¨ jQuery ç¶å®š click listenerã€‚&#160;<a class="footnote-backref" href="#fnref:build-link" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:python3">
<p>çœ‹ <a href="https://github.com/coleifer/huey">huey</a> å’Œ <a href="https://github.com/PolicyStat/jobtastic">jobtastic</a> master branch ä¸Šæœ‰ py3k çš„ commit ä½†æ„Ÿè¦ºæ˜¯æœ€è¿‘çš„äº‹ï¼Œæœ‰å¾…è§€å¯Ÿã€‚&#160;<a class="footnote-backref" href="#fnref:python3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:ec2-nano">
<p>åå˜ˆä¸€ä¸‹ï¼Œt2.nano vCPU çœŸçš„æ™‚å¿«æ™‚æ…¢ï¼Œæœ‰æ™‚ build doc å¹¾åˆ†é˜å°±æå®šäº†ï¼Œæœ‰æ™‚è¦å¹¾ååˆ†é˜ï¼Œæœ‰ä¸€å¤©è¶…æ…¢ï¼Œç„¶å¾Œåˆè¢« web crawler æŠ“åˆ°ï¼Œè®“ task queue timeout é™·å…¥äº† timeoutã€restartã€timeout çš„ç„¡é™åœ°ç„â€¦â€¦&#160;<a class="footnote-backref" href="#fnref:ec2-nano" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:/run">
<p>/var/run = /runï¼Œé€™å€‹è·¯å¾‘æ˜¯å€‹ tmpfs æ‰€ä»¥æ¯æ¬¡é‡é–‹æ©Ÿå°±æœƒæ¸…ç©ºï¼Œç›®éŒ„è¦è¨˜å¾—é‡å»ºã€‚&#160;<a class="footnote-backref" href="#fnref:/run" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:pydoc-url">
<p>å…¶å¯¦åœ¨ <a href="https://docs.python.org/">https://docs.python.org/</a> ä¸Šé¢ <a href="https://docs.python.org/3/">/3/</a> å’Œ <a href="https://docs.python.org/3.5/">/3.5/</a> æ˜¯ä¸åŒä»½æ–‡ä»¶ï¼Œå³ä½¿æ˜¯åŒå€‹ç‰ˆæœ¬è™Ÿå®ƒå€‘æ›´æ–°çš„æ™‚é–“ä¸ç›¸åŒã€‚è »æ„å¤–æœƒæ˜¯é€™æ¨£çš„æƒ…æ³ã€‚ä¸éæˆ‘å€‘ä¸ç”¨æé€™éº¼è¤‡é›œï¼Œåªè¦è½‰å€å°±å¥½ã€‚&#160;<a class="footnote-backref" href="#fnref:pydoc-url" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
</ol>
</div></section>
    <footer class="post-footer">
<section
	class="giscus"
	data-repo="ccwang002/ccwang002.github.io"
	data-repo-id="MDEwOlJlcG9zaXRvcnkxNzMwNzU2MQ=="
	data-category="Blog post"
	data-category-id="DIC_kwDOAQgXqc4C0b5M"
	data-mapping="pathname"
	data-strict="0"
	data-reactions-enabled="0"
	data-emit-metadata="0"
	data-input-position="bottom"
	data-lang="zh-TW">
</section>	</footer>
</article>
	</main>
	<footer class="site-footer">
		<a class="subscribe"
			href="https://blog.liang2.tw/feeds/all.atom.xml"
			aria-label="Subscribe the Atom feed"
			data-tooltip="Subscribe"
		>
			<svg viewBox="0 0 24 24" width="24" height="24">
				<title>Atom feed</title>
				<circle cx="6.18" cy="17.82" r="2.18"/>
				<path d="m4 10.1v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9zm0-5.66v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56z"/>
			</svg>
		</a>
		<div class="inner">
			<section>
				Browse articles by
				<a href="https://blog.liang2.tw/tags.html">Tags</a> |
				<a href="https://blog.liang2.tw/categories.html">Categories</a>
			</section>
			<section class="contact">
				Contact me by
				<a href="https://twitter.com/lbwang2">Twitter</a> |
				<a href="https://www.facebook.com/lbwang.2">Facebook</a> |
				<a href="https://github.com/ccwang002">GitHub</a> |
				<a href="mailto:me+blog@liang2.tw">Email</a> |
				<a href="https://www.linkedin.com/in/liangbowang/">LinkedIn</a>
			</section>
			<section class="copyright">
				This work is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
			</section>
			<section class="powered-by">
				Built using <a href="https://getpelican.com/">Pelican</a>.
				Powered by the <a href="https://github.com/kura/hauntr">Hauntr</a> theme.
			</section>
		</div>
	</footer>
	<script src="https://blog.liang2.tw/theme/scripts/color_scheme.js"></script>
</body>
</html>