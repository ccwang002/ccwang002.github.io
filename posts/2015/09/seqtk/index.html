<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">
<meta name="author" content="Liang2" />
<meta name="description" content="This post demonstrates the FASTQ to FASTA conversion and sequence quality check using seqtk." />
<meta name="keywords" content="en, seqtk, NGS">
	<link rel="shortcut icon" href="https://blog.liang2.tw/favicon.ico" />
	<title>FASTA/Q sequence processing toolkit -- seqtk</title>

	<!-- og -->
<meta property="og:locale" content="en_USen"/>
<meta property="og:site_name" content="Liang2's Blog"/>
<meta property="og:title" content="FASTA/Q sequence processing toolkit -- seqtk"/>
<meta property="og:description" content="This post demonstrates the FASTQ to FASTA conversion and sequence quality check using seqtk."/>
<meta property="og:locale" content=""/>
<meta property="og:url" content="https://blog.liang2.tw/posts/2015/09/seqtk/"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2015-09-27 14:11:00-05:00"/>
<meta property="article:modified_time" content="2015-09-27 14:11:00-05:00"/>
<meta property="article:author" content="https://blog.liang2.tw/author/liang2.html">
<meta property="article:section" content="Bioinfo"/>
<meta property="article:tag" content="en"/>
<meta property="article:tag" content="seqtk"/>
<meta property="article:tag" content="NGS"/>
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ccwang002">
<meta name="twitter:title" content="FASTA/Q sequence processing toolkit -- seqtk">
<meta name="twitter:description" content="This post demonstrates the FASTQ to FASTA conversion and sequence quality check using seqtk.">

	<!-- Feeds -->
	<link href="https://blog.liang2.tw/feeds/all.atom.xml"
		type="application/atom+xml" rel="alternate" title="Liang2's Blog" />

	<link href="https://blog.liang2.tw/theme/css/haunter.css?471da5af" rel="stylesheet" />
</head>

<body class="post-template">
	<header class="site-head">
		<h1 class="blog-title"><a href="https://blog.liang2.tw">Liang2's Blog</a></h1>
		<h2 class="blog-description">
			<a href="https://blog.liang2.tw/about-me/">About</a> |
			<a href="https://blog.liang2.tw/talks/">Talks</a> |
			<a href="https://blog.liang2.tw/archives.html">Archives</a>
		</h2>
	</header>
	<main id="content" class="content" role="main">
<article class="post">
    <span class="post-meta">
        <time datetime="Sep 27, 2015">Sep 27, 2015</time>
        in <a href="https://blog.liang2.tw/category/bioinfo/">Bioinfo</a>
    </span>
    <h1 class="post-title">
        <a href="https://blog.liang2.tw/posts/2015/09/seqtk/" rel="bookmark" title="Permalink to FASTA/Q sequence processing toolkit -- seqtk">FASTA/Q sequence processing toolkit -- seqtk</a>
    </h1>
    <span class="post-meta">
                <a href="https://blog.liang2.tw/tag/en/">en</a>
                <a href="https://blog.liang2.tw/tag/seqtk/">seqtk</a>
                <a href="https://blog.liang2.tw/tag/ngs/">NGS</a>
    </span>
    <section class="post-content"><p>This is the first post of the series of my common NGS processing workflows and notes.</p>
<p>Some of the most common operation in sequence processing is FASTQ → FASTA conversion. Tons of conversion scripts using either sed or awk can be found by search. For example,</p>
<div class="highlight"><pre><span></span><span class="c1"># FASTQ to FASTA</span>
<span class="c1"># Assume every read record takes exactly 4 line</span>
<span class="c1"># Ref: http://stackoverflow.com/a/10359425</span>
$ sed -n <span class="s1">&#39;1~4s/^@/&gt;/p;2~4p&#39;</span>
</pre></div>


<p>The assumption of 4 lines per read usually holds for recent NGS sequencing data, so not a big deal.</p>
<p>In many case the sequence is gzip&rsquo;d. It is still a piece of cake when combining with pipe editing,</p>
<div class="highlight"><pre><span></span>gzcat myseq.fq.gz <span class="p">|</span> sed -n <span class="s1">&#39;1~4s/^@/&gt;/p;2~4p&#39;</span> <span class="p">|</span> gzip &gt; myseq.fa.gz
</pre></div>


<p>However, things can get complex really fast when one wants to additionally do reverse complement, randomly sample a subset of reads, and many other types of sequence manipulation. Efficiency matters if those tasks are applied to tens of millions of reads. Even a few nanoseconds longer of computing time difference per read can make a difference at this scale of reads.</p>
<h3 id="seqtk">Seqtk</h3>
<p>So <a href="https://github.com/lh3/seqtk">seqtk</a> comes into rescue. It is written in C and MIT licensed. <a href="https://www.biostars.org/p/85929/#86082">A quick comparison</a> shows it is generally faster than other UNIX-based solutions, let alone implementations based on scripting languages.</p>
<p>Seqtk bundles many other operations, but I&rsquo;ll just mention those I frequently use.</p>
<div class="highlight"><pre><span></span><span class="nv">$seqtk</span>

Usage:   seqtk &lt;command&gt; &lt;arguments&gt;
Version: 1.0-r77-dirty

Command: seq       common transformation of FASTA/Q
         comp      get the nucleotide composition of FASTA/Q
         sample    subsample sequences
         subseq    extract subsequences from FASTA/Q
         fqchk     fastq QC <span class="o">(</span>base/quality summary<span class="o">)</span>
         mergepe   interleave two PE FASTA/Q files
         trimfq    trim FASTQ using the Phred algorithm

         hety      regional heterozygosity
         mutfa     point mutate FASTA at specified positions
         mergefa   merge two FASTA/Q files
         dropse    drop unpaired from interleaved PE FASTA/Q
         rename    rename sequence names
         randbase  choose a random base from hets
         cutN      cut sequence at long N
         listhet   extract the position of each het
</pre></div>


<h3 id="fastq-fasta">FASTQ → FASTA</h3>
<p>Read (gzip&rsquo;d) FASTQ and write out as FASTA,</p>
<div class="highlight"><pre><span></span>$ seqtk seq -A in.fq<span class="o">[</span>.gz<span class="o">]</span> &gt; out.fa
</pre></div>


<p>To make the output gzip&rsquo;d again, piped with gzip,</p>
<div class="highlight"><pre><span></span>$ seqtk seq -A in.fq<span class="o">[</span>.gz<span class="o">]</span> <span class="p">|</span> gzip &gt; out.fa.gz
</pre></div>


<h3 id="reverse-complement">Reverse complement</h3>
<p>If one wants to debug the R2 reads of pair-end sequencing (second read on forward strand), since they contain reverse complement sequence of the insert DNA, one needs to reverse complement R2 reads again to debug directly by bare human eyes.</p>
<div class="highlight"><pre><span></span>$ seqtk seq -r R2.fq &gt; R2_rc.fq

$ <span class="nb">echo</span> <span class="s1">&#39;&gt; Example R2 seq</span>
<span class="s1">  GCATTGGTGGTTCAGTGGTAGAATTCT&#39;</span> <span class="p">|</span> seqtk seq -r
<span class="c1"># &gt; Example R2 seq</span>
<span class="c1"># AGAATTCTACCACTGAACCACCAATGC</span>
</pre></div>


<h3 id="quality-check">Quality check</h3>
<p>To be honest, <a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> is more frequently used for quality check because it generates <a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/good_sequence_short_fastqc.html">reports with beautiful figures</a>.</p>
<p>But for a detail report on each read position, one should consider <code>seqtk fqchk</code>.</p>
<div class="highlight"><pre><span></span>$ seqtk fqchk myseq.fq<span class="o">[</span>.gz<span class="o">]</span>
</pre></div>


<p>By default it sets <code>-q 20</code>. This quality threshold determines the threshold of counting a base as low or high quality, shown as <code>%low</code> and <code>%high</code> per read position. In the default case, quality score higher than 20 will be treated as high quality bases.</p>
<div class="highlight"><pre><span></span>min_len: 10; max_len: 174; avg_len: 28.92; 37 distinct quality values
POS #bases    %A   %C   %G   %T   %N  avgQ errQ %low %high
ALL 236344886 17.0 22.5 31.3 29.2 0.0 39.9 37.6 0.1  99.9
1   8172342   8.9  12.4 57.0 21.7 0.0 39.6 29.0 0.5  99.5
2   8172342   7.7  62.5 16.2 13.7 0.0 39.8 37.8 0.2  99.8
3   8172342   50.3 24.1 11.9 13.6 0.0 39.8 38.2 0.1  99.9
4   8172342   10.4 22.9 15.3 51.3 0.0 39.9 38.7 0.1  99.9
5   8172342   14.3 12.9 22.3 50.5 0.0 39.8 37.0 0.2  99.8
# ... (trimmed)
</pre></div>


<p>The following columns, <code>avgQ</code> and <code>errQ</code>, need more explanation. Average quality (<code>avgQ</code>) is computed by weighted mean of each base&rsquo;s quality,</p>
<div class="math">$$
    \text{avgQ} = \dfrac{\sum_{q=0}^{93} q \cdot n_q}{\sum_{q = 0}^{93} n_q},
$$</div>
<p>where <span class="math">\(n_q\)</span> is the number of bases with quality score being <span class="math">\(q\)</span>. The magic number 93 comes from the quality score of Sanger sequencing<sup id="fnref:sanger-qual-score"><a class="footnote-ref" href="#fn:sanger-qual-score" rel="footnote">1</a></sup>, whose score ranges from 0 to 93.</p>
<p>For <code>errQ</code> we need more background knowledge about how quality score is computed. A base with quality score <span class="math">\(q\)</span> implies the probability of being erroneously called, <span class="math">\(P_q\)</span>, is </p>
<div class="math">$$
    P_q = 10^{\frac{-q}{10}}, \hspace{1em} q = -10\log_{10}{P_q}.
$$</div>
<p>Therefore, given <span class="math">\(q\)</span> being <span class="math">\(0, 1, 2, \ldots\)</span>, seqtk has a conversion table <code>perr</code> from quality score to probability,</p>
<table>
<thead>
<tr>
<th align="left">Q</th>
<th align="right">0</th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3<sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>P</strong></td>
<td align="right">0.5</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="left">Q</th>
<th align="right">4</th>
<th align="right">5</th>
<th align="center">&hellip;</th>
<th align="right">38</th>
<th align="right">39</th>
<th align="right">40</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>P</strong></td>
<td align="right">0.398107</td>
<td align="right">0.316228</td>
<td align="center">&hellip;</td>
<td align="right">0.000158</td>
<td align="right">0.000126</td>
<td align="right">0.000100</td>
</tr>
</tbody>
</table>
<p>Based on the probability, it computes the expected number of base call errors, num_err, and the empirical probability of having a base call error at this position, errP, </p>
<div class="math">$$
    \text{num_err} = \sum_q P_q \cdot n_q, \hspace{1em} \text{errP} = \frac{\text{num_err}}{\sum_q n_q}.
$$</div>
<p>Thus the <code>errQ</code> is the equivalent quality score of errP, which better interprets the probability of base call error than <code>avgQ</code>, </p>
<div class="math">$$
    \text{errQ} = -10\log_{10}{\text{errP}}.
$$</div>
<p>By passing <code>-q 0</code> to <code>seqtk fqchk</code>, one can get the proportion of all distinct quality scores at each position. This information is pretty useful if the sequencing data is all a mess and one needs to figure out the cause.</p>
<p>Though some of the <code>seqtk fqchk</code>&lsquo;s behavior is not documented, it should be straight forward enough to understand. All in all, the details can always be found in the <a href="https://github.com/lh3/seqtk/blob/4feb6e81444ab6bc44139dd3a125068f81ae4ad8/seqtk.c#L1483">source code</a>.</p>
<h3 id="summary">Summary</h3>
<p><a href="https://github.com/lh3/seqtk">Seqtk</a> is fast to use for daily routines of FASTA/Q conversion. On top of that it provide various functionalities such as read random sampling, quality check, and many I haven&rsquo;t tried or mentioned.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:sanger-qual-score">
<p>See multiple specifications of quality score at <a href="http://scikit-bio.org/docs/latest/generated/skbio.io.format.fastq.html#quality-score-variants">sckit-bio doc</a>. The score is <a href="https://en.wikipedia.org/wiki/Phred_quality_score">Phred quality score</a>. More other score representations can be found at <a href="https://en.wikipedia.org/wiki/FASTQ_format">FASTQ wiki</a>.&#160;<a class="footnote-backref" href="#fnref:sanger-qual-score" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Note that the probability of q less than 4 is fixed with 0.5. A quick computation can see when <span class="math">\(q = 3\)</span>, its actual Phred probability is <span class="math">\(10 ^ {-0.3} = 0.501\)</span>.&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></section>
    <footer class="post-footer">
<section class="share">
    <h2>Share</h2>
    <a class="icon-twitter" href="https://twitter.com/share?text=FASTA/Q sequence processing toolkit -- seqtk&amp;url=https://blog.liang2.tw/posts/2015/09/seqtk/"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235'); return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="http://www.facebook.com/sharer/sharer.php?u=https://blog.liang2.tw/posts/2015/09/seqtk/"
        onclick="window.open(this.href, 'facebook-share', 'width=580,height=296'); return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=https://blog.liang2.tw/posts/2015/09/seqtk/"
        onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>    <section>
        <h2>Discuss</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'liang2';
          var disqus_identifier = '/posts/2015/09/seqtk/';
          var disqus_url = 'https://blog.liang2.tw/posts/2015/09/seqtk/';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
    </section>
    <footer>
</article>
	</main>
	<footer class="site-footer">
		<a class="subscribe icon-feed" href="https://blog.liang2.tw/feeds/all.atom.xml"><span class="tooltip">Atom</span></a>
		<div class="inner">
			<section>
				Browse articles by
				<a href="https://blog.liang2.tw/tags/">Tags</a> |
				<a href="https://blog.liang2.tw/categories.html">Categories</a>
			</section>
			<section class="contact">
				Contact me by
				<a href="https://twitter.com/ccwang002">Twitter</a> |
				<a href="https://www.facebook.com/lbwang.2">Facebook</a> |
				<a href="https://keybase.io/liang2">Keybase</a> |
				<a href="https://github.com/ccwang002">GitHub</a> |
				<a href="https://bitbucket.org/ccwang002">Bitbucket</a> |
				<a href="mailto:me+blog@liang2.tw">Email</a> |
				<a href="https://www.linkedin.com/in/liangbowang/">LinkedIn</a>
			</section>
			<section class="copyright">
				This work is licensed under <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
			</section>
			<section class="poweredby">
				Built using <a href="http://getpelican.com/">Pelican</a>.
				Powered by the <a href="https://kura.io/hauntr/">Hauntr</a> theme.
			</section>
		</div>
	</footer>
</body>
</html>