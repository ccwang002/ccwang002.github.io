<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Liang-Bo Wang's Blog - png</title><link href="https://blog.liang2.tw/" rel="alternate"></link><link href="https://blog.liang2.tw/feeds/tag_png.atom.xml" rel="self"></link><id>https://blog.liang2.tw/</id><updated>2022-02-20T20:07:45-06:00</updated><entry><title>PNG Optimizer</title><link href="https://blog.liang2.tw/posts/2015/09/png-optim/" rel="alternate"></link><published>2015-09-22T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-22:/posts/2015/09/png-optim/</id><summary type="html">&lt;p&gt;部落格剛成立總是特別興奮，測了一下瀏覽像這樣的網站要用多少頻寬。首頁能壓在 600KB 左右，因為文章 summary 裡面暫時還沒圖 …&lt;/p&gt;</summary><content type="html">&lt;p&gt;部落格剛成立總是特別興奮，測了一下瀏覽像這樣的網站要用多少頻寬。首頁能壓在 600KB 左右，因為文章 summary 裡面暫時還沒圖。不過像部落格設定這篇文章，裡面有幾張螢幕截圖的就要花快 2MB 傳。&lt;/p&gt;
&lt;p&gt;就想了一下圖檔有什麼壓縮方式。如果是 JPG 的話，&lt;a href="https://github.com/tjko/jpegoptim"&gt;jpegoptim&lt;/a&gt; 簡單又有效；如果是 PNG 的話，以前都是用 &lt;a href="http://optipng.sourceforge.net/"&gt;OptiPNG&lt;/a&gt;，但效果有限，而且是無損壓縮。在螢幕截圖的情況，我倒不介意幾個像素的顏色稍微不一樣（其實人眼無法分辨）&lt;/p&gt;
&lt;p&gt;於是，需要比較看看市面找得到的幾種 PNG 壓縮方式。很碰巧找到 &lt;a href="http://css-ig.net/png-tools-overview.html"&gt;http://css-ig.net/png-tools-overview.html&lt;/a&gt; 專講 PNG 優化的比較，就挑了幾款來試。&lt;/p&gt;
&lt;p&gt;直接把結果整理成下表：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Filename&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Original size&lt;/th&gt;
&lt;th style="text-align: right;"&gt;&lt;a href="http://optipng.sourceforge.net/"&gt;OptiPNG&lt;/a&gt; (lossless)&lt;/th&gt;
&lt;th style="text-align: right;"&gt;&lt;a href="https://github.com/google/zopfli"&gt;Zopfli&lt;/a&gt; (lossless)&lt;/th&gt;
&lt;th style="text-align: right;"&gt;&lt;a href="https://pngquant.org/"&gt;pngquant&lt;/a&gt; (lossy)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_desktop.png"&gt;blog_desktop.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;180K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;108K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;100K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_mobile.png"&gt;blog_mobile.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;72K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;52K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;44K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;28K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/justfont_setting.png"&gt;justfont_setting.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;272K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;196K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;164K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;84K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/oldsite.png"&gt;oldsite.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;604K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;536K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;492K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;288K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="https://blog.liang2.tw/posts/2015/09/png-optim/pics/oldsite_full.png"&gt;oldsite_full.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;816K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;684K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;644K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;376K&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="optipng"&gt;OptiPNG&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://optipng.sourceforge.net/"&gt;OptiPNG&lt;/a&gt; 還是有部份效果，不過他跑不快。&lt;/p&gt;
&lt;h3 id="zopfli-zopflipng"&gt;Zopfli (Zopflipng)&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/google/zopfli"&gt;Zopfli&lt;/a&gt; 是 Google 開發的壓縮演算法，相容於 deflate, gzip, zlib 格式。也因此能用在 PNG 上面。他也是 lossless compression。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Zopfli Compression Algorithm is a compression library programmed in C to perform very good, but slow, deflate or zlib compression.
(&lt;a href="https://github.com/google/zopfli"&gt;Zopfli Readme&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;這個 &lt;a href="https://github.com/google/zopfli/blob/master/README.zopflipng"&gt;Zopflipng&lt;/a&gt; 也是同個 repo 維護。自己編譯簡單，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git clone https://github.com/google/zopfli.git
make zopflipng
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;如果要一口氣壓縮一堆 PNG，可以這樣使用：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;zopflipng --lossy_transparent --prefix *.png
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;速度也蠻慢的，有個 &lt;code&gt;-q&lt;/code&gt; 選項可以加速。但壓縮效率比 OptiPNG 還好。&lt;/p&gt;
&lt;p&gt;PS 剛好今天早上看到 Google 又出了另一個壓縮演算法 &lt;a href="https://github.com/google/brotli"&gt;Brotli&lt;/a&gt;，但這個與 deflate 不相容，應該不能用在 PNG 上面。&lt;/p&gt;
&lt;h3 id="pngquant"&gt;pngquant&lt;/h3&gt;
&lt;p&gt;想要有損的 PNG 可以用 &lt;a href="https://pngquant.org/"&gt;pngquant&lt;/a&gt;。看官網有特別強調在透明度的資訊會被保留，並能像 JPEG 一樣設定 quality。一般 quality 容許越低壓縮比都會越高。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pngquant -f --ext=.png --quality=70-85 --skip-if-larger *.png
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;可以看到 pngquant 能很容易達到 50% 以下的壓縮比。就我的例子看不太出現螢幕截圖哪裡失真了，而且失真了……也不會怎麼樣啦。&lt;/p&gt;
&lt;h3 id="pngquant-zopflipng"&gt;pngquant + Zopflipng&lt;/h3&gt;
&lt;p&gt;看了一下相關的討論，pngquant 還有再被壓縮的空間，所以最後再套上 Zopflipng 還可以再變小，還蠻驚人的。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Filename&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Orig. size&lt;/th&gt;
&lt;th style="text-align: right;"&gt;pngquant&lt;/th&gt;
&lt;th style="text-align: right;"&gt;pngquant + Zopfli&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Compress ratio&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_desktop.png"&gt;blog_desktop.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;180K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;60K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_mobile.png"&gt;blog_mobile.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;72K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;28K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;28K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.39&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/justfont_setting.png"&gt;justfont_setting.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;272K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;84K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;76K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/oldsite.png"&gt;oldsite.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;604K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;288K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;268K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.44&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="https://blog.liang2.tw/posts/2015/09/png-optim/pics/oldsite_full.png"&gt;oldsite_full.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;816K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;376K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;348K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.43&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="truepng"&gt;沒有測的 TruePNG&lt;/h3&gt;
&lt;p&gt;在原始網站中有提到 &lt;a href="http://css-ig.net/articles/truepng"&gt;TruePNG&lt;/a&gt; 表現很好，但它不是 open source 而且好像只能在 Windows 上跑，那就算了。&lt;/p&gt;
&lt;h3 id="_1"&gt;結論&lt;/h3&gt;
&lt;p&gt;以後沒事截圖都會用 pngquant 壓縮一下，完全不能有色差的考慮從 OptiPNG 改為 Zopfli。&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="png"></category></entry></feed>