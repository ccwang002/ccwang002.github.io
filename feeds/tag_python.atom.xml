<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Liang2's Blog - python</title><link href="https://blog.liang2.tw/" rel="alternate"></link><link href="https://blog.liang2.tw/feeds/tag_python.atom.xml" rel="self"></link><id>https://blog.liang2.tw/</id><updated>2018-01-20T00:00:00-06:00</updated><entry><title>Ad hoc bioinformatic analysis in database</title><link href="https://blog.liang2.tw/posts/2018/01/ad-hoc-bioinfo-analysis-in-database/" rel="alternate"></link><published>2018-01-20T00:00:00-06:00</published><updated>2018-01-20T00:00:00-06:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2018-01-20:/posts/2018/01/ad-hoc-bioinfo-analysis-in-database/</id><summary type="html">&lt;p&gt;Recently I&amp;rsquo;ve found that bioinformatic analysis in database is not hard at all and the database set up wasn&amp;rsquo;t as daunting as â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Recently I&amp;rsquo;ve found that bioinformatic analysis in database is not hard at all and the database set up wasn&amp;rsquo;t as daunting as it sounds, especially when the data are tabular. I used to start my analysis with loading everything into R or Python, and then figuring out all the filtering and grouping commands with my favorite R or Python packages. However, the data size would be bound by memory and the analysis might be slow unless additional optimization was applied. On the other hand, database has already solved the problems by mapping the data to disk and indexing. Therefore I&amp;rsquo;d like to share my recent experience on using database for bioinfo analysis.&lt;/p&gt;
&lt;p&gt;Note that if one is interested in the actual tips of using database for analysis, feel free to skip the whole background section.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#background"&gt;Background&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#reading-tabular-data-in-bioinformatics"&gt;Reading tabular data in bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database"&gt;Database&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#tabular-data-io-in-database"&gt;Tabular data IO in database&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sqlite"&gt;SQLite&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#loading-compressed-data-with-named-pipe"&gt;Loading compressed data with named pipe&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#benchmark"&gt;Benchmark&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#pandas-python"&gt;pandas (Python)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sqlite_1"&gt;SQLite&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql_1"&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#result"&gt;Result&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="background"&gt;Background&lt;/h2&gt;
&lt;h3 id="reading-tabular-data-in-bioinformatics"&gt;Reading tabular data in bioinformatics&lt;/h3&gt;
&lt;p&gt;Tabular data are everywhere in bioinformatics. To record gene expressions, variants or cross reference IDs between different annotation systems or databases, data are stored in various tabular-like formats, such as BED, GTF, MAF, and VCF, which can usually be normalized to the standard CSV and TSV files. Starting with the raw data, we apply different kinds of filtering and grouping to pick up the records of interest. For example, we might subset the data within a genomic region, select transcripts above an expression threshold, or group the data by the same transcript across multiple samples. &lt;/p&gt;
&lt;p&gt;Researchers have developed numerous tools to select the data of interest. In Python, numpy and pandas dominate the analysis; in R, data.frame, tibble, and data.table are all widely used. However, all the tools above only work if the data can be fit into memory. Unfortunately, bioinformatics data can go beyond 10GB easily these day. It has been difficult to analyze everything in memory. Even using a powerful server with a few hundreds GB of memory, the overhead of loading all data into memory can be time consuming. To make things worse, when joining multiple data together, the magnitude of the issues above will be multiplied.&lt;/p&gt;
&lt;p&gt;One might argue that in Python there are packages like &lt;a href="http://xarray.pydata.org/en/stable/"&gt;xarray&lt;/a&gt; and &lt;a href="https://dask.pydata.org/en/latest/"&gt;dask&lt;/a&gt; capable of handling out-of-memory multi-dimensional array. But they are only useful for numerical data. In bioinformatics metadata are frequently used and consist of many text columns, where numpy doesn&amp;rsquo;t have the same computing advantage as numerical columns. For example, gene expression only makes sense if it comes with the gene symbol, the transcript id, and the sample id.&lt;/p&gt;
&lt;h3 id="database"&gt;Database&lt;/h3&gt;
&lt;p&gt;Databases have been solving the out-of-memory data analysis for decades, and it also comes with several advantages. First, the language databases use is standardized, known as Structured Query Language (SQL). SQL is expressive, which means in stead of writing how to load or query the data, one writes what the data or the query look like. Database supports concurrent reads, so one is able to query the same data in parallel. Second, One can speed up the queries by setting up indexes. Different types of indexes and different combinations of columns can be added to boost the query. Lastly, database is persistent, so one only needs to load the data once.&lt;/p&gt;
&lt;p&gt;I mainly use two databases: &lt;a href="https://sqlite.org/"&gt;SQLite&lt;/a&gt; and &lt;a href="https://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt;. SQLite&amp;rsquo;s database is just a single file on disk and it doesn&amp;rsquo;t need any configuration to run. In fact SQLite ships with Python, available as the &lt;a href="https://docs.python.org/3/library/sqlite3.html"&gt;&lt;code&gt;sqlite&lt;/code&gt; module&lt;/a&gt;. SQLite works very well in my case.&lt;/p&gt;
&lt;p&gt;PostgreSQL is a more feature-rich database and has better concurrency support such as multiple writers at the same time. &lt;a href="https://www.postgresql.org/docs/current/static/indexes-types.html"&gt;Its advanced indexing&lt;/a&gt; and &lt;a href="https://www.postgresql.org/docs/current/static/datatype.html"&gt;data types&lt;/a&gt; might be helpful for genomic range query. The downside is that it requires some configurations and its installation is not as easy as SQLite. Though the basic PosgreSQL setup is actually just a few commands on Debian Linux, one probably needs to go through some documentations to understand what they are about and how to tweak the config.&lt;/p&gt;
&lt;p&gt;The most annoying thing I found using database in the past was to load my data, where I had to create the table by &lt;code&gt;CREATE TABLE ...&lt;/code&gt; and insert all my data by multiple &lt;code&gt;INSERT INTO ... VALUES ...&lt;/code&gt; statements. But recently I found that many databases have some builtin utilities to make the process easy and fast. Also, it is not hard to programmatically generate the statements through packages like &lt;a href="https://www.sqlalchemy.org/"&gt;SQLAlchemy&lt;/a&gt;. Therefore, I will share some experience of using database here. &lt;/p&gt;
&lt;h2 id="tabular-data-io-in-database"&gt;Tabular data IO in database&lt;/h2&gt;
&lt;h3 id="sqlite"&gt;SQLite&lt;/h3&gt;
&lt;p&gt;For SQLite, use &lt;code&gt;.mode csv&lt;/code&gt; with &lt;a href="https://www.sqlite.org/cli.html#csv"&gt;&lt;code&gt;.import&lt;/code&gt; statement&lt;/a&gt; to load in data. SQLite will create the table automatically by using the first row as the column names if the table doesn&amp;rsquo;t exist. One can create the table before the loading to define each column&amp;rsquo;s data type, otherwise columns are just &lt;code&gt;TEXT&lt;/code&gt; type. &lt;code&gt;.separator&lt;/code&gt; controls the delimiter character SQLite uses between columns.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;separator&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;   &lt;span class="c1"&gt;-- For TSV files&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/path/to/tsv&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;table_name&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To export data, use &lt;code&gt;.once&lt;/code&gt; statement followed by the query:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="k"&gt;on&lt;/span&gt;  &lt;span class="c1"&gt;-- Export columns name &lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;once&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/path/to/output.tsv&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;-- Export all data in the table&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Commands above can be scripting into SQLite like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sqlite3 mydb.sqlite &amp;lt; load_data.sql
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="postgresql"&gt;PostgreSQL&lt;/h3&gt;
&lt;p&gt;For PostgreSQL, the built-in solution is to use the &lt;a href="https://www.postgresql.org/docs/current/static/sql-copy.html"&gt;&lt;code&gt;COPY&lt;/code&gt; statement&lt;/a&gt; or the &lt;a href="https://www.postgresql.org/docs/current/static/app-psql.html#APP-PSQL-META-COMMANDS-COPY"&gt;&lt;code&gt;\copy&lt;/code&gt; metacommand&lt;/a&gt; to import or export data. &lt;code&gt;COPY&lt;/code&gt; runs faster than the equivalent &lt;code&gt;INSERT&lt;/code&gt; statements. Besides built-in commands, an external tool &lt;a href="https://pgloader.io/"&gt;pgloader&lt;/a&gt; has been very helpful for the data loading, whose loading process is more flexible. &lt;/p&gt;
&lt;p&gt;In this post, I won&amp;rsquo;t dive into details of their usage. There will be an example in the benchmark section.&lt;/p&gt;
&lt;h3 id="loading-compressed-data-with-named-pipe"&gt;Loading compressed data with named pipe&lt;/h3&gt;
&lt;p&gt;Many tabular data are compressed by gzip or bgzip to save the disk space. To decompress the file and load into the database without storing the uncompressed file somewhere first, one can consider using &lt;a href="https://www.linuxjournal.com/article/2156"&gt;named pipe&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The idea is to decompress the file to a named pipe, and read the data in database from the named pipe. A named pipe can be created by &lt;code&gt;mkfifo&lt;/code&gt;.  For example,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkfifo mypipe
gunzip -c mydata.tsv.gz &amp;gt; mypipe &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The trailing &lt;code&gt;&amp;amp;&lt;/code&gt; makes the decompress command run at the background to keep everything in one shell session. Then read the data in SQLite as if it were a file like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;mypipe&lt;/span&gt; &lt;span class="nn"&gt;mytable&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The trick here can be further expand to any preprocessing in any language. One can simply preprocess the file and write the output to a named pipe. The database can read from the named pipe without storing the full intermediate output on disk. Plus, by piping between commands more CPU cores are utilized.&lt;/p&gt;
&lt;h2 id="benchmark"&gt;Benchmark&lt;/h2&gt;
&lt;p&gt;To give an idea of the data processing time in databases, I used all the &lt;a href="https://www.synapse.org/#!Synapse:syn7214402/wiki/405297"&gt;somatic variants from TCGA MC3&lt;/a&gt; as a demonstration. The goal here is to count the number of variants by different transcript and its mutation type. So the output result will be something like the following:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;Transcript ID&lt;/th&gt;
&lt;th&gt;Mutation type&lt;/th&gt;
&lt;th&gt;Count&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ENST00000000233&lt;/td&gt;
&lt;td&gt;3&amp;rsquo;UTR&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ENST00000000233&lt;/td&gt;
&lt;td&gt;Frame_Shift_Del&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ENST00000000233&lt;/td&gt;
&lt;td&gt;Intron&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;After filtering out all the silent mutations, there are total about 2.8 million variants making up 614MB of disk space. &lt;/p&gt;
&lt;p&gt;I used three methods to load and group the variants: pandas, SQLite, and PostgreSQL. Their code are shown below.&lt;/p&gt;
&lt;h3 id="pandas-python"&gt;pandas (Python)&lt;/h3&gt;
&lt;p&gt;Standard pandas IO code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;


&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;mc3_filtered.tsv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;names&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;chrom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;strand&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;mutation_type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ref_allele&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;alt_allele&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;transcript_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;hgvs_c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;hgvs_p&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;p_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;p_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;normal_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tumor_id&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;],&lt;/span&gt;
    &lt;span class="n"&gt;dtype&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;chrom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;strand&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;p_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;p_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;grp_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;groupby&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;transcript_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;mutation_type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;alt_allele&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reset_index&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;grp_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_csv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;out.pandas.tsv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sep&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="sqlite_1"&gt;SQLite&lt;/h3&gt;
&lt;p&gt;I set some &lt;code&gt;PRAGMA ...&lt;/code&gt; statements at the beginning to control some of the SQLite settings. It tells SQLite to use more cache, create temporary tables in memory and disable all the transaction recovery settings. SQLite by default writes everything to the disk first before changing the actual database content so if the program fails or any exception occurs, it can recover all the transactions properly. In our case we don&amp;rsquo;t care about the integrity of the database.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;cache_size&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mi"&gt;4192000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;-- Use 2GB RAM as cache&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;temp_store&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;MEMORY&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;synchronous&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;OFF&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;journal_mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;OFF&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;locking_mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;EXCLUSIVE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;separator&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;mc3&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;chrom&lt;/span&gt;       &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;&amp;quot;start&amp;quot;&lt;/span&gt;     &lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="ss"&gt;&amp;quot;end&amp;quot;&lt;/span&gt;       &lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;strand&lt;/span&gt;      &lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;mutation_type&lt;/span&gt;   &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;ref_allele&lt;/span&gt;  &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;alt_allele&lt;/span&gt;  &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;transcript_id&lt;/span&gt;   &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;hgvs_c&lt;/span&gt;      &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;hgvs_p&lt;/span&gt;      &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;cdna_start&lt;/span&gt;  &lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;cdna_end&lt;/span&gt;    &lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;p_start&lt;/span&gt;     &lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;p_end&lt;/span&gt;       &lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;normal_id&lt;/span&gt;   &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;tumor_id&lt;/span&gt;    &lt;span class="nb"&gt;TEXT&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;mc3_filtered&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tsv&lt;/span&gt; &lt;span class="n"&gt;mc3&lt;/span&gt;
&lt;span class="c1"&gt;-- Create an index to speed up grouping on the same columns&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;INDEX&lt;/span&gt; &lt;span class="n"&gt;mc3_idx&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;mc3&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="c1"&gt;-- Output&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;once&lt;/span&gt; &lt;span class="k"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqlite&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tsv&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;COUNT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alt_allele&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;mc3&lt;/span&gt;
&lt;span class="k"&gt;GROUP&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="postgresql_1"&gt;PostgreSQL&lt;/h3&gt;
&lt;p&gt;I used &lt;a href="https://pgloader.io/"&gt;pgloader&lt;/a&gt; to load the data into a local PostgreSQL database &lt;code&gt;test_mc3&lt;/code&gt;. pgloader can take a script of its own mini-language.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;LOAD CSV
    FROM &amp;#39;mc3_filtered.tsv&amp;#39;
    INTO postgresql:///test_mc3?mc3
    WITH fields terminated by &amp;#39;\t&amp;#39;,
         fields not enclosed,
         drop indexes
    BEFORE LOAD DO 
    $$ DROP TABLE IF EXISTS mc3; $$,
    $$ CREATE TABLE mc3 (
            chrom       TEXT,
            &amp;quot;start&amp;quot;     BIGINT,
            &amp;quot;end&amp;quot;       BIGINT,
            strand      SMALLINT,
            mutation_type   TEXT,
            ref_allele  TEXT,
            alt_allele  TEXT,
            transcript_id   TEXT,
            hgvs_c      TEXT,
            hgvs_p      TEXT,
            cdna_start  INT,
            cdna_end    INT,
            p_start     INT,
            p_end       INT,
            normal_id   TEXT,
            tumor_id    TEXT
        ); 
    $$,
    $$ CREATE INDEX mc3_idx ON mc3 (transcript_id, mutation_type); $$
;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To do the grouping analysis, I used the built-in &lt;code&gt;COPY&lt;/code&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;COPY&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; 
    &lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;COUNT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alt_allele&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;
    &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;mc3&lt;/span&gt;
    &lt;span class="k"&gt;GROUP&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mutation_type&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/private/tmp/mc3/MC3/out.psql.tsv&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;FORMAT&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="result"&gt;Result&lt;/h3&gt;
&lt;p&gt;I didn&amp;rsquo;t run it systematically but a few repeats showed the similar numbers. &lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;Method&lt;/th&gt;
&lt;th align="right"&gt;Read data (sec)&lt;/th&gt;
&lt;th align="right"&gt;Group-by analysis (sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;Pandas&lt;/td&gt;
&lt;td align="right"&gt;10.7&lt;/td&gt;
&lt;td align="right"&gt;0.9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;SQLite&lt;/td&gt;
&lt;td align="right"&gt;27.7&lt;/td&gt;
&lt;td align="right"&gt;4.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;PostgreSQL&lt;/td&gt;
&lt;td align="right"&gt;82.6&lt;/td&gt;
&lt;td align="right"&gt;13.5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;In this case, all data can be loaded into memory easily, so pandas gave the best performance here. It actually took nearly no-time to complete the grouping. &lt;/p&gt;
&lt;p&gt;All databases ran much slower on loading data than pandas. PostgreSQL seems to run a lot more slower than SQLite, which I think it has something to do with my server configuration, say, not enough cache size, or not enough working memory for the group-by operation. I feel like PostgreSQL can be faster but anyway this&amp;rsquo;s the result I have so far. Note that all the databases are stored on a PCIe SSD disk. It they were on a normal hard drive, the database creation will take a much longer time.&lt;/p&gt;
&lt;p&gt;However, after the data are loaded into the database, the speed of the query alone is comparable to pandas. Because for pandas, one cannot skip the step of reading data so if the analysis is on a frequently used dataset, database like SQLite can yield better performance. Once the data get larger than the memory capacity, special care will be needed to make the pandas approach work, whereas database can scale up with little fuss.&lt;/p&gt;
&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;My post provides a different solution to work with tabular data by working in a database. In-memory approach like pandas works very efficiently at a small dataset but one will have to code the &amp;ldquo;how-tos&amp;rdquo; to scale to a larger dataset that cannot feed into memory (or the overhead is too high). On the other hand, database can easily scale to a few hundred GBs in size and the query is fast. For analysis on a frequently used dataset, loading data into the database first might be a good idea. &lt;/p&gt;
&lt;p&gt;Another good thing about database is that SQL make joining across tables easily. One can easily join across multiple tables, say, expanding the gene annotation and doesn&amp;rsquo;t have to worry how to implement it. With indexing, the joining can be fast. In pandas, one generates many objects representing the joining results, but those objects cannot be easily shared between scripts. Relying on storing the intermediate objects on disk, the accumulated overhead might be significant. Projects like &lt;a href="https://arrow.apache.org/"&gt;Apache Arrow&lt;/a&gt; might solve the in-memory object passing ultimately, but its development is still in the early phase. As for database, one can define reusable views for the joining logics and filtering results. The post didn&amp;rsquo;t really touch this part so I probably need another benchmark or post to back my thoughts. &lt;/p&gt;
&lt;p&gt;However, working in pandas gives users great room of flexibility. For example, one can iterate over rows and do some complex transformation of the value. Maybe it would be the optimal solution to use &lt;a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_sql.html#pandas.read_sql"&gt;&lt;code&gt;pandas.read_sql&lt;/code&gt;&lt;/a&gt; to run query in database. &lt;/p&gt;
&lt;p&gt;It seems to me like many people rely too much on the features of some special file formats such as bgzip and tabix and have forgotten the generic yet flexible approach using database. Those formats often optimize the random access by a given genomic query by indexing. In database, such index is analogous to &lt;code&gt;(chrom, start, -end)&lt;/code&gt; or even GiST index on Range type in PostgreSQL. It might be slower in database, but aside from the performance, one can continue to query the records in the same way in database. For special format, the functionality will be much limited.&lt;/p&gt;
&lt;p&gt;Now I will give database a try before writing my own data wrangling script.&lt;/p&gt;</content><category term="en"></category><category term="python"></category><category term="pandas"></category><category term="sqlite"></category><category term="postgresql"></category></entry><entry><title>Using EnsDb's annotation database in Python</title><link href="https://blog.liang2.tw/posts/2017/11/use-ensdb-database-in-python/" rel="alternate"></link><published>2017-11-17T00:00:00-06:00</published><updated>2017-11-17T00:00:00-06:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2017-11-17:/posts/2017/11/use-ensdb-database-in-python/</id><summary type="html">&lt;p&gt;How to find and download the EnsDb, the Ensembl genomic annotation in SQLite database made by R package ensembldb, and use it in Python application.&lt;/p&gt;</summary><content type="html">&lt;p&gt;I found that there isn&amp;rsquo;t a systematic way to query and convert genomic annotation IDs in Python. At least there isn&amp;rsquo;t one as good as &lt;a href="https://www.bioconductor.org/help/workflows/annotation/annotation/"&gt;what R/Bioconductor currently has&lt;/a&gt;. If you&amp;rsquo;ve never heard of R/Bioconductor annotation tool stack before, check out &lt;a href="https://www.bioconductor.org/help/workflows/annotation/annotation/"&gt;the official workflow&lt;/a&gt; or &lt;a href="https://blog.liang2.tw/posts/2016/05/biocondutor-ensembl-reference/"&gt;my post in 2016&lt;/a&gt; specific for querying Ensembl annotations.&lt;/p&gt;
&lt;p&gt;Although I enjoy using R for genomic annotation conversion, a few days ago I wanted to do the same thing inside my text processing script in Python. I might be able to re-write the script in R but I feel like R is not really the right tool for this task and on top of it, I don&amp;rsquo;t know how to write an efficent text processing in R&lt;sup id="fnref-r-text-processing"&gt;&lt;a class="footnote-ref" href="#fn-r-text-processing"&gt;1&lt;/a&gt;&lt;/sup&gt;. &lt;/p&gt;
&lt;p&gt;Knowing the fact that all annotations in R are stored in single-file SQLite databases, I should be able to connect the database directly Python or any other language and wirte SQL query to retrieve the same information. So my question now becomes to how to extract or find the path to the databases. Turn out that many new Bioconductor annotation packages are hosted via &lt;a href="https://bioconductor.org/packages/release/bioc/html/AnnotationHub.html"&gt;AnnotationHub&lt;/a&gt;, and user can search for the annotation package and retrieve them locally by their ID. For example, all the recent Ensembl releases, e.g., &lt;code&gt;EnsDb.Hsapiens.vXX&lt;/code&gt;, are available on AnnotationHub. &lt;/p&gt;
&lt;p&gt;After digging around a bit, I am able to query the AnnotationHub, download the correct EnsDB SQLite database file, and make SQL queries for the annotation ID conversion without any R package. I will share the details in the rest of the post. &lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#manual-query-in-annotationhub"&gt;Manual query in AnnotationHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#manual-query-in-ensdb"&gt;Manual query in EnsDB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;But before we start with the details, I want to clarify that it wasn&amp;rsquo;t my intention to persuade people away from the current R ecosystem. The current R ecosystem is great and I will recommend people to stick with it as much as you can. I am pretty sure I will hit a lot of issues if I want to do more complex analysis or queries without the help of what R packages provide.&lt;/p&gt;
&lt;h2 id="manual-query-in-annotationhub"&gt;Manual query in AnnotationHub&lt;/h2&gt;
&lt;p&gt;When one wants to use the R package AnnotationHub, the common usage is &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;AnnotationHub&lt;span class="p"&gt;)&lt;/span&gt;
ah &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; AnnotationHub&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c1"&gt;## snapshotDate(): 2017-10-27&lt;/span&gt;

query&lt;span class="p"&gt;(&lt;/span&gt;ah&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;EnsDb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Homo sapiens&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The function call &lt;code&gt;AnnotationHub()&lt;/code&gt; will download the latest version of the metadata of all available annotation object. The subsequent &lt;code&gt;query(...)&lt;/code&gt; function will talk to the local metadata database.&lt;/p&gt;
&lt;p&gt;Now let&amp;rsquo;s do it manually without any R function calls.&lt;/p&gt;
&lt;p&gt;The default &lt;a href="https://bioconductor.org/packages/release/bioc/html/AnnotationHub.html"&gt;AnnotationHub&lt;/a&gt; is at &lt;a href="https://annotationhub.bioconductor.org/"&gt;https://annotationhub.bioconductor.org/&lt;/a&gt;. By visiting the page we can find several relevant endpoints:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/metadata/annotationhub.sqlite3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/fetch/:id # id =&amp;gt; rdatapaths.id&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So as long as we get the &lt;code&gt;rdatapaths.id&lt;/code&gt; of the EnsDb using the metadata, we can download it via the &lt;code&gt;/fetch/:id&lt;/code&gt; endpoint.&lt;/p&gt;
&lt;p&gt;After downloading the metadata database &lt;code&gt;https://annotationhub.bioconductor.org/metadata/annotationhub.sqlite3&lt;/code&gt;, we can inspect it in SQLite3 by connecting it directly:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sqlite3 annotationhub.sqlite3
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Some useful commands to inspect a foreign database (or the ultimate help command &lt;code&gt;.help&lt;/code&gt;): &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="k"&gt;on&lt;/span&gt; 
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt; &lt;span class="k"&gt;column&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;
&lt;span class="go"&gt;biocversions       rdatapaths         schema_info        test             &lt;/span&gt;
&lt;span class="go"&gt;input_sources      recipes            statuses           timestamp        &lt;/span&gt;
&lt;span class="go"&gt;location_prefixes  resources          tags&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;schema&lt;/span&gt; &lt;span class="n"&gt;rdatapaths&lt;/span&gt;
&lt;span class="go"&gt;CREATE TABLE `rdatapaths`(`id` integer DEFAULT (NULL) NOT NULL PRIMARY KEY , `rdatapath` varchar(255) DEFAULT (NULL) NULL, `rdataclass` varchar(255) DEFAULT (NULL) NULL, `resource_id` integer DEFAULT (NULL) NULL, `dispatchclass` varchar(255) DEFAULT (NULL) NULL, CONSTRAINT `rdatapaths_ibfk_1` FOREIGN KEY (`resource_id`) REFERENCES `resources`(`id`));&lt;/span&gt;
&lt;span class="go"&gt;CREATE INDEX `rdatapaths_resource_id` ON `rdatapaths` (`resource_id`);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So let&amp;rsquo;s make a SQL query to find all Human&amp;rsquo;s EnsDb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ah_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rdp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;rdatapaths_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rdp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rdatapath&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;resources&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;rdatapaths&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;rdp&lt;/span&gt;
&lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rdp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resource_id&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt; &lt;span class="k"&gt;LIKE&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;%EnsDb for Homo Sapiens%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;-- ah_id       rdatapaths_id  rdatapath                               title                            &lt;/span&gt;
&lt;span class="c1"&gt;-- ----------  -------------  --------------------------------------  -- ---------------------------------&lt;/span&gt;
&lt;span class="c1"&gt;-- AH53211     59949          AHEnsDbs/v87/EnsDb.Hsapiens.v87.sqlite  Ensembl 87 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;span class="c1"&gt;-- AH53715     60453          AHEnsDbs/v88/EnsDb.Hsapiens.v88.sqlite  Ensembl 88 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;span class="c1"&gt;-- AH56681     63419          AHEnsDbs/v89/EnsDb.Hsapiens.v89.sqlite  Ensembl 89 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;span class="c1"&gt;-- AH57757     64495          AHEnsDbs/v90/EnsDb.Hsapiens.v90.sqlite  Ensembl 90 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;All the Ensembl releases 87+ are available! I will use the release 90 for example. we can download it by its rdatapaths id:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget -O EnsDb.Hsapiens.v90.sqlite https://annotationhub.bioconductor.org/fetch/64495
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For older Ensembl release, one may need to &lt;a href="https://bioconductor.org/packages/release/bioc/vignettes/ensembldb/inst/doc/ensembldb.html#102_building_annotation_packages"&gt;build the SQLite database based by the instructions from ensembldb&lt;/a&gt;.  For the last GRCh37 release, Ensembl release 75, one can download the source of the Bioconductor annotation package &lt;a href="https://bioconductor.org/packages/release/data/annotation/html/EnsDb.Hsapiens.v75.html"&gt;&lt;code&gt;EnsDb.Hsapiens.v75&lt;/code&gt;&lt;/a&gt; and extract it. The database will be under &lt;code&gt;inst/extdata&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="manual-query-in-ensdb"&gt;Manual query in EnsDB&lt;/h2&gt;
&lt;p&gt;EnsDb SQLite database are Ensembl annotation databases created by the R package &lt;a href="https://bioconductor.org/packages/release/bioc/html/ensembldb.html"&gt;ensembldb&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here I will show how to find a transcript&amp;rsquo;s gene name, its genomic location, and all its exon locations given its Ensembl transcript ID.&lt;/p&gt;
&lt;p&gt;First connect the database by &lt;code&gt;sqlite3 EnsDb.Hsapiens.v90.sqlite&lt;/code&gt;. Its table design is very straightforward:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;
&lt;span class="go"&gt;chromosome      exon            metadata        protein_domain  tx2exon&lt;/span&gt;
&lt;span class="go"&gt;entrezgene      gene            protein         tx              uniprot&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So it didn&amp;rsquo;t take me long to figure out how to join the transcript and gene information:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tx_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seq_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seq_strand&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt; &lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;gene&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;tx_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ENST00000358731&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;-- tx_id            gene_id          gene_name   seq_name    seq_strand&lt;/span&gt;
&lt;span class="c1"&gt;-- ---------------  ---------------  ----------  ----------  ----------&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000358731  ENSG00000145734  BDP1        5           1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And for the genomic ranges of its exon:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;tx_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;exon_idx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;exon_seq_start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;exon_seq_end&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;tx2exon&lt;/span&gt; &lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;exon&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;tx2exon&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exon_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;exon&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exon_id&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;tx_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ENST00000380139&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;exon_idx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;-- tx_id            exon_idx    exon_seq_start  exon_seq_end&lt;/span&gt;
&lt;span class="c1"&gt;-- ---------------  ----------  --------------  ------------&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  1           32427904        32428133    &lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  2           32407645        32407772    &lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  3           32407250        32407338    &lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  4           32404203        32404271    &lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  5           32400723        32403200  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;All the coordinates are 1-based and the ranges are inclusive.&lt;/p&gt;
&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;By downloading the underlying annotation database, one can do the same annotation query out of R language and sometimes it may be helpful. I feel like instead of trying to come up with my own layout of annotation mapping across multiple sources, it is more reliable to use a more official build. On the other hand, it is very hard to get the annotaion mapping correct and there are tons of corner cases that require careful and systematic decisions. So I don&amp;rsquo;t really recommend to build my own mapping at the first place anyway. The method here should help the situation of annotation query out of R a bit.&lt;/p&gt;
&lt;p&gt;Potentially one can try copy the full R infrastructure but using the same underlying database and replicate the same experience to other languages, but it might require substantial work to get the infrastructure done and correct.&lt;/p&gt;
&lt;p&gt;EDIT 2017-12-13: Add instructions of using older Ensembl release.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-r-text-processing"&gt;
&lt;p&gt;Based on my impression, my R expert friends would probably recommend me to write it with R-cpp, which I think would be over-kill for such a small task. But my impression can be wrong. Feel free to share your thoughts!&amp;#160;&lt;a class="footnote-backref" href="#fnref-r-text-processing" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="en"></category><category term="python"></category><category term="r"></category><category term="bioconductor"></category><category term="ensembldb"></category></entry><entry><title>Use Snakemake on Google cloud</title><link href="https://blog.liang2.tw/posts/2017/08/snakemake-google-cloud/" rel="alternate"></link><published>2017-08-10T00:00:00-05:00</published><updated>2017-08-10T00:00:00-05:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2017-08-10:/posts/2017/08/snakemake-google-cloud/</id><summary type="html">&lt;p&gt;&lt;em&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Run a RNA-seq pipeline using Snakemake locally and later port it to Google Cloud. Snakemake can parallelize jobs of a pipeline and â€¦&lt;/em&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Run a RNA-seq pipeline using Snakemake locally and later port it to Google Cloud. Snakemake can parallelize jobs of a pipeline and even across machines.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://snakemake.readthedocs.io/"&gt;Snakemake&lt;/a&gt; has been my favorite workflow management system for a while. I came across it while writing &lt;a href="https://www.dropbox.com/s/u7aa2mbsto77wwy/thesis_upload.pdf?dl=0"&gt;my master thesis&lt;/a&gt; and from the first look, it already appeared to be extremely flexible and powerful. I got some time to play with it during my lab rotation and now after joining the lab, I am using it in my many research projects.  With more and more projects in lab relying on virtualization like &lt;a href="https://www.docker.com/"&gt;Docker&lt;/a&gt;, package management like &lt;a href="https://bioconda.github.io/"&gt;bioconda&lt;/a&gt;, and cloud computing like &lt;a href="https://cloud.google.com/"&gt;Google Cloud&lt;/a&gt;, I would like to continue using Snakemake in those scenarios as well. Hence this post to write down all the details.&lt;/p&gt;
&lt;p&gt;The post will introduce the Snakemake by writing the pipeline locally, then gradually move towards to Docker and more Google Cloud products, e.g., Google Cloud Storage, Google Compute Engine (GCE), and Google Container Engine (GKE). &lt;a href="https://snakemake.readthedocs.io/en/stable/tutorial/tutorial.html"&gt;Snakemake tutorial&lt;/a&gt; is a good place to start with to understand how Snakemake works.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#rna-seq-dataset-and-pipeline-for-demonstration"&gt;RNA-seq dataset and pipeline for demonstration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#installation-of-snakemake-and-all-related-tools"&gt;Installation of snakemake and all related tools&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#snakemake-local-pipeline-execution"&gt;Snakemake local pipeline execution&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#genome-reference-index-build-how-to-write-snakemake-rules"&gt;Genome reference index build (How to write snakemake rules)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#run-snakemake"&gt;Run Snakemake&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sample-alignment-how-to-write-a-general-rule"&gt;Sample alignment (How to write a general rule)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#transcript-assement"&gt;Transcript assement&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#job-dependencies-and-dag"&gt;Job dependencies and DAG&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#snakemake-on-google-cloud"&gt;Snakemake on Google Cloud&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#move-input-files-to-the-cloud-from-google-cloud-storage"&gt;Move input files to the cloud (from Google Cloud Storage)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#store-output-files-on-the-cloud"&gt;Store output files on the cloud&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#dockerize-the-environment"&gt;Dockerize the environment&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#use-google-cloud-storage-in-docker-image"&gt;Use Google Cloud Storage in Docker image&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#google-container-engine-gke"&gt;Google Container Engine (GKE)&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#potential-issues-of-using-gke-with-snakemake"&gt;Potential issues of using GKE with Snakemake&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="rna-seq-dataset-and-pipeline-for-demonstration"&gt;RNA-seq dataset and pipeline for demonstration&lt;/h2&gt;
&lt;p&gt;In this example, I will use &lt;code&gt;~/snakemake_example&lt;/code&gt; to store all the files and output. Make sure you change all the paths to be relative to the actual folder in your machine.&lt;/p&gt;
&lt;p&gt;The demo pipeline will be a RNA-seq pipeline for transcript-level expression analysis, often called the &lt;a href="https://www.nature.com/nprot/journal/v11/n9/full/nprot.2016.095.html"&gt;&lt;em&gt;new Tuxedo&lt;/em&gt;&lt;/a&gt; pipeline involving &lt;a href="https://ccb.jhu.edu/software/hisat2/"&gt;HISAT2&lt;/a&gt; and &lt;a href="https://ccb.jhu.edu/software/stringtie/"&gt;StringTie&lt;/a&gt;. The RNA-seq dataset is from &lt;a href="https://github.com/griffithlab/rnaseq_tutorial/"&gt;Griffith Lab&amp;rsquo;s RNA-seq tutorial&lt;/a&gt; which,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;hellip; consists of two commercially available RNA samples: Universal Human Reference (UHR) and Human Brain Reference (HBR). The UHR is total RNA isolated from a diverse set of 10 cancer cell lines. The HBR is total RNA isolated from the brains of 23 Caucasians, male and female, of varying age but mostly 60-80 years old.&lt;/p&gt;
&lt;p&gt;(From the wiki page &lt;a href="[griffith-lab-data]"&gt;&amp;ldquo;RNA-seq Data&amp;rdquo;&lt;/a&gt; of the tutorial)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Our RNA-seq raw data are the 10% downsampled FASTQ files for these samples. For the human genome reference, only the chromosome 22 from GRCh38 is used. The gene annotation is from &lt;a href="http://dec2016.archive.ensembl.org/Homo_sapiens/Info/Index"&gt;Ensembl Version 87&lt;/a&gt;.  Let&amp;rsquo;s download all the samples and annotations.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; ~/snakemake_example
&lt;span class="gp"&gt;$&lt;/span&gt; wget https://storage.googleapis.com/lbwang-playground/snakemake_rnaseq/griffithlab_brain_vs_uhr.tar.gz
&lt;span class="gp"&gt;$&lt;/span&gt; tar xf griffithlab_brain_vs_uhr.tar.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now you should have the following file structure:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/snakemake_example
â”œâ”€â”€ griffithlab_brain_vs_uhr/
â”‚Â Â  â”œâ”€â”€ GRCh38_Ens87_chr22_ERCC/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ chr22_ERCC92.fa
â”‚Â Â  â”‚Â Â  â””â”€â”€ genes_chr22_ERCC92.gtf
â”‚Â Â  â””â”€â”€ HBR_UHR_ERCC_ds_10pc/
â”‚Â Â      â”œâ”€â”€ HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1.fastq.gz
â”‚Â Â      â”œâ”€â”€ HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2.fastq.gz
â”‚Â Â      â”œâ”€â”€ ...
â”‚Â Â      â”œâ”€â”€ UHR_Rep3_ERCC-Mix1_Build37-ErccTranscripts-chr22.read1.fastq.gz
â”‚Â Â      â””â”€â”€ UHR_Rep3_ERCC-Mix1_Build37-ErccTranscripts-chr22.read2.fastq.gz
â””â”€â”€ griffithlab_brain_vs_uhr.tar.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="installation-of-snakemake-and-all-related-tools"&gt;Installation of snakemake and all related tools&lt;/h2&gt;
&lt;p&gt;After installing &lt;a href="https://conda.io/miniconda.html"&gt;conda&lt;/a&gt; and setting up &lt;a href="https://bioconda.github.io/"&gt;bioconda&lt;/a&gt;, the installation is simple. All the dependencies are kept in a conda environment called &lt;code&gt;new_tuxedo&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; conda create -n new_tuxedo &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="nv"&gt;python&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.6 snakemake hisat2 stringtie samtools
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;source&lt;/span&gt; activate new_tuxedo        &lt;span class="c1"&gt;# Use the conda env&lt;/span&gt;
&lt;span class="gp"&gt;(new_tuxedo) $&lt;/span&gt; hisat2 --version     &lt;span class="c1"&gt;# Tools are available in the env&lt;/span&gt;
&lt;span class="go"&gt;/Users/liang/miniconda3/envs/new_tuxedo/bin/hisat2-align-s version 2.1.0&lt;/span&gt;
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="gp"&gt;(new_tuxedo) $&lt;/span&gt; deactivate           &lt;span class="c1"&gt;# Exit the env&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; hisat2 --version                  &lt;span class="c1"&gt;# Tools are isolated in the env&lt;/span&gt;
&lt;span class="go"&gt;bash: hisat2: command not found&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;All the following steps should be run inside this conda environment unless it&amp;rsquo;s specified otherwise.&lt;/p&gt;
&lt;h2 id="snakemake-local-pipeline-execution"&gt;Snakemake local pipeline execution&lt;/h2&gt;
&lt;p&gt;The RNA-seq pipeline largely consists of the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Build HISAT2 genome reference index for alignment&lt;/li&gt;
&lt;li&gt;Align sample reads to the genome by HISAT2&lt;/li&gt;
&lt;li&gt;Assemble per-sample transcripts by StringTie&lt;/li&gt;
&lt;li&gt;Merge per-sample transcripts by StringTie&lt;/li&gt;
&lt;li&gt;Quantify transcript abundance by StringTie&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To get the taste of how to write a Snakemake pipeline, I will implement it gradually by breaking it into three major parts: genome reference index build, alignment, and transcript assessment.&lt;/p&gt;
&lt;h3 id="genome-reference-index-build-how-to-write-snakemake-rules"&gt;Genome reference index build (How to write snakemake rules)&lt;/h3&gt;
&lt;p&gt;To build the genome reference, we need to extract the splice sites and exons by two of the HISAT2 scripts, &lt;code&gt;hisat2_extract_splice_sites.py&lt;/code&gt; and &lt;code&gt;hisat2_extract_exons.py&lt;/code&gt;. Then we call &lt;code&gt;hisat2-build&lt;/code&gt; to build the index. Create a new file at &lt;code&gt;~/snakemake_example/Snakefile&lt;/code&gt; with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;GENOME_FA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/chr22_ERCC92.fa&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;extract_genome_splice_sites&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.ss&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_extract_splice_sites.py {input} &amp;gt; {output}&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;extract_genome_exons&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.exon&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_extract_exons.py {input} &amp;gt; {output}&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;build_hisat_index&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;genome_fa&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GENOME_FA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;splice_sites&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.ss&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;exons&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.exon&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{HISAT2_INDEX_PREFIX}.{{ix}}.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/build.log&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2-build -p {threads} {input.genome_fa} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;--ss {input.splice_sites} --exon {input.exons} {HISAT2_INDEX_PREFIX} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;2&amp;gt;{log}&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Overall &lt;code&gt;Snakefile&lt;/code&gt; is Python-based, so one can define variables and functions, import Python libraries, and use all the string operations as one does in the Python source code.  Here I defined some constants to the genome reference files (&lt;code&gt;GENOME_FA&lt;/code&gt; and &lt;code&gt;GENOME_GTF&lt;/code&gt;) and the output index prefix (&lt;code&gt;HISAT2_INDEX_PREFIX&lt;/code&gt;) because they will get quite repetitive and specifying them at the front can make future modifications easier.&lt;/p&gt;
&lt;p&gt;In case one hasn&amp;rsquo;t read the &lt;a href="https://snakemake.readthedocs.io/en/stable/tutorial/tutorial.html"&gt;Snakemake Tutorial&lt;/a&gt;, here is an overview of the Snakemake pipeline execution.  A Snakemake rule is similar to a Makefile rule.  In a rule, one can specify the input pattern and the output pattern of a rule, as well as the command to run for this rule.  When snakemake runs, all the output user wants to generate will be translated into a sets of rules to be run.  Based on the desired output, Snakemake will find the rule that can generate them (matching the rule&amp;rsquo;s output pattern) and the required input.  The finding process can be traversed rules after rules, that is, some input of a rule depends on the output of another rule, until all the inputs are available.  Then Snakemake will start to generate the output by running the commands each rule gives.&lt;/p&gt;
&lt;p&gt;Now we can look at the three rules in our current &lt;code&gt;Snakefile&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The first rule &lt;code&gt;extract_genome_splice_sites&lt;/code&gt; extracts the genome splice sites. The input file is &lt;code&gt;GENOME_GTF&lt;/code&gt; which is the Ensembl gene annotation. The output is a file at &lt;code&gt;hisat2_index/chr22_ERCC92.ss&lt;/code&gt;. The command to generate the output from the given input is a shell command. The command contains some variables, &lt;code&gt;{input}&lt;/code&gt; and &lt;code&gt;{output}&lt;/code&gt;, where Snakemake will fill in them with the sepcified intput and output. So when the first rule is activated, Snakemake will let Bash shell to run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hisat2_extract_splice_sites.py &lt;span class="se"&gt;\&lt;/span&gt;
    griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf &lt;span class="se"&gt;\&lt;/span&gt;
    &amp;gt; hisat2_index/chr22_ERCC92.ss
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The second rule &lt;code&gt;extract_genome_exons&lt;/code&gt; is quite similar to the first one, but extracts the genome exons and stores it in &lt;code&gt;hisat2_index/chr22_ERCC92.exon&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The third rule &lt;code&gt;build_hisat_index&lt;/code&gt; builds the actual index. Input can be multiple files, in this case there are three entries, including the chromosome sequence, splice sites and exons. One can later refer only to input of the same entry by their entry name. For example, &lt;code&gt;{input.genome_fa}&lt;/code&gt; means the chromosome sequence FASTA file.&lt;/p&gt;
&lt;p&gt;The output of the third rule is &lt;code&gt;expand(f"{HISAT2_INDEX_PREFIX}.{{ix}}.ht2", ix=range(1, 9))&lt;/code&gt;, where &lt;code&gt;expand(...)&lt;/code&gt; is a Snakemake function which can interpolate a string pattern into an array of strings. In this case the generate index files are &lt;code&gt;&amp;lt;index_prefix&amp;gt;.1.ht2&lt;/code&gt;, &amp;hellip; ,&lt;code&gt;&amp;lt;index_prefix&amp;gt;.8.ht2&lt;/code&gt;. Instead of specifies the output eight times, we use &lt;code&gt;expand&lt;/code&gt; and pass a variable &lt;code&gt;ix&lt;/code&gt; to iterate from 1 to 8. The double curly brackets are to escape the &lt;code&gt;f"..."&lt;/code&gt; f-string interpolation (see &lt;a href="https://docs.python.org/3/whatsnew/3.6.html#whatsnew36-pep498"&gt;the Python documentation&lt;/a&gt;). So the whole process to interpret the output is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{HISAT2_INDEX_PREFIX}.{{ix}}.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.{ix}.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.1.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.2.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.8.ht2&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For the rest of the entries such as &lt;code&gt;threads&lt;/code&gt;, and &lt;code&gt;log&lt;/code&gt;, one can find more information at &lt;a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html"&gt;the Snakemake documentation about Rules&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id="run-snakemake"&gt;Run Snakemake&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s build the genome reference index.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; snakemake -j &lt;span class="m"&gt;8&lt;/span&gt; -p build_hisat_index
&lt;span class="go"&gt;Provided cores: 8&lt;/span&gt;
&lt;span class="go"&gt;Rules claiming more threads will be scaled down.&lt;/span&gt;
&lt;span class="go"&gt;Job counts:&lt;/span&gt;
&lt;span class="go"&gt;    count   jobs&lt;/span&gt;
&lt;span class="go"&gt;    1   build_hisat_index&lt;/span&gt;
&lt;span class="go"&gt;    1   extract_genome_exons&lt;/span&gt;
&lt;span class="go"&gt;    1   extract_genome_splice_sites&lt;/span&gt;
&lt;span class="go"&gt;    3&lt;/span&gt;

&lt;span class="go"&gt;rule extract_genome_exons:&lt;/span&gt;
&lt;span class="go"&gt;    input: griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf&lt;/span&gt;
&lt;span class="go"&gt;    output: hisat2_index/chr22_ERCC92.exon&lt;/span&gt;
&lt;span class="go"&gt;    jobid: 1&lt;/span&gt;

&lt;span class="go"&gt;hisat2_extract_exons.py griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf &amp;gt; hisat2_index/chr22_ERCC92.exon&lt;/span&gt;
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;3 of 3 steps (100%) done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The command &lt;code&gt;snakemake -j 8 -p build_hisat_index&lt;/code&gt; means:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-j 8&lt;/code&gt;: Use 8 cores&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-p&lt;/code&gt;: Print the actual command of each job&lt;/li&gt;
&lt;li&gt;&lt;code&gt;build_hisat_index&lt;/code&gt;: The rule or certain output to be generated&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If one runs it again, one will find that snakemake won&amp;rsquo;t do anything since all the output are present and updated.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; snakemake -j &lt;span class="m"&gt;8&lt;/span&gt; -p build_hisat_index
&lt;span class="go"&gt;Nothing to be done.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="sample-alignment-how-to-write-a-general-rule"&gt;Sample alignment (How to write a general rule)&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s write the rule to do the sample alignment. Append the &lt;code&gt;Snakefile&lt;/code&gt; with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;glob_wildcards&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/{sample}.read1.fastq.gz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_hisat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;hisat2_index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{HISAT2_INDEX_PREFIX}.{{ix}}.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="n"&gt;fastq1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/{sample}.read1.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;fastq2&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/{sample}.read2.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;align_hisat2/{sample}.bam&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;align_hisat2/{sample}.log&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2 -p {threads} --dta -x {HISAT2_INDEX_PREFIX} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-1 {input.fastq1} -2 {input.fastq2} 2&amp;gt;{log} | &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;samtools sort -@ {threads} -o {output}&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_all_samples&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;align_hisat2/{sample}.bam&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;There are two rules here but only &lt;code&gt;align_hisat&lt;/code&gt; does the real work. The rule looks familar but there are something new. There is a unresolved variable &lt;code&gt;{sample}&lt;/code&gt; in input, output and log entries, such as &lt;code&gt;fastq1=".../{sample}.read1.fastq.gz"&lt;/code&gt;. So this rule will apply to all outputs that match the pattern &lt;code&gt;align_hisat2/{sample}.bam&lt;/code&gt;. For example, given an output &lt;code&gt;align_hisat2/mysample.bam&lt;/code&gt;, Snakemake will look for the inputs &lt;code&gt;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/mysample.read1.fastq.gz&lt;/code&gt;, where &lt;code&gt;sample = "mysample"&lt;/code&gt; in this case.&lt;/p&gt;
&lt;p&gt;To get the names of all the samples, we use &lt;code&gt;glob_wildcards(...)&lt;/code&gt; which finds all the files that match the given string pattern, and collects the possible values of the variables in the string pattern as a list. Hence all the sample names are stored in &lt;code&gt;SAMPLES&lt;/code&gt;, and the other rule takes input of all samples&amp;rsquo; BAM files to generate alignment of all samples.&lt;/p&gt;
&lt;p&gt;Now run Snakemake again with a different rule target:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;snakemake -j 8 -p align_all_samples
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This time pay attention to the CPU usage (say, using &lt;a href="http://hisham.hm/htop/"&gt;&lt;code&gt;htop&lt;/code&gt;&lt;/a&gt;), one should find out that snakemake runs jobs in parallel, and tries to use as many cores as possible.&lt;/p&gt;
&lt;h3 id="transcript-assement"&gt;Transcript assement&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s complete the whole pipeline by adding all StringTie steps to &lt;code&gt;Snakefile&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_assemble&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;genome_gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;bam&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;align_hisat2/{sample}.bam&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;stringtie/assembled/{sample}.gtf&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;stringtie -p {threads} -G {input.genome_gtf} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-o {output} -l {wildcards.sample} {input.bam}&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_merge_list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/assembled/{sample}.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;stringtie/merged_list.txt&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;gtf&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gtf&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resolve&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="nb"&gt;file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_merge&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;genome_gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;merged_list&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/merged_list.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;sample_gtfs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/assembled/{sample}.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;stringtie/merged.gtf&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;stringtie --merge -p {threads} -G {input.genome_gtf} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-o {output} {input.merged_list}&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_quant&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;merged_gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/merged.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;sample_bam&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;align_hisat2/{sample}.bam&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/quant/{sample}/{sample}.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;ctabs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;stringtie/quant/{{sample}}/{name}.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;i2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;i_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;t_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;stringtie -e -B -p {threads} -G {input.merged_gtf} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-o {output.gtf} {input.sample_bam}&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;quant_all_samples&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/quant/{sample}/{sample}.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Most rules are similar to the previous ones except for &lt;code&gt;stringtie_merge_list&lt;/code&gt;. This step a file is generated to contain list of paths to all the samples&amp;rsquo; GTF file. Instead of running some command (no &lt;code&gt;shell&lt;/code&gt; entry), a &lt;code&gt;run&lt;/code&gt; entry is used to write a Python code snippet to generate the file.&lt;/p&gt;
&lt;p&gt;Another thing to be noted is the output entry &lt;code&gt;ctabs=...&lt;/code&gt; of &lt;code&gt;stringtie_quant&lt;/code&gt;. The following lines are equivalent:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Before expansion&lt;/span&gt;
&lt;span class="n"&gt;ctabs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stringtie/quant/{{sample}}/{name}.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;i2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;i_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;t_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# After expansion&lt;/span&gt;
&lt;span class="n"&gt;ctabs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/quant/{sample}/i2t.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stringtie/quant/{sample}/e2t.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stringtie/quant/{sample}/t_data.ctab&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The full &lt;code&gt;Snakefile&lt;/code&gt; can be found &lt;a href="https://gist.github.com/ccwang002/2659b19439b6205284c0ae68ca06345d"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id="job-dependencies-and-dag"&gt;Job dependencies and DAG&lt;/h3&gt;
&lt;p&gt;Now with the pipeline complete, we can further look at the how all the rules are chained with each other. Snakemake has a command to generate the job depedency graph (a DAG):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;snakemake --dag quant_all_samples | dot -Tsvg &amp;gt; dag.svg
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="figure full-img"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2017/08/snakemake-google-cloud/pics/snakemake_rnaseq_dag.svg"/&gt;
  &lt;p class="caption"&gt;Snakemake job dependency graph.&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;Snakemake generates such DAG first before execution, where each node represents a job. As long as two nodes have no connected edges and their input exist, they can be executed parallely. This is a powerful feature to pipeline management, which can use the resources in a fin grain.&lt;/p&gt;
&lt;p&gt;A simpler graph that shows rules instead of jobs can be generated by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;snakemake --rulegraph quant_all_samples | dot -Tsvg &amp;gt; ruledag.svg
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="figure"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2017/08/snakemake-google-cloud/pics/snakemake_rnaseq_ruledag.svg"/&gt;
  &lt;p class="caption"&gt;Snakemake rule dependency graph.&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id="snakemake-on-google-cloud"&gt;Snakemake on Google Cloud&lt;/h2&gt;
&lt;p&gt;Now we start to move our Snakemake pipeline to the Google Cloud. To complete all the following steps, one needs a Google account and has a bucket on the Google Cloud with write access. That is, be able to upload the output back to Google Cloud Storage. Snakemake is able to download/upload files from the cloud, one needs to &lt;a href="https://cloud.google.com/sdk/downloads"&gt;set up the Google Cloud SDK on the local machine&lt;/a&gt; and create the default application credentials:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcloud auth application-default login
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Also, install the neccessary Python packages to give Snakemake the access to storage API:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;conda install google-cloud-storage
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Actually snakemake support remote files from many more providers. More detail can be found at &lt;a href="https://snakemake.readthedocs.io/en/stable/snakefiles/remote_files.html"&gt;the Snakemake documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Note that although one can run this section on a local machine, this step will be significantly faster if one runs it on a Google Computer Engine (GCE) instance. It also saves extra bandwidth and fees.&lt;/p&gt;
&lt;h3 id="move-input-files-to-the-cloud-from-google-cloud-storage"&gt;Move input files to the cloud (from Google Cloud Storage)&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s modify the &lt;code&gt;Snakefile&lt;/code&gt; to use the reference and FASTQ files from Google Cloud Storage. Replace those file paths with the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;snakemake.remote.GS&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;RemoteProvider&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;GSRemoteProvider&lt;/span&gt;
&lt;span class="n"&gt;GS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;GSRemoteProvider&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lbwang-playground/snakemake_rnaseq&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;GENOME_FA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{GS_PREFIX}/griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/chr22_ERCC92.fa&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{GS_PREFIX}/griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;glob_wildcards&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/{sample}.read1.fastq.gz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# rule extract_genome_splice_sites:&lt;/span&gt;
&lt;span class="c1"&gt;# ...&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_hisat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;hisat2_index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{HISAT2_INDEX_PREFIX}.{{ix}}.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="n"&gt;fastq1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/{sample}.read1.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;fastq2&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/{sample}.read2.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now all the file paths are on Google Cloud Storage under the bucket &lt;code&gt;lbwang-playground&lt;/code&gt;. For example, &lt;code&gt;GENOME_FA&lt;/code&gt; points to &lt;code&gt;gs://lbwang-playground/snakemake_rnaseq/griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/chr22_ERCC92.fa&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;One could launch Snakemake again:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;snakemake --timestamp -p --verbose --keep-remote -j 8 quant_all_samples
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="store-output-files-on-the-cloud"&gt;Store output files on the cloud&lt;/h3&gt;
&lt;p&gt;Although we could replace all the file paths to &lt;code&gt;GS.remote(...)&lt;/code&gt;, there is a simpler way to replace every path through the command line option. On top of that, we need to add a &lt;code&gt;FULL_HISAT2_INDEX_PREFIX&lt;/code&gt; variable to reflect the path change that prepends the path under the writable bucket. Replace all &lt;code&gt;{WRITABLE_BUCKET_PATH}&lt;/code&gt; with a writable Google Cloud Storage bucket.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;FULL_HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;{WRITABLE_BUCKET_PATH}/hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;build_hisat_index&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2-build -p {threads} {input.genome_fa} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;--ss {input.splice_sites} --exon {input.exons} {FULL_HISAT2_INDEX_PREFIX} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;2&amp;gt;{log}&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_hisat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2 -p {threads} --dta -x {FULL_HISAT2_INDEX_PREFIX} &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-1 {input.fastq1} -2 {input.fastq2} 2&amp;gt;{log} | &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;samtools sort -@ {threads} -o {output}&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The full &lt;code&gt;Snakefile&lt;/code&gt; can be found &lt;a href="https://gist.github.com/ccwang002/2686840e90574a67a673ec4b48e9f036"&gt;here&lt;/a&gt;. Now run the Snakemake with the following options:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;snakemake --timestamp -p --verbose --keep-remote -j &lt;span class="m"&gt;8&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-provider GS &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-prefix &lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt; &amp;gt; &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To understand how the whole remote files work, here is the the folder structure after the exection:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/snakemake_example
â”œâ”€â”€ lbwang-playground/
â”‚Â Â  â””â”€â”€ snakemake_rnaseq/
â”‚Â Â      â””â”€â”€ griffithlab_brain_vs_uhr/
â”‚Â Â          â”œâ”€â”€ GRCh38_Ens87_chr22_ERCC/
â”‚Â Â          â””â”€â”€ HBR_UHR_ERCC_ds_10pc/
â”œâ”€â”€ {WRITABLE_BUCKET_PATH}/
â”‚Â Â  â”œâ”€â”€ align_hisat2/
â”‚Â Â  â”œâ”€â”€ hisat2_index/
â”‚Â Â  â””â”€â”€ stringtie/
â””â”€â”€ Snakefile
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So Snakemake simply downloads/generates the files with the full path on remote storage.&lt;/p&gt;
&lt;h2 id="dockerize-the-environment"&gt;Dockerize the environment&lt;/h2&gt;
&lt;p&gt;Although bioconda has made the package installation very easy, it would be easier to just isolate the whole environment at the operating system level. One common approach is to use &lt;a href="https://www.docker.com/"&gt;Docker&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A minimal working Dockerfile would be:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; continuumio/miniconda3&lt;/span&gt;
&lt;span class="k"&gt;RUN&lt;/span&gt; conda install -y &lt;span class="nv"&gt;python&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.6 nomkl &lt;span class="se"&gt;\&lt;/span&gt;
        stringtie samtools hisat2 snakemake google-cloud-storage &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; conda clean -y --all
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;However there are some details required extra care at the time of writing, so I&amp;rsquo;ve created a Docker image for this pipeline on Docker Hub, &lt;a href="https://hub.docker.com/r/lbwang/snakemake-conda-rnaseq/"&gt;&lt;code&gt;lbwang/snakemake-conda-rnaseq&lt;/code&gt;&lt;/a&gt;. One could be able to run the snakemake by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~/snakemake_example
docker run -t                       &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;:/analysis             &lt;span class="se"&gt;\&lt;/span&gt;
    lbwang/snakemake-conda-rnaseq   &lt;span class="se"&gt;\&lt;/span&gt;
    snakemake -j &lt;span class="m"&gt;2&lt;/span&gt; --timestamp      &lt;span class="se"&gt;\&lt;/span&gt;
        -s /analysis/Snakefile --directory /analysis &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="use-google-cloud-storage-in-docker-image"&gt;Use Google Cloud Storage in Docker image&lt;/h3&gt;
&lt;p&gt;To use Google&amp;rsquo;s Cloud products in a Docker image, one needs to install &lt;a href="https://cloud.google.com/sdk/downloads"&gt;Google Cloud SDK&lt;/a&gt; inside the Docker image. Refer to &lt;a href="https://github.com/GoogleCloudPlatform/cloud-sdk-docker/blob/master/debian_slim/Dockerfile"&gt;Google&amp;rsquo;s Dockerfile with Cloud SDK&lt;/a&gt; for detail. &lt;a href="https://hub.docker.com/r/lbwang/snakemake-conda-rnaseq/"&gt;&lt;code&gt;lbwang/snakemake-conda-rnaseq&lt;/code&gt;&lt;/a&gt; has installed the Cloud SDK.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo docker run -t -i                           &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;:/analysis                         &lt;span class="se"&gt;\&lt;/span&gt;
    -v ~/.config/gcloud:/root/.config/gcloud    &lt;span class="se"&gt;\&lt;/span&gt;
    lbwang/snakemake-conda-rnaseq               &lt;span class="se"&gt;\&lt;/span&gt;
    snakemake -j &lt;span class="m"&gt;4&lt;/span&gt; --timestamp --verbose -p --keep-remote   &lt;span class="se"&gt;\&lt;/span&gt;
        -s /analysis/Snakefile --directory /analysis        &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-provider GS --default-remote-prefix &lt;span class="s2"&gt;&amp;quot;{WRITABLE_BUCKET_PATH}&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To run Docker on a GCE VM instance, it requires the host machine (the VM instance) to have Docker installed. One may refer to Docker&amp;rsquo;s &lt;a href="https://docs.docker.com/engine/installation/linux/docker-ce/debian/#install-using-the-repository"&gt;official installation guide&lt;/a&gt; to install it. VM instance by default inherit the user&amp;rsquo;s permission (via the automatically created service account), thus the command above should apply to the GCE instance as well.&lt;/p&gt;
&lt;h2 id="google-container-engine-gke"&gt;Google Container Engine (GKE)&lt;/h2&gt;
&lt;p&gt;To scale up the pipeline execution across multiple machines, Snakemake could use &lt;a href="https://cloud.google.com/container-engine/"&gt;Google Container Engine&lt;/a&gt; (GKE, implemented on top of Kubernetes). This method is built on Docker which each node will pull down the given Docker image to load the environment. After &lt;a href="https://bitbucket.org/snakemake/snakemake/issues/602"&gt;some discussions&lt;/a&gt; about how to specify user input image &lt;sup id="fnref-kubernetes-docker"&gt;&lt;a class="footnote-ref" href="#fn-kubernetes-docker"&gt;1&lt;/a&gt;&lt;/sup&gt;, on Snakemake 4.1+ one is able to specify the Docker image Kubernete&amp;rsquo;s node uses by &lt;code&gt;--container-image &amp;lt;image&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To install the master branch of Snakemake, run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install git+https://bitbucket.org/snakemake/snakemake.git@master
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Following Snakemake&amp;rsquo;s &lt;a href="https://snakemake.readthedocs.io/en/stable/executable.html#executing-a-snakemake-workflow-via-kubernetes"&gt;GKE guide&lt;/a&gt;, extra packages need to be installed to talk to GKE (Kubernetes) cluster:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install kubernetes
gcloud components install kubectl
&lt;span class="c1"&gt;# or Debian on GCE:&lt;/span&gt;
&lt;span class="c1"&gt;# sudo apt-get install kubectl&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;First we create the GKE cluster by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CLUSTER_NAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;snakemake-cluster&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;ZONE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;us-central1-a&amp;quot;&lt;/span&gt;
gcloud container clusters create &lt;span class="nv"&gt;$CLUSTER_NAME&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --zone&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$ZONE&lt;/span&gt; --num-nodes&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --machine-type&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;n1-standard-4&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --scopes storage-rw
gcloud container clusters get-credentials --zone&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$ZONE&lt;/span&gt; &lt;span class="nv"&gt;$CLUSTER_NAME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This will launch 3 GCE VM instances using &lt;code&gt;n1-standard-4&lt;/code&gt; machine type (4 CPUs). Therefore in the cluster there are total 12 CPUs available for computation. Modify the variables to fit one&amp;rsquo;s setting.&lt;/p&gt;
&lt;p&gt;Note that some rule may specify a number of CPUs that no node in the clusters has, say the rule &lt;code&gt;build_hisat_index&lt;/code&gt; specifies 8 threads. In this case, the cluster cannot find a node with enough free CPUs to forward the job to a &lt;a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/"&gt;pod&lt;/a&gt; and the cluster will halt. Therefore, make sure to lower the &lt;code&gt;threads&lt;/code&gt; to a reasonable number (or use &lt;a href="https://snakemake.readthedocs.io/en/stable/snakefiles/configuration.html"&gt;configfile&lt;/a&gt; to apply to mulitple samples). We will continue to use the same Docker image &lt;a href="https://hub.docker.com/r/lbwang/snakemake-conda-rnaseq/"&gt;&lt;code&gt;lbwang/snakemake-conda-rnaseq&lt;/code&gt;&lt;/a&gt; as the Kubernetes&amp;rsquo; container image.&lt;/p&gt;
&lt;p&gt;By default, Snakemake will always check if the output files are outdated, that is, older than the rule that generated them. To ensure it re-runs the pipeline, one might need to remove the generated output before calling Snakemake again:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gsutil -m rm -r gs://&lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt;/&lt;span class="o"&gt;{&lt;/span&gt;align_hisat2,hisat2_index,stringtie&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we are able to run the pipeline again.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;snakemake                                            &lt;span class="se"&gt;\&lt;/span&gt;
    --timestamp -p --verbose --keep-remote           &lt;span class="se"&gt;\&lt;/span&gt;
    -j &lt;span class="m"&gt;12&lt;/span&gt; --kubernetes                               &lt;span class="se"&gt;\&lt;/span&gt;
    --container-image lbwang/snakemake-conda-rnaseq &lt;span class="se"&gt;\&lt;/span&gt;
    --default-remote-provider GS                     &lt;span class="se"&gt;\&lt;/span&gt;
    --default-remote-prefix &lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt;   &lt;span class="se"&gt;\&lt;/span&gt;
    quant_all_samples
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note that since we change the container image, we have to make sure the version of Snakemake in the Docker image and the machine starting the pipeline matches. An easy way to ensure that the versions are matched is to start the workflow inside the same Docker image.&lt;/p&gt;
&lt;p&gt;To connect the Kubernete cluster inside Docker, we need to pass kubectl&amp;rsquo;s config file as well, which is at &lt;code&gt;~/.kube/config&lt;/code&gt;. So the full command becomes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo docker run -t -i                           &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;:/analysis                         &lt;span class="se"&gt;\&lt;/span&gt;
    -v ~/.config/gcloud:/root/.config/gcloud    &lt;span class="se"&gt;\&lt;/span&gt;
    -v ~/.kube/config:/root/.kube/config        &lt;span class="se"&gt;\&lt;/span&gt;
    lbwang/snakemake-conda-rnaseq               &lt;span class="se"&gt;\&lt;/span&gt;
    snakemake                                           &lt;span class="se"&gt;\&lt;/span&gt;
        -s /analysis/Snakefile --directory /analysis    &lt;span class="se"&gt;\&lt;/span&gt;
        --timestamp -p --verbose --keep-remote          &lt;span class="se"&gt;\&lt;/span&gt;
        -j &lt;span class="m"&gt;12&lt;/span&gt; --kubernetes                              &lt;span class="se"&gt;\&lt;/span&gt;
        --container-image lbwang/snakemake-conda-rnaseq &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-provider GS                    &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-prefix &lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt;  &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After running our pipeline, make sure to delete the GKE cluster by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcloud container clusters delete --zone&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$ZONE&lt;/span&gt; &lt;span class="nv"&gt;$CLUSTER_NAME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="potential-issues-of-using-gke-with-snakemake"&gt;Potential issues of using GKE with Snakemake&lt;/h3&gt;
&lt;p&gt;I still encountered the following issues while running the whole pipeline on the Kubernetes. It is likely that they are not Snakemake&amp;rsquo;s fault but I couldn&amp;rsquo;t find enough time to dig into the details at the time of writing:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HISAT2 cannot build its index on Kubenetes. So the step &lt;code&gt;build_hisat_index&lt;/code&gt; failed for unknown reason. The error message from HISAT2 looks like this:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;...
Wrote 8912688 bytes to secondary GFM file: {WRITABLE_BUCKET_PATH}/snakemake_demo/hisat2_index/chr22_ERCC92.6.ht2
Index is corrupt: File size for {WRITABLE_BUCKET_PATH}/snakemake_demo/hisat2_index/chr22_ERCC92.6.ht2 should have been 8912688 but is actually 0.
Please check if there is a problem with the disk or if disk is full.
Total time for call to driver() for forward index: 00:01:18
Error: Encountered internal HISAT2 exception (#1)
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;Snakemake is a flexible pipeline management tool that can be run locally and on the cloud. Although it is able to run on Kubernetes such as Google Container Engine, it is a relatively new feature and will take some time to stablize. Currently if one wants to run everything (both the computing and the data) on the cloud, using Google Compute Engine and Google Cloud Storage will be the way to go.&lt;/p&gt;
&lt;p&gt;Using a 4-core (n1-standard-4) GCE instance, the total time to finish the pipeline locally and via Google Cloud Storage were 3.2 mins and 5.8 mins resepctively. So there are some overhead to transfer files from/to the storage.&lt;/p&gt;
&lt;p&gt;Docker and bioconda have made the deployment a lot easier. Bioconda truly saves a lot of duplicated efforts to figure out the tool compilation. Docker provides an OS-level isolation and an ecosystem of deployment. With more tools such as &lt;a href="http://singularity.lbl.gov/"&gt;Singularity&lt;/a&gt; continuing to come out, virtualization seems to be a inevitable trend.&lt;/p&gt;
&lt;p&gt;Other than Google cloud products, Snakemake also supports AWS, S3, LSF, SLURM and many other cluster settings. It seems to me that the day when one &lt;code&gt;Snakefile&lt;/code&gt; works for all platforms might be around the corner.&lt;/p&gt;
&lt;p&gt;EDIT 2017-08-15: Add a section about using Google Cloud in Docker. Update summary with some time measurements. Add links to the full Snakefiles.&lt;br&gt;
EDIT 2017-09-07: Snakemake has added the support of custom Kubernetes container image. Thus update the GKE section to use the official parameter to pass image.&lt;br&gt;
EDIT 2017-11-17: Add instructions to run the Snakemake on Kubernete inside Docker. And also list out the issues of using GKE.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-kubernetes-docker"&gt;
&lt;p&gt;In the discussion, Snakemake&amp;rsquo;s author, Johannes, mentioned the possiblity of using &lt;a href="http://singularity.lbl.gov/"&gt;Singularity&lt;/a&gt; so each rule can run in a different virutal environment. Singularity support comes at Snakemake 4.2+.&amp;#160;&lt;a class="footnote-backref" href="#fnref-kubernetes-docker" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="en"></category><category term="bio"></category><category term="python"></category><category term="snakemake"></category><category term="cloud"></category></entry><entry><title>ä½¿ç”¨ conda env éƒ¨ç½² Django</title><link href="https://blog.liang2.tw/posts/2016/05/django-deploy-conda/" rel="alternate"></link><published>2016-05-24T00:00:00-05:00</published><updated>2016-05-24T00:00:00-05:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2016-05-24:/posts/2016/05/django-deploy-conda/</id><summary type="html">&lt;p&gt;æ²’å¹¾å¤©å‰å‰›éƒ¨ç½²ä¸€æ¬¡ Djangoï¼Œè¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/"&gt;ã€Šä½¿ç”¨ uWSGIã€nginxã€systemd éƒ¨ç½² Djangoã€‹&lt;/a&gt;ã€‚ä»Šå¤©åˆéƒ¨ç½²äº†å¦ä¸€å€‹å°ˆæ¡ˆã€‚éƒ¨ç½²çš„è¨­å®šè·Ÿä¸Šæ¬¡ä¸€æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nginx -- unix socket -- uWSGI -- Django
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸€æ¨£å¯«ä¸€å€‹ &lt;code&gt;PROJ.service&lt;/code&gt; çš„ systemd unit ä¾†ç®¡ç†ç¶²ç«™çš„å•Ÿå‹• (uWSGI â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æ²’å¹¾å¤©å‰å‰›éƒ¨ç½²ä¸€æ¬¡ Djangoï¼Œè¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/"&gt;ã€Šä½¿ç”¨ uWSGIã€nginxã€systemd éƒ¨ç½² Djangoã€‹&lt;/a&gt;ã€‚ä»Šå¤©åˆéƒ¨ç½²äº†å¦ä¸€å€‹å°ˆæ¡ˆã€‚éƒ¨ç½²çš„è¨­å®šè·Ÿä¸Šæ¬¡ä¸€æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nginx -- unix socket -- uWSGI -- Django
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸€æ¨£å¯«ä¸€å€‹ &lt;code&gt;PROJ.service&lt;/code&gt; çš„ systemd unit ä¾†ç®¡ç†ç¶²ç«™çš„å•Ÿå‹• (uWSGI)ã€‚ä¹‹å¾Œæåˆ° &lt;code&gt;PROJ&lt;/code&gt; æ™‚å°±æ›æˆè‡ªå·±çš„å°ˆæ¡ˆåç¨±ï¼›&lt;code&gt;USER&lt;/code&gt; å°±æ›æˆåŸ·è¡Œç¶²ç«™çš„å¸³è™Ÿã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#conda"&gt;conda&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#uwsgi-path"&gt;uWSGI å’Œ $PATH&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sysmted-unit"&gt;åœ¨ sysmted unit ä½¿ç”¨ç’°å¢ƒè®Šæ•¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;çµè«–&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="conda"&gt;conda&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://conda.pydata.org/"&gt;conda&lt;/a&gt; æ˜¯ä¸€å€‹ Python å¥—ä»¶çš„ç®¡ç†ç³»çµ±ï¼Œä»–çš„å¥½è™•æ˜¯ï¼Œé‡åˆ°è¦ä½¿ç”¨å¤–éƒ¨ library æ™‚ï¼Œæœƒé€™äº›å¥—ä»¶ç›¸ä¾çš„ library éƒ½ä¸€ä½µå®‰è£ç®¡ç†ï¼Œä¹Ÿå¯ä»¥ç®¡ç†ä¸åŒ Python ç‰ˆæœ¬ã€‚å¯ä»¥æƒ³åƒæ˜¯åŠ å¼·ç‰ˆçš„ pip + venvã€‚conda è·Ÿ pip æ˜¯ç›¸å®¹çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹ Django å°ˆæ¡ˆå°±ç”¨åˆ°å¾ˆå¤šåƒ numpyã€pandas çš„å¥—ä»¶ã€‚ç‚ºäº†ç¶­è­·æ–¹ä¾¿ï¼Œæˆ‘è€ƒæ…®ç”¨ conda ä¾†å®‰è£ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ &lt;a href="http://conda.pydata.org/miniconda.html"&gt;miniconda3&lt;/a&gt;ï¼Œé è¨­æœƒå®‰è£åœ¨ &lt;code&gt;~/miniconda3&lt;/code&gt; åº•ä¸‹ï¼Œè™›æ“¬ç’°å¢ƒæœƒå‡ºç¾åœ¨ &lt;code&gt;~/miniconda3/envs/&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ conda create -n VENV &lt;span class="nv"&gt;python&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.5 numpy pandas django
$ &lt;span class="nb"&gt;source&lt;/span&gt; activate VENV
&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ pip install uwsgi
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;uWSGI æ²’æœ‰åœ¨ conda è£¡é¢ï¼Œæ‰€ä»¥å°±ç”¨ pip è£ã€‚å¾ž&lt;a href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/"&gt;ä¸Šæ¬¡çš„æ–‡ç« &lt;/a&gt;çŸ¥é“ç³»çµ±ä¸¦ä¸ç”¨å®‰è£ã€‚&lt;/p&gt;
&lt;h3 id="uwsgi-path"&gt;uWSGI å’Œ $PATH&lt;/h3&gt;
&lt;p&gt;ç†è«–ä¸Šï¼Œä¹‹å¾Œå°±ç…§è‘—ä¸Šæ¬¡æ“ä½œå°±å¥½ï¼Œä½†åœ¨ uWSGI å°±ç¢°åˆ°å•é¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;$ sudo /home/USER/miniconda3/envs/VENV/bin/uwsgi --ini PROJ.ini&lt;/span&gt;
&lt;span class="go"&gt;[uWSGI] getting INI configuration from PROJ.ini&lt;/span&gt;
&lt;span class="go"&gt;*** Starting uWSGI 2.0.13.1 (64bit) on [Wed May 25 08:04:23 2016] ***&lt;/span&gt;
&lt;span class="go"&gt;compiled with version: 5.3.1 20160413 on 25 May 2016 01:35:28&lt;/span&gt;
&lt;span class="go"&gt;os: Linux-4.4.0-22-generic #40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016&lt;/span&gt;
&lt;span class="go"&gt;nodename: s66&lt;/span&gt;
&lt;span class="go"&gt;machine: x86_64&lt;/span&gt;
&lt;span class="go"&gt;clock source: unix&lt;/span&gt;
&lt;span class="go"&gt;detected number of CPU cores: 24&lt;/span&gt;
&lt;span class="go"&gt;current working directory: /etc/uwsgi/vassals&lt;/span&gt;
&lt;span class="go"&gt;detected binary path: /home/USER/miniconda3/envs/VENV/bin/uwsgi&lt;/span&gt;
&lt;span class="go"&gt;â€¦â€¦&lt;/span&gt;
&lt;span class="go"&gt;chdir() to /path/to/PROJ/&lt;/span&gt;
&lt;span class="go"&gt;your processes number limit is 514650&lt;/span&gt;
&lt;span class="go"&gt;your memory page size is 4096 bytes&lt;/span&gt;
&lt;span class="go"&gt;detected max file descriptor number: 1024&lt;/span&gt;
&lt;span class="go"&gt;lock engine: pthread robust mutexes&lt;/span&gt;
&lt;span class="go"&gt;thunder lock: disabled (you can enable it with --thunder-lock)&lt;/span&gt;
&lt;span class="go"&gt;uwsgi socket 0 bound to UNIX address /run/PROJ/django.sock fd 3&lt;/span&gt;
&lt;span class="go"&gt;Python version: 3.5.1 |Continuum Analytics, Inc.| (default, Dec  7 2015, 11:16:01)  [GCC 4.4.7 20120313 (Red Hat 4.4.7-1)]&lt;/span&gt;
&lt;span class="go"&gt;Set PythonHome to /home/USER/miniconda3/envs/VENV&lt;/span&gt;
&lt;span class="go"&gt;Failed to import the site module&lt;/span&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/usr/lib/python3.5/site.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;580&lt;/span&gt;, in &lt;span class="n"&gt;&amp;lt;module&amp;gt;&lt;/span&gt;
    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gr"&gt;  â€¦â€¦ &lt;/span&gt;
&lt;span class="gr"&gt;  File &amp;quot;/usr/lib/python3.5/_sysconfigdata.py&amp;quot;, line 6, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="gr"&gt;    from _sysconfigdata_m import *&lt;/span&gt;
&lt;span class="gr"&gt;ImportError&lt;/span&gt;: &lt;span class="n"&gt;No module named &amp;#39;_sysconfigdata_m&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½†å› ç‚ºæ­¥é©Ÿå¯¦åœ¨å¤ªç°¡å–®ï¼Œæƒ³ä¸å‡ºä¾†å“ªè£¡æœ‰éŒ¯ï¼ŒæŸ¥ç¶²è·¯ä¹Ÿæ²’ä»€éº¼ç›¸é—œçš„çµæžœã€‚åœ¨é€™é‚Šå¡äº†å¾ˆä¹…ã€‚&lt;/p&gt;
&lt;p&gt;çµæžœå¾Œä¾†æ‰ç™¼ç¾ï¼ŒTraceback é‚£é‚Š uWSGi è·‘åŽ»è®€åˆ° &lt;code&gt;/usr/lib/python3.5/site.py&lt;/code&gt;ï¼Œé€™è¡¨ç¤ºä¸€å®šæœ‰ç’°å¢ƒè¨­éŒ¯æ‰è®“å®ƒæ‰¾åˆ°é€™å€‹ä¸æ˜¯æˆ‘å€‘è¦çš„ python ç’°å¢ƒï¼Œç†è«–ä¸Šæ‡‰è©²æ˜¯æ‰¾åˆ° &lt;code&gt;/home/USER/miniconda3/envs/VENV/lib/python3.5/site.py&lt;/code&gt; æ‰å°ã€‚&lt;/p&gt;
&lt;p&gt;ç¶“éŽä¸€é™£å˜—è©¦ï¼Œç™¼ç¾åªè¦ä¿®æ”¹ &lt;code&gt;$PATH&lt;/code&gt; ç’°å¢ƒè®Šæ•¸å°±èƒ½é‹ä½œäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; sudo -i
&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$PATH&lt;/span&gt;
&lt;span class="go"&gt;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/USER/miniconda3/envs/VENV/bin:&lt;span class="nv"&gt;$PATH&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; /home/USER/miniconda3/envs/VENV/bin/uwsgi --ini PROJ.ini
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="sysmted-unit"&gt;åœ¨ sysmted unit ä½¿ç”¨ç’°å¢ƒè®Šæ•¸&lt;/h3&gt;
&lt;p&gt;æ ¹æ“š &lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#%24PATH"&gt;systemd.exec(5)&lt;/a&gt; é—œæ–¼ &lt;code&gt;$PATH&lt;/code&gt; ç’°å¢ƒè®Šæ•¸çš„ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Colon-separated list of directories to use when launching executables. Systemd uses a fixed value of /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é è¨­åªæœ‰ä»¥ä¸Šæåˆ°çš„è·¯å¾‘ï¼Œå¦‚æžœè¦ä¿®æ”¹ç’°å¢ƒè®Šæ•¸çš„è©±ï¼Œå°±é€éŽ &lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Environment="&gt;&lt;code&gt;Environment=&lt;/code&gt;&lt;/a&gt;ï¼Œå› æ­¤å¤šåŠ äº†ä¸€è¡Œåœ¨ systemd unit è£¡ã€‚å…¶é¤˜çš„è¨­å®šéƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PROJ Django server by uWSGI&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog.target&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;PATH=/home/USER/miniconda3/envs/VENV/bin:$PATH&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/home/USER/miniconda3/envs/VENV/bin/uwsgi --ini /etc/uwsgi/vassals/PROJ.ini&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;
&lt;span class="na"&gt;KillSignal&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;SIGQUIT&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;notify&lt;/span&gt;
&lt;span class="na"&gt;StandardError&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog&lt;/span&gt;
&lt;span class="na"&gt;NotifyAccess&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;all&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_1"&gt;çµè«–&lt;/h3&gt;
&lt;p&gt;å¦‚æžœè¦æ”¹ç”¨ conda ç®¡ç†å¥—ä»¶çš„è©±ï¼Œåªè¦åœ¨ systemd unit é‚£é‚Šå¤šåŠ ä¸€è¡Œä¿®æ”¹ $PATHï¼ŒåŠ å…¥è™›æ“¬ç’°å¢ƒæ”¾åŸ·è¡Œæª”çš„è·¯å¾‘ï¼Œå…¶é¤˜çš„è¨­å®šéƒ½èˆ‡ä¸€èˆ¬ Python è™›æ“¬ç’°å¢ƒç›¸åŒã€‚é€™æ¨£å°±æžå®šäº†ã€‚ä½†é€™å€‹å•é¡ŒèŠ±äº†æˆ‘ 1 å€‹å¤šå°æ™‚â€¦â€¦&lt;/p&gt;</content><category term="zh"></category><category term="python"></category><category term="django"></category><category term="postgresql"></category><category term="deploy"></category><category term="debian"></category><category term="systemd"></category><category term="nginx"></category><category term="uwsgi"></category><category term="conda"></category></entry><entry><title>ä½¿ç”¨ uWSGIã€nginxã€systemd éƒ¨ç½² Django</title><link href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/" rel="alternate"></link><published>2016-05-19T00:00:00-05:00</published><updated>2016-05-19T00:00:00-05:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2016-05-19:/posts/2016/05/django-deploy-uwsgi-nginx-systemd/</id><summary type="html">&lt;p&gt;ä¸Šä¸€æ¬¡å¾ˆèªçœŸçš„ Django éƒ¨ç½²è¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;ã€Šè¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Serverã€‹&lt;/a&gt;ä¸€æ–‡ã€‚å¾ˆå·§åœ°è‡ªå·±ç•¢æ¥­çš„é¡Œç›®ä¹Ÿè¦æž¶å€‹ Django ç¶²ç«™ï¼Œæ‰€ä»¥å°±å†è·‘äº†ä¸€æ¬¡éƒ¨ç½²è¨­å®šã€‚èˆŠæ–‡é‚„æäº†æœ‰çš„æ²’çš„ï¼Œé€™ç¯‡åƒ…é‡å° Django çš„éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šçš„éƒ¨ç½²è¨­å®šéƒ½å„˜é‡ä¸ä½¿ç”¨ root æ¬Šé™ï¼Œæ•´å€‹é€£ç·šçš„æµç¨‹åœ–å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nginx -- unix socket -- uWSGI â€¦&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;ä¸Šä¸€æ¬¡å¾ˆèªçœŸçš„ Django éƒ¨ç½²è¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;ã€Šè¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Serverã€‹&lt;/a&gt;ä¸€æ–‡ã€‚å¾ˆå·§åœ°è‡ªå·±ç•¢æ¥­çš„é¡Œç›®ä¹Ÿè¦æž¶å€‹ Django ç¶²ç«™ï¼Œæ‰€ä»¥å°±å†è·‘äº†ä¸€æ¬¡éƒ¨ç½²è¨­å®šã€‚èˆŠæ–‡é‚„æäº†æœ‰çš„æ²’çš„ï¼Œé€™ç¯‡åƒ…é‡å° Django çš„éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šçš„éƒ¨ç½²è¨­å®šéƒ½å„˜é‡ä¸ä½¿ç”¨ root æ¬Šé™ï¼Œæ•´å€‹é€£ç·šçš„æµç¨‹åœ–å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nginx -- unix socket -- uWSGI -- Django
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯«ä¸€å€‹åç‚º &lt;code&gt;PROJ.service&lt;/code&gt; çš„ systemd unit ä¾†ç®¡ç†é€™ç¶²ç«™çš„å•Ÿå‹•èˆ‡å¦ã€‚ä¹‹å¾Œ &lt;code&gt;PROJ&lt;/code&gt; å°±æ›æˆè‡ªå·±çš„å°ˆæ¡ˆåç¨±ï¼›&lt;code&gt;USER&lt;/code&gt; å°±æ›æˆåŸ·è¡Œç¶²ç«™çš„å¸³è™Ÿã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ä½œæ¥­ç³»çµ±&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-proj"&gt;Django PROJ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#tmpfilesd"&gt;tmpfiles.d&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#nginx"&gt;nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#uwsgi"&gt;uWSGI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#systemd"&gt;systemd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç¢ºèªã€ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="_1"&gt;ä½œæ¥­ç³»çµ±&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ Ubuntu 16.04 LTSã€‚æˆ‘å° Ubuntu å…¶å¯¦æ²’æ„›ï¼Œä½†å› ç‚ºå¾ˆå¤šäººç”¨ï¼Œç•¢æ¥­ä¹‹å¾Œæ‡‰è©²é‚„æ‰¾å¾—åˆ°äººç¶­è­·ã€‚ä»–è·Ÿ Debian å·®ä¸å¤šï¼Œæ‰€ä»¥è·ŸèˆŠæ–‡æ²’ä»€éº¼å·®åˆ¥ã€‚Ubuntu 16 å…§å»ºå°±æœ‰ Python 3.5ï¼Œä¸ç”¨å†è£ï¼›PostgreSQL ä¹Ÿä¾†åˆ° 9.5 ç‰ˆã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href="https://wiki.debian.org/UnattendedUpgrades"&gt;unattended-upgrades&lt;/a&gt; å®šæœŸæ›´æ–°èˆ‡ security ç›¸é—œçš„å¥—ä»¶ï¼Œå®ƒé è¨­ä¸€å¤©æª¢æŸ¥ä¸€æ¬¡ï¼Œæ›´æ–°çš„è¨˜éŒ„æœƒåœ¨ &lt;code&gt;/var/log/unattended-upgrades&lt;/code&gt; ç›®éŒ„ä¸­ã€‚&lt;/p&gt;
&lt;h3 id="postgresql"&gt;PostgreSQL&lt;/h3&gt;
&lt;p&gt;åƒè€ƒ&lt;a href="https://blog.liang2.tw/posts/2016/01/postgresql-install/"&gt;ã€Šå®‰è£ PostgreSQL 9 æ–¼ Debian Jessie / OSXã€‹&lt;/a&gt;ä¸€æ–‡è¨­å®šã€‚å»ºç«‹è·Ÿ OS user åŒåçš„ PostgreSQL å¸³è™Ÿï¼Œçµ¦äº†å»ºç«‹ database çš„æ¬Šé™ï¼Œé€™æ¨£é–‹ç™¼æ¯”è¼ƒæ–¹ä¾¿ã€‚ä¸ç”¨è¨­å®šå¯†ç¢¼ã€‚&lt;/p&gt;
&lt;h3 id="django-proj"&gt;Django PROJ&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨å…§å»º &lt;a href="https://docs.python.org/3/library/venv.html"&gt;venv&lt;/a&gt; åœ¨è‡ªå·±å®¶ç›®éŒ„ä¸‹æŸè™•ï¼Œå»ºç«‹åç‚º &lt;code&gt;VENV&lt;/code&gt; çš„è™›æ“¬ç’°å¢ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python3.5 -m venv VENV
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æœ‰é—œéƒ¨ç½²çš„è¨­å®šï¼ˆå³ &lt;code&gt;settings.py&lt;/code&gt;ï¼‰ï¼Œåˆ©ç”¨ &lt;a href="https://github.com/joke2k/django-environ"&gt;django-environ&lt;/a&gt; æŠŠ secret keyã€database é€£ç·šè³‡è¨Šã€å¯„ä¿¡ SMTP server ç­‰è¨­å®šå¯«åœ¨ç¨ç«‹çš„æª”æ¡ˆï¼Œå°±å¯ä»¥è®“ local å’Œ production ç’°å¢ƒè®€åˆ°å„è‡ªçš„è¨­å®šã€‚å…·é«”çš„åšæ³•å¯ä»¥åƒè€ƒ &lt;a href="https://github.com/pycontw/pycontw2016/blob/master/src/pycontw2016/settings/production.py"&gt;PyCon Taiwan 2016 ç¶²ç«™ç®¡ç†è¨­å®š&lt;/a&gt; çš„å¯«æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é€£ PostgreSQL æ™‚ä½¿ç”¨ local connection (Unix-domain socket)ï¼Œå³ä½¿ç”¨è€…åŒåçš„èº«ä»½ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="na"&gt;DATABASE_URL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;postgres:///TABLE_NAME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="tmpfilesd"&gt;tmpfiles.d&lt;/h3&gt;
&lt;p&gt;æŠŠ nginx èˆ‡ uwsgi æºé€šç”¨çš„ socket æ”¾åœ¨ &lt;code&gt;/run/PROJ&lt;/code&gt; åº•ä¸‹ï¼Œä½†é€™ä¹Ÿè¡¨ç¤ºé‡é–‹æ©Ÿä¹‹å¾Œï¼Œ&lt;code&gt;/run/PROJ&lt;/code&gt; è³‡æ–™å¤¾å°±æœƒæ¶ˆå¤±ä¸è¦‹ï¼Œæ‰€ä»¥ä½¿ç”¨ &lt;a href="https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html"&gt;tmpfiles.d&lt;/a&gt;&lt;sup id="fnref-systemd-runtimedir"&gt;&lt;a class="footnote-ref" href="#fn-systemd-runtimedir"&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚é™¤äº†è³‡æ–™å¤¾çš„å‘½åæ”¹æˆç”¨å°ˆæ¡ˆåç¨±ï¼Œè¨­å®šéƒ½è·Ÿ&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;èˆŠæ–‡&lt;/a&gt;ä¸€æ¨£ã€‚&lt;/p&gt;
&lt;h3 id="nginx"&gt;nginx&lt;/h3&gt;
&lt;p&gt;nginx è¨­å®šè·Ÿ&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;èˆŠæ–‡&lt;/a&gt;ä¸€æ¨£ã€‚æ”¾åœ¨ &lt;code&gt;/etc/nginx/sites-available/PROJ.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Upstream Django setting; the socket nginx connects to&lt;/span&gt;
&lt;span class="k"&gt;upstream&lt;/span&gt; &lt;span class="s"&gt;django&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;server&lt;/span&gt; &lt;span class="s"&gt;unix:///run/PROJ/django.sock&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt;      &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt;      &lt;span class="mi"&gt;443&lt;/span&gt; &lt;span class="s"&gt;default&lt;/span&gt; &lt;span class="s"&gt;ssl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="mi"&gt;123&lt;/span&gt;&lt;span class="s"&gt;.123.123.123&lt;/span&gt;
                &lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;charset&lt;/span&gt;     &lt;span class="s"&gt;utf-8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;client_max_body_size&lt;/span&gt; &lt;span class="s"&gt;10M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# max upload size&lt;/span&gt;
    &lt;span class="kn"&gt;keepalive_timeout&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/static&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;alias&lt;/span&gt; &lt;span class="s"&gt;/path/to/PROJ/assets&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;# Finally, send all non-media requests to the Django server.&lt;/span&gt;
    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;uwsgi_pass&lt;/span&gt;  &lt;span class="s"&gt;django&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;include&lt;/span&gt;     &lt;span class="s"&gt;/etc/nginx/uwsgi_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;/path/to/PROJ/assets&lt;/code&gt; æ˜¯ Django &lt;a href="https://docs.djangoproject.com/en/1.9/ref/settings/#std:setting-STATIC_ROOT"&gt;STATIC_ROOT&lt;/a&gt; çš„è·¯å¾‘ã€‚åªè¦åŸ·è¡Œ &lt;code&gt;python manage.py collectstatic&lt;/code&gt; å¾Œï¼Œå³ä½¿ uWSGI é‚„æ²’è¨­å®šå°±å¯ä»¥æ¸¬è©¦ /static/&amp;hellip;/ æœ‰æ²’æœ‰è¢« nginx æŠ“åˆ°ã€‚ &lt;/p&gt;
&lt;p&gt;å•Ÿå‹•æ™‚ï¼Œå…ˆæŠŠæª”æ¡ˆé€£çµåˆ° &lt;code&gt;/etc/nginx/site-enabled/&lt;/code&gt;ï¼Œé‡è¼‰ nginx è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /etc/nginx/sites-enabled/
sudo ln -s ../sites-available/PROJ.conf .
sudo systemctl reload nginx
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="uwsgi"&gt;uWSGI&lt;/h3&gt;
&lt;p&gt;è·ŸèˆŠæ–‡æœ€å¤§çš„å·®åˆ¥ï¼Œåªè¦è£åœ¨ VENV è£¡é¢å°±å¥½äº†ï¼›ç„¶å¾Œä¹Ÿä¸ä½¿ç”¨ emperor modeã€‚å¯«ä¸€å€‹ &lt;code&gt;/etc/uwsgi/vassals/PROJ.ini&lt;/code&gt; æ”¾è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[uwsgi]&lt;/span&gt;
&lt;span class="na"&gt;chdir&lt;/span&gt;        &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/path/to/PROJ&lt;/span&gt;
&lt;span class="c1"&gt;# Django&amp;#39;s wsgi file&lt;/span&gt;
&lt;span class="na"&gt;module&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;PROJ.wsgi:application&lt;/span&gt;
&lt;span class="na"&gt;env&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;DJANGO_SETTINGS_MODULE=PROJ.settings.production&lt;/span&gt;
&lt;span class="c1"&gt;# the virtualenv (full path)&lt;/span&gt;
&lt;span class="na"&gt;home&lt;/span&gt;         &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/path/to/VENV&lt;/span&gt;

&lt;span class="c1"&gt;# process-related settings&lt;/span&gt;
&lt;span class="c1"&gt;# master&lt;/span&gt;
&lt;span class="na"&gt;master&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;true&lt;/span&gt;
&lt;span class="c1"&gt;# maximum number of worker processes&lt;/span&gt;
&lt;span class="na"&gt;processes&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;4&lt;/span&gt;
&lt;span class="c1"&gt;# the socket (use the full path to be safe&lt;/span&gt;
&lt;span class="na"&gt;socket&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/run/PROJ/django.sock&lt;/span&gt;
&lt;span class="c1"&gt;# ... with appropriate permissions - may be needed&lt;/span&gt;
&lt;span class="na"&gt;chmod-socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;664&lt;/span&gt;
&lt;span class="na"&gt;uid&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;USER&lt;/span&gt;
&lt;span class="na"&gt;gid&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;www-data&lt;/span&gt;
&lt;span class="c1"&gt;# clear environment on exit&lt;/span&gt;
&lt;span class="na"&gt;vacuum&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¨­å®šå¥½å¾ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œå°±æ‡‰è©²èƒ½çœ‹åˆ°ç¶²ç«™èƒ½å‹•äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo /path/to/VENV/bin/uwsgi --ini /etc/uwsgi/vassals/PROJ.ini
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="systemd"&gt;systemd&lt;/h3&gt;
&lt;p&gt;é€™é‚Šé™¤äº†åŸ·è¡Œ uWSGI çš„æŒ‡ä»¤ä¸åŒå¤–ï¼Œéƒ½è·Ÿ&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;èˆŠæ–‡&lt;/a&gt;ç›¸åŒã€‚Debian ç³» systemd system unit è¨­å®šæª”æ”¾åœ¨ &lt;code&gt;/etc/systemd/system/PROJ.service&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PROJ&amp;#39;s Django server by uWSGI&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog.target&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/path/to/VENV/bin/uwsgi --ini /etc/uwsgi/vassals/PROJ.ini&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;
&lt;span class="na"&gt;KillSignal&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;SIGQUIT&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;notify&lt;/span&gt;
&lt;span class="na"&gt;StandardError&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog&lt;/span&gt;
&lt;span class="na"&gt;NotifyAccess&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;all&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™é‚Šè¨­å®šå®ƒæœƒï¼ˆæœ‰éŒ¯èª¤æ™‚ï¼‰è‡ªå‹•é‡æ–°èµ·å‹•ï¼Œä¸¦æŠŠ stderr å°Žåˆ° syslogã€‚æŽ¥è‘—ï¼Œå°±è¦å•Ÿå‹•é€™å€‹ &lt;code&gt;PROJ.service&lt;/code&gt; æœå‹™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo systemctl &lt;span class="nb"&gt;enable&lt;/span&gt; PROJ
sudo systemctl status PROJ
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥é€éŽ &lt;code&gt;sudo journalctl -xe -u PROJ&lt;/code&gt; ä¾†æŸ¥çœ‹ uWSGI åŸ·è¡Œã€é€£ç·š logã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;ç¢ºèªã€ç¸½çµ&lt;/h3&gt;
&lt;p&gt;é‡å•Ÿç³»çµ±ä¸€æ¬¡ï¼Œå¦‚æžœç¶²ç«™é‚„æ´»è‘—ï¼Œå°±è¡¨ç¤ºä¸€åˆ‡è¨­å®šéƒ½æ²’å•é¡Œã€‚æ•´é«”ä¸Šä¸å¤ªè¤‡é›œï¼Œä½†æ¬Šé™ä¸ç¬¦çš„éŒ¯èª¤å¯èƒ½æœƒè®“ä½ é¬¼æ‰“ç‰†ï¼Œè¦æœ‰è€å¿ƒã€‚&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-systemd-runtimedir"&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ç”¨ &lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html"&gt;systemd.exec(5)&lt;/a&gt; æåˆ°çš„ &lt;code&gt;RuntimeDirectory=PROJ&lt;/code&gt; ä¾†å»ºç«‹åŸ·è¡Œç”¨ç›®éŒ„ã€‚ä½†å› ç‚º &lt;code&gt;PROJ.service&lt;/code&gt; çš„ USER å¿…é ˆæ˜¯ rootï¼Œé€™ç¨®æƒ…æ³ man page å°±å»ºè­°æ”¹ç”¨ tmpfiles.dã€‚æˆ‘è¦ºå¾—æ‡‰è©²èƒ½è§£æ±ºä½¿ç”¨ root æ¬Šé™çš„å•é¡Œï¼Œä½†å¤ªæ‡¶äº†å°±å…ˆé€™æ¨£â€¦â€¦&amp;#160;&lt;a class="footnote-backref" href="#fnref-systemd-runtimedir" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="zh"></category><category term="python"></category><category term="django"></category><category term="postgresql"></category><category term="deploy"></category><category term="debian"></category><category term="systemd"></category><category term="nginx"></category><category term="uwsgi"></category></entry><entry><title>è¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Server</title><link href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/" rel="alternate"></link><published>2016-02-14T21:00:00-06:00</published><updated>2016-02-14T21:00:00-06:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2016-02-14:/posts/2016/02/pydoctw-server/</id><summary type="html">&lt;p&gt;è¨­å®šä¸€å€‹è‡ªå‹•æ›´æ–° Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯ä¸¦ä¸” host ä¸­æ–‡åŒ–ç¶²é ç‰ˆæ–‡ä»¶çš„ serverã€‚ä½¿ç”¨ Django ä½œ web serverã€Django-Q åšç‚º task queueï¼Œdeploy stack ç”¨ nginxã€uWSGIï¼Œhost æ–¼ Amazon EC2 (Debian Jessie)ï¼Œè³‡æ–™åº«ç”¨ PostgreSQLï¼Œä¸¦ç”¨ systemd ç®¡ç†ç›¸é—œçš„ processã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;TL;DR&lt;/em&gt; å¯è‡³ &lt;a href="http://docs.python.org.tw"&gt;http://docs.python.org.tw&lt;/a&gt; çœ‹ç·šä¸Šè‡ªå‹•æ›´æ–°çš„&lt;a href="http://docs.python.org.tw/3/"&gt;ä¸­æ–‡åŒ–çš„æ–‡ä»¶&lt;/a&gt;å’Œ &lt;a href="http://docs.python.org.tw/_build/"&gt;build server&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;EDIT 2016-02-16: åŠ ä¸Š language codeã€git sshconfigã€swap çš„è¨­å®šï¼›æ–‡å¥æ½¤é£¾ã€‚&lt;br&gt;
EDIT 2016-02-20: åŠ ä¸Š tmpfiles.d çš„è¨­å®šã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#python"&gt;Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sphinx"&gt;Sphinx æ–‡ä»¶å¤šåœ‹èªžè¨€æž¶æ§‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#transifex-po"&gt;Transifex ç·šä¸Šæœå‹™è®“å¤šäººå…±åŒç¿»è­¯ po æª”&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç¿»è­¯é«”é©—æ”¹å–„&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#pydoc-autobuild-server"&gt;PyDoc Autobuild Server&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_2"&gt;å¯¦ä½œ&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sphinx_1"&gt;Sphinx æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#autobuild-django-server"&gt;Autobuild Django server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#autobuild-server"&gt;Autobuild server éƒ¨ç½²&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_3"&gt;ä½œæ¥­ç³»çµ±&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python-35-and-apt-pinning"&gt;Python 3.5 and APT-pinning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;è³‡æ–™åº« PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#swap"&gt;Swap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git-repo-ssh-config"&gt;Git repo ssh config&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#tmpfilesd"&gt;tmpfiles.d&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-stack-nginx-uwsgi"&gt;Django Stack &amp;ndash; nginx + uWSGI&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#nginx"&gt;nginx è¨­å®š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#uwsgi"&gt;uWSGI è¨­å®š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#systemd-services"&gt;Systemd services&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="python"&gt;Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘ä¸€æ®µæ™‚é–“éƒ½åœ¨æº–å‚™ &lt;a href="https://github.com/python-doc-tw/python-doc-tw"&gt;Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«&lt;/a&gt;ã€‚ç¿»è­¯æœ¬èº«é›–ç„¶é‚„æ²’å¾ˆç©æ¥µåœ°é€²è¡Œï¼Œä½†ç¶“éŽ&lt;a href="http://www.meetup.com/Taipei-py/events/226558484/"&gt;å‰&lt;/a&gt;&lt;a href="http://www.meetup.com/Taipei-py/events/227001232/"&gt;å¹¾æ¬¡&lt;/a&gt; Taipei.py Projects On çš„ sprint æ´»å‹•ï¼Œå·²ç¶“æœ‰è »å¤šäººåŠ å…¥ç¿»è­¯çš„è¡Œåˆ—ã€‚å¤§å®¶éƒ½æœ‰å„è‡ªç¿»è­¯çš„ä¸»é¡Œï¼Œåƒæˆ‘è‡ªå·±æ˜¯å¾ž &lt;a href="http://docs.python.org.tw/3/tutorial/index.html"&gt;Tutorial&lt;/a&gt; çš„éƒ¨ä»½é–‹å§‹ç¿»è­¯ã€‚&lt;/p&gt;
&lt;h3 id="sphinx"&gt;Sphinx æ–‡ä»¶å¤šåœ‹èªžè¨€æž¶æ§‹&lt;/h3&gt;
&lt;p&gt;å…ˆç°¡ä»‹ä¸€ä¸‹ &lt;a href="https://docs.python.org/3/"&gt;CPython Documentation&lt;/a&gt;ï¼ˆä¸‹ç¨± pydocï¼‰çš„æž¶æ§‹å’Œç¿»è­¯æ–¹å¼ã€‚pydoc æ˜¯æ¨™æº–çš„ &lt;a href="http://www.sphinx-doc.org/en/stable/"&gt;Sphinx&lt;/a&gt; æ–‡ä»¶ï¼Œå› æ­¤ç¿»è­¯ä½¿ç”¨ Sphinx è‡ªå¸¶çš„ &lt;a href="http://www.sphinx-doc.org/en/stable/intl.html"&gt;internationalization&lt;/a&gt; (i18n or intl) åŠŸèƒ½æŠŠæ–‡ä»¶çš„å…§å®¹è½‰æ›åˆ°åˆ¥çš„èªžè¨€ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¦‚åŒ Django ç­‰å°ˆæ¡ˆï¼Œi18n éƒ½æ˜¯é€éŽ gettextï¼ŒSphinx æœƒæŒ‰ç…§ rst æª”æ¡ˆè¼¸å‡ºåŒæª”åçš„ po æª”ã€‚rst æª”æ¡ˆä¸­çš„æ¯å€‹æ–‡å­—æ®µè½æœƒå°æ‡‰åˆ° po æª”ä¸€å€‹ entryï¼Œä¸ç›¸å¹²çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ç­‰æ®µè½æœƒè¢«è·³éŽã€‚è¼¸å‡ºçš„ po æª”æ”¾åœ¨å°æ‡‰çš„è·¯å¾‘ä¾‹å¦‚ &lt;code&gt;locale/&amp;lt;lang&amp;gt;/LC_MESSAGES/xxx.po&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Gettext"&gt;po æª”çš„æ ¼å¼&lt;/a&gt;å¾ˆç°¡å–®ï¼Œè·³éŽæœ‰çš„æ²’çš„ headerï¼Œå¯¦è³ªå…§å®¹é•·é€™æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;#: ../../tutorial/appetite.rst:50&lt;/span&gt;
&lt;span class="nv"&gt;msgid&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Python enables programs to be written compactly and readably.  Programs &amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;written in Python are typically much shorter than equivalent C,  C++, or &amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Java programs, for several reasons:&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;msgstr&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Python è®“ç¨‹å¼å¯«å¾—ç²¾ç°¡ä¸¦æ˜“è®€ã€‚ç”¨ Python å¯¦ä½œçš„ç¨‹å¼é•·åº¦å¾€å¾€é æ¯”ç”¨ &amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Cã€C++ã€Java å¯¦ä½œçš„çŸ­ã€‚é€™æœ‰ä»¥ä¸‹å¹¾å€‹åŽŸå› ï¼š&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯¦éš›ä¸Š Sphinx æœƒå…ˆè¼¸å‡ºä¸€ä»½ä¹¾æ·¨çš„ po æª”ç¯„æœ¬ï¼ˆç¨±ç‚º pot æª”ï¼‰åˆ° &lt;code&gt;locale/pot/&lt;/code&gt;ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åªæœ‰åŽŸæ–‡çš„ po æª”ã€‚æ¯å¢žåŠ ä¸€å€‹æ–°èªžè¨€å°±æœƒå¾ž pot æª”è£½ä½œä¸€ä»½ po æª”åˆ°å„è‡ªçš„ &lt;code&gt;locale/&amp;lt;lang&amp;gt;/&lt;/code&gt; ç›®éŒ„ä¸‹ï¼Œç¿»è­¯æ™‚å°±ä¿®æ”¹é‚£ä»½ po æª”å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;ç¿»è­¯å®Œæˆå¾Œï¼Œé¦–å…ˆ Sphinx æœƒå…ˆå‘¼å« gettext æŠŠ po æª”ç·¨è­¯æˆ mo æª”åŠ é€Ÿæœå°‹ç¿»è­¯å­—ä¸²é€Ÿåº¦ã€‚è¼¸å‡ºç¿»è­¯å¾Œçš„æ–‡ä»¶åªè¦è¨­å®šä¸åŒèªžè¨€ï¼ŒSphinx å°±æœƒåŽ»æ‰¾è©²èªžè¨€çš„ mo æª”ï¼Œä¸¦æŠŠåŽŸæ–‡å­—ä¸²æ›æˆ mo æª”è£¡çš„å…§å®¹ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸­æ–‡çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id="transifex-po"&gt;Transifex ç·šä¸Šæœå‹™è®“å¤šäººå…±åŒç¿»è­¯ po æª”&lt;/h3&gt;
&lt;p&gt;æ•´å€‹ Sphinx æ–‡ä»¶ç¿»è­¯æµç¨‹å°±é€™æ¨£ï¼Œæ‰€ä»¥ç¿»è­¯åªè¦ç·¨è¼¯ä¸­æ–‡ (lang code: zh-Hant&lt;sup id="fnref-zh-Hant"&gt;&lt;a class="footnote-ref" href="#fn-zh-Hant"&gt;1&lt;/a&gt;&lt;/sup&gt;) çš„ po æª”å°±å¥½äº†ã€‚ä¸éŽè¦ç›´æŽ¥å¯« po æª”æ ¼å¼é–€æª»é‚„æ˜¯å¤ªé«˜ï¼Œæ–¼æ˜¯å°±æœ‰åƒ &lt;a href="https://www.transifex.com/"&gt;Transifex&lt;/a&gt; é€™æ¨£çš„ç¶²ç«™ã€‚ä¸Šå‚³ po/pot æª”å°±èƒ½ç·šä¸Šä¿®æ”¹ç¿»è­¯ï¼Œç„¶å¾Œå†æŠŠç¿»å®Œçš„çµæžœç”¨ po æª”æ ¼å¼ä¸‹è¼‰ä¸‹ä¾†ã€‚æˆ‘èªç‚ºé€™æ˜¯ç¾åœ¨åƒåŠ ä»¥ gettext-based PO æª”ç¿»è­¯é–€æª»æœ€ä½Žçš„æ–¹å¼ï¼Œè‡³å°‘æ—¥æœ¬ä¹Ÿæ˜¯é€™éº¼åšã€‚æ–¼æ˜¯æƒ³è¦åƒè€ƒ pydoc ç¿»è­¯çš„äººï¼Œåªè¦ç™»å…¥ Transifex å°±å¯ä»¥é–‹å§‹ç·¨è¼¯ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ Transifex é‚„æœ‰é¡å¤–çš„å¥½è™•ã€‚ä¾‹å¦‚ä»–æœ‰ POS tagging å¯ä»¥æ¨™æ³¨å°ˆæœ‰åè©žï¼Œå®šç¾©çµ±ä¸€çš„è­¯åï¼Œé€™äº›è­¯åæœƒæ•´ç†åœ¨ glossary terms è£¡ï¼Œç¿»è­¯æ™‚å‡ºç¾é€™äº›è©žå°±æœƒè‡ªå‹•æç¤ºã€‚é¡žä¼¼çš„åŽŸæ–‡æ–‡å¥ä¹Ÿæœƒæ”¾åœ¨ suggestion è£¡ï¼Œè®“ç¿»è­¯å®Œçš„ç”¨èªžæ–‡æ³•ä¹Ÿèƒ½ä¸€è‡´ã€‚æ­¤å¤–ä¹Ÿæœ‰ä¿®æ”¹æ­·å²ã€é˜²å‘†æç¤ºï¼ˆå¦‚è©²æœ‰çš„æ ¼å¼æ²’åœ¨è­¯æ–‡å‡ºç¾ï¼‰ã€åŠ è¨»è§£ (comment)ã€è©•è«– (issue) ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;ç¿»è­¯é«”é©—æ”¹å–„&lt;/h3&gt;
&lt;p&gt;é€™æ®µæ™‚é–“ç¿»è­¯çš„ç”¨è©žã€æµç¨‹ç­‰è¦ç¯„éƒ½æœ‰å€‹é››åž‹äº†ï¼Œç›¸é—œçš„å…§å®¹éƒ½å¯ä»¥åœ¨&lt;a href="https://github.com/python-doc-tw/python-doc-tw/wiki"&gt;å°ˆæ¡ˆçš„ wiki&lt;/a&gt; è£¡æ‰¾åˆ°ã€‚æ‰€ä»¥é–‹å§‹æƒ³è¦æ€Žéº¼è®“å¤§å®¶æ›´å¥½åƒèˆ‡ç¿»è­¯å’Œçœ‹åˆ°ç¿»è­¯çš„çµæžœã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç™¼ç¾åƒåŠ ç¿»è­¯æœ¬èº«å·²ç¶“ä¸å›°é›£ï¼Œå¤§å®¶æ²’ä»€éº¼ç–‘å•ã€‚ç¶­è­·æ•´é«”çš„ç”¨è©žã€ç¿»è­¯è¨Žè«–ç”¨ Transifex issue å’Œ comment æ•ˆæžœä¸éŒ¯ã€‚æ•´é«”ä¸Šèƒ½ä¿æŒæ¥µåº¦åˆ†æ•£å¼çš„å·¥ä½œå½¢å¼ã€‚&lt;/p&gt;
&lt;p&gt;å¹³å¸¸é‡åˆ°æœ€å¤šå•é¡Œæ˜¯å‡ºç¾ rst æ ¼å¼éŒ¯èª¤ã€ç¼ºå°‘å¿…è¦çš„ç©ºç™½ã€å‰å¾Œæ–‡åŠ ä¸Šç¨‹å¼ç¢¼ç¯„ä¾‹ä¹‹å¾Œä¸é€šé †ã€è­¯æ–‡æ›²è§£æˆ–èª¤æœƒåŽŸæ–‡çš„æ„æ€ã€‚é€™äº›å•é¡Œï¼Œæˆ‘è¦ºå¾—åªè¦è‡ªå·±è®€éŽç¿»å®Œçš„ pydoc è©²é ã€çœ‹ä¸€ä¸‹è¼¸å‡ºçš„ log å°±èƒ½æ˜Žç™½ï¼Œä¹Ÿä¸éœ€è¦æˆ‘å¤šä½œè§£é‡‹ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†ï¼Œçœ‹ä¸åˆ°è‡ªå·±ç¿»è­¯çš„æˆæžœ&lt;strong&gt;å¾ˆæ²’æœ‰æˆå°±æ„Ÿ&lt;/strong&gt;ï¼ŒéŽä¸€æ®µæ™‚é–“æˆ‘æ€•æœƒå¤±åŽ»å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯è®Šæˆéœ€è¦ä¸€ä»½ä¿æŒæ›´æ–°çš„ç¿»è­¯æˆæžœã€‚ç•¶ç„¶è‡ªå·±è¼¸å‡º doc çš„æ–¹æ³•éƒ½æœ‰å¯«åœ¨ &lt;a href="https://github.com/python-doc-tw/python-doc-tw/wiki/How-to-build-the-doc-locally"&gt;wiki&lt;/a&gt; è£¡ï¼Œä½†æ­¥é©Ÿå¾ˆå¤šï¼Œèªªç°¡å–®ä¹Ÿæ²’å¤šç°¡å–®ï¼Œè€Œä¸”æœ‰éŒ¯æˆ–æœ‰å•é¡Œå¯èƒ½éƒ½è¦ä¾†æ‰¾æˆ‘ï¼Œå°±å¤±åŽ»åˆ†æ•£å¼åˆ†å·¥çš„ç‰¹æ€§äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸å¦‚åšå€‹ autobuild serverã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯æœ‰äº†é€™æƒ³æ³•ã€‚ä½†å¯¦åœ¨æ˜¯å€‹å¤§å‘ï¼Œä¸€ç›´åªèƒ½ç”¨æƒ³çš„ã€‚åœ¨éŽå¹´çš„æ™‚å€™ç¸½ç®—æ‰¾åˆ°æ™‚é–“æŠŠ prototype åšå‡ºä¾†äº†ï¼Œå…¶å¯¦è »æœ‰æˆå°±æ„Ÿçš„ã€‚&lt;/p&gt;
&lt;h2 id="pydoc-autobuild-server"&gt;PyDoc Autobuild Server&lt;/h2&gt;
&lt;p&gt;ç°¡å–®æ•´ç†å¹¾å€‹éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PyDoc çµæžœç¶²å€å°æ‡‰æœ¬å®¶ &lt;a href="https://docs.python.org/"&gt;https://docs.python.org/&lt;/a&gt;ã€‚ä¾‹å¦‚ /3/ å°±æ˜¯ Python 3.x ç‰ˆæœ€æ–°çš„ï¼Œè€Œç¾åœ¨ /3.5/ å°±æœƒè‡ªå‹•è½‰å€åˆ° /3/&lt;sup id="fnref-pydoc-url"&gt;&lt;a class="footnote-ref" href="#fn-pydoc-url"&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸€é éƒ½æœ‰å€‹æ›´æ–°ç¿»è­¯é€£çµï¼Œé»žä¸€ä¸‹å°±æœƒå¾ž Transifex ä¸ŠæŠ“æ–°çš„ç¿»è­¯ï¼Œä¸¦æ›´æ–°è¼¸å‡ºã€‚&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ¯é ç¿»è­¯çš„æŒ‡ä»¤è¼¸å‡ºéƒ½è¦ä¿ç•™ï¼Œæ–¹ä¾¿æª¢æŸ¥ rst èªžæ³•ç­‰éŒ¯èª¤ã€‚&lt;/li&gt;
&lt;li&gt;æ›´æ–°ç¿»è­¯è¦æœ‰å€‹ queueï¼Œæ‰å¯ä»¥å¤šäººåˆä½œæ™‚ä¸ç‚¸æŽ‰ autobuild serverã€‚&lt;/li&gt;
&lt;li&gt;æ¯æ—¥æ›´æ–°å…¨éƒ¨çš„æ–‡ä»¶ï¼Œä¸¦ä¸”æŠŠæ›´æ–°åŠ åˆ° CPython-tw çš„ git repo ä¸­ã€‚æ›´æ–°çš„éŽç¨‹ä¸€æ¨£è¦æœ‰è¨˜éŒ„ã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šè¿°çš„æ‰€æœ‰åŠŸèƒ½éƒ½èƒ½åœ¨æœ¬æ©Ÿè¼•é¬†åœ°è¨­å®šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_2"&gt;å¯¦ä½œ&lt;/h3&gt;
&lt;p&gt;ç›®æ¨™å°±æ˜¯å®Œæˆä¸Šè¿°çš„éœ€æ±‚ã€‚pydoc åŸºæœ¬ä¸Šå°±æ˜¯å€‹ static siteï¼Œäº¤çµ¦ nginx è¨­å¥½è·¯å¾‘ host static files å°±å¯ä»¥ã€‚Pydoc Sphinx ç”¨ &lt;a href="http://jinja.pocoo.org/docs/dev/"&gt;Jinja2&lt;/a&gt; ä½œ HTML templateï¼Œæ‰€ä»¥åªè¦å¤šåŠ ä¸€äº›è®Šæ•¸å°±èƒ½æŽ§åˆ¶é é¢çš„è¼¸å‡ºï¼Œåœ¨ autobuild server ä¸Šæ™‚å°±å¯ä»¥åŠ ä¸Šé¡å¤–çš„é€£çµã€‚è€Œ Autobuild server æœ¬èº«æ˜¯å€‹ task queueï¼Œå…¶å¯¦åŠŸèƒ½å¾ˆç°¡å–®ï¼Œä½†ç‚ºäº†ç¶­è­·æ–¹ä¾¿ï¼Œä¸¦è€ƒæ…®åˆ° localã€production ç’°å¢ƒéƒ½è¦èƒ½å‹•çš„è©±ï¼Œé¸æ“‡ &lt;a href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt; ç‚ºåŸºç¤Žã€‚çœŸçš„çµ¦ Django ç®¡ç†çš„å°±é¡¯ç¤º task queueã€task resultã€æŽ¥å— rebuild doc request é€™å¹¾å€‹ viewã€‚&lt;/p&gt;
&lt;h4 id="sphinx_1"&gt;Sphinx æ–‡ä»¶&lt;/h4&gt;
&lt;p&gt;åœ¨ Sphinx æ–‡ä»¶éƒ¨ä»½ä¸æƒ³æžå¤ªè¤‡é›œï¼Œå°±åœ¨æ¯ä¸€é åŠ ä¸Šä¸€å€‹è‡ªå·±çš„å°ˆå±¬é€£çµï¼Œæ‰“é€™å€‹ç¶²å€å°±æœƒåŠ å…¥ä¸€å€‹æ›´æ–°è©²é é¢çš„ task åˆ° autobuild server&lt;sup id="fnref-build-link"&gt;&lt;a class="footnote-ref" href="#fn-build-link"&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ autobuild æ™‚åŠ å…¥å°ˆå±¬é€£çµåªè¦ä¿®æ”¹ Sphinx doc template å³å¯ã€‚Sphinx åœ¨ build doc æ™‚å¯ä»¥é€éŽ &lt;a href="http://www.sphinx-doc.org/en/stable/man/sphinx-build.html#options"&gt;&lt;code&gt;-A &amp;lt;name=value&amp;gt;&lt;/code&gt;&lt;/a&gt; å¢žåŠ  Jinja2 template çš„è®Šæ•¸ï¼Œå°±å¯æŽ§åˆ¶ template render è¡Œç‚ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# &amp;lt;cpython-src&amp;gt;/Doc/tools/templates/layout.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt;- &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;autobuildi18n&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/_build/update/?source_path=&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;pagename&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Update Translation&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt;- &lt;span class="k"&gt;endif&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sphinx-build -A autobuildi18n=1&lt;/code&gt; æ™‚å°±æœƒåŒ…å«é€™å€‹ Jinja2 blockï¼Œå¤šé€™å€‹ Update Translation é€£çµã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.sphinx-doc.org/en/stable/templating.html#pagename"&gt;&lt;code&gt;{{ pagename }}&lt;/code&gt;&lt;/a&gt; æ˜¯æ¯é æ–‡ä»¶çš„ rst è·¯å¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="autobuild-django-server"&gt;Autobuild Django server&lt;/h4&gt;
&lt;p&gt;Django server ç›®æ¨™å°±æ˜¯æŽ¥å— task request å’Œé¡¯ç¤º task resultã€‚ä¸€å€‹æ¨™æº–çš„ task queue å°±æœ‰é€™äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Django ä¸Šçš„ task queue é¸æ“‡å¾ˆå¤šï¼Œå¾ž &lt;a href="https://www.djangopackages.com/"&gt;Django Packages&lt;/a&gt; ä¸Šçš„ &lt;a href="https://www.djangopackages.com/grids/g/workers-queues-tasks/"&gt;Workers, Queues, and Tasks&lt;/a&gt; ç›¸é—œçš„å¥—ä»¶å¯ä»¥çœ‹åˆ°æœ‰å¹¾å€‹æœ‰åœ¨æ›´æ–°è€Œä¸” up æ•¸å¤šçš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://celery.github.io/django-celery/"&gt;django-celery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://huey.readthedocs.org/en/latest/"&gt;huey&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/ui/django-rq"&gt;django-RQ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://policystat.github.io/jobtastic/"&gt;jobtastic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://django-q.readthedocs.org/"&gt;django-Q&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰£æŽ‰ä¸æ”¯æ´ Python 3 çš„å¥—ä»¶&lt;sup id="fnref-python3"&gt;&lt;a class="footnote-ref" href="#fn-python3"&gt;4&lt;/a&gt;&lt;/sup&gt;å¾Œï¼Œå°±å‰© django-celeryã€django-RQã€django-Q å¯ä»¥é¸ã€‚é€™è£¡é¢æœ€ç´…ä¹Ÿæœ€è€ç‰Œçš„æ˜¯ django-celery ï¼Œå®ƒèˆ‡ &lt;a href="http://www.celeryproject.org/"&gt;Celery&lt;/a&gt; æ•´åˆï¼ŒåŠŸèƒ½å®Œæ•´ä¸”ç©©å®šï¼Œæˆ‘ç”¨éŽä¹Ÿè¦ºå¾—ååˆ†ä¸éŒ¯ï¼Œç¼ºé»žæ˜¯åŠŸèƒ½å¤ªå¤šæœ‰é»žè¤‡é›œï¼ŒåŠ ä¸Šä¸åŒ message queue æ™‚æœƒæœ‰å¾ˆå¤šè¨­å®šè¦èª¿æ•´ï¼Œéœ€è¦ä¸€æ®µæ™‚é–“ä¸Šæ‰‹ã€‚ä¸€èˆ¬ Celery å¸¸è¦‹çš„æ­é…ä½¿ç”¨ &lt;a href="https://www.rabbitmq.com/"&gt;Rabbit-MQ&lt;/a&gt; å’Œ &lt;a href="http://redis.io/"&gt;Redis&lt;/a&gt;ï¼Œçš„ç¢ºåœ¨ task å¾ˆå¤šæ™‚æœ‰å¿…è¦ï¼Œä½†æˆ‘å€‘é€™å€‹ build doc ä¸€å¤©å¯èƒ½æ‰åå¹¾æ¬¡ï¼Œåœ¨ä¸éš”é›¢ build doc ç’°å¢ƒçš„æƒ…æ³åŒæ™‚é–“çš„ worker åªèƒ½æœ‰ä¸€å€‹ï¼Œä¸æœƒæœ‰æ•ˆèƒ½ä¸Šçš„å•é¡Œã€‚å› æ­¤æˆ‘å‚¾å‘åªè¦ä½¿ç”¨èˆ‡ Django åŒä¸€å€‹ database å°±å¥½ï¼Œä¸è¦å†æœ‰é¡å¤–éž Python çš„ dependencyï¼Œè®“ local é–‹ç™¼ç°¡å–®ä¸€é»žã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œé¸æ“‡ &lt;a href="https://django-q.readthedocs.org/"&gt;django-Q&lt;/a&gt;ã€‚é›–ç„¶å¾ˆæ–°ä½†ä½œè€…ç¶­è­·å¾—å¾ˆå‹¤ï¼Œworker å¯ä»¥åªç”¨ Python å…§å»ºçš„ multiprocessing å®Œæˆã€‚åŠŸèƒ½ç°¡å–®å»å®Œæ•´ï¼ŒåŒ…å« monitorï¼Œè·Ÿ django-admin æ•´åˆï¼Œé‚„å¯ä»¥æŽ’ç¨‹ã€‚æ‰€ä»¥è¦å•Ÿå‹• django-Q çš„ clusterï¼Œåªè¦å¤šä¸€å€‹ &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python manage.py qcluster
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å³å¯ï¼Œååˆ†æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;æ€Žéº¼ä½¿ç”¨ django-Q å°±ä¸åœ¨é€™ç¯‡ blog è¨Žè«–ç¯„åœå…§äº†ã€‚æˆ‘æƒ³æˆ‘æ‡‰è©²æœƒæŠ•ç¨¿ PyCon TW æˆ– Taipei.pyï¼Œåˆ°æ™‚å€™å†æ•´ç†æˆå¦ä¸€ç¯‡ã€‚Django-Q çš„èªªæ˜Žæ–‡ä»¶å¯«å¾—å¾ˆæ¸…æ¥šï¼Œè®€ä¸€è®€æ‡‰è©²å°±æœƒäº†ã€‚&lt;/p&gt;
&lt;h2 id="autobuild-server"&gt;Autobuild server éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;ï¼ˆé€™ç¯‡æ–‡çš„é‡é»žå…¶å¯¦æ˜¯éƒ¨ç½²ï¼Œèª°æ›‰å¾—èƒŒæ™¯ä»‹ç´¹å¯ä»¥é€™éº¼é•·ï¼‰&lt;/p&gt;
&lt;p&gt;éƒ¨ç½² (deploy) æ–¹æ³•ç™¾ç™¾ç¨®ï¼Œæœ‰å¥½æœ‰å£žã€‚ä½†è‡³å°‘è¦æœƒä¸€ç¨®å˜›ï¼Œæ‰€ä»¥é€™é‚Šå°±ç”¨å…¶ä¸­ä¸€ç¨®ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;nginx &amp;lt;-&amp;gt; uwsgi &amp;lt;-&amp;gt; Django&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿç®—å¾ˆæµè¡Œçš„çµ„åˆã€‚æ›´å®Œæ•´åœ°ä¾†èªªï¼Œæ•´å€‹è™•ç† request çš„æµç¨‹ç¶“éŽï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;web client &amp;lt;-&amp;gt; nginx web server &amp;lt;-&amp;gt; socket &amp;lt;-&amp;gt; uwsgi &amp;lt;-&amp;gt; Django server&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åŸºæœ¬çš„è¨­å®šèˆ‡æ•™å­¸ä¾†è‡ª &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/index.html"&gt;uWSGI&lt;/a&gt; å®˜ç¶²çš„ &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html"&gt;&lt;em&gt;Setting up Django and your web server with uWSGI and nginx&lt;/em&gt;&lt;/a&gt; ä¸€æ–‡ï¼Œæ­é… &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/Systemd.html"&gt;&lt;em&gt;uWGSI and Systemd&lt;/em&gt;&lt;/a&gt; èˆ‡ &lt;a href="https://www.freedesktop.org/wiki/Software/systemd/"&gt;systemd&lt;/a&gt; æ•´åˆã€‚&lt;/p&gt;
&lt;p&gt;é€™ä¹Ÿæ˜¯ç›®å‰ Pydoc production çš„è¨­å®šï¼Œè¨˜éŒ„ä¸€ä¸‹æ–¹ä¾¿æœªä¾†çš„ç¶­è­·ã€‚&lt;/p&gt;
&lt;h3 id="_3"&gt;ä½œæ¥­ç³»çµ±&lt;/h3&gt;
&lt;p&gt;ä½œæ¥­ç³»çµ±ç”¨ Debian Jessieï¼Œæž¶è¨­æ–¼ Amazon EC2 ä¸Šï¼Œä½¿ç”¨ t2.nano&lt;sup id="fnref-ec2-nano"&gt;&lt;a class="footnote-ref" href="#fn-ec2-nano"&gt;5&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Python web deploy éƒ½æœƒæŠŠå¥—ä»¶è£åœ¨è™›æ“¬ç’°å¢ƒä¸­ï¼Œé¿å…ä¸åŒå°ˆæ¡ˆé–“äº’è¡æˆ–èˆ‡ç³»çµ±è¡çªã€‚åœ¨ Debian ä¸Šå¯ä»¥ç”¨ &lt;code&gt;apt buid-dep python3-&amp;lt;pkg&amp;gt;&lt;/code&gt; æŠŠ Python &lt;pkg&gt; å¥—ä»¶æ‰€éœ€çš„ header æˆ– library å®‰è£å¥½ï¼Œååˆ†ç°¡å–®ã€‚&lt;/p&gt;
&lt;h4 id="python-35-and-apt-pinning"&gt;Python 3.5 and APT-pinning&lt;/h4&gt;
&lt;p&gt;æˆ‘çš„ code è£¡ç”¨åˆ°äº† &lt;a href="https://docs.python.org/3/library/subprocess.html#subprocess.run"&gt;&lt;code&gt;subprocess.run&lt;/code&gt;&lt;/a&gt;ï¼Œé€™æ˜¯ Python 3.5+ æ‰æœ‰çš„ APIã€‚ä½† Jessie åªæœ‰ Python 3.4ï¼Œä½†æˆ‘è¦ºå¾—å¾ˆå¥½ç”¨ä¸€é»žéƒ½ä¸æƒ³æ”¹å¯«æˆç›¸å®¹èˆŠç‰ˆçš„ codeã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤éœ€è¦å®‰è£ Debian testing channel ä¸Šæœ€æ–°çš„ Python 3.5ã€‚é€™æ¨£å…¶å¯¦æœ‰å®‰å…¨ä¸Šçš„ç–‘æ…®ï¼Œå› ç‚ºåªæœ‰ stable channel æ‰æœ‰ security supportï¼Œä½†è‡ªå·±ç·¨è­¯çš„å•é¡Œæ›´å¤§ï¼Œæ‰€ä»¥åƒ &lt;a href="https://github.com/yyuu/pyenv"&gt;pyenv&lt;/a&gt; é€™ç¨®å¤š Python ç‰ˆæœ¬çš„å·¥å…·ä¸åœ¨è€ƒæ…®å…§ã€‚&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯ç”¨ &lt;a href="https://wiki.debian.org/AptPreferences"&gt;Apt-Pinning&lt;/a&gt; åªè®“ Python 3.5 ç›¸é—œçš„å¥—ä»¶å®‰è£ testing çš„ç‰ˆæœ¬ã€‚é¦–å…ˆæŠŠ testing channel åŠ åˆ° &lt;code&gt;/etc/apt/source.list&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;deb&lt;/span&gt; &lt;span class="s"&gt;http://cloudfront.debian.net/debian&lt;/span&gt; &lt;span class="kp"&gt;testing&lt;/span&gt; &lt;span class="kp"&gt;main&lt;/span&gt;
&lt;span class="k"&gt;deb-src&lt;/span&gt; &lt;span class="s"&gt;http://cloudfront.debian.net/debian&lt;/span&gt; &lt;span class="kp"&gt;testing&lt;/span&gt; &lt;span class="kp"&gt;main&lt;/span&gt;
&lt;span class="k"&gt;deb&lt;/span&gt; &lt;span class="s"&gt;http://security.debian.org/&lt;/span&gt; &lt;span class="kp"&gt;testing/updates&lt;/span&gt; &lt;span class="kp"&gt;main&lt;/span&gt;
&lt;span class="k"&gt;deb-src&lt;/span&gt; &lt;span class="s"&gt;http://security.debian.org/&lt;/span&gt; &lt;span class="kp"&gt;testing/updates&lt;/span&gt; &lt;span class="kp"&gt;main&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç„¶å¾Œä¿®æ”¹ &lt;code&gt;/etc/apt/preferences&lt;/code&gt; ç¢ºå®šæˆ‘å€‘ä¸æœƒä¸å°å¿ƒè£åˆ° testing ç›¸é—œçš„å¥—ä»¶ï¼Œä¸¦æŠŠ Python 3.5 ç›¸é—œçš„å¥—ä»¶è¨­å®šæ¬Šé™ &amp;gt;= 990 è®“å®ƒå€‘èƒ½è¢«è‡ªå‹•å®‰è£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# Specify * rules first so later package-specfic rules can override them
Package: *
Pin: release a=testing
Pin-Priority: -10

Package: python3.5* libpython3.5*
Pin: release a=testing
Pin-Priority: 990
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥ç”¨ &lt;code&gt;sudo apt-cache policy &amp;lt;pkg-name&amp;gt;&lt;/code&gt; æª¢æŸ¥ç›®å‰çš„è¦å‰‡æœƒè£åˆ°å“ªå€‹ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get update 
$ sudo apt-get install python3.5 python3.5-venv python3.5-dev
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£åªæœ‰ Python 3.5 ç›¸é—œçš„å¥—ä»¶æ‰æœƒè£åˆ° testingã€‚&lt;/p&gt;
&lt;h4 id="postgresql"&gt;è³‡æ–™åº« PostgreSQL&lt;/h4&gt;
&lt;p&gt;è³‡æ–™åº«ç”¨ PostgreSQL 9.4ã€‚åƒç…§ä¹‹å‰ blog&lt;a href="https://blog.liang2.tw/posts/2016/01/postgresql-install/"&gt;ã€Šå®‰è£ PostgreSQL 9 æ–¼ Debian Jessie / OSXã€‹&lt;/a&gt;ä¸€æ–‡è¨­å®šã€‚&lt;/p&gt;
&lt;h4 id="swap"&gt;Swap&lt;/h4&gt;
&lt;p&gt;å…¶å¯¦æ˜¯ä¸Šç·šä¸ä¹…æ‰æ³¨æ„åˆ° EC2 é è¨­æ²’æœ‰ swap ç©ºé–“ã€‚æˆ‘å¾ˆçª®æ‰€ä»¥ production server çš„ RAM åªæœ‰ 512 MBï¼Œè§€å¯Ÿä¸€ä¸‹æœ‰æ™‚å€™ build doc RAM å°±å…¨æ»¿äº†ï¼Œæ‰€ä»¥é‚„æ˜¯åŠ å€‹ swap å®‰å¿ƒä¸€é»žã€‚&lt;/p&gt;
&lt;p&gt;å› ç‚º Amazon EBS SSD I/O æ•¸ä¸æœƒå¦å¤–æ”¶éŒ¢ï¼ˆæ‡‰è©²å§ï¼Ÿï¼‰ï¼Œå°±å»º swap file åœ¨ä¸»ç¡¬ç¢Ÿè£¡ã€‚&lt;/p&gt;
&lt;p&gt;Swap è¨­å®šçš„æ•™å­¸å¾ˆå¤šï¼Œé€™é‚Šå°±åƒè€ƒ &lt;a href="https://wiki.archlinux.org/index.php/swap"&gt;Arch Wiki&lt;/a&gt; ä¸Šçš„åšæ³•ï¼Œæˆ‘é¸æ“‡æ”¾åœ¨ &lt;code&gt;/var/swap.1&lt;/code&gt;ã€‚å¤§å°è¨­å®šç‚º RAM çš„ 2 å€ï¼Œå³ 1GBã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæŠŠé€™å€‹æª”æ¡ˆå»ºå‡ºä¾†ï¼Œæ¬Šé™æ”¹ç‚º 600ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo /bin/dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/zero &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/swap.1 &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1M &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1024&lt;/span&gt;
&lt;span class="c1"&gt;# or faster with fallocate&lt;/span&gt;
sudo fallocate -l 1G /var/swap.1
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo chmod &lt;span class="m"&gt;600&lt;/span&gt; /var/swap.1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†ä¾†æŠŠé€™å€‹æª”æ¡ˆæ”¹æˆ swap æ ¼å¼ä¸¦å•Ÿç”¨å®ƒï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo /sbin/mkswap /var/swap.1
sudo /sbin/swapon /var/swap.1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¿®æ”¹ fstab è®“æ¯æ¬¡é–‹æ©Ÿéƒ½æœ‰é€™å€‹ swap è¨­å®šï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# /etc/fstab
/var/swap.1 none swap defaults 0 0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”¨ &lt;code&gt;free -h&lt;/code&gt;ã€&lt;code&gt;cat /proc/meminfo&lt;/code&gt; æª¢æŸ¥æ­¤æ™‚æ‡‰è©²æœ‰å€‹ 1GB swap äº†ã€‚&lt;/p&gt;
&lt;h4 id="git-repo-ssh-config"&gt;Git repo ssh config&lt;/h4&gt;
&lt;p&gt;å†ä¾†æ˜¯ code çš„åŒæ­¥èˆ‡æ›´æ–°ã€‚autobuild server åªè¦æ›´æ–° source codeï¼Œä½† cpython-tw source éœ€è¦å®šæ™‚ commit æ–°çš„ç¿»è­¯ï¼Œå› æ­¤ deploy server æœƒæœ‰ä¿®æ”¹ git repo çš„æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸æ‡‰è©²ä½¿ç”¨è‡ªå·±çš„ SSH keyï¼Œdeploy server ä¸Šæ‡‰è©²æœ‰å°ˆå±¬çš„ deploy keyï¼Œå…¶ä¸­ cpython-tw çš„ deploy key æœ‰å¯«å…¥æ¬Šé™ï¼ˆå³å¯ä»¥ commitï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥äº†ä¸€ä¸‹ï¼Œè¦è®“ä¸åŒ git repo ä½¿ç”¨ä¸åŒçš„ SSH key ä¹Ÿä¸è¤‡é›œã€‚ä»¥é€™é‚Šçš„ä¾‹å­ï¼Œå…ˆä¿®æ”¹ &lt;code&gt;~/.ssh/config&lt;/code&gt; åŠ å…¥å…©å€‹æ–°çš„ hostï¼Œä½¿ç”¨ä¸åŒçš„ SSH keyï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Host github-pydoc_autobuild
  HostName github.com
  User git
  IdentityFile /home/pydoc/.ssh/id_rsa.pydoc_autobuild

Host github-cpython_tw
  HostName github.com
  User git
  IdentityFile /home/pydoc/.ssh/id_rsa.cpython_tw
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å»ºç«‹å°æ‡‰çš„ SSH keypairï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh-keygen -t rsa -f ~/.ssh/id_rsa.pydoc_autobuild
ssh-keygen -t rsa -f ~/.ssh/id_rsa.cpython_tw
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŠŠå…©å€‹ repo çš„ URL host æ›æŽ‰ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git remote set-url origin git@github-pydoc_autobuild:python-doc-tw/pydoc_autobuild.git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£å…©å€‹ repo æœƒé€éŽçµ¦å®šçš„ ssh key é€£ç·šã€‚GitHub æœƒé¡¯ç¤ºæ¯å€‹ key æœ€è¿‘ä½¿ç”¨çš„æ™‚é–“ï¼Œæª¢æŸ¥æ™‚é–“å°±èƒ½ç¢ºèªè¨­å®šæ­£ç¢ºèˆ‡å¦ï¼ˆè€Œä¸”æ”¹ host æ²’è¨­å®šå°æ‡‰è©²ç›´æŽ¥é€£ä¸ä¸Šï¼‰ã€‚&lt;/p&gt;
&lt;h4 id="tmpfilesd"&gt;tmpfiles.d&lt;/h4&gt;
&lt;p&gt;ä¹‹å¾Œ nginx å’Œ uwsgi æºé€šç”¨çš„ socket æ‰“ç®—æ”¾åœ¨ &lt;code&gt;/run/django/xxxx.sock&lt;/code&gt; &lt;sup id="fnref-/run"&gt;&lt;a class="footnote-ref" href="#fn-/run"&gt;6&lt;/a&gt;&lt;/sup&gt;ã€‚å› ç‚ºåªéœ€è¦éž root çš„æ¬Šé™ï¼Œä¿®æ”¹ &lt;a href="https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html"&gt;tmpfiles.d&lt;/a&gt; çš„è¨­å®šï¼Œè®“é€™å€‹è³‡æ–™å¤¾èƒ½åœ¨é–‹æ©Ÿæ™‚è‡ªå‹•å»ºç«‹ã€‚å¢žåŠ è¨­å®šæª” &lt;code&gt;/etc/tmpfiles.d/pydoc_autobuild.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;d /run/django 0755 pydoc www-data
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="django-stack-nginx-uwsgi"&gt;Django Stack &amp;ndash; nginx + uWSGI&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬åœ°é–‹ç™¼éƒ½ç”¨ &lt;code&gt;python manage.py runserver&lt;/code&gt; å•Ÿå‹• Djangoã€‚ä½†ä¸Šç·šæ™‚å…§å»ºçš„ runserver å°±ç„¡æ³•åŒæ™‚é–“æœå‹™å¤ªå¤šäººã€‚å› æ­¤éœ€è¦åƒ nginxã€uWSGI ç­‰å·¥å…·ä¾†å”åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;åƒç…§ uWSGI &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html"&gt;&lt;em&gt;Setting up Django and your web server with uWSGI and nginx&lt;/em&gt;&lt;/a&gt; ä¸€æ–‡ä»¥åŠ TP å¯«çš„ ã€Šç‚ºç¨‹å¼äººå¯«çš„ Django Tutorialã€‹ç³»åˆ—æ–‡ä¸­ &lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers/blob/master/25-deploy-to-ubuntu-server.md"&gt;&lt;em&gt;Day 27 - Deploy to Ubuntu server&lt;/em&gt;&lt;/a&gt; é—œæ–¼éƒ¨ç½²çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;Autobuild server æœ‰ç‰¹åˆ¥ç‚º production å¯«ä¸€ä»½è¨­å®šæª”ï¼Œåˆ‡æ›æ™‚åªè¦è¨­å®šæˆ &lt;code&gt;settings.production&lt;/code&gt; å³å¯ã€‚åœ¨ Django è¨­å®šéƒ¨ä»½ï¼Œå»ºè­°æŠŠæ‰€æœ‰è·¯å¾‘éƒ½è¨­æˆçµ•å°è·¯å¾‘ï¼ˆåŒ…å«åŸ·è¡Œæª”ï¼‰ã€‚ä¸ç„¶å¾ŒçºŒåœ¨è¨­å®š systemd è¦èª¿æ•´å¾ˆå¤šç’°å¢ƒè®Šæ•¸ï¼Œsystemd ä¹Ÿä¸æœƒå¸¶å…¥ä½¿ç”¨è€…çš„ PATH è®Šæ•¸ï¼Œä¸ç”¨çµ•å°è·¯å¾‘å…¶å¯¦è »éº»ç…©çš„ä¹Ÿå®¹æ˜“éŒ¯ã€‚&lt;/p&gt;
&lt;h4 id="nginx"&gt;nginx è¨­å®š&lt;/h4&gt;
&lt;p&gt;nginx æœƒæŽ¥å— incoming HTTP requestï¼Œéœ€è¦è·Ÿ Django server è¯çµ¡æ™‚ï¼Œå°±æœƒæœƒé€£åˆ° uWSGI é–‹çš„ UNIX socketã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å…ˆå‡è¨­ uWSGI é€™æ®µæ²’å•é¡Œï¼Œé¦–å…ˆè¨­å®š nginx æœ¬èº«ã€‚ç”±æ–¼ static files åœ¨ nginx å°±ç›´æŽ¥å°Žåˆ°å°æ‡‰çš„æª”æ¡ˆï¼Œä¸æœƒç¶“éŽ uWSGI ï¼Œæ‰€ä»¥è¨­å®šå¥½ nginx ä¹‹å¾Œ pydoc æ–‡ä»¶æœ¬èº«å°±ä¸Šç·šäº†ã€‚ç”¨é€™å€‹ä¾†æ¸¬è©¦è¨­å®šçš„æ­£ç¢ºæ€§ã€‚&lt;/p&gt;
&lt;p&gt;å°æœ¬ç¶²ç«™è€Œè¨€ï¼Œ/static å°Žåˆ° Django staticfilesï¼›/3/ã€/3.5/ å°Žåˆ° pydoc build HTML çš„è·¯å¾‘ï¼›å…¶é¤˜è·¯å¾‘å†äº¤çµ¦ Django è™•ç†ã€‚å…¶ä¸­ï¼Œ/3.5/* çš„é€£çµå°‡é‡æ–°å°Žå‘åˆ° /3/* ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ•´ç†ä¸Šè¿°çš„éœ€æ±‚ï¼Œå¯«å€‹ nginx è¨­å®šæª”åœ¨ &lt;code&gt;/etc/nginx/sites-available/pydoc_autobuild.conf&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Upstream Django setting; the socket nginx connects to&lt;/span&gt;
&lt;span class="k"&gt;upstream&lt;/span&gt; &lt;span class="s"&gt;django&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;server&lt;/span&gt; &lt;span class="s"&gt;unix:///run/django/pydoc_autobuild.sock&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt;      &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt;      &lt;span class="mi"&gt;443&lt;/span&gt; &lt;span class="s"&gt;default&lt;/span&gt; &lt;span class="s"&gt;ssl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;docs.python.org.tw&lt;/span&gt;
                &lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="s"&gt;.69.170.26&lt;/span&gt;
                &lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;charset&lt;/span&gt;     &lt;span class="s"&gt;utf-8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;client_max_body_size&lt;/span&gt; &lt;span class="s"&gt;10M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# max upload size&lt;/span&gt;
    &lt;span class="kn"&gt;keepalive_timeout&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/static&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;alias&lt;/span&gt; &lt;span class="s"&gt;/path/to/code/pydoc_autobuild/assets&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/3&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;alias&lt;/span&gt; &lt;span class="s"&gt;/path/to/code/cpython-tw/Doc/build/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;~&lt;/span&gt; &lt;span class="sr"&gt;/3\.5/(.*)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;302&lt;/span&gt; &lt;span class="s"&gt;/3/&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;# Finally, send all non-media requests to the Django server.&lt;/span&gt;
    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;uwsgi_pass&lt;/span&gt;  &lt;span class="s"&gt;django&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;include&lt;/span&gt;     &lt;span class="s"&gt;/etc/nginx/uwsgi_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†æŠŠæª”æ¡ˆ soft link åˆ° &lt;code&gt;/etc/nginx/sites-enabled/&lt;/code&gt;ï¼Œæ›´æ–° nginx è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /etc/nginx/sites-available/
sudo ln -s pydoc_autobuild.conf ../sites-enabled/
sudo systemctl reload nginx
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç¢ºå®š pydoc ä¸Šç·šå°±å¯ä»¥å°ˆå¿ƒè™•ç† uWSGI äº†ã€‚&lt;/p&gt;
&lt;h4 id="uwsgi"&gt;uWSGI è¨­å®š&lt;/h4&gt;
&lt;p&gt;uWSGI åœ¨ VENV å¤–ä¹Ÿè¦è£ï¼Œæˆ‘è¦ºå¾—é‚„æ˜¯ç”¨ pip æ¯”è¼ƒç°¡å–®ï¼Œé›–ç„¶é€™æ¨£å°±è¦è‡ªå·±æ³¨æ„ uWSGI çš„ç‰ˆæœ¬æ›´æ–°äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo python3.5 -m pip install uwsgi
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŠŠ uWSGI è¨­å®šå­˜æˆ &lt;code&gt;pydoc_autobuild_uwsgi.ini&lt;/code&gt; ä¸¦ä¸”åœ¨æ¸¬è©¦æ™‚ï¼Œéƒ½ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo uwsgi --ini pydoc_autobuild_uwsgi.ini
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ¨¡æ“¬å¯¦éš›ä¸Šçš„åŸ·è¡Œæ–¹å¼ï¼Œé€™æ¨£ä¹‹å¾Œæ”¹ç”¨ systemd åŸ·è¡Œæ‰ä¸æœƒåˆä¸Ÿä¸€å †æ¬Šé™çš„å•é¡Œã€‚è¨­å®šæª”çš„å…§å®¹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[uwsgi]&lt;/span&gt;
&lt;span class="na"&gt;chdir&lt;/span&gt;        &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/path/to/code/pydoc_autobuild&lt;/span&gt;
&lt;span class="c1"&gt;# Django&amp;#39;s wsgi file&lt;/span&gt;
&lt;span class="na"&gt;module&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;pydoc_autobuild.wsgi:application&lt;/span&gt;
&lt;span class="na"&gt;env&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;DJANGO_SETTINGS_MODULE=pydoc_autobuild.settings.production&lt;/span&gt;
&lt;span class="c1"&gt;# the virtualenv (full path)&lt;/span&gt;
&lt;span class="na"&gt;home&lt;/span&gt;         &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/path/to/VENV&lt;/span&gt;

&lt;span class="c1"&gt;# process-related settings&lt;/span&gt;
&lt;span class="c1"&gt;# master&lt;/span&gt;
&lt;span class="na"&gt;master&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;true&lt;/span&gt;
&lt;span class="c1"&gt;# maximum number of worker processes&lt;/span&gt;
&lt;span class="na"&gt;processes&lt;/span&gt;    &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;4&lt;/span&gt;
&lt;span class="c1"&gt;# the socket (use the full path to be safe&lt;/span&gt;
&lt;span class="na"&gt;socket&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/run/django/pydoc_autobuild.sock&lt;/span&gt;
&lt;span class="c1"&gt;# ... with appropriate permissions - may be needed&lt;/span&gt;
&lt;span class="na"&gt;chmod-socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;664&lt;/span&gt;
&lt;span class="na"&gt;uid&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;pydoc&lt;/span&gt;
&lt;span class="na"&gt;gid&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;www-data&lt;/span&gt;
&lt;span class="c1"&gt;# clear environment on exit&lt;/span&gt;
&lt;span class="na"&gt;vacuum&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ¬Šé™ä¸Šçš„è¨­å®šå¯èƒ½è¦èŠ±é»žæ™‚é–“è™•ç†ä¸€ä¸‹ï¼Œnginx ä½¿ç”¨ www-data/www-data çš„èº«ä»½åŸ·è¡Œï¼Œsocket è¦ç¢ºå®š nginx èƒ½è®€å¯«ï¼Œä½†æˆ‘çš„ code æ”¾åœ¨ pydoc ä½¿ç”¨è€…è·¯å¾‘ä¸‹ï¼Œç”¨ www-data å¯èƒ½æœƒæœ‰æ¬Šé™çš„å•é¡Œã€‚å»ºè­°æŠŠ uidã€gid éƒ½è¨­å®šå¥½ã€‚&lt;/p&gt;
&lt;p&gt;éŽç¨‹ä¸­ï¼Œæ­é… nginx çš„éŒ¯èª¤è¨Šæ¯æ¯”è¼ƒå¥½ debugï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo less +F /var/log/nginx/error.log
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æˆåŠŸå¾Œï¼Œå†ç”¨ uWSGI çš„ Emperor modeï¼ŒæŠŠè¨­å®šæª”ä¸Ÿåˆ°ä¸€å€‹è·¯å¾‘åº•ä¸‹ï¼ˆè©²è·¯å¾‘ç¨±ç‚º vassalsï¼‰ã€‚uWSGI åœ¨ Emperor mode æ™‚æœƒè‡ªå‹•æŠŠ vassals è·¯å¾‘å…§æ‰€æœ‰è¨­å®šæª”éƒ½è®€é€²ä¾†ä¸¦åŸ·è¡Œã€‚&lt;/p&gt;
&lt;p&gt;é€™è£¡ vassals è·¯å¾‘ä½¿ç”¨ &lt;code&gt;/etc/uwsgi/vassals/&lt;/code&gt;ã€‚å› ç‚ºæœ‰è¨­ uidã€gidï¼Œè·‘çš„æ™‚å€™å°±ä¸ç”¨å†è¨­äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo uwsgi --emperor /etc/uwsgi/vassals
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£æ‡‰è©² Django ç›¸é—œçš„ view éƒ½æ²’å•é¡Œäº†ã€‚æŽ¥ä¸‹ä¾†ï¼Œè¦æŠŠå•Ÿå‹• uWSGI çš„æ­¥é©Ÿäº¤çµ¦ç³»çµ±ä¾†ç®¡ç†ã€‚&lt;/p&gt;
&lt;h3 id="systemd-services"&gt;Systemd services&lt;/h3&gt;
&lt;p&gt;Autobuild server åŒ…å«å…©å€‹éƒ¨ä»½ï¼šDjango Server èˆ‡ Django-Q clusterã€‚æ‰€ä»¥å¯«æˆ systemd service æ™‚æœƒæœ‰å…©å€‹æœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;Debian system service æ”¾åœ¨ &lt;code&gt;/etc/systemd/system/&lt;/code&gt; åº•ä¸‹ï¼Œå› æ­¤å»ºç«‹ &lt;code&gt;uwsgi.service&lt;/code&gt; å’Œ &lt;code&gt;qcluster.service&lt;/code&gt; åˆ†åˆ¥ç®¡ç† uWSGI Emperor mode å’Œ Django-Q clusterã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;uwsgi.service&lt;/code&gt; åƒè€ƒ uWSGI å®˜ç¶² &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/Systemd.html"&gt;&lt;em&gt;Django and Systemd&lt;/em&gt;&lt;/a&gt; ä¸€æ–‡çš„è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;uWSGI Emperor&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog.target&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/local/bin/uwsgi --emperor /etc/uwsgi/vassals&lt;/span&gt;
&lt;span class="na"&gt;RuntimeDirectory&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;uwsgi&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;
&lt;span class="na"&gt;KillSignal&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;SIGQUIT&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;notify&lt;/span&gt;
&lt;span class="na"&gt;StandardError&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog&lt;/span&gt;
&lt;span class="na"&gt;NotifyAccess&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;all&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;qcluster.service&lt;/code&gt; ç®—æ˜¯è‡ªå·±ç¡¬å¯«æ¨¡æ“¬ &lt;code&gt;python manage.py qcluster&lt;/code&gt; è¡Œç‚ºã€‚å› æ­¤ç’°å¢ƒè®Šæ•¸éƒ½è¦è¨­å®šå¥½ï¼ˆç•¶ç„¶ç”¨çµ•å°è·¯å¾‘å°±æ²’å•é¡Œäº†ï¼Œæˆ‘åªæ˜¯è¦ºå¾—é€™æ¨£ build log å…§çš„åŸ·è¡Œæª”è·¯å¾‘éƒ½å¾ˆé•·æœƒå¾ˆé†œ xdï¼‰&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Django-Q Cluster for site pydoc_autobuild&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog.target&lt;/span&gt;
&lt;span class="na"&gt;Wants&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;uwsgi.service&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;User&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;pydoc&lt;/span&gt;
&lt;span class="na"&gt;Group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;www-data&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;VIRTUAL_ENV=/path/to/VENV&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PATH=/path/to/VENV/bin:$PATH&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;DJANGO_SETTINGS_MODULE=pydoc_autobuild.settings.production&lt;/span&gt;
&lt;span class="na"&gt;WorkingDirectory&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/path/to/code/pydoc_autobuild&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/path/to/VENV/bin/python manage.py qcluster&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;
&lt;span class="na"&gt;KillSignal&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;SIGQUIT&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;simple&lt;/span&gt;
&lt;span class="na"&gt;NotifyAccess&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;none&lt;/span&gt;
&lt;span class="na"&gt;StandardError&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£çš„è¨­å®šæª”æ‡‰è©²ä¸æ˜¯ systemd çš„æ…£ä¾‹ï¼Œæˆ‘é‚„åœ¨æƒ³æ˜¯ä¸æ˜¯æ‡‰è©²è¦æ”¹å¯«åˆ° user service åŽ»ï¼ˆä½†æˆ‘ä¸æœƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åŠ å…¥åˆ° systemd ä¹‹å¾Œç®¡ç†å°±å¾ˆç°¡å–®ï¼Œå•Ÿå‹•é€™å…©å€‹ serviceï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo systemctl enable uwsgi
sudo systemctl enable qcluster
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŸ¥çœ‹ä»–å€‘çš„ç‹€æ…‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo systemctl status uwsgi
sudo systemctl status qcluster
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŸ¥çœ‹å®ƒå€‘çš„ log ä¹Ÿè®Šå¾—å¾ˆç°¡å–®ï¼Œå› ç‚ºæœ‰æŠŠå®ƒå€‘çš„ stderr æŠ“èµ·ä¾†ã€‚systemd å¥½è™•æ˜¯ rotation ç­‰ç­‰éƒ½æœƒå¹«ä½ æ³¨æ„ï¼Œçœ‹ log çš„åŠŸèƒ½ä¹Ÿå¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚è¦æŸ¥æœ€è¿‘ä¸€å°æ™‚ uWSGI çš„é€£ç·šè¨˜éŒ„ï¼Œä¸¦åœ¨æœ‰æ–°é€£ç·šæ™‚æŒçºŒæ›´æ–° logï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo journalctl -xef -u uwsgi --since &amp;#39;1 hour ago&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_4"&gt;ç¸½çµ&lt;/h2&gt;
&lt;p&gt;ä»‹ç´¹äº† &lt;a href="https://github.com/python-doc-tw/python-doc-tw"&gt;Python èªªæ˜Žæ–‡ä»¶ç¿»è­¯è¨ˆç•«&lt;/a&gt;ï¼Œç·šä¸Šæ–‡ä»¶autobuild server åŸºæ–¼ Django èˆ‡ Django-Q çš„æž¶æ§‹ï¼Œä»¥åŠåœ¨ Debian ä¸Šçµåˆ nginxã€uWSGIã€systemd çš„éƒ¨ç½²è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥è³‡æ–™æ™‚è¦ºå¾—æ–‡ç« é‚„ä¸å¤šï¼Œåªæœ‰å¹¾ç¯‡åƒ &lt;a href="https://luxagraf.net/src/how-set-django-uwsgi-systemd-debian-8"&gt;&lt;em&gt;How to Set Up Django with Nginx, uWSGI &amp;amp; systemd on Debian/Ubuntu&lt;/em&gt;&lt;/a&gt; çš„æ–‡ç« ï¼Œå‰©ä¸‹è¦è‡ªå·±çµ„è£é‚„æ˜¯è¦èŠ±ä¸€é»žæ™‚é–“ã€‚åŒæ™‚ä¹ŸæŠŠéƒ¨ç½² pydoc server çš„è¨­å®šéƒ½è¨˜åœ¨é€™ï¼Œå°‡ä¾†è¦é‡å»ºä¹Ÿæ¯”è¼ƒç°¡å–®ã€‚&lt;/p&gt;
&lt;p&gt;é—œæ–¼èªªæ˜Žæ–‡ä»¶ç¿»è­¯ï¼Œæ‡‰è©²æœƒå†èŠ±ç¯‡æ–‡ç« å¥½å¥½å¯«æ•´å€‹è¨ˆç•«æœ¬èº«ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆæ˜¯èªªå¦‚æžœæœ‰äººèƒ½å¾žé ­çœ‹åˆ°å°¾çš„è©±ï¼Œçµ¦å€‹å›žé¥‹å§ &amp;gt; &amp;lt;ï¼‰&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-zh-Hant"&gt;
&lt;p&gt;å…«å¦æ˜¯ï¼Œè‡ºç£ç¹é«”ä¸­æ–‡çš„ language code (or locale identifier) ç©¶ç«Ÿæ˜¯ zh_TWã€zh-Hantã€zh-Hant-TWã€zh-Hant_TWã€zh_Hant é‚„æ˜¯ zh_Hant_TWï¼Ÿé€™å•é¡Œæœ¬èº«å°±å¯ä»¥å¯«ä¸€ç¯‡äº†ã€‚&lt;br&gt;&lt;br&gt;æŸ¥åœ‹éš›è¦ç¯„ &lt;a href="http://www.ietf.org/rfc/bcp/bcp47.txt"&gt;BCP 47&lt;/a&gt; çš„è©±ï¼Œåªæœ‰ &lt;a href="http://www.iana.org/assignments/lang-tags/zh-Hant"&gt;zh-Hant&lt;/a&gt; å’Œ &lt;a href="http://www.iana.org/assignments/lang-tags/zh-Hant-TW"&gt;zh-Hant-TW&lt;/a&gt;ï¼Œæ›´å¤šé—œæ–¼æ¨™æº–çš„èªªæ˜Žèˆ‡å®šç¾©å¯ä»¥åƒè€ƒ &lt;a href="https://www.w3.org/International/articles/bcp47/"&gt;&lt;em&gt;Understanding the New Language Tags&lt;/em&gt;, W3C&lt;/a&gt; ä¸€æ–‡ã€‚&lt;br&gt;&lt;br&gt;ä¸éŽç¾ç‹€æ˜¯å¾ˆå¥‡å¦™çš„ã€‚åƒè€ƒ OSX å®šç¾© &lt;a href="https://developer.apple.com/library/ios/documentation/MacOSX/Conceptual/BPInternational/LanguageandLocaleIDs/LanguageandLocaleIDs.html"&gt;&lt;em&gt;Language and Locale IDs&lt;/em&gt;&lt;/a&gt; çš„è©±æ‡‰è©²æ˜¯ zh_TWã€zh-Hant æˆ– zh-Hant_TWã€‚è€Œåœ¨ Debain ä¸­ï¼Œæ‰€æœ‰æ”¯æ´çš„ locale å¯«åœ¨ &lt;code&gt;/usr/share/i18n/SUPPORTED&lt;/code&gt;ï¼Œè£¡é¢åªæœ‰ zh_TWï¼Œä¸éŽ Debian åªç”¨ &lt;code&gt;language[_country][.charset]&lt;/code&gt; æ‰€ä»¥ä¸æœƒæœ‰å®šç¾©ä¸­ç‚º script çš„ Hantï¼Œé›–ç„¶åœ¨ locale ä¸­ä½¿ç”¨åº•ç·šèˆ‡ &lt;a href="http://www.ietf.org/rfc/bcp/bcp47.txt"&gt;BCP 47&lt;/a&gt; çš„å®šç¾©ä¸åŒã€‚Sphinx é€éŽ &lt;a href="http://babel.pocoo.org/"&gt;Babel&lt;/a&gt; è™•ç† localeï¼Œä½†å®ƒä¸å…è¨± locale ä¸­æœ‰ &lt;code&gt;-&lt;/code&gt;ï¼Œå› æ­¤åªèƒ½è€ƒæ…® zh_Hant æˆ– zh_Hant_TWã€‚æ›´æœ‰è¶£çš„æ˜¯ï¼Œlocale æ‡‰è©²æ˜¯ case-insensitive æ‰€ä»¥å¤§å°å¯«æ˜¯ä¸é‡è¦çš„ XD&amp;#160;&lt;a class="footnote-backref" href="#fnref-zh-Hant" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-pydoc-url"&gt;
&lt;p&gt;å…¶å¯¦åœ¨ &lt;a href="https://docs.python.org/"&gt;https://docs.python.org/&lt;/a&gt; ä¸Šé¢ &lt;a href="https://docs.python.org/3/"&gt;/3/&lt;/a&gt; å’Œ &lt;a href="https://docs.python.org/3.5/"&gt;/3.5/&lt;/a&gt; æ˜¯ä¸åŒä»½æ–‡ä»¶ï¼Œå³ä½¿æ˜¯åŒå€‹ç‰ˆæœ¬è™Ÿå®ƒå€‘æ›´æ–°çš„æ™‚é–“ä¸ç›¸åŒã€‚è »æ„å¤–æœƒæ˜¯é€™æ¨£çš„æƒ…æ³ã€‚ä¸éŽæˆ‘å€‘ä¸ç”¨æžé€™éº¼è¤‡é›œï¼Œåªè¦è½‰å€å°±å¥½ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-pydoc-url" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-build-link"&gt;
&lt;p&gt;é–‹ç™¼æ™‚ä¸€ç›´éƒ½æ˜¯ç”¨ GETï¼Œå³å¦‚æ–‡ä¸­æ‰€èªªï¼Œæœ‰å€‹å°ˆå±¬çš„ linkã€‚ä½†ç™¼ç¾æœƒæœ‰ robot / crawler æ‰“é€™äº›è·¯å¾‘ï¼Œå› æ­¤æœ€å¾Œæ”¹æˆ POSTï¼ŒæŠŠ &lt;code&gt;{{ pagename }}&lt;/code&gt; ç”¨ data-* å³ &lt;code&gt;&amp;lt;a href="#" data-pagename="{{ pagename }}"&amp;gt;...&amp;lt;/a&amp;gt;&lt;/code&gt; çš„æ–¹å¼å­˜èµ·ä¾†ï¼Œåœ¨ç”¨ jQuery ç¶å®š click listenerã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-build-link" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-python3"&gt;
&lt;p&gt;çœ‹ &lt;a href="https://github.com/coleifer/huey"&gt;huey&lt;/a&gt; å’Œ &lt;a href="https://github.com/PolicyStat/jobtastic"&gt;jobtastic&lt;/a&gt; master branch ä¸Šæœ‰ py3k çš„ commit ä½†æ„Ÿè¦ºæ˜¯æœ€è¿‘çš„äº‹ï¼Œæœ‰å¾…è§€å¯Ÿã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-python3" title="Jump back to footnote 4 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-ec2-nano"&gt;
&lt;p&gt;åå˜ˆä¸€ä¸‹ï¼Œt2.nano vCPU çœŸçš„æ™‚å¿«æ™‚æ…¢ï¼Œæœ‰æ™‚ build doc å¹¾åˆ†é˜å°±æžå®šäº†ï¼Œæœ‰æ™‚è¦å¹¾ååˆ†é˜ï¼Œæœ‰ä¸€å¤©è¶…æ…¢ï¼Œç„¶å¾Œåˆè¢« web crawler æŠ“åˆ°ï¼Œè®“ task queue timeout é™·å…¥äº† timeoutã€restartã€timeout çš„ç„¡é™åœ°ç„â€¦â€¦&amp;#160;&lt;a class="footnote-backref" href="#fnref-ec2-nano" title="Jump back to footnote 5 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-/run"&gt;
&lt;p&gt;/var/run = /runï¼Œé€™å€‹è·¯å¾‘æ˜¯å€‹ tmpfs æ‰€ä»¥æ¯æ¬¡é‡é–‹æ©Ÿå°±æœƒæ¸…ç©ºï¼Œç›®éŒ„è¦è¨˜å¾—é‡å»ºã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-/run" title="Jump back to footnote 6 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="zh"></category><category term="pydoctw"></category><category term="python"></category><category term="django"></category><category term="postgresql"></category><category term="deploy"></category><category term="debian"></category><category term="systemd"></category><category term="nginx"></category><category term="uwsgi"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—é™„éŒ„ - Bioinfo Practices using Python</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/" rel="alternate"></link><published>2016-01-21T23:30:00-06:00</published><updated>2016-01-21T23:30:00-06:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-appendix-bioinfo-python/</id><summary type="html">&lt;p&gt;A walk through of practices created by Rosalind Team.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jan, 2016 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;We are going to walk through a series of practice created by &lt;a href="http://rosalind.info/problems/"&gt;Rosalind Team&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once you register an account at Rosalind, you can use their judging system to work through all problems. However, in this case you cannot arbitrarily skip easy levels and it sucks. So I&amp;rsquo;m not going to force you using the system. Luckily, in each problem one set of example data and expected output is given, which can be used for checking our answer.&lt;/p&gt;
&lt;p&gt;Note: Their code assumes Python 2 but everything I mention here is Python 3.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#python-basics"&gt;Python Basics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bininfo-first-try"&gt;Bininfo First Try&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#q-dna-counting-dna-nucleotides"&gt;Q DNA: Counting DNA Nucleotides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#q-revc-the-secondary-and-tertiary-structures-of-dna"&gt;Q REVC: The Secondary and Tertiary Structures of DNA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#q-gc-computing-gc-content"&gt;Q: GC: Computing GC Content&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#workthrough"&gt;Workthrough&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#q-next"&gt;Q: (next?)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="python-basics"&gt;Python Basics&lt;/h2&gt;
&lt;p&gt;Do their &lt;a href="http://rosalind.info/problems/list-view/?location=python-village"&gt;Python Village&lt;/a&gt; problem sets. If any topic you don&amp;rsquo;t know, go read your Python reference.&lt;/p&gt;
&lt;p&gt;Should be very trivial.&lt;/p&gt;
&lt;h2 id="bininfo-first-try"&gt;Bininfo First Try&lt;/h2&gt;
&lt;h3 id="q-dna-counting-dna-nucleotides"&gt;Q DNA: Counting DNA Nucleotides&lt;/h3&gt;
&lt;p&gt;Link: &lt;a href="http://rosalind.info/problems/dna/"&gt;http://rosalind.info/problems/dna/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: use &lt;a href="https://docs.python.org/3/library/collections.html#collections.Counter"&gt;collections.Counter&lt;/a&gt; provided by Python&amp;rsquo;s stdlib&lt;/li&gt;
&lt;li&gt;More Hint: use &lt;code&gt;' '.join&lt;/code&gt; and list comprehension to output the answer&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="q-revc-the-secondary-and-tertiary-structures-of-dna"&gt;Q REVC: The Secondary and Tertiary Structures of DNA&lt;/h3&gt;
&lt;p&gt;Link: &lt;a href="http://rosalind.info/problems/revc/"&gt;http://rosalind.info/problems/revc/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: &lt;a href="https://docs.python.org/3/library/functions.html#reversed"&gt;reversed&lt;/a&gt; for any sequence object and a dict for nucleotide code mapping&lt;/li&gt;
&lt;li&gt;More Hint: done in a list comprehension&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="q-gc-computing-gc-content"&gt;Q: GC: Computing GC Content&lt;/h3&gt;
&lt;p&gt;Link: &lt;a href="http://rosalind.info/problems/gc/"&gt;http://rosalind.info/problems/gc/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This is the first complicated problem that some abstraction should help you come up the solution. Try write some re-usable code blocks, for example, function calls and class definitions.&lt;/p&gt;
&lt;p&gt;Don&amp;rsquo;t worry about the computation complexity&lt;/p&gt;
&lt;h4 id="workthrough"&gt;Workthrough&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;You should implement by yourself before looking my solution. Also I didn&amp;rsquo;t see their official solution so my solution can differ a lot from theirs.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Intuitively, we need to implement a FASTA file parser. FASTA contains a series of sequence reads with unique ID. From a object-oriented viewpoint, we create classes &lt;code&gt;Read&lt;/code&gt; for reads and &lt;code&gt;Fasta&lt;/code&gt; for fasta files.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Read&lt;/code&gt; is easy to design and understand,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seq&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;seq&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Since we need to compute their GC content, add a method for &lt;code&gt;Read&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# ... skipped&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;gc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Compute the GC content (in %) of the read.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="c1"&gt;# put the logic here (think of problem Q DNA)&lt;/span&gt;
        &lt;span class="n"&gt;gc_percent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seq&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;gc_percent&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we have to implement the FASTA parser, which reads all read entries and converts them through &lt;code&gt;Read&lt;/code&gt;. In real world we are dealing with &lt;code&gt;myfasta.fa&lt;/code&gt;-like files, but here the input is string.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Fasta&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;raw_str&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Parse a FASTA formated string.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;raw_str&lt;/span&gt;
        &lt;span class="c1"&gt;# convert string into structured reads.&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reads&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Parse the string and yield read in Read class.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="c1"&gt;# though we have no idea right now, the code structure&lt;/span&gt;
        &lt;span class="c1"&gt;# should be something like the following.&lt;/span&gt;
        &lt;span class="n"&gt;raw_lines&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;raw_lines&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here I use &lt;code&gt;yield Read(...)&lt;/code&gt;, which may be unfamiliar for Python beginners. It turns &lt;code&gt;parse(self)&lt;/code&gt; function as a generator. Generator makes you focus on the incoming data. Once data is parsed and converted, the result is immediated thrown out by &lt;code&gt;yield&lt;/code&gt;. We don&amp;rsquo;t care about how to collect all the results. In our case, we catch all the results into a list by &lt;code&gt;list(...)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So how should we read FASTA file? A simple rule in this case is that every read consists by two continuous row. Also, the first row will always be the first read id.&lt;/p&gt;
&lt;p&gt;All we need is read two lines at the same time. Here &lt;a href="https://docs.python.org/3/library/functions.html#zip"&gt;a Pythonic idiom&lt;/a&gt; is introduced. The following code read two non-overlapping lines,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;first_line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;second_line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;iter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;raw_lines&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;first_line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;second_line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;By &lt;code&gt;zip(*[iter(s)]*n)&lt;/code&gt; magic, we are very close to implement a full parser. You could find a lot of &lt;a href="http://stackoverflow.com/a/2233247"&gt;explanations&lt;/a&gt; for this magic.&lt;/p&gt;
&lt;p&gt;Read id line percedes with a &lt;code&gt;&amp;gt;&lt;/code&gt; sign, so we could use something like &lt;code&gt;first_line[1:]&lt;/code&gt; or &lt;code&gt;first_line[len('&amp;gt;'):]&lt;/code&gt; for explicity.&lt;/p&gt;
&lt;p&gt;Then sorting the GC% of reads in a FASTA file is easy.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;fasta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Fasta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;...&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sorted_reads&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fasta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reads&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gc&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;  &lt;span class="c1"&gt;# note 1&lt;/span&gt;
&lt;span class="n"&gt;top_gc_read&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sorted_reads&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# note 2&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;&amp;gt;{0:s}&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;{1:.6f}&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# note 3, 4&lt;/span&gt;
    &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;top_gc_read&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;top_gc_read&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gc&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The code above completes the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;sorted(list, key=key_func)&lt;/code&gt; sorts the list based on the return value of key_func applied to each element.&lt;/li&gt;
&lt;li&gt;or &lt;code&gt;top_gc_read = sorted(..., reversed=True)[0]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;two string with no operands in between will be joint automatically. In this case it is exactly &lt;code&gt;&amp;gt;{0:s}\n{1:.6f}&lt;/code&gt;. This is useful to tidy a super long string.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;'...'.format()&lt;/code&gt; fills the string with given values. See &lt;a href="https://docs.python.org/3/library/string.html#formatspec"&gt;doc&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In real case FASTA can span across multiple lines, also likely the file we parse is broken. How could we modify this parser to handle these situations?&lt;/p&gt;
&lt;h3 id="q-next"&gt;Q: (next?)&lt;/h3&gt;
&lt;p&gt;I&amp;rsquo;m super tired now so I&amp;rsquo;ll leave the rest for you. Try those problems within yellow correct ratio range.&lt;/p&gt;</content><category term="en"></category><category term="labcoding"></category><category term="python"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—ï¼Python</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/" rel="alternate"></link><published>2016-01-21T22:50:00-06:00</published><updated>2016-01-21T22:50:00-06:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-python/</id><summary type="html">&lt;p&gt;é¸æ“‡ Python ä½œç‚ºç¬¬ä¸€å€‹æ·±å…¥å­¸ç¿’çš„èªžè¨€æœ‰å¾ˆå¤šå¥½è™•ã€‚ä»–çš„èªžæ³•è·Ÿè‹±æ–‡ç›¸ä¼¼ã€ç”¨äº’å‹•å¼çš„æ–¹å¼ä¾†æ“ä½œï¼Œæ–¹ä¾¿ä»¥é‚Šè©¦é‚Šå­¸ã€å…§å»ºçš„æ¨™æº–å‡½å¼åº«åŠŸèƒ½è±å¯Œã€ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œå¹¾ä¹Žèƒ½ç”¨ Python å®Œæˆå„ç¨®äº‹æƒ…ã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jun, 2017 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Python æ˜¯ä¸€ç¨®ç‰©ä»¶å°Žå‘ã€ç›´è­¯å¼çš„é›»è…¦ç¨‹å¼èªžè¨€ï¼Œå…·æœ‰è¿‘äºŒåå¹´çš„ç™¼å±•æ­·å²ã€‚å®ƒåŒ…å«äº†ä¸€çµ„åŠŸèƒ½å®Œå‚™çš„æ¨™æº–åº«ï¼Œèƒ½å¤ è¼•é¬†å®Œæˆå¾ˆå¤šå¸¸è¦‹çš„ä»»å‹™ã€‚&lt;/p&gt;
&lt;p&gt;(From &lt;a href="https://zh.wikipedia.org/wiki/Python"&gt;Wikipedia&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¸æ“‡ Python ä½œç‚ºç¬¬ä¸€å€‹æ·±å…¥å­¸ç¿’çš„èªžè¨€æœ‰å¾ˆå¤šå¥½è™•ã€‚ä»–çš„èªžæ³•è·Ÿè‹±æ–‡ç›¸ä¼¼ï¼Œæ¯”èµ·å…¶ä»–èªžè¨€ç¶“å¸¸ç”¨åˆ° &lt;code&gt;;{}()&lt;/code&gt; ä¾†æŽ§åˆ¶èªžæ³•ä¸åŒçš„æ®µè½ï¼ŒPython ä¸»è¦ç”¨çš„æ˜¯ç©ºç™½èˆ‡ç¸®æŽ’ã€‚&lt;/p&gt;
&lt;p&gt;Python èƒ½ç”¨äº’å‹•å¼çš„æ–¹å¼ï¼ˆreadâ€“evalâ€“print loop, REPLï¼‰ä¾†æ“ä½œï¼Œä»¥é‚Šè©¦é‚Šåšçš„æ–¹æ³•ä¾†é–‹ç™¼å¾ˆé©åˆåˆå­¸è€…ã€‚&lt;/p&gt;
&lt;p&gt;å…§å»ºçš„æ¨™æº–åº«ï¼ˆstandard libraryï¼‰åŠŸèƒ½å¾ˆè±å¯Œï¼Œåœ¨ç¶²è·¯ã€æ–‡å­—è™•ç†ã€æª”æ¡ˆè™•ç†ã€ç”šè‡³ GUI ä»‹é¢éƒ½èƒ½ç”¨å®ƒå®Œæˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒçš„ç¬¬ä¸‰æ–¹å¥—ä»¶ä¹Ÿå¾ˆå¤šï¼Œåœ¨ Linux ä¸Šå¾ˆå¥½å®‰è£ï¼Œé€™æ¨£å¹¾ä¹Žèƒ½ç”¨ Python å®Œæˆå„ç¨®äº‹æƒ…ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;è½èªªç³»åˆ—&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python"&gt;è½èªª Python è·‘å¾ˆæ…¢ï¼Œæ˜¯ä¸æ˜¯ä¸èƒ½ç”¨ä¾†è¨ˆç®—/åˆ†æž/å¤§æª”æ¡ˆï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python-2-python-3"&gt;Python 2 é‚„æ˜¯ Python 3ï¼Œè½æˆ‘æœ‹å‹èªªâ€¦æ¯”è¼ƒå¥½ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç›¸é—œè³‡æº&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#introducing-python-python"&gt;Introducing Pythonï¼ˆç²¾é€š Pythonï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python_1"&gt;Python å®˜ç¶²&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python_2"&gt;Python ç¨‹å¼è¨­è¨ˆã€Œè¶…å…¥é–€ã€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#learning-python"&gt;Learning Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python-cookbookpython"&gt;Python Cookbookï¼ˆPython çš„éŒ¦å›Šå¦™è¨ˆï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#fluent-python-python"&gt;Fluent Pythonï¼ˆæµæš¢çš„ Pythonï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#moocs"&gt;MOOCs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;å­¸ç¿’ç›®æ¨™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#file-a1_python_bioinfo-md"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="_1"&gt;è½èªªç³»åˆ—&lt;/h2&gt;
&lt;p&gt;ï¼ˆéœ€è¦æŽ¥è§¸éŽ Python ä¹‹å¾Œæ‰èƒ½ç†è§£ï¼‰&lt;/p&gt;
&lt;h3 id="python"&gt;è½èªª Python è·‘å¾ˆæ…¢ï¼Œæ˜¯ä¸æ˜¯ä¸èƒ½ç”¨ä¾†è¨ˆç®—/åˆ†æž/å¤§æª”æ¡ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Python çš„ç¢ºåŸ·è¡Œæ•ˆçŽ‡æ¯”ç·¨è­¯å¼çš„èªžè¨€å·®ï¼ˆä¾‹ï¼šC/C++ã€Javaï¼‰ï¼Œä½†é€™å¾ˆå¯èƒ½ä¸æ˜¯ä½ ç¨‹å¼è·‘å¾—æ…¢çš„ä¸»å› ï¼Œæ‰€ä»¥ä¹Ÿä¸ä»£è¡¨ Python ä¸èƒ½è™•ç†è¨ˆç®—é‡é«˜çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ç¢°åˆ°ç¨‹å¼è·‘å¾—æ¯”æƒ³åƒä¸­æ…¢çš„æ™‚å€™ï¼Œæœ‰å¹¾å€‹æ­¥é©Ÿï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ°åº•æ˜¯å“ªå¹¾è¡Œç¨‹å¼è·‘å¾—æ…¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é€™æ˜¯æœ€ä½³çš„æ¼”ç®—æ³•å—Žï¼Ÿ&lt;/li&gt;
&lt;li&gt;é€™æ˜¯æœ€æœ‰æ•ˆçŽ‡çš„ Python èªžæ³•å—Žï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æžœç”¨åˆ°äº†æœ€å¾Œä¸€æ­¥æƒ…æ³é‚„æ˜¯æ²’æœ‰æ”¹å–„çš„è©±ï¼Œå°±å¯ä»¥é–‹å§‹æŠŠé‚£äº›éƒ¨ä»½ç”¨å…¶ä»–èªžè¨€æ”¹å¯«ï¼Œä¾‹å¦‚ï¼šCã€‚Python èƒ½å¾ˆå®¹æ˜“è·Ÿ C èªžè¨€çš„çµåˆã€‚è€Œä¸”å¸¸è¦‹çš„ C èªžè¨€åŠ é€Ÿï¼Œå…¶å¯¦éƒ½æœ‰ Python å¥—ä»¶èƒ½æ”¯æ´äº†ï¼Œä¾‹å¦‚ Numpyï¼Œæ‰€ä»¥å¤§éƒ¨ä»½çš„æ™‚é–“ï¼Œéƒ½èƒ½åœ¨ä¸ä½¿ç”¨ Python ä»¥å¤–çš„èªžè¨€å®Œæˆé«˜é‡è¨ˆç®—ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘åœ¨å¯¦ç¿’æ™‚å€™ï¼Œä¹Ÿå¸¸ç¢°åˆ°éœ€è¦å„ªåŒ–çš„å•é¡Œã€‚ç”¨ Python æˆ‘èƒ½å¾ˆè¼•é¬†ï¼ˆä¸€å¤©å…§ï¼‰æŠŠå·¥ä½œåˆ†é…åˆ° 4 å°ä¸»æ©Ÿ 64 cores ä¸Šè·‘ï¼Œä¹Ÿè¨±æ–¹æ³•ä¸æœ‰æ•ˆçŽ‡ï¼Œä½†æ¯”èµ·æˆ‘èŠ±å¹¾å¤©æŠŠ Python æ”¹å¯«æˆ C/C++ï¼Œå¯¦ä½œæ›´ç²¾å¯†æœ‰æ•ˆçš„ç®—æ³•ï¼ˆé‚„è¦æ˜¯ multithreadï¼‰ï¼Œä»”ç´°è™•ç†å¯èƒ½çš„ corner caseï¼Œå¹³è¡ŒåŒ–ä¹‹å¾Œæœ¬ä¾†ä¸‰å››å¤©çš„è¨ˆç®—æ™‚é–“æˆ‘ 2 å€‹å°æ™‚å°±èƒ½æ”¶å·¥ã€‚&lt;/p&gt;
&lt;p&gt;æ›´é‡è¦çš„æ˜¯ï¼Œé€™å€‹å¯¦é©—å°±åªè·‘å€‹å…©æ¬¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯”èµ·è¨ˆç®—æ™‚é–“ï¼Œé–‹ç™¼æ™‚é–“å°å·¥ç¨‹å¸«è€Œè¨€æ˜¯æ›´åŠ å¯¶è²´çš„ã€‚å°¤å…¶åœ¨å¯¦é©—å®¤ï¼Œæœ€é—œå¿ƒçš„æ˜¯é€™å€‹æ–¹æ³•è¡Œä¸è¡Œå¾—é€šï¼Œç¨‹å¼è·‘å¾—æ…¢æœ‰å¾ˆå¤šè§£æ±ºçš„æ–¹å¼ï¼Œä¾‹å¦‚å¹³è¡ŒåŒ–ã€‚é‡é»žåœ¨è§£æ±ºå•é¡Œï¼Œéœ€è¦ç”¨å¤šä¸€é»žçš„è³‡æºå…¶å¯¦ä¸æ˜¯å¾ˆé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœå•æˆ‘ Python é‚„æ˜¯ Matlab æ¯”è¼ƒå¿«ï¼Ÿé€™é‚Šæœ‰æ­£ç¶“çš„ &lt;a href="http://www.pyzo.org/python_vs_matlab.html"&gt;Python vs Matlab&lt;/a&gt;ã€‚ä¸€é–‹å§‹é¸ Python æ…¢çš„è©±æœ‰&lt;a href="http://wiki.scipy.org/PerformancePython"&gt;å¾ˆå¤šæ¢è·¯å¯ä»¥èµ°&lt;/a&gt;ï¼Œä½† Matlab å‘¢ï¼Ÿ meh&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ Python è·‘å¾—å¿«ä¸å¿«ï¼Ÿå®ƒå–®æ‰“ç¨é¬¥æœ‰æ¥µé™ï¼Œä½†å®ƒæœ‰å¾ˆå¤šå¿«æ¨‚å¤¥ä¼´ã€‚O&amp;rsquo;Reilly æœ‰æœ¬ &lt;a href="http://shop.oreilly.com/product/0636920028963.do"&gt;High Performance Python&lt;/a&gt; å€¼å¾—ä¸€çœ‹ã€‚&lt;/p&gt;
&lt;h3 id="python-2-python-3"&gt;Python 2 é‚„æ˜¯ Python 3ï¼Œè½æˆ‘æœ‹å‹èªªâ€¦æ¯”è¼ƒå¥½ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;éš¨è‘—æ™‚é–“æµé€ï¼Œæ¯éŽä¸€å¤©æˆ‘éƒ½å¯ä»¥æ›´ç¢ºä¿¡çš„èªª&lt;strong&gt;ã€Œè«‹å­¸ Python 3ã€&lt;/strong&gt;ã€‚ç¾åœ¨æœ‰åœ¨ç”¨ Python 2 å¤šåŠä¹Ÿæ˜¯ç”¨ 2.7 ç‰ˆæœ¬ï¼Œè¦æŠŠ 3.3+ çš„ç¨‹å¼ç¢¼æ”¹å›ž 2.7 ä¹Ÿä¸é›£ã€‚&lt;/p&gt;
&lt;p&gt;EDIT 2017-06: Python 2.7 ç¢ºå®š&lt;a href="https://pythonclock.org/"&gt;åœ¨ 2020 å¹´æœƒåœæ­¢å®˜æ–¹æ”¯æ´&lt;/a&gt;ï¼Œé€™ä¸ä»£è¡¨èªªåœ¨é‚£å¹´ Python 2.7 å°±æœƒçž¬é–“æ¶ˆå¤±ï¼Œç›®å‰ä¸–ç•Œä¸Šæœ‰éžå¸¸å¤šå…¬å¸æœƒç¹¼çºŒç¶­è­·ä»–å€‘å…§éƒ¨çš„ Python 2.x ç¨‹å¼ç¢¼ï¼Œä½†æ–°çš„å°ˆæ¡ˆéƒ½é è¨­ä½¿ç”¨ 3.5+ ç‰ˆæœ¬é–‹ç™¼ã€‚è€Œå¸‚é¢ä¸Šçš„æ›¸ç±ä¹Ÿå·²ç¶“éƒ½æ˜¯é‡å° Python 3.x æ’°å¯«ï¼ŒéŽå¾€ä½¿ç”¨ä¸­æ–‡å­¸ç¿’çš„éšœç¤™å·²ç¶“æ¶ˆå¤±ã€‚&lt;/p&gt;
&lt;h2 id="_2"&gt;ç›¸é—œè³‡æº&lt;/h2&gt;
&lt;p&gt;é€£åŒå‰å¹¾ç« ï¼Œå¦‚æžœä½ è¦åœ¨è‡ªå·±é›»è…¦ä¸Šè¨­å®š Python é–‹ç™¼ç’°å¢ƒï¼Œå¯ä»¥åƒè€ƒ &lt;a href="http://djangogirlstaipei.herokuapp.com/tutorials/"&gt;Djang Girls Taipei Tutorial&lt;/a&gt;ã€‚å¦å¤–ï¼Œ&lt;a href="http://wiki.python.org.tw/Python/%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%94%A8%E5%B0%B1%E4%B8%8A%E6%89%8B"&gt;Python Taiwan Wiki&lt;/a&gt; æœ‰æ›´å®Œæ•´çš„ Python å­¸ç¿’è³‡æºåˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;O&amp;rsquo;Reillyï¼ˆæ­èŠç¦®ï¼‰çš„æ›¸ï¼Œ&lt;a href="https://shop.oreilly.com/"&gt;å®˜æ–¹ç·šä¸Šå•†åº—&lt;/a&gt;å¸¸æœ‰ 50% æŠ˜æ‰£ï¼ŒPDF/ePub/Mobi æ ¼å¼éƒ½æœ‰, è²·ä¸€æ¬¡å°±èƒ½è¼•é¬†åœ¨é›»è…¦ã€Kindleã€eReader ä¸Šé–±è®€ï¼Œèƒ½æŽ¥å—è‹±æ–‡çš„è©±ï¼Œååˆ†æŽ¨è–¦è·Ÿå®˜æ–¹è³¼è²·ã€‚ä¸­æ–‡ç‰ˆå°±ä»¥&lt;a href="https://www.tenlong.com.tw/"&gt;å¤©ç“æ›¸å±€&lt;/a&gt;ç‚ºä¸»ã€‚å®ƒä¹Ÿæœ‰è³£è‹±æ–‡ç´™æœ¬ï¼Œé€›å¯¦é«”åº—å¾ˆèˆ’æœã€‚&lt;/p&gt;
&lt;p&gt;EDIT 2017-06: è‡ªæœ¬æ–‡æ’°å¯«å…©å¹´ä»¥ä¾†ï¼Œå¸‚é¢ä¸Š Python 3.x ä¸­æ–‡æ›¸å·²ç¶“éžå¸¸å……è¶³ï¼Œåœ¨å¤©ç“å¯¦é«”åº—ç”šè‡³æœ‰ä¸€æ•´å€‹å°ˆæ«ƒæä¾›ä¸åŒé›£æ˜“åº¦ã€å„ç¨®æ‡‰ç”¨çš„å°ˆæ›¸ã€‚åº•ä¸‹åˆ—å‡ºçš„æ›¸åªæ˜¯æˆ‘å€‹äººçš„æŽ¨è–¦èˆ‡åå¥½ï¼Œå»ºè­°æœ‰ç©ºåˆ°æ›¸åº—è¦ªè‡ªç¿»ä¸€ç¿»æ›´èƒ½æ‰¾åˆ°è‡ªå·±å–œæ­¡çš„å­¸ç¿’æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†æ›¸ç±ä¹‹å¤–ï¼Œç¾åœ¨è¶Šä¾†è¶Šå¤šä»¥å½±ç‰‡ã€äº’å‹•å½¢å¼çš„æ•™å­¸ï¼Œåƒ Jessica McKellar éŒ„è£½çš„ &lt;a href="http://shop.oreilly.com/product/110000448.do"&gt;Introduction to Python&lt;/a&gt; æ•™å­¸å½±ç‰‡å³éžå¸¸å—æ­¡è¿Žã€‚å› ç‚ºæˆ‘ä¸¦æ²’æœ‰è¦ªè‡ªçŽ©éŽé€™äº›æ–°èª²ç¨‹ï¼Œå®ƒå€‘ä¸¦æ²’æœ‰åˆ—æ–¼æ­¤ï¼Œä½†éƒ½æ­¡è¿Žè®€è€…å˜—è©¦ã€‚&lt;/p&gt;
&lt;h3 id="introducing-python-python"&gt;Introducing Pythonï¼ˆç²¾é€š Pythonï¼‰&lt;/h3&gt;
&lt;p&gt;O&amp;rsquo;Reilly Python ç³»åˆ—çš„æ›¸éƒ½å¯«å¾—å¾ˆå¥½ã€‚é€™æœ¬æ˜¯æ¯”è¼ƒæ–°å‡ºçš„ï¼Œå¥½è™•æ˜¯å®ƒé‡å°åˆå­¸è€…ï¼Œæ¯”è¼ƒè–„ï¼Œèƒ½åœ¨çŸ­æ™‚é–“çœ‹å®Œï¼Œæ–‡å­—å¾ˆæµæš¢ã€‚æƒ³è¦å¿«é€ŸæŽŒæ¡åŸºç¤Žçš„èªžæ³•çš„è©±ï¼Œå»ºè­°é–±è®€ Chp1 åˆ° Chp7ï¼Œä»¥åŠ Chp8 File I/O éƒ¨ä»½ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Introducing Python&amp;rdquo;, Bill Lubanovic. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2014.11&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920028659.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tenlong.com.tw/items/9863477311?item_id=1007464"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="python_1"&gt;Python å®˜ç¶²&lt;/h3&gt;
&lt;p&gt;Python çš„å®˜ç¶²é™¤äº†æŸ¥èªžè¨€ç‰¹æ€§ä¹‹å¤–ï¼Œé‚„èƒ½ç”¨ä¾†å­¸ç¿’æ€Žéº¼ä½¿ç”¨ stdlibã€‚Python æ¨™æº–å‡½å¼åº«åŠŸèƒ½åŒ…å±±åŒ…æµ·ï¼Œåœ¨ä½ æƒ³è¦åšä»€éº¼ä¹‹å‰ï¼Œéƒ½æ‡‰è©²åˆ°å®˜ç¶²æŸ¥çœ‹çœ‹æ˜¯ä¸æ˜¯å…§å»º module å°±å·²ç¶“æä¾›åŠŸèƒ½äº†ã€‚é™¤å¤–ï¼Œé‚„æœ‰ä¸€å€‹ç°¡æ½”çš„ tutorialï¼Œä¾›åˆå­¸è€…åƒè€ƒï¼Œé©åˆæœ‰å­¸éŽå…¶ä»–èªžè¨€çš„äººã€‚æˆ‘èªç‚ºé€™ä»½å¯«å¾—éžå¸¸å¥½ï¼Œè‹¦æ–¼æ²’æœ‰ä¸­æ–‡ï¼Œæ“šä»¥å‰ç¶“é©—ä¸å¤ªå®¹æ˜“æŽ¨å»£ï¼Œä½†å€¼å¾—ä¸€è®€ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Python Tutorial&amp;rdquo;, Official Python Documentation, Python Devs.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/3/"&gt;é€£çµ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.pythondoc.com/pythontutorial3/index.html"&gt;ç°¡ä¸­ç¿»è­¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org.tw/3/tutorial/index.html"&gt;ç¹ä¸­ç¿»è­¯&lt;/a&gt;ï¼ˆé€²è¡Œä¸­ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="python_2"&gt;Python ç¨‹å¼è¨­è¨ˆã€Œè¶…å…¥é–€ã€&lt;/h3&gt;
&lt;p&gt;å¦‚æžœä½ å®Œå…¨æ²’æœ‰ä»»ä½•ç¨‹å¼è¨­è¨ˆçš„åŸºç¤Žï¼Œä¾‹å¦‚ä¸æ‡‚ä»€éº¼æ˜¯è®Šæ•¸ã€å¦‚æžœå¯«ç¨‹å¼æŽ§åˆ¶é›»è…¦è¡Œç‚ºã€ä»€éº¼æ˜¯å‘½ä»¤åˆ—æ¨¡å¼ï¼Œé‚£éº¼é€™æœ¬å…¥é–€æ›¸æ‡‰è©²å¾ˆé©åˆä½ ã€‚å®ƒç”¨åœ–è§£çš„æ–¹å¼åŽ»è§£é‡‹ä½•è¬‚è¿´åœˆã€if-else æ¢ä»¶åˆ¤æ–·ã€ç‰©ä»¶å°Žå‘æ¦‚å¿µã€‚é€™é‚Šæ‰€åˆ—çš„å…¶ä»–ã€Œå…¥é–€æ›¸ã€ï¼Œéƒ½æœƒå‡è¨­ä½ å¤§æ¦‚çŸ¥é“ä¸Šè¿°é€™äº›æ¦‚å¿µã€‚åˆ°äº†æœ€å¾Œå…©ç« å¯èƒ½æœƒçªç„¶è®Šå¾—è¤‡é›œï¼Œé€™æ™‚å€™å¯ä»¥å†å›žé ­çœ‹çœ‹å…¶ä»–å…¥é–€æ›¸ï¼Œæ‡‰è©²å°±æœƒæœ‰è¾¦æ³•é–±è®€ã€‚&lt;/p&gt;
&lt;p&gt;ã€ŠPython ç¨‹å¼è¨­è¨ˆã€Œè¶…å…¥é–€ã€ã€‹ï¼ŒéŽŒç”°æ­£æµ©ã€€è‘—ã€é™³ç¦¹è±ªã€æž—å­æ”¿ è­¯ã€‚æ——æ¨™ 2016.11&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://amzn.asia/dQgghO8"&gt;æ—¥æ–‡æ›¸&lt;/a&gt; (source: Amazon)&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.tenlong.com.tw/products/9789863123798"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="learning-python"&gt;Learning Python&lt;/h3&gt;
&lt;p&gt;é›–ç„¶åç¨±çœ‹èµ·ä¾†å¾ˆåƒæ˜¯ Python çš„å…¥é–€æ›¸ï¼Œä½†å®ƒçš„ç¯‡å¹…å·²ç¶“ä¾†åˆ° 1600 é ï¼Œå¯¦åœ¨ç„¡æ³•æŽ¨è–¦çµ¦åˆå­¸è€…ã€‚å®ƒåœ¨ä¸€æœ¬æ›¸å…§æŠŠ Python å¹¾ä¹Žæ‰€æœ‰èªžè¨€ç‰¹æ€§éƒ½èªªæ¸…æ¥šï¼ŒåŒæ™‚è€ƒæ…®åˆ° Python 2 å’Œ 3 ç‰ˆæœ¬ã€‚ç•¶ä½ æƒ³è¦äº†è§£ï¼Œä¾‹å¦‚ MRO çš„é †åºã€ä½•è¬‚ unbounded, bound methodï¼Œé€™æœ¬æ›¸è©³ç´°çš„ç¨‹åº¦ä¸æœƒè®“ä½ å¤±æœ›ï¼Œåªæ€•ä½ æ²’ç©ºè®€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç•¶åˆçœ‹çš„æ˜¯é€™ä¸€æœ¬ 3ed ä¸­æ–‡ç‰ˆï¼ˆç¾å·²çµ•ç‰ˆï¼‰ï¼Œé‚£æ™‚é‚„æ²’æœ‰è€ƒæ…® Python 3ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Learning Python&amp;rdquo; 5ed, Mark Lutz. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2013.06&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920028154.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="python-cookbookpython"&gt;Python Cookbookï¼ˆPython çš„éŒ¦å›Šå¦™è¨ˆï¼‰&lt;/h3&gt;
&lt;p&gt;é€™æœ¬ä¸æ˜¯å…¥é–€æ›¸ä½†å¾ˆé©åˆæ·±å…¥äº†è§£ Pythonï¼Œä¸¦è®“è‡ªå·±çš„ç¨‹å¼ç¢¼å¯«å¾—æ›´ Pythonicã€‚è£¡é¢ä»‹ç´¹äº†å¾ˆå¤šå¯«æ³•æ…£ä¾‹ idiomsï¼ŒåŒæ™‚ä¹Ÿæœ‰ä¸­æ–‡ç‰ˆã€‚éžå¸¸å€¼å¾—åœ¨æœªä¾†æ¯”è¼ƒæ‡‚ Python æ™‚è²·ä¾†çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…ä¹‹ä¸€ David Beazley æ˜¯ PyCon TW 2013 çš„ Keynoteã€‚ä»–å¹³å¸¸å°±æ˜¯å°ˆé–€æ•™ Python çš„è¬›å¸«ï¼Œä»–åœ¨ PyCon è¬›éŽçš„ã€Œæ‰€æœ‰ talk èˆ‡ tutorialã€ï¼Œå¦‚ &lt;a href="http://www.dabeaz.com/coroutines/"&gt;concurrency&lt;/a&gt;, &lt;a href="http://www.dabeaz.com/modulepackage/index.html"&gt;packaging&lt;/a&gt;, &lt;a href="https://www.youtube.com/watch?v=MCs5OvhV9S4"&gt;async io&lt;/a&gt; ç­‰ç­‰éƒ½å€¼å¾—ä¸€çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Python Cookbook&amp;rdquo; 3ed, David Beazley and Brian K. Jones. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2013.05&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920027072.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tenlong.com.tw/items/9863470686"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="fluent-python-python"&gt;Fluent Pythonï¼ˆæµæš¢çš„ Pythonï¼‰&lt;/h3&gt;
&lt;p&gt;ç•¶å®ƒæ˜¯è©³ç´°ã€æ“´å……ç‰ˆçš„ &amp;ldquo;Python Cookbook&amp;rdquo;ï¼Œå¯¦éš›ä¸Šæ›¸ä¸­ä¹Ÿå¸¸å¸¸å¼•ç”¨ David çš„è©±ã€‚è¬›è¿°æ›´å¤š Python åˆä»‹ç´¹æ™‚ä¸æœƒæ·±è«‡çš„èªžè¨€ç‰¹æ€§ã€‚å¦‚ï¼šMRO, Mixin, decorator, closure, metaprogramming&lt;/p&gt;
&lt;p&gt;æ¯ç« æœ€å¾Œçš„ Future Reading èˆ‡ Soapbox æ—å¾µåšå¼•ï¼Œé™¤äº†æ›´ç´°ç¯€çš„åƒè€ƒè³‡æ–™ï¼Œé‚„æœ‰ç•¶åˆ Python ç‚ºä½•å¦‚æ­¤è¨­è¨ˆç­‰è€ƒé‡èˆ‡è¨Žè«–çš„æ­·å²ã€ç™¼å±•ã€èˆ‡å„èªžè¨€æ¯”è¼ƒã€‚éžå¸¸é©åˆåšç‚ºé‚å‘ Python core developer çš„åƒè€ƒæ›¸ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Fluent Python&amp;rdquo;, Luciano Ramalho. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2015.07&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920032519.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tenlong.com.tw/items/986347911X"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="moocs"&gt;MOOCs&lt;/h3&gt;
&lt;p&gt;é—œæ–¼ MOOCs æˆ‘æœ‰çœ‹éŽ Codecademy Python Track ä»¥åŠ Coursera &amp;ldquo;An Introduction to Interactive Programming in Python&amp;rdquo; é€™å…©é–€èª²ã€‚æˆ‘è¦ºå¾—æœ€å¤§çš„ç¼ºé»žå°±æ˜¯è¬› Python 2.7ï¼ŒPython 3.x çš„å¥½ç”¨åŠŸèƒ½èˆ‡å·®ç•°éƒ½æ²’æï¼›å†ä¾†è¬›èª²çš„ code ç¯„ä¾‹ä¸¦ä¸æ˜¯ä½¿ç”¨ idiomatic Python syntaxï¼Œåœ¨åˆå­¸å°±æ²’é¤Šæˆå¥½ç¿’æ…£èˆ‡æ…£ç”¨èªžæ³•æœ‰é»žå¯æƒœã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Codecademy Python Track &lt;a href="http://www.codecademy.com/en/tracks/python"&gt;http://www.codecademy.com/en/tracks/python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Coursera: An Introduction to Interactive Programming in Python &lt;a href="https://www.coursera.org/course/interactivepython"&gt;https://www.coursera.org/course/interactivepython&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="_3"&gt;å­¸ç¿’ç›®æ¨™&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ‰“é–‹è‡ªå·± Linux è£¡çš„ Python3ï¼Œè·Ÿè‘—å­¸ç¿’ç”¨çš„åƒè€ƒè³‡æ–™å‹•æ‰‹æ“ä½œã€‚ç”¨ REPL ä»¥åŠé‹è¡Œè…³æœ¬å…©ç¨®æ–¹æ³•ä¾†åŸ·è¡Œ Python ç¨‹å¼ã€‚&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­¸ç¿’ä½¿ç”¨ pip å’Œ venv (virtualenv) ä¾†ç®¡ç† Python å¥—ä»¶èˆ‡ç’°å¢ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: Python å®˜ç¶²æ˜¯ä½ çš„å¥½å¤¥ä¼´ã€‚ä½ å¯ä»¥åœ¨&lt;a href="https://docs.python.org/3/installing/"&gt;é€™è£¡ (pip)&lt;/a&gt; å’Œ&lt;a href="https://docs.python.org/3/library/venv.html?highlight=venv"&gt;é€™è£¡ (venv)&lt;/a&gt; æ‰¾åˆ°å…©è€…çš„æ•™å­¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://rg3.github.io/youtube-dl/"&gt;youtube-dl&lt;/a&gt; æ˜¯ä¸€å€‹ç”¨ä¾†ä¸‹è¼‰ Youtubeã€Crunchyroll ç­‰å„å¤§å½±éŸ³ä¸²æµç¶²ç«™å½±ç‰‡çš„å·¥å…·ã€‚é™¤äº†ç”¨ Linux çš„å¥—ä»¶ç®¡ç†å·¥å…·å®‰è£å®ƒï¼Œå®ƒå…¶å¯¦æ˜¯å€‹ç”¨ Python å¯«æˆçš„å¥—ä»¶ã€‚ç‚ºäº†é¿å…è·Ÿ Linux ç³»çµ±ç’°å¢ƒç›¸è¡ï¼Œè«‹é–‹ä¸€å€‹ Python è™›æ“¬ç’°å¢ƒï¼Œä¸¦åœ¨è£¡é¢ç”¨ pip å®‰è£å®ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Note: youtube-dl é™¤äº†å–®ç´”åšä¸‹è¼‰ä¸²æµæª”ä¹‹å¤–ï¼Œé‚„æ”¯æ´è½‰æª”ã€å°è£ã€å¾Œè£½ç­‰å½±åƒè™•ç†ï¼Œé€™éœ€è¦ libav æˆ– ffmpeg ä»»ä¸€å½±åƒè™•ç†å¥—ä»¶ã€‚åœ¨ Debian ç³»åˆ—çš„ Linux ä¸Š libav æœƒå¥½è£ä¸€é»žã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨ Python è§£æ±ºä¸€äº›å¯¦é©—å®¤æœƒç¢°åˆ°çš„ Bioinfo å•é¡Œã€‚æœ‰å€‹ç¶²ç«™ Rosalind å‡ºäº†ä¸€ç³»åˆ—çš„é¡Œç›®ï¼Œæˆ‘é¸äº†ä¸€äº›è®“å„ä½ç·´ç¿’ï¼Œè«‹åƒè€ƒ&lt;a href="#file-a1_python_bioinfo-md"&gt;é™„éŒ„ 1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;EDIT 2016-05-22: æŠŠ &lt;a href="https://www.ptt.cc/bbs/Python/M.1463750830.A.DA8.html"&gt;ptt ç™¼æ–‡&lt;/a&gt; çš„å…§å®¹æ›´æ–°ä¸Šä¾†ï¼Œå¢žåŠ ä¸€äº›æ–°æ›¸å’Œä¸­æ–‡ç¿»è­¯ï¼›èª¿æ•´æŽ¨è–¦çš„é †åºã€‚&lt;br&gt;
EDIT 2017-06-20: æ›´æ–°æ›¸ç±è³‡è¨Šèˆ‡ 2/3 æ¯”è¼ƒã€‚&lt;/p&gt;</content><category term="zh"></category><category term="labcoding"></category><category term="python"></category></entry><entry><title>Numpy Indexing</title><link href="https://blog.liang2.tw/posts/2016/01/numpy-index/" rel="alternate"></link><published>2016-01-18T02:00:00-06:00</published><updated>2016-01-18T02:00:00-06:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2016-01-18:/posts/2016/01/numpy-index/</id><summary type="html">&lt;p&gt;Numpy å¤šç¶­åº¦çš„ indexing è·Ÿ pandas è¡Œç‚ºä¸ä¸€æ¨£ï¼Œéœ€è¦é¡å¤–çš„æ“ä½œã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;å‰å¹¾å¤©éœ€è¦å¯« &lt;a href="http://docs.scipy.org/doc/numpy/index.html"&gt;numpy&lt;/a&gt; æ™‚ï¼Œçªç„¶ç™¼ç¾è·Ÿ &lt;a href="http://pandas.pydata.org/"&gt;pandas&lt;/a&gt; åœ¨ indexing çš„è¡Œç‚ºè »ä¸ä¸€æ¨£çš„ã€‚æˆ‘æ„Ÿè¦ºæœªä¾†ä¸€å®šæœƒå¿˜è¨˜ï¼Œå…ˆç­†è¨˜èµ·ä¾†ã€‚&lt;/p&gt;
&lt;p&gt;å°±ç”¨æ™‚äº‹ä¾†èˆ‰ä¾‹å§ï¼ŒæŠŠç¶­åŸºç™¾ç§‘ä¸Š&lt;a href="https://zh.wikipedia.org/wiki/2016%E5%B9%B4%E4%B8%AD%E8%8F%AF%E6%B0%91%E5%9C%8B%E7%AB%8B%E6%B3%95%E5%A7%94%E5%93%A1%E9%81%B8%E8%88%89"&gt;å„æ”¿é»¨ 2016 å¹´è‡ºç£ç«‹æ³•å§”å“¡æåæ•¸&lt;/a&gt;çš„è¡¨æ ¼æŠ“ä¸‹ä¾†ã€‚è™•ç†åŽŸå§‹è³‡æ–™çš„ç¨‹å¼æ”¾åˆ°æ–‡æœ«ï¼Œåšå®Œå¤§æ¦‚é•·é€™æ¨£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;&lt;/th&gt;
&lt;th align="right"&gt;å€åŸŸ&lt;/th&gt;
&lt;th align="right"&gt;åŽŸä½æ°‘&lt;/th&gt;
&lt;th align="right"&gt;ä¸åˆ†å€&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ä¸­åœ‹åœ‹æ°‘é»¨&lt;/td&gt;
&lt;td align="right"&gt;72&lt;/td&gt;
&lt;td align="right"&gt;5&lt;/td&gt;
&lt;td align="right"&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;æ°‘ä¸»é€²æ­¥é»¨&lt;/td&gt;
&lt;td align="right"&gt;60&lt;/td&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="right"&gt;34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;å°ç£åœ˜çµè¯ç›Ÿ&lt;/td&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="right"&gt;0&lt;/td&gt;
&lt;td align="right"&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;è¦ªæ°‘é»¨&lt;/td&gt;
&lt;td align="right"&gt;6&lt;/td&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="right"&gt;16&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ç„¡é»¨åœ˜çµè¯ç›Ÿ&lt;/td&gt;
&lt;td align="right"&gt;0&lt;/td&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="right"&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;æ°‘åœ‹é»¨&lt;/td&gt;
&lt;td align="right"&gt;13&lt;/td&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="right"&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ç¶ é»¨ç¤¾æœƒæ°‘ä¸»é»¨è¯ç›Ÿ&lt;/td&gt;
&lt;td align="right"&gt;11&lt;/td&gt;
&lt;td align="right"&gt;0&lt;/td&gt;
&lt;td align="right"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ä¸­è¯çµ±ä¸€ä¿ƒé€²é»¨&lt;/td&gt;
&lt;td align="right"&gt;14&lt;/td&gt;
&lt;td align="right"&gt;0&lt;/td&gt;
&lt;td align="right"&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;æ™‚ä»£åŠ›é‡&lt;/td&gt;
&lt;td align="right"&gt;12&lt;/td&gt;
&lt;td align="right"&gt;0&lt;/td&gt;
&lt;td align="right"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;å¤§æ„›æ†²æ”¹è¯ç›Ÿ&lt;/td&gt;
&lt;td align="right"&gt;12&lt;/td&gt;
&lt;td align="right"&gt;0&lt;/td&gt;
&lt;td align="right"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="pandas-indexing"&gt;Pandas indexing&lt;/h3&gt;
&lt;p&gt;Pandas indexing èŠ±ä¿åˆ°ç”¨&lt;a href="http://pandas.pydata.org/pandas-docs/stable/indexing.html"&gt;ä¸€&lt;/a&gt;ã€&lt;a href="http://pandas.pydata.org/pandas-docs/stable/advanced.html"&gt;å…©&lt;/a&gt;é ä¹Ÿä»‹ç´¹ä¸å®Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽä»Šå¤©åªæƒ³èªªæœ‰é—œå…©å€‹ç¶­åº¦ä»¥ä¸Šçš„ indexingï¼Œä¾‹å¦‚æƒ³çœ‹åœ‹æ°‘é»¨ã€æ°‘é€²é»¨ã€æ™‚ä»£åŠ›é‡å€åŸŸèˆ‡ä¸åˆ†å€çš„æåå¥½äº†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ä¸­åœ‹åœ‹æ°‘é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ°‘ä¸»é€²æ­¥é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ™‚ä»£åŠ›é‡&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;å€åŸŸ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ä¸åˆ†å€&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸Šè¿°å…©å€‹æ–¹æ³•éƒ½èƒ½æ‹¿åˆ°ä¸€éƒ¨ä»½çš„è¡¨æ ¼ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;&lt;/th&gt;
&lt;th align="right"&gt;å€åŸŸ&lt;/th&gt;
&lt;th align="right"&gt;ä¸åˆ†å€&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;ä¸­åœ‹åœ‹æ°‘é»¨&lt;/td&gt;
&lt;td align="right"&gt;72&lt;/td&gt;
&lt;td align="right"&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;æ°‘ä¸»é€²æ­¥é»¨&lt;/td&gt;
&lt;td align="right"&gt;60&lt;/td&gt;
&lt;td align="right"&gt;34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;æ™‚ä»£åŠ›é‡&lt;/td&gt;
&lt;td align="right"&gt;12&lt;/td&gt;
&lt;td align="right"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="numpy-indexing"&gt;Numpy indexing&lt;/h3&gt;
&lt;p&gt;ä¸‹æ„è­˜åœ°ä»¥ç‚º &lt;a href="http://docs.scipy.org/doc/numpy/reference/arrays.indexing.html#arrays-indexing"&gt;numpy indexing&lt;/a&gt; æœƒæ˜¯ä¸€æ¨£çš„ï¼Œç•¢ç«Ÿ pandas åº•å±¤å°±æ˜¯ä¸€å€‹ numpy arrayã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;array([[72,  5, 33],&lt;/span&gt;
&lt;span class="go"&gt;       [60,  2, 34],&lt;/span&gt;
&lt;span class="go"&gt;       [ 2,  0, 15],&lt;/span&gt;
&lt;span class="go"&gt;       [ 6,  1, 16],&lt;/span&gt;
&lt;span class="go"&gt;       [ 0,  1,  7]])&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;IndexError: shape mismatch: indexing arrays could not be broadcast &lt;/span&gt;
&lt;span class="go"&gt;together with shapes (3,) (2,) &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å›žåŽ»çœ‹&lt;a href="http://docs.scipy.org/doc/numpy/reference/arrays.indexing.html#arrays-indexing"&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;æ‰æƒ³èµ·ä¾†ï¼Œ numpy é€™æ™‚å€™æ˜¯å¦‚åŒçµ¦å®š (x, y) åº§æ¨™é€™æ¨£ï¼Œä¸€å€‹å€‹æŠŠå…ƒç´ é¸å‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="go"&gt;[72, 2, 6]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç°¡å–®çš„æ–¹å¼æ˜¯åˆ†å…©æ¬¡é¸ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;:][:,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½†é€™æ¨£ numpy æœƒå‚³å…©æ¬¡ copy&lt;sup id="fnref-1"&gt;&lt;a class="footnote-ref" href="#fn-1"&gt;1&lt;/a&gt;&lt;/sup&gt; å›žä¾†ï¼Œè³‡æ–™å¾ˆå¤§çš„æ™‚å€™å°±æ²’æ•ˆçŽ‡ã€‚æ‰€ä»¥è¦æ€Žéº¼åšå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åƒè€ƒ &lt;a href="http://stackoverflow.com/a/30918530"&gt;Stack Overflow&lt;/a&gt; ä¸Šçš„å›žç­”ï¼Œåº•ä¸‹å¹¾ç¨®æ–¹å¼éƒ½å¯ä»¥ã€‚æœ€ç°¡å–®çš„æ–¹æ³•å°±æ˜¯é€éŽ &lt;a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.ix_.html#numpy.ix_"&gt;numpy.ix_()&lt;/a&gt;ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ix_&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¦‚æžœäº†è§£ numpy broadcasting æ©Ÿåˆ¶çš„è©±ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# index must be numpy array&lt;/span&gt;
&lt;span class="n"&gt;cols&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;rows&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cols&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;newaxis&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c1"&gt;# np.newaxis is None&lt;/span&gt;
&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cols&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æˆ–è€…ç›´æŽ¥æŠŠæ‰€æœ‰åŒ…å«çš„ index å€¼éƒ½åšå‡ºä¾†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;indices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meshgrid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
    &lt;span class="n"&gt;indexing&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ij&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;indices&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ•´ç†ä¸€ä¸‹ï¼Œé€™åªè¦ä¸€æ®µæ™‚é–“æ²’ç”¨å°±å¸¸æœƒå¿˜è¨˜ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;ç¶­åŸºåŽŸå§‹è³‡æ–™è™•ç†&lt;/h3&gt;
&lt;p&gt;Wikipedia åŽŸå§‹è³‡æ–™å¾ž&lt;a href="https://zh.wikipedia.org/wiki/2016%E5%B9%B4%E4%B8%AD%E8%8F%AF%E6%B0%91%E5%9C%8B%E7%AB%8B%E6%B3%95%E5%A7%94%E5%93%A1%E9%81%B8%E8%88%89"&gt;é€™è£¡&lt;/a&gt;å–å¾—ï¼Œé€™å°±æ˜¯å±•ç¾ pandas è™•ç†èƒ½åŠ›çš„æ™‚å€™äº†ã€‚æ–°ç‰ˆæœ¬å°å­—ä¸²è™•ç†æä¾›æ›´å¤šåŠŸèƒ½ï¼Œéƒ½è®“æˆ‘å¿˜äº†åº•ä¸‹çš„ numpy å° unicode æ”¯æ´å…¶å¯¦ä¸æ€Žéº¼æ¨£ XD&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;urllib.parse&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;quote_plus&lt;/span&gt;

&lt;span class="n"&gt;dfs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_html&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;https://zh.wikipedia.org/wiki/&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; 
    &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;quote_plus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016å¹´ä¸­è¯æ°‘åœ‹ç«‹æ³•å§”å“¡é¸èˆ‰&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dfs&lt;/span&gt; 
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç«‹æ³•å§”å“¡æ”¿é»¨æååé¡&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Data cleaning&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;:]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;æ”¿é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;æ”¿é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;\[(è¨» |)\d+\]&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;æ”¿é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ï¼&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astype&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-1"&gt;
&lt;p&gt;åœ¨é€™æƒ…æ³è³‡æ–™æœƒè¢« copy å‚³å›žä¾†ï¼Œä½†å¦‚æžœæ˜¯ &lt;code&gt;start:end:step&lt;/code&gt; çš„ simple indexing å°±åªæœƒå›žå‚³ viewã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="zh"></category><category term="python"></category><category term="numpy"></category><category term="pandas"></category></entry><entry><title>Customize Django User Model</title><link href="https://blog.liang2.tw/posts/2015/11/django-custom-user/" rel="alternate"></link><published>2015-11-04T18:23:00-06:00</published><updated>2015-11-04T18:23:00-06:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2015-11-04:/posts/2015/11/django-custom-user/</id><summary type="html">&lt;p&gt;Django å¸³è™Ÿçš„æ¬„ä½å®šç¾©åœ¨ &lt;code&gt;django.contrib.auth&lt;/code&gt; çš„ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/contrib/auth/#fields"&gt;User&lt;/a&gt; ä¸­ï¼Œå°ä½¿ç”¨è€…è€Œè¨€åŒ…å«äº†ï¼šusername*ã€first_nameã€last_nameã€emailã€password*ã€‚åŒæ™‚å°é–‹ç™¼è€…ä¾†èªªï¼Œé‚„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‡å®š Group å’Œ Permission&lt;/li&gt;
&lt;li&gt;æ˜¯å¦ç‚º staffã€superuser&lt;/li&gt;
&lt;li&gt;å¸³è™Ÿé–‹é€š â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Django å¸³è™Ÿçš„æ¬„ä½å®šç¾©åœ¨ &lt;code&gt;django.contrib.auth&lt;/code&gt; çš„ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/contrib/auth/#fields"&gt;User&lt;/a&gt; ä¸­ï¼Œå°ä½¿ç”¨è€…è€Œè¨€åŒ…å«äº†ï¼šusername*ã€first_nameã€last_nameã€emailã€password*ã€‚åŒæ™‚å°é–‹ç™¼è€…ä¾†èªªï¼Œé‚„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‡å®š Group å’Œ Permission&lt;/li&gt;
&lt;li&gt;æ˜¯å¦ç‚º staffã€superuser&lt;/li&gt;
&lt;li&gt;å¸³è™Ÿé–‹é€šã€æœ€å¾Œä¸€æ¬¡ç™»å…¥æ™‚é–“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…§å»ºçš„å¸³è™ŸåŠŸèƒ½æ‡‰è©²å¾ˆå¯¦ç”¨ï¼Œå®‰å…¨æ€§ä¹Ÿå¾ˆå¥½ã€‚æ‰€ä»¥ä¸€èˆ¬ä¾†èªªéƒ½ä¸æœƒåŽ»æ”¹å®ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœåªæ˜¯æƒ³è¦å¹« User åŠ å€‹ profileï¼Œä¾‹å¦‚ç”Ÿæ—¥ã€ä¾†è‡ªå“ªå€‹æ˜Ÿçƒç­‰æ¬„ä½ï¼Œä¹Ÿä¸éœ€è¦æ”¹å¯« Userã€‚åƒè€ƒå®˜ç¶² &lt;a href="https://docs.djangoproject.com/en/1.8/topics/auth/customizing/#extending-the-existing-user-model"&gt;Extending the existing User model&lt;/a&gt;ï¼Œåªéœ€è¦å»ºä¸€å€‹ one-to-one relationship æŒ‡åˆ° User å°±å¥½äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserProfile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;OneToOneField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AUTH_USER_MODEL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;birth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DateField&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;orig_planet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½† Django é è¨­ç”¨ username ä¾†ç™»å…¥ï¼Œå¦‚æžœè¦æ”¹ç”¨ email ç™»å…¥è¦æ€Žéº¼åšï¼Ÿ&lt;/p&gt;
&lt;h3 id="email"&gt;æ”¹ç”¨ Email åšå¸³è™Ÿç™»å…¥&lt;/h3&gt;
&lt;p&gt;å› ç‚º User æ˜¯å€‹å¾ˆé‡è¦çš„ modelï¼Œæ‰€ä»¥æ”¹å¯«æ™‚è¦æ³¨æ„ç›¸å®¹æ€§çš„å•é¡Œã€‚å…¶å¯¦å®˜ç¶²ä¹Ÿæœ‰æ•™å­¸ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/auth/customizing/#specifying-a-custom-user-model"&gt;Specifying a custom User model&lt;/a&gt;ï¼Œä¸éŽé€™æ•™å­¸æ¯”å‰é¢é•·å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;ç¶²è·¯ä¸Šå·²ç¶“æœ‰äºº @jcugat åšäº†ä¸€å€‹å¥—ä»¶ &lt;a href="https://github.com/jcugat/django-custom-user"&gt;django-custom-user&lt;/a&gt;ï¼Œä»–å¯¦ä½œäº† &lt;code&gt;EmailUser&lt;/code&gt; å³ç”¨ email ä½œç‚ºå¸³è™Ÿç™»å…¥ã€‚å·²ç¶“æŠŠæ‰€æœ‰è‹¦å·¥éƒ½åšå¥½äº†ï¼Œæ‰€ä»¥å¦‚æžœæƒ³è¦å†åŠ ä¸Šè‡ªå·±çš„æ¬„ä½ç­‰ç­‰ï¼Œå¯ä»¥ç¹¼æ‰¿ä»–çš„ &lt;code&gt;AbstractEmailUser&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å¯¦å¦‚æžœçœ‹å®Œè‡ªå®š User ä¹‹å¾Œï¼Œå¯«å¥½ User Model ä¸é›£ï¼Œæ¯”è¼ƒè¤‡é›œçš„æ˜¯åƒå‰µå»ºã€ä¿®æ”¹ User ä»¥åŠ admin çš„è¨­å®šã€‚é™¤äº†è®€é€™å€‹å¥—ä»¶çš„ source code ä¹‹å¾Œï¼Œ&lt;a href="http://stackoverflow.com/questions/15012235"&gt;é€™ä¸² Stack Overflow è¨Žè«–&lt;/a&gt;ä¹Ÿæåˆ°äº†ä¸åŒçš„å¯¦ä½œæ–¹å¼ã€‚Django é€™éƒ¨ä»½çš„ source code è »å¥½è®€çš„ï¼Œä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å› ç‚ºä¹‹å¾Œè¦åš Email èªè¨¼ï¼Œæ‡‰è©²æœƒç”¨ &lt;a href="https://github.com/pennersr/django-allauth"&gt;django-allauth&lt;/a&gt; åšã€‚æ„Ÿè¦ºå¾ˆä¹…æ²’ç™¼æ–‡äº†ï¼Œæ‡‰è©²è¦æŠŠæ–‡ç« æ‹†çŸ­æ‰å° XD&lt;/p&gt;</content><category term="zh"></category><category term="django"></category><category term="python"></category></entry><entry><title>ç”¨ Django èˆ‡ SQLite æž¶æŠ½ç±¤ç¶²ç«™</title><link href="https://blog.liang2.tw/posts/2015/10/django-draw-member/" rel="alternate"></link><published>2015-10-04T14:55:00-05:00</published><updated>2015-10-04T14:55:00-05:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2015-10-04:/posts/2015/10/django-draw-member/</id><summary type="html">&lt;p&gt;æŠŠä¹‹å‰ç”¨ Flask æž¶çš„æŠ½ç±¤ç¶²ç«™æ”¹ç”¨ Django å¯¦ä½œï¼Œä¹Ÿè—‰é€™å€‹æ©Ÿæœƒæ¯”è¼ƒä¸€ä¸‹å…©å€‹ Framework è¨­è¨ˆæ¦‚å¿µçš„ä¸åŒã€‚&lt;/p&gt;</summary><content type="html">&lt;h4 id="_1"&gt;å‰æƒ…æè¦&lt;/h4&gt;
&lt;p&gt;æˆ‘æŠŠ LoveLive! å…©å­£çœ‹å®Œäº†ï¼Î¼&amp;rsquo;s åœ¨ç¬¬ä¸€å­£çš„æˆé•·å……æ»¿æ„Ÿå‹•å•Šã€‚&lt;strong&gt;\çœŸå§«æœ€é«˜/&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€¦â€¦å‘ƒå¥½å•¦ï¼Œä¹‹å‰è¬›äº†&lt;a href="../../09/flask-draw-member"&gt;ç”¨ Flask åŽ»æž¶ä¸€å€‹æŠ½ç±¤ç¶²ç«™&lt;/a&gt;ã€‚ä¸éŽæˆ‘å€‘æœ€çµ‚çš„ç›®æ¨™æ˜¯ç”¨ Django å˜›ï¼Œæ‰€ä»¥æŽ¥ä¸‹ä¾†å°±è¦æ”¹å¯«ã€‚ä¹Ÿè—‰é€™å€‹æ©Ÿæœƒæ¯”è¼ƒä¸€ä¸‹å…©å€‹ Framework è¨­è¨ˆæ¦‚å¿µçš„ä¸åŒï¼ˆ&lt;del&gt;ä¾‹å¦‚ Django ä¸€é–‹å§‹å¯«æœ‰å¤šå†—&lt;/del&gt;ã€&lt;del&gt;Flask å¯«åˆ°æœ€å¾Œæœ‰å¤šå†—&lt;/del&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="from-flask-to-django"&gt;From Flask to Django&lt;/h3&gt;
&lt;p&gt;ç‚ºäº†è½‰æ›ä½†åˆä¸è¦ä¸€ä¸‹å­æŠŠæ‰€æœ‰ Django çš„åŠŸèƒ½éƒ½æ”¾é€²ä¾†ï¼Œä¸­é–“éŽç¨‹æœ‰å¾ˆå¤šã€Œä¸å¸¸è¦‹çš„å¯«æ³•ã€ã€‚æƒ³è¦ç›´æŽ¥å¯« Django best practice çš„è©±ï¼Œå¯ä»¥åƒè€ƒ TP å¤§å¤§çš„&lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers"&gt;ã€Šç‚ºç¨‹å¼äººå¯«çš„ Django Tutorial ã€‹&lt;/a&gt;ï¼Œä»–çš„è¦åŠƒæ˜¯ 30 å€‹å–®å…ƒåšä¸€å€‹è¨‚é¤ç³»çµ±ã€‚&lt;/p&gt;
&lt;p&gt;éŽç¨‹ä¸­æœƒç”¨åˆ°å¾ˆå¤š Django APIï¼Œæ²’æœ‰è§£é‡‹çš„è©±å¯ä»¥åˆ°&lt;a href="https://docs.djangoproject.com/en/1.8/"&gt;å®˜ç¶²&lt;/a&gt;åŽ»æŸ¥ä½¿ç”¨ã€‚å¦å¤–æˆ‘ç™¼ç¾å¦‚æžœèƒ½ç”¨ debugger åŽ» trace Django åŸ·è¡Œçš„æµç¨‹èƒ½å¹«åŠ©ç†è§£ï¼Œæƒ³è¦ä¸€å€‹ç²¾ç¾Žçš„ debugger çš„è©±å¯ä»¥è£åƒ PyCharm çš„ IDEã€‚&lt;/p&gt;
&lt;p&gt;æ•´é«”çš„è¦åŠƒæœƒæ¼¸è¿‘æŠŠ Django çš„åŠŸèƒ½åŠ é€²ä¾†ï¼Œä¾åºæ‡‰è©²æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Django View, Template&lt;/li&gt;
&lt;li&gt;Django Model, ORM&lt;/li&gt;
&lt;li&gt;Django Form&lt;/li&gt;
&lt;li&gt;(Django Admin æ²’æœ‰ç”¨åˆ°)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æžœçœ‹ &lt;a href="https://docs.djangoproject.com/en/1.8/"&gt;Django doc&lt;/a&gt; é¦–é çš„è©±ï¼Œä¹Ÿæ˜¯åˆ†é€™å¹¾å€‹éƒ¨ä»½ï¼Œé›–ç„¶é€™ç¯‡æ–‡ç« ä¸¦ä¸æœƒæŠŠæ‰€æœ‰æ¦‚å¿µéƒ½ä»‹ç´¹ä¸€éã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œåœ¨æ”¹å¯«çš„æ™‚å€™æœƒè·³éŽç”¨ raw SQLï¼Œå› ç‚ºå®Œå…¨ä¸ç”¨ ORM æœ‰é»žé›£éŠœæŽ¥å…¶ä»– Django éƒ¨ä»½ã€‚æœ‰èˆˆè¶£çš„è©±åœ¨è¬›å®Œ Model ä¹‹å¾Œå¯ä»¥åƒè€ƒ Detailsã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;å‰æƒ…æè¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#from-flask-to-django"&gt;From Flask to Django&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django"&gt;Django åˆå§‹è¨­å®š&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#django-server"&gt;Django server&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-app"&gt;ç¬¬ä¸€å€‹ Django app&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-settings"&gt;Django settings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database-migration"&gt;Database Migration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#url-dispatcher"&gt;URL dispatcher&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-model-and-orm"&gt;Django Model and ORM&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#migration-the-tracker-of-model-changes"&gt;Migration the tracker of model changes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#orm-queries-in-shell"&gt;ORM queries in shell&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#data-in-orm-and-fixtures"&gt;Data in ORM and fixtures&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-template"&gt;Django Template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#more-on-djangos-model-template-and-view-mtv"&gt;More on Django&amp;rsquo;s model, template and view (MTV)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-form"&gt;Django Form&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#more-django-form-in-view"&gt;More Django form in view&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#details"&gt;Details&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#raw-sql"&gt;Raw SQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#better-queryset"&gt;Better QuerySet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#timezone"&gt;Timezone&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#post-form-and-csrf"&gt;POST form and CSRF&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="django"&gt;Django åˆå§‹è¨­å®š&lt;/h3&gt;
&lt;p&gt;ä¸€æ¨£é–‹ä¸€å€‹ Python è™›æ“¬ç’°å¢ƒï¼ˆé€™æ™‚å€™å°±æ˜¯å®ƒçš„å¥½è™•äº†ï¼Œèƒ½æŠŠä¸åŒå°ˆæ¡ˆçš„å¥—ä»¶éš”é›¢ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install django pytz ipython pyyaml
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;a href="http://pythonhosted.org/pytz/"&gt;pytz&lt;/a&gt; åœ¨&lt;a href="../../09/datetime-sqlite"&gt;å‰ä¸€ç¯‡&lt;/a&gt;å·²ç¶“ä»‹ç´¹éŽï¼Œæ˜¯è™•ç†æ™‚å€çš„å¥—ä»¶ã€‚&lt;a href="http://ipython.org/"&gt;IPython&lt;/a&gt; å…¨åæ˜¯ Interactive Pythonï¼ŒåŒæ¨£æ˜¯ Python shell ä½†æä¾›äº†å¾ˆå¤šé™„åŠ åŠŸèƒ½ï¼Œæœ€å¸¸ç”¨çš„æ‡‰è©²æ˜¯è‡ªå‹•è£œå®Œã€‚&lt;a href="http://pyyaml.org/"&gt;PyYAML&lt;/a&gt; ç”¨ä¾†è™•ç† YAML ç‰©ä»¶ï¼Œå¯è£å¯ä¸è£ï¼Œä¸è£ä¹‹å¾Œçš„ä¾‹å­å°±ç”¨ JSON å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘çš„å°ˆæ¡ˆæ ¹ç›®éŒ„æ˜¯ &lt;code&gt;demo_django_draw_member&lt;/code&gt;ã€‚å› ç‚º Django çš„è¨­å®šå¾ˆå¤šï¼Œå…ˆåœ¨é€™ç›®éŒ„ä¸‹ç”¨ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/contrib/admin/"&gt;django-admin&lt;/a&gt; æŠŠåŸºæœ¬çš„æž¶æ§‹å»ºèµ·ä¾†ã€‚æˆ‘å€‘å»ºäº†ä¸€å€‹åç‚º &lt;code&gt;draw_site&lt;/code&gt; çš„å°ˆæ¡ˆï¼ˆProjectï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ django-admin startproject draw_site
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åŸ·è¡Œå®Œä¹‹å¾Œæ‡‰è©²æœƒå¤šå‡ºä¸€å †æª”æ¡ˆï¼Œçµæ§‹å¦‚ä¸‹ã€‚æ³¨æ„åˆ°æœ‰å…©å±¤ &lt;code&gt;draw_site&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;demo_django_draw_member/
â””â”€â”€ draw_site/
    â”œâ”€â”€ draw_site/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ settings.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ wsgi.py
    â””â”€â”€ manage.py*
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¹‹å¾Œå·¥ä½œçš„ç›®éŒ„å…¶å¯¦æ˜¯ &lt;code&gt;demo_django_draw_member/draw_site/&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯æœ‰ &lt;code&gt;manage.py&lt;/code&gt; çš„é‚£å±¤ç›®éŒ„ï¼Œä¹‹å¾Œçš„è·¯å¾‘éƒ½æ˜¯ç›¸å°æ–¼ &lt;code&gt;demo_django_draw_member/draw_site/&lt;/code&gt;ã€‚ä»‹ç´¹ä¸€ä¸‹æ¯å€‹æª”æ¡ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;manage.py&lt;/code&gt; ä¹‹å¾Œå°±æœƒå–ä»£ django-admin çš„åŠŸèƒ½ã€‚å…©è€…æœ€å¤§çš„å·®åˆ¥æ˜¯ manage.py çŸ¥é“ project çš„è¨­å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;draw_site/settings.py&lt;/code&gt; è£¡é¢å­˜è‘— Django çš„å„ç¨®è¨­å®šï¼Œåƒ secret keyã€databaseã€template engineã€app ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;draw_site/urls.py&lt;/code&gt; è£¡é¢å­˜è‘— URL dispatching è¨­å®šï¼Œå³å“ªå€‹è·¯å¾‘è¦ç”¨å“ªå€‹ function åŽ»è™•ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;draw_site/wsgi.py&lt;/code&gt; &lt;a href="http://wsgi.org/"&gt;WSGI&lt;/a&gt; æ˜¯è¦ç¯„ Python web server çš„æ¨™æº–ï¼Œé€šå¸¸ä¸æœƒå‹•é€™å€‹æª”æ¡ˆå°±ä¸ç´°æã€‚Flaskã€Django éƒ½æ˜¯ç›¸å®¹ WSGI çš„å¯¦ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€å€‹ Django ç”±ä¸€å€‹ project å’Œå¾ˆå¤šå€‹ apps æ‰€çµ„æˆã€‚æ¯å€‹ app å°±å°ˆæ³¨åœ¨ç¶²ç«™çš„æŸå€‹åŠŸèƒ½ä¸Šï¼Œå„è‡ªåŒ…è‘—å„è‡ªéœ€è¦çš„ database schemaã€templateã€view logicsã€‚é€™æ¨£çš„å¥½è™•æ˜¯åŒæ¨£çš„åŠŸèƒ½å°±ä¸ç”¨é‡å¯«ï¼ŒåŒæ™‚åœ¨å¾ˆå¤§çš„ç¶²ç«™æ™‚é€™æ¨£çš„çµæ§‹æœ‰åŠ©æ–¼ç®¡ç†é‹ä½œçš„é‚è¼¯ã€‚&lt;/p&gt;
&lt;h4 id="django-server"&gt;Django server&lt;/h4&gt;
&lt;p&gt;å…ˆæŠŠ Django è·‘èµ·ä¾†çœ‹çœ‹å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; python manage.py runserver
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;Django version 1.8.5, using settings &amp;#39;draw_site.settings&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;Starting development server at http://127.0.0.1:8000/&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_initial.png"/&gt;
  &lt;p class="caption"&gt;Django Hello World&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;é€™æ˜¯ Django å…§å»ºåœ¨ä»€éº¼ URL éƒ½æ²’è¨­å®šæ™‚çš„æ­¡è¿Žç•«é¢ã€‚çœ‹åˆ°é€™å€‹è‡³å°‘è¡¨ç¤ºåŸºæœ¬çš„ settings æ­£å¸¸ã€‚Django è·Ÿ Flask ä¸€æ¨£ï¼Œå…§å»ºçš„ server æœƒåœ¨ source code æœ‰æ”¹è®Šçš„æ™‚å€™ reloadï¼Œæ‰€ä»¥ä¸€ç›´é–‹è‘—è·‘ä¹Ÿå¯ä»¥ã€‚&lt;/p&gt;
&lt;h4 id="django-app"&gt;ç¬¬ä¸€å€‹ Django app&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘çš„ç¶²ç«™åªæœƒç”¨åˆ°ä¸€å€‹ appï¼ŒæŠŠå®ƒå»ºå‡ºä¾†å–åç‚º &lt;code&gt;draw_member&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python manage.py startapp draw_member
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;demo_django_draw_member/
â””â”€â”€ draw_site/
    â”œâ”€â”€ draw_member/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ migrations/
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ draw_site/
    â”‚Â Â  â””â”€â”€ ...
    â””â”€â”€ manage.py*
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥çœ‹åˆ° app èˆ‡ project çš„æž¶æ§‹æ˜¯ä¸ä¸€æ¨£çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¦æŠŠé€™å€‹æ–°çš„ app åŠ åˆ° project è£¡ï¼Œä¿®æ”¹ &lt;code&gt;draw_site/settings.py&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_site/settings.py&lt;/span&gt;

&lt;span class="n"&gt;INSTALLED_APPS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;draw_member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;    &lt;span class="c1"&gt;# åŠ é€™ä¸€è¡Œ&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.admin&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.auth&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.contenttypes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.sessions&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.messages&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.staticfiles&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é è¨­å…¶å¯¦è£äº†å¾ˆå¤š appã€‚æš«æ™‚ä¸ç†ä»–å€‘æ˜¯ä»€éº¼ã€‚&lt;/p&gt;
&lt;h4 id="django-settings"&gt;Django settings&lt;/h4&gt;
&lt;p&gt;å…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹ &lt;code&gt;draw_site/settings.py&lt;/code&gt;ã€‚é™¤äº†å‰›å‰›ç”¨åˆ° INSTALLED_APPSï¼Œè¬›å¹¾å€‹è·Ÿé€™é‚Šæ¯”è¼ƒæœ‰é—œçš„åƒæ•¸ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Database&lt;/span&gt;
&lt;span class="c1"&gt;# https://docs.djangoproject.com/en/1.8/ref/settings/#databases&lt;/span&gt;

&lt;span class="n"&gt;DATABASES&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;default&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ENGINE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;django.db.backends.sqlite3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;NAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BASE_DIR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;db.sqlite3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Internationalization&lt;/span&gt;
&lt;span class="c1"&gt;# https://docs.djangoproject.com/en/1.8/topics/i18n/&lt;/span&gt;

&lt;span class="n"&gt;LANGUAGE_CODE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;en-us&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;TIME_ZONE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;UTC&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;USE_TZ&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;DATABSES è£¡å®šç¾©äº†ä½¿ç”¨çš„è³‡æ–™åº«ã€‚é è¨­æœƒä½¿ç”¨ &lt;code&gt;db.sqlite3&lt;/code&gt; é€™å€‹ SQLite è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æ˜¯èªžè¨€ã€æ™‚å€çš„è¨­å®šã€‚é è¨­æ˜¯ UTC ä¸¦ä¸”ä½¿ç”¨ timezoneï¼Œä¹Ÿå°±æ˜¯ server çš„æ™‚é–“éƒ½æ˜¯ç”¨ UTC è¨˜éŒ„çš„ã€‚&lt;/p&gt;
&lt;h4 id="database-migration"&gt;Database Migration&lt;/h4&gt;
&lt;p&gt;åœ¨ä»€éº¼ code éƒ½é‚„æ²’å¯«ä¹‹å‰ï¼Œä»‹ç´¹ä¸€å€‹ database è§€å¿µï¼š&lt;a href="https://docs.djangoproject.com/en/1.8/topics/migrations/"&gt;migration&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„ä¾‹å­å¯ä»¥çŸ¥é“ï¼Œæˆ‘å€‘æœƒå…ˆè¨­è¨ˆä¸€å€‹è³‡æ–™åº«è©²å­˜ä»€éº¼æ±è¥¿ï¼Œæ•´å€‹ç¶²ç«™æµç¨‹æœƒæ€Žéº¼ç”¨é€™äº›è³‡æ–™ï¼Œé€™äº›å½¢æˆ table schemaã€‚ä½†æ˜¯éš¨è‘—æ™‚é–“ï¼Œå¯èƒ½ç¶²ç«™æœ‰æ–°çš„åŠŸèƒ½ï¼Œå¾ˆé›£èªªå®Œå…¨ä¸åŽ»æ›´å‹• schemaã€‚&lt;/p&gt;
&lt;p&gt;æ›´å‹• schema ä¸æ˜¯ä»¶ç°¡å–®çš„äº‹ï¼Œå¦‚æžœæ˜¯ä¸Š production çš„ç¶²ç«™ï¼Œè³‡æ–™åº«æœƒæœ‰é‹ä½œä»¥ä¾†ç´¯ç©çš„è³‡æ–™ï¼Œç¸½ä¸èƒ½ schema æ”¹äº†é€™äº›è³‡æ–™å°±ä¸ŸæŽ‰å§ï¼Ÿè€Œä¸”åœ¨ç¶²ç«™é–‹ç™¼çš„æ™‚å€™ï¼Œåœ¨ä¸åŒç‰ˆæœ¬çš„ï¼ˆæˆ–ä¸åŒäººé–‹ç™¼çš„ï¼‰code å°±å¯èƒ½æœ‰ä¸åŒçš„ schemaã€‚è¦æ€Žéº¼ç¢ºä¿ code èˆ‡ database çš„ç‹€æ…‹å°±è¦é  migrationã€‚&lt;/p&gt;
&lt;p&gt;â€¦â€¦ä¸€é–‹å§‹å°±é€™éº¼è¤‡é›œï¼Ÿå¥½å•¦æˆ‘å€‘çš„ä¾‹å­æ²’æœ‰ç”¨åˆ° migration å¤§å¤šæ•¸çš„åŠŸèƒ½ï¼Œåªæœ‰ç”¨å®ƒ initiate databaseã€‚å…§å»ºçš„ app éƒ½æœ‰è‡ªå·±çš„ database schemaï¼Œå¯ä»¥ç”¨å®ƒæŠŠè³‡æ–™åº«çš„ table å»ºå‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; python manage.py migrate
&lt;span class="go"&gt;Operations to perform:&lt;/span&gt;
&lt;span class="go"&gt;  Synchronize unmigrated apps: messages, staticfiles&lt;/span&gt;
&lt;span class="go"&gt;  Apply all migrations: sessions, auth, contenttypes, admin&lt;/span&gt;
&lt;span class="go"&gt;Synchronizing apps without migrations:&lt;/span&gt;
&lt;span class="go"&gt;  Creating tables...&lt;/span&gt;
&lt;span class="go"&gt;    Running deferred SQL...&lt;/span&gt;
&lt;span class="go"&gt;  Installing custom SQL...&lt;/span&gt;
&lt;span class="go"&gt;Running migrations:&lt;/span&gt;
&lt;span class="go"&gt;  Rendering model states... DONE&lt;/span&gt;
&lt;span class="go"&gt;  Applying contenttypes.0001_initial... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0001_initial... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying admin.0001_initial... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying contenttypes.0002_remove_content_type_name... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0002_alter_permission_name_max_length... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0003_alter_user_email_max_length... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0004_alter_user_username_opts... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0005_alter_user_last_login_null... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0006_require_contenttypes_0002... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying sessions.0001_initial... OK&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;migration å°±æœƒä¸€æ­¥æ­¥æŠŠ database èª¿æ•´åˆ°ç¬¦åˆç¾åœ¨ code çš„ç‹€æ…‹ï¼Œé€™äº›èª¿æ•´å°±æœƒè¨˜éŒ„åœ¨ &lt;code&gt;&amp;lt;app&amp;gt;/migrations/&lt;/code&gt; åº•ä¸‹ï¼Œç­‰ç­‰å°±æœƒçœ‹åˆ°äº†ã€‚&lt;/p&gt;
&lt;h3 id="url-dispatcher"&gt;URL dispatcher&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æŽ¥ä¸‹ä¾†è¦æ”¹é¦–é ï¼ŒæŠŠ Django é è¨­çš„ &lt;code&gt;/&lt;/code&gt; é¦–é æ›æˆ Hello Worldã€‚&lt;/p&gt;
&lt;p&gt;Flask URL routing æ˜¯ç›´æŽ¥ç”¨ decorator å¯«åœ¨ view function ä¸Šé¢ã€‚å¹«å¤§å®¶å›žé¡§ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Django çš„ view å’Œ URL æ˜¯åˆ†é–‹çš„ï¼Œé¦–å…ˆæ˜¯ viewï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/views.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.shortcuts&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;  &lt;span class="c1"&gt;# å…ˆæš«æ™‚ç•™è‘—&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.http&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;çµæ§‹ä¸Šå¤§åŒå°ç•°ï¼ˆä¹Ÿå› ç‚ºæœ‰ &lt;a href="http://wsgi.org/"&gt;WSGI&lt;/a&gt; è¦ç¯„çš„é—œä¿‚å•¦ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æ˜¯ URL è¨­å®šã€‚æˆ‘å€‘å…ˆæŠŠ URL åŠ åœ¨ project è¨­å®šã€‚é€™é‚Šå¯èƒ½è¦ºå¾—è¨­å®šæœ‰é»žåˆ†æ•£æ¯”è¼ƒæ€ªï¼Œç­‰ä¸€ä¸‹å†æŠŠå®ƒæ”¾åˆ° app è£¡é¢ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_site/urls.py&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;draw_site URL Configuration&lt;/span&gt;

&lt;span class="sd"&gt;The `urlpatterns` list routes URLs to views. For more information please see:&lt;/span&gt;
&lt;span class="sd"&gt;    https://docs.djangoproject.com/en/1.8/topics/http/urls/&lt;/span&gt;
&lt;span class="sd"&gt;...&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf.urls&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.contrib&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;admin&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member.views&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;

&lt;span class="n"&gt;urlpatterns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;home&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^admin/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;admin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urls&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ¦‚å¿µä¹Ÿå¾ˆç°¡å–®ï¼ŒæŠŠè¦çš„ view function å¾ž app import é€²ä¾†ï¼ˆæ‰€ä»¥ app ç›®éŒ„æ˜¯å€‹ Python moduleï¼Œåº•ä¸‹æœƒ &lt;code&gt;__init__.py&lt;/code&gt;ï¼‰ï¼Œçµ¦ä¸€å€‹ regex è¡¨ç¤ºçš„è·¯å¾‘ï¼Œå¾Œé¢æ”¾ä¸Šè™•ç† function ä»¥åŠä¸€å€‹ optional çš„åå­—ï¼Œé€™å€‹åå­—å°±ä»£è¡¨äº†é€™å€‹ URL è·¯å¾‘ï¼Œä¹‹å¾Œå¯ä»¥åæŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ¸¬ä¸€ä¸‹ç¢ºèªè¨­å®šéƒ½æ˜¯æ­£ç¢ºçš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl -XGET &lt;span class="s2"&gt;&amp;quot;localhost:8000&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†çœ‹ä¸€ä¸‹ &lt;code&gt;draw_site/urls.py&lt;/code&gt;ï¼Œå¯ä»¥çœ‹åˆ° Django é è¨­æ”¾äº†å€‹ &lt;code&gt;/admin&lt;/code&gt; å¾Œé¢ç”¨çš„æ˜¯ &lt;code&gt;include(app.urls)&lt;/code&gt;ï¼Œè¡¨ç¤ºé€™ä¸€æ•´åŒ…åªè¦æ˜¯ admin/ é–‹é ­çš„ URL éƒ½äº¤çµ¦ admin.site.urls åŽ»è™•ç†è·¯å¾‘ã€‚é€™æ¨£æ–¹ä¾¿ app åœ¨ä¸åŒç¶²ç«™ä¸­é‡è¦†åˆ©ç”¨ï¼Œå› ç‚ºå¯èƒ½æ”¾çš„è·¯å¾‘éƒ½ä¸ä¸€æ¨£ï¼Œä½†ä¸€å€‹ app å…§çš„ URL è™•ç†æœƒæœ‰ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é¦¬ä¸Šä¾†æ”¹å¯«ä¸€ä¸‹ã€‚é¦–å…ˆåœ¨ app &lt;strong&gt;draw_member&lt;/strong&gt; åº•ä¸‹åŠ ä¸€å€‹ &lt;code&gt;urls.py&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/urls.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf.urls&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.views&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;  &lt;span class="c1"&gt;# explicit relative import&lt;/span&gt;

&lt;span class="n"&gt;urlpatterns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;home&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åŸºæœ¬ä¸Šæ ¼å¼å°±æ˜¯ç…§æŠ„åŽŸæœ¬å°±æœ‰çš„ã€‚å› ç‚ºæ”¾åœ¨åŒå€‹ app è£¡é¢äº†ï¼Œimport view æ™‚å°±å¯ä»¥ç”¨ explicit relative importï¼ˆé€™ä¸æ˜¯ relative import å–”ï¼‰&lt;/p&gt;
&lt;p&gt;åŽŸæœ¬çš„ urls.py å°±æ”¹æˆæŠŠ URL çš„è™•ç†ã€Œdispatchã€çµ¦é€™å€‹ appï¼Œæ”¹æˆåº•ä¸‹é€™æ¨£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_site/urls.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf.urls&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.contrib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;admin&lt;/span&gt;


&lt;span class="n"&gt;urlpatterns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^admin/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;admin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urls&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;draw_member.urls&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;r'^'&lt;/code&gt; ä»£è¡¨å¾žæ ¹ç›®éŒ„å°±äº¤çµ¦é€™å€‹ app åŽ»ç®¡ç†ï¼Œä¹Ÿå› ç‚ºé€™æ¨£æ¯”è¼ƒå°ˆä¸€çš„è·¯å¾‘è¦æ”¾å‰é¢ï¼Œåƒæ˜¯ /adminã€‚ç”¨å­—ä¸²è¡¨ç¤ºåœ¨åŸ·è¡Œçš„æ™‚å€™æ‰ import é€™å€‹ moduleï¼Œä¸æƒ³ä¹Ÿå¯ä»¥æ‹¿æŽ‰å­—ä¸²æŠŠ app import é€²ä¾†ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/http/urls/"&gt;URL dispatching&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="django-model-and-orm"&gt;Django Model and ORM&lt;/h3&gt;
&lt;p&gt;æŽ¥è‘—è™•ç†è³‡æ–™åº«çš„å•é¡Œã€‚ç•¶ç„¶å¯ä»¥åœ¨ Django è£¡é¢å¯« raw SQLï¼Œä½†é€™é‚Šæä¾›å¦ä¸€å€‹æƒ³æ³•ï¼šObject-relational Mapping (ORM)ã€‚ORM æŠŠè³‡æ–™ç”¨ç‰©ä»¶å°Žå‘çš„æ–¹å¼æ•´ç†ï¼ŒæŠŠ SQLã€tableã€database çš„ç´°ç¯€äº¤çµ¦ ORM engine åŽ»ç¿»è­¯ã€‚é€™å¯ä»¥åœ¨æ‰¾åˆ°éžå¸¸å¤šä»‹ç´¹ï¼Œç›´æŽ¥è·³åˆ°å¯¦ä½œã€‚&lt;/p&gt;
&lt;pre style="font-family: Consolas, 'Courier New', monospace"&gt;
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ members             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id          INTEGER â”‚ &lt;â”€â”
    â”‚ name           TEXT â”‚   â”‚
    â”‚ group_name     TEXT â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ draw_histories      â”‚   â”‚ foreign
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ key
    â”‚ memberid    INTEGER â”‚ â”€â”€â”˜
    â”‚ time       DATETIME â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/pre&gt;

&lt;p&gt;å›žæƒ³ä¸€ä¸‹æˆ‘å€‘çš„ schema è¨­è¨ˆã€‚æ”¹ç”¨ ORM ä¾†æ€è€ƒæˆ‘å€‘å°±æœƒæœ‰æˆå“¡ï¼ˆMemberï¼‰ä»¥åŠæŠ½ç±¤æ­·å²ï¼ˆHistoryï¼‰å…©å¤§ modelsã€‚&lt;strong&gt;Member&lt;/strong&gt; è¨˜éŒ„äº†åå­—èˆ‡æ‰€å±¬åœ˜é«”ï¼›&lt;strong&gt;History&lt;/strong&gt; æœƒè¨˜éŒ„æ™‚é–“ã€é€™ç­†æŠ½ç±¤æ˜¯å±¬æ–¼å“ªå€‹æˆå“¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Django ä¸­ï¼Œmodel å®šç¾©åœ¨ &lt;code&gt;models.py&lt;/code&gt; è£¡é¢ï¼Œé¦¬ä¸Šä¾†å¯«å¯«çœ‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_members/models.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.db&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.utils.timezone&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;now&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__str__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt; of &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;member&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;related_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draw_histories&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# now() will return datetime.utcnow()&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DateTimeField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__str__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt; at &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸€å€‹ class è£¡çš„å±¬æ€§å°±å°æ‡‰åˆ°ä¸€å€‹æ¬„ä½ï¼ˆFieldï¼‰ï¼Œæ¬„ä½æœƒæœ‰ä»–çš„åž‹åˆ¥ä»¥åŠè³‡æ–™åº«å¯¦ä½œä¸Šçš„é™åˆ¶ï¼ˆä¾‹å¦‚å­—ä¸²æœ‰ä¸Šé™ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä¸è¨­ï¼‰ã€‚Field type å¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#field-types"&gt;å®˜ç¶²&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Member&lt;/strong&gt; åº•ä¸‹éƒ½æ˜¯å­—ä¸²æ‰€ä»¥æ˜¯ &lt;code&gt;CharField&lt;/code&gt;ã€‚ &lt;strong&gt;History&lt;/strong&gt; ç¨å¾®è¤‡é›œä¸€é»žï¼Œæ™‚é–“çš„è¨˜éŒ„ date ç”¨ &lt;code&gt;DateTimeField&lt;/code&gt;ï¼Œé€™æ¨£æ¬„ä½æ‹¿å›žä¾†å°±æœƒè½‰æ›æˆ Python datetime objectï¼›å¦ä¸€å€‹ member ç”¨çš„æ˜¯ &lt;code&gt;ForeignKey&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ relationship fieldï¼Œä¾†è¡¨ç¤ºé€™ç­†æŠ½ç±¤å±¬æ–¼æ‹¿å€‹æˆå“¡ã€‚å¾Œé¢çš„ &lt;code&gt;related_name&lt;/code&gt; æä¾›äº†åæŸ¥åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯èƒ½å¾žä¸€å€‹ member åŽ»æŸ¥ä»–æ‰€æœ‰çš„ historiesã€‚&lt;/p&gt;
&lt;p&gt;åŒæ™‚å…ˆå¯«å¥½å…©å€‹ class åº•ä¸‹çš„ &lt;code&gt;__str__&lt;/code&gt;ï¼Œé€™æ¨£ç­‰ä¸‹åœ¨ Python shell æ“ä½œæ™‚å®¹æ˜“è¾¨èªæ¯å€‹ç‰©ä»¶çš„å…§å®¹ã€‚&lt;/p&gt;
&lt;h4 id="migration-the-tracker-of-model-changes"&gt;Migration the tracker of model changes&lt;/h4&gt;
&lt;p&gt;å¤šèªªç„¡ç”¨ï¼Œé¦¬ä¸Šä¾†è©¦ä¸€è©¦ã€‚&lt;/p&gt;
&lt;p&gt;â€¦â€¦ç­‰ç­‰ï¼Œæƒ³åˆ° migration äº†å—Žï¼Ÿæ¯æ¬¡æ›´å‹• database model éƒ½è¦è·‘ migrationï¼Œç¢ºä¿ code èˆ‡è³‡æ–™åº«ç‹€æ…‹ä¸€è‡´ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; python manage.py makemigrations draw_member
&lt;span class="go"&gt;python manage.py makemigrations draw_member&lt;/span&gt;
&lt;span class="go"&gt;Migrations for &amp;#39;draw_member&amp;#39;:&lt;/span&gt;
&lt;span class="go"&gt;  0001_initial.py:&lt;/span&gt;
&lt;span class="go"&gt;    - Create model History&lt;/span&gt;
&lt;span class="go"&gt;    - Create model Member&lt;/span&gt;
&lt;span class="go"&gt;    - Add field member to history&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥çœ‹åˆ° Django å¾ˆè°æ˜Žçš„çŸ¥é“æˆ‘å€‘å¤šå®šç¾©äº†å…©å€‹ modelsï¼Œè£¡é¢æœ‰äº›å°æ‡‰åˆ°è³‡æ–™åº«çš„æ¬„ä½åž‹æ…‹ã€‚é€™äº›è³‡è¨Šæœƒå¯«åœ¨ migration file è£¡é¢ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/migrations/0001_initial.py&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Migration&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Migration&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="n"&gt;dependencies&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="n"&gt;operations&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CreateModel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;History&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AutoField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serialize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verbose_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auto_created&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DateTimeField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utils&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
            &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CreateModel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AutoField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serialize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verbose_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auto_created&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
            &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AddField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;model_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;draw_member.Member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;related_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;draw_histories&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ³¨æ„åˆ° Django ORM è‡ªå‹•å¹«æˆ‘å€‘åŠ äº† &lt;code&gt;id&lt;/code&gt; é€™å€‹ primary keyï¼Œç­‰ç­‰å°±æœƒç”¨åˆ°ã€‚Migration è£¡é¢çš„ç´°ç¯€ç­‰å° Django æ›´ç†Ÿäº†ä¹‹å¾Œå°±èƒ½æ…¢æ…¢äº†è§£äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†æ–°çš„ migration å°±è¦åŒæ­¥è³‡æ–™åº«çš„ç‹€æ…‹ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; python manage.py migrate
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;Running migrations:&lt;/span&gt;
&lt;span class="go"&gt;  Rendering model states... DONE&lt;/span&gt;
&lt;span class="go"&gt;  Applying draw_member.0001_initial... OK&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="orm-queries-in-shell"&gt;ORM queries in shell&lt;/h4&gt;
&lt;p&gt;æŽ¥ä¸‹ä¾†æˆ‘å€‘æ“ä½œä¸€ä¸‹ ORMã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ python manage.py shell
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å°±æœƒæ‰“é–‹ä¸€å€‹ Python shellã€‚å¦‚æžœè£äº† IPython å°±æœƒæ‰“é–‹ IPython shellã€‚
é€™å€‹èˆ‡ä¸€èˆ¬çš„æœ‰ä»€éº¼å·®åˆ¥å‘¢ï¼Ÿä»–æœƒå¸¶æœ‰ Django project çš„è¨­å®šã€‚å¦‚æžœæ˜¯å¾žä¸€èˆ¬çš„ shell å¯ä»¥å…ˆè·‘ä»¥ä¸‹çš„æŒ‡ä»¤ä¾†é”åˆ°ç›¸åŒçš„æ•ˆæžœã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;$ DJANGO_SETTINGS_MODULE=&amp;quot;draw_site.settings&amp;quot; python&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;django&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é«˜å‚ ç©‚ä¹ƒæžœ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;å¹³æ²¢ å”¯&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;K-ON!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="err"&gt;é«˜å‚&lt;/span&gt; &lt;span class="err"&gt;ç©‚ä¹ƒæžœ&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="err"&gt;Î¼&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s&amp;gt;, &amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;)&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;m2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;h1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;h1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½¿ç”¨ä¸Šå°±æŠŠè³‡æ–™ç•¶ä½œç‰©ä»¶ä¾†æ“ä½œï¼Œå¦‚åŒ ORM å­—é¢çš„æ„æ€ã€‚æ³¨æ„åªæœ‰åœ¨ &lt;code&gt;.save()&lt;/code&gt; æ‰çœŸæ­£è¢«å­˜åˆ°è³‡æ–™è£¡ã€‚æ‹¿æ²’æœ‰å­˜çš„ object ä¾†æ“ä½œ database å°±æœƒå‡ºç¾ exceptionã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h_failed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;FF&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h_failed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="c"&gt;...&lt;/span&gt;
&lt;span class="gr"&gt;IntegrityError&lt;/span&gt;: &lt;span class="n"&gt;NOT NULL constraint failed: draw_member_history.member_id&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¦ºå¾—éº»ç…©çš„è©±ï¼Œç”¨ &lt;code&gt;Model.objects.create()&lt;/code&gt; å°±å¯ä»¥ä¸€æ­¥æžå®šã€‚æ­£ç¢ºçš„å­˜å¥½ä¹‹å¾Œï¼Œç¾åœ¨è³‡æ–™åº«å·²ç¶“æœ‰è³‡æ–™äº†ã€‚æˆ‘å€‘å¯ä»¥å…ˆåœ¨ SQLite è£¡ç¢ºèªã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;-- sqlite3 db.sqlite3&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="k"&gt;on&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;draw_member_member&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;id|name|group_name&lt;/span&gt;
&lt;span class="go"&gt;1|é«˜å‚ ç©‚ä¹ƒæžœ|Î¼&amp;#39;s&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;draw_member_history&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;id|time|member_id&lt;/span&gt;
&lt;span class="go"&gt;1|2015-10-05 15:17:32.061384|1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€éŽåƒå‰›å‰› object çš„æ“ä½œï¼Œæˆ‘å€‘ä¹Ÿèƒ½å»ºå‡ºå¦‚åŒæ‰‹å¯« SQL ä¸€æ¨£çš„è³‡æ–™åº«ï¼Œç•¶ç„¶åƒ &lt;code&gt;id&lt;/code&gt;ã€&lt;code&gt;member_id&lt;/code&gt; é€™äº›æ¬„ä½æ˜¯ ORM engine è‡ªå‹•å¹«æˆ‘å€‘åšå‡ºä¾†çš„ï¼Œé€™äº›å¯ä»¥è‡ªè¨‚ï¼Œä¸éŽé è¨­çš„è¡Œç‚ºä¸é›£ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;è¦æ€Žéº¼å¾ž ORM åƒå‰›å‰›ä¸‹ SQL ä¸€æ¨£æ’ˆè³‡æ–™å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s&amp;gt;, &amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;History: é«˜å‚ ç©‚ä¹ƒæžœ at 2015-10-05 15:17:32.061384+00:00&amp;gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è³‡æ–™é€éŽ &lt;code&gt;Model.objects&lt;/code&gt; é€™å€‹ Manager åŽ»æŸ¥è©¢ï¼Œç´°ç¯€å°±åŽ»çœ‹ Django é—œæ–¼ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/db/queries"&gt;Making queries&lt;/a&gt; çš„å…§å®¹å§ã€‚æŸ¥è©¢è³‡æ–™åº«å°±æœƒå›žå‚³ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/models/querysets/#django.db.models.query.QuerySet"&gt;QuerySet&lt;/a&gt;ï¼Œé€™ä¸¦ä¸æœƒçœŸçš„åŽ»ã€ŒæŸ¥ã€è³‡æ–™åº«ï¼Œä½†å…ˆæŠŠæŒ‡ä»¤å­˜è‘—ç­‰çœŸçš„è¦ç”¨åˆ°å€¼æ™‚æ‰åŽ»è¨ˆç®—ï¼Œä¹Ÿå°±æ˜¯ lazy evaluationã€‚&lt;/p&gt;
&lt;p&gt;QuerySet åº•ä¸‹å°±æœ‰å¾ˆå¤šå°æ‡‰åˆ° SQL æŒ‡ä»¤çš„æŸ¥è©¢ï¼Œåƒæ˜¯æ‹¿å›žæ‰€æœ‰ objects çš„ &lt;code&gt;QuerySet.all()&lt;/code&gt;ï¼Œå‰é¢å·²ç¶“ç”¨éŽäº†ã€‚æˆ–è€…ç¯©é¸çš„ &lt;code&gt;QuerySet.filter()&lt;/code&gt;ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name__contains&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å…¶ä¸­ &lt;code&gt;&amp;lt;field&amp;gt;__contains&lt;/code&gt; å°±æ˜¯ Django ORM ç‚ºäº†å¯¦åšåƒ SQL &lt;code&gt;LIKE&lt;/code&gt; æŒ‡ä»¤çš„å°æ‡‰æ¬„ä½ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆè¬›å¹¾å€‹æœ‰é—œçš„ï¼Œé¦–å…ˆæ¯å€‹ Model éƒ½æœ‰å€‹ primary key &lt;code&gt;pk&lt;/code&gt;ï¼Œé è¨­æŒ‡åˆ° &lt;code&gt;Model.id&lt;/code&gt; é€™å€‹æ¬„ä½ä¸Šï¼Œå¦ç”¨ &lt;code&gt;QuerySet.get()&lt;/code&gt; å¯ä»¥æ‹¿åˆ°å–®ä¸€ç‰©ä»¶ï¼Œé€™æ™‚å€™è¬ç”¨çš„ pk å°±æ´¾ä¸Šç”¨å ´äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;Member: é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŸ¥ relation ä¹Ÿå¾ˆç°¡å–®ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;Member: é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s&amp;gt;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é‚„è¨˜å¾—ä¹‹å‰è¨­å¾— &lt;code&gt;related_name="draw_histories"&lt;/code&gt;ï¼Œè¡¨ç¤ºæˆ‘å€‘èƒ½å¾ž &lt;strong&gt;Member&lt;/strong&gt; åæŸ¥å›žåŽ»è©²äººç›¸é—œçš„æ­·å²ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;History: é«˜å‚ ç©‚ä¹ƒæžœ at 2015-10-05 15:17:32.061384+00:00&amp;gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æœ€å¾Œæˆ‘å€‘ä¾†åˆªè³‡æ–™ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç•¶ç„¶ä¸€é–‹å§‹æˆ‘å€‘å¯ä»¥æš´åŠ›æŠŠ &lt;code&gt;db.sqlite3&lt;/code&gt; æ•´å€‹åˆªæŽ‰å†é‡æ–° &lt;code&gt;python manage.py migrate&lt;/code&gt; ä¸€æ¬¡å°±å¯ä»¥è®“ database å°æ‡‰çš„ table éƒ½å»ºç«‹å¥½ï¼Œä¸éŽåªé©ç”¨æ–¼ SQLite è€Œå·²ã€‚æˆ–è€…ï¼Œæ­£ç¢ºçš„ã€Œæ¸…ç©ºè³‡æ–™åº«ã€åšæ³•æ˜¯ç”¨ &lt;code&gt;flush&lt;/code&gt; æŒ‡ä»¤ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; python manage.py flush
&lt;span class="go"&gt;You have requested a flush of the database.&lt;/span&gt;
&lt;span class="go"&gt;This will IRREVERSIBLY DESTROY all data currently in the &amp;#39;draw_site/db.sqlite3&amp;#39; database,&lt;/span&gt;
&lt;span class="go"&gt;and return each table to an empty state.&lt;/span&gt;
&lt;span class="go"&gt;Are you sure you want to do this?&lt;/span&gt;

&lt;span class="go"&gt;    Type &amp;#39;yes&amp;#39; to continue, or &amp;#39;no&amp;#39; to cancel: yes&lt;/span&gt;
&lt;span class="go"&gt;Installed 0 object(s) from 0 fixture(s)&lt;/span&gt;
&lt;span class="go"&gt;Installed 0 object(s) from 0 fixture(s)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="data-in-orm-and-fixtures"&gt;Data in ORM and fixtures&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘æŠŠ &lt;code&gt;members.csv&lt;/code&gt; çš„è³‡æ–™å¡«åˆ°è³‡æ–™åº«å§ã€‚é€™é‚Šå°±ä¸ç”¨ç´°èªªäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../../draw_member/members.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;csv_reader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;csv_reader&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥è‡ªå·±æª¢æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯ 14 å€‹äººéƒ½å¯«åˆ°è³‡æ–™åº«äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽç¾åœ¨æœ‰å€‹å•é¡Œæ˜¯ï¼Œä¹‹å¾Œå¯èƒ½æœƒå¸¸å¸¸æŠŠè³‡æ–™åº«ç æŽ‰é‡ç·´ï¼Œæˆ–è€…è¦æŠŠé€™äº›ï¼ˆæˆ–å¾ˆå¤šä¾†æºï¼‰çš„è³‡æ–™è®€åˆ°è³‡æ–™åº«ï¼Œæ¯æ¬¡éƒ½é‡æ–°è®€å¯«ä¹Ÿæ˜¯å¯ä»¥ï¼Œä½†æœ‰æ²’æœ‰åˆ¥çš„åšæ³•èƒ½æŠŠè³‡æ–™å…ˆå­˜èµ·ä¾†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é€™é‚Šå°±è¦ä»‹ç´¹ &lt;a href="https://docs.djangoproject.com/en/1.8/howto/initial-data/#providing-initial-data-with-fixtures"&gt;Django fixtures&lt;/a&gt; äº†ã€‚ä»–èƒ½æŠŠè³‡æ–™åº«çš„è³‡æ–™å­˜æˆ JSONã€YAMLï¼ˆéœ€è¦ &lt;a href="http://pyyaml.org/"&gt;PyYAML&lt;/a&gt;ï¼‰ç­‰æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ fixtures æ˜¯è¢«åœ¨ &lt;code&gt;&amp;lt;app&amp;gt;/fixtures/&lt;/code&gt; ç›®éŒ„åº•ä¸‹ï¼Œè¨˜å¾—å…ˆæŠŠç›®éŒ„å»ºå‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir draw_member/fixtures
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ ¹æ“š database çš„å…§å®¹å»ºç«‹ fixtures å¯ä»¥ä½¿ç”¨ &lt;code&gt;dumpdata&lt;/code&gt; æŒ‡ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python manage.py dumpdata &lt;span class="se"&gt;\&lt;/span&gt;
    --format&lt;span class="o"&gt;=&lt;/span&gt;yaml &lt;span class="se"&gt;\&lt;/span&gt;
    --indent&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --output draw_member/fixtures/anime_members.yaml
    draw_member.Member &lt;span class="se"&gt;\&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/fixtures/anime_members.yaml&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;   &lt;span class="l l-Scalar l-Scalar-Plain"&gt;fields&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;group_name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u03BC&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u9AD8\u5742&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="se"&gt;\u7A42\u4E43\u679C&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;}&lt;/span&gt;
    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;model&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;draw_member.member&lt;/span&gt;
    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pk&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;   &lt;span class="l l-Scalar l-Scalar-Plain"&gt;fields&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;group_name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u03BC&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u7D62\u702C&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="se"&gt;\u7D75\u91CC&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;}&lt;/span&gt;
    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;model&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;draw_member.member&lt;/span&gt;
    &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pk&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;2&lt;/span&gt;
&lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”¨ JSON è¼¸å‡ºä¹Ÿå¯ä»¥ï¼Œæ”¹æˆ &lt;code&gt;--format=json&lt;/code&gt; å°±å¯ä»¥äº†&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;quot;model&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;draw_member.member&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;quot;pk&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\u9ad8\u5742 \u7a42\u4e43\u679c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\u03bc&amp;#39;s&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æˆ‘å€‘å¯ä»¥ç”¨ &lt;code&gt;python manage.py flush&lt;/code&gt; æŠŠè³‡æ–™åº«æ¸…æŽ‰ï¼Œæ¨¡æ“¬è³‡æ–™çš„è®€å…¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; python manage.py loaddata anime_members.yaml
&lt;span class="go"&gt;Installed 14 object(s) from 1 fixture(s)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£è³‡æ–™çš„å­˜å–å°±ä»‹ç´¹å¾—å·®ä¸å¤šäº†ã€‚æ›´å¤šçš„ç´°ç¯€å¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#the-model-layer"&gt;å®˜ç¶² model layer&lt;/a&gt; çš„èªªæ˜Žã€‚&lt;/p&gt;
&lt;h3 id="django-template"&gt;Django Template&lt;/h3&gt;
&lt;p&gt;åœ¨é€²è¡Œä¸‹åŽ»ä¹‹å‰ï¼Œå…ˆç¢ºèªæˆ‘å€‘çš„ç›®éŒ„çµæ§‹æ˜¯ä¸€æ¨£çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;demo_django_draw_member/
â””â”€â”€ draw_site/
    â”œâ”€â”€ db.sqlite3
    â”œâ”€â”€ draw_member/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ fixtures/
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ anime_members.json
    â”‚Â Â  â”‚Â Â  â””â”€â”€ anime_members.yaml
    â”‚Â Â  â”œâ”€â”€ migrations/
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 0001_initial.py
    â”‚Â Â  â”‚Â Â  â””â”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ draw_site/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ settings.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ wsgi.py
    â””â”€â”€ manage.py*
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Django çš„ template é è¨­æ˜¯æ”¾åœ¨ &lt;code&gt;&amp;lt;app&amp;gt;/templates/&lt;/code&gt; åº•ä¸‹ã€‚ä¸éŽç‚ºäº†åœ¨è·¨ app æ™‚ä¸è¦è¡åˆ°åå­—ï¼Œæˆ‘å€‘æœƒå¤šåŒ…ä¸€å±¤ app ç‚ºåçš„è³‡æ–™å¤¾ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir -p draw_member/templates/draw_member
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å®ƒè·Ÿ Flask ç”¨çš„ Jinja2 templates ä¹çœ‹ä¸‹éžå¸¸é¡žä¼¼ï¼ˆJinja2 æ¨¡ä»¿ Django templateï¼‰ï¼Œå…©è€…æœ€å¤§çš„å·®åˆ¥æ˜¯åœ¨ Jinja2 è£¡èƒ½å¾ˆè‡ªç”±çš„ä½¿ç”¨ Python functionï¼Œä¸éŽ Django é çš„æ˜¯ template tag ä»¥åŠ filterã€‚æˆ‘å€‘çš„ä¾‹å­å…©è€…æ˜¯æ²’å·®å¤šå°‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ¨£å…ˆæŠŠ &lt;code&gt;base.html&lt;/code&gt; ä»¥åŠ &lt;code&gt;home.html&lt;/code&gt; åšå‡ºä¾†ã€‚æˆ‘å€‘ä¹Ÿå…ˆæŠŠ Form å¯«ä¸Šäº†ï¼Œæš«æ™‚å…ˆç”¨ GETã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_member/templates/draw_member/base.html #}&lt;/span&gt;
&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt; &lt;span class="na"&gt;lang&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;width=device-width&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤ç³»çµ±&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;hr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åŠŸèƒ½åˆ—&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;home&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¦–é ï¼ˆæŠ½ç±¤ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;history&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æ­·å²è¨˜éŒ„&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_member/templates/draw_member/home.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;label&lt;/span&gt; &lt;span class="na"&gt;for&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åœ˜éšŠåç¨±ï¼š&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;label&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Î¼&amp;#39;s
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;K-ON!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;K-ON!
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ALL&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;checked&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ï¼ˆå…¨ï¼‰
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ•´é«”çš„æ¦‚å¿µæ‡‰è©²å¾ˆå¥½ç†è§£ã€‚&lt;code&gt;{% url 'xxxx' %}&lt;/code&gt; å°±æ˜¯ URL resolverï¼Œé‚„è¨˜å¾—åœ¨ &lt;code&gt;urls.py&lt;/code&gt; çš„è¨­å®šæ™‚æœ‰çµ¦å€‹ &lt;code&gt;name&lt;/code&gt; åƒæ•¸å—Žï¼Œé€™é‚Šå°±æœƒæ ¹æ“šé‚£å€‹åå­—å›žå‚³æ­£ç¢ºçš„ç¶²å€ã€‚&lt;/p&gt;
&lt;p&gt;é †ä¾¿æ›´æ–°ä¸€ä¸‹ URL æŠŠé€™äº› view å…ˆåŠ å¥½ï¼Œä¸ç„¶ç­‰ä¸‹ runserver æœƒèªªæ‰¾ä¸åˆ°é€™äº›ç¶²å€ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_members/urls.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf.urls&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.views&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt;

&lt;span class="n"&gt;urlpatterns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;home&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^draw/$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draw&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^history/$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_members/views.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.shortcuts&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.http&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Draw&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;History&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç·ŠæŽ¥è‘—æ”¹å¯«æˆ‘å€‘çš„é¦–é ï¼Œè®“å®ƒç”¨ä¸Š &lt;code&gt;home.html&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/home.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_home.png"/&gt;
  &lt;p class="caption"&gt;åŠ ä¸Š template çš„é¦–é &lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;Template æ›´å¤šçš„èªªæ˜Žå¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#the-template-layer"&gt;å®˜ç¶² template layer&lt;/a&gt; çš„èªªæ˜Žã€‚&lt;/p&gt;
&lt;h3 id="more-on-djangos-model-template-and-view-mtv"&gt;More on Django&amp;rsquo;s model, template and view (MTV)&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æŠŠæœ€é‡è¦çš„æŠ½ç±¤åŠŸèƒ½å¯¦ä½œå‡ºä¾†å§ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šéœ€è¦ç†è§£çš„å°±æ˜¯ï¼ŒDjango æœƒæŠŠå‚³åˆ° GET / POST çš„åƒæ•¸ä»¥ dict å­˜åœ¨ &lt;code&gt;request.GET&lt;/code&gt; / &lt;code&gt;request.POST&lt;/code&gt; è£¡é¢ï¼Œ&lt;code&gt;@require_GET&lt;/code&gt; é™åˆ¶åªèƒ½ä½¿ç”¨ GET åŽ»æºé€šã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–çš„é‚è¼¯éƒ½æ˜¯ç…§æŠ„ä»¥å‰çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.shortcuts&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.http&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Http404&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.views.decorators.http&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;require_GET&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.models&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;

&lt;span class="nd"&gt;@require_GET&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Retrieve all related members&lt;/span&gt;
    &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GET&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# Raise 404 if no members are found given the group name&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;valid_members&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;Http404&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;No member in group &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# Lucky draw&lt;/span&gt;
    &lt;span class="n"&gt;lucky_member&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# Update history&lt;/span&gt;
    &lt;span class="n"&gt;draw_history&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lucky_member&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;draw_history&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0.name}&lt;/span&gt;&lt;span class="s2"&gt;ï¼ˆåœ˜é«”ï¼š&lt;/span&gt;&lt;span class="si"&gt;{0.group_name}&lt;/span&gt;&lt;span class="s2"&gt;ï¼‰&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;
        &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lucky_member&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”¨ ORM å¯«èµ·ä¾†æ¯” raw SQL ä¹¾æ·¨å¤šäº†ï¼Œä¸éŽä¸€é–‹å§‹è¦æŠŠå°æ‡‰çš„ function éƒ½è¨˜èµ·ä¾†å°±æ˜¯ã€‚
é¦¬ä¸Šæ¸¬è©¦ä¸€ä¸‹ï¼Œä¸€æ¨£å·æ‡¶å…ˆä¸åŽ»å¯« templateã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl -XGET &lt;span class="s2"&gt;&amp;quot;localhost:8000/draw/?group=ALL&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;p&amp;gt;å°æ³‰ èŠ±é™½ï¼ˆåœ˜é«”ï¼šÎ¼&amp;#39;sï¼‰&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¦‚æžœæ˜¯å¾žé¦–é åŽ»é»žçš„ï¼Œè§€å¯Ÿä¸€ä¸‹ç¶²å€çš„è®ŠåŒ–ã€‚ä¾‹å¦‚ï¼š&lt;code&gt;http://localhost:8000/draw/?group_name=K-ON!&lt;/code&gt;ï¼Œå¯ä»¥çœ‹åˆ° form çš„é¸é …ç›´æŽ¥å¯«åœ¨ç¶²å€åˆ—ã€‚é€™æ˜¯ä½¿ç”¨ POST èˆ‡ GET æœ€å¤§çš„ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æŠŠæ­·å²è¨˜éŒ„çš„éƒ¨ä»½ä¹Ÿå¯«ä¸€ä¸‹ï¼Œä¹ŸæŠŠ template éƒ½è£œä¸Šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_member/templates/history.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤æ­·å²&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ç±¤æ­·å²ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;thead&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åå­—&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åœ˜é«”&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ä¸­æ™‚é–“&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;thead&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;history&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;recent_histories&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.member.name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.member.group_name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.time&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nf"&gt;date&lt;/span&gt;&lt;span class="s2"&gt;:&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;history.html èˆ‡æœ¬ä¾† Flask ä¸ä¸€æ¨£çš„åœ°æ–¹ï¼Œåœ¨ç”¨ä¸Šäº† &lt;code&gt;date:"r"&lt;/code&gt; çš„ filterï¼Œå‚³çš„åƒæ•¸æŽ¥åœ¨ &lt;code&gt;:&lt;/code&gt; ä¹‹å¾Œã€‚ä¹Ÿæ›´æ–°å°æ‡‰ view çš„å‹•ä½œï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;recent_draws&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()[:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/history.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;recent_histories&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;recent_draws&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_history.png"/&gt;
&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°é è¨­ç”¨çš„æ˜¯ UTC æ™‚å€ï¼Œæ™‚å€çš„è½‰æ›ç´°ç¯€æ”¾åˆ°æ–‡æœ«å§ã€‚æˆ‘å€‘å¯ä»¥åœ¨ view è£¡æ›´æ”¹è¦å‘ˆç¾çš„æ™‚å€ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.utils.timezone&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;activate&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;activate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_history_tz.png"/&gt;
&lt;/div&gt;

&lt;p&gt;é€™æ¨£åŸºæœ¬åŠŸèƒ½å°±æžå®šå•¦ï¼ç´°ç¯€ä¸€æ¨£åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#the-view-layer"&gt;å®˜ç¶² view layer&lt;/a&gt; çš„èªªæ˜Žã€‚&lt;/p&gt;
&lt;h3 id="django-form"&gt;Django Form&lt;/h3&gt;
&lt;p&gt;ç›´æŽ¥æŠŠ form å¯«åœ¨ template è£¡é¢ä¹Ÿæ˜¯å¯ä»¥ï¼Œæœ‰æ™‚å€™ form å¯èƒ½è·Ÿ model æ¯æ¯ç›¸é—œï¼Œè€Œä¸” form input å¤šäº†ä¹‹å¾Œæ¯å€‹æ¬„ä½éƒ½è¦è‡ªå·±è®€å¯«ä¹Ÿå¤ªä¸ç›´è¦ºã€‚æƒ³è¦é©—è¨¼ä½¿ç”¨è€…çš„ input çš„è©±å°±æ›´è¤‡é›œäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯å°±æœ‰äº† Django Formã€‚é¦¬ä¸Šä¾†çœ‹ç”¨èµ·ä¾†æ˜¯æ€Žéº¼æ¨£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/forms.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;forms&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;forms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Form&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;GROUP_CHOICES&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;K-ON!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;K-ON!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ALL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ï¼ˆå…¨ï¼‰&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;forms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ChoiceField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GROUP_CHOICES&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜éšŠåç¨±&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;label_suffix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ï¼š&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;widget&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;forms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RadioSelect&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;initial&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å»ºäº†ä¸€å€‹æ–°çš„ form classï¼Œåƒ Model ä¸€æ¨£ï¼Œè£¡é¢è¦å®šäº†æ¯å€‹æ¬„ä½çš„å±¬æ€§ã€‚æˆ‘å€‘é€™é‚Šåªæœ‰ä¸€å€‹ &lt;code&gt;group&lt;/code&gt; æ˜¯å€‹å–®é¸çš„ ChoiceFieldï¼Œ&lt;code&gt;choices&lt;/code&gt; æ˜¯å€‹ list of two-item tuplesï¼Œç¬¬ä¸€å€‹æ˜¯å…§éƒ¨çš„å€¼ï¼Œç¬¬äºŒå€‹æ˜¯é¡¯ç¤ºçš„å­—ã€‚å…¶ä»–çš„éƒ½æ˜¯ç´°ç¯€çš„èª¿æ•´ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠé€™å€‹ form ç”¨åˆ° view è£¡é¢ã€‚æ–°å»ºä¸€å€‹ form object &lt;code&gt;form&lt;/code&gt;ï¼Œç„¶å¾ŒæŠŠé€™å€‹è®Šæ•¸ &lt;code&gt;form&lt;/code&gt; å‚³é€² template è£¡é¢ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.forms&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/home.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;form&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†ä¾†ä¿®æ”¹ templateï¼Œå°±ä¸ç”¨è‡ªå·±å¯« form çš„å…§å®¹äº†ï¼Œæ”¹æˆ &lt;code&gt;{{ form }}&lt;/code&gt; Django å°±æœƒè‡ªå‹•ç”¢ç”Ÿã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_member/home.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;form&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_form.png"/&gt;
&lt;/div&gt;

&lt;p&gt;ä¸éŽé€™å€‹é•·å¾—è·Ÿæˆ‘å€‘åŽŸæœ¬çš„ form ä¸ä¸€æ¨£å˜›ã€‚å¥½åœ¨ Django form æ˜¯å¾ˆå½ˆæ€§çš„ï¼Œform åœ¨è¢« render æˆ HTML æ™‚å¯ä»¥æä¾›ç´°ç¯€çš„èª¿æ•´ï¼Œå¤§å®¶å¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/topics/forms/#form-rendering-options"&gt;å®˜ç¶² Form rendering options&lt;/a&gt; èª¿æ•´ã€‚æˆ‘ç›´æŽ¥çµ¦èª¿å¥½çš„çµæžœå§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;form.group.label_tag&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;radio&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;form.group&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
      &lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;radio.tag&lt;/span&gt; &lt;span class="cp"&gt;}}{{&lt;/span&gt; &lt;span class="nv"&gt;radio.choice_label&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”¨çµæžœåŽ»å°ç…§æ¯å€‹ &lt;code&gt;{{ ... }}&lt;/code&gt; éƒ¨ä»¶å°æ‡‰çš„ HTML å…ƒç´ å§ã€‚&lt;/p&gt;
&lt;h4 id="more-django-form-in-view"&gt;More Django form in view&lt;/h4&gt;
&lt;p&gt;Form çš„åŠŸèƒ½å¯ä¸åªé€™æ¨£ï¼Œå¯ä»¥åœ¨å‰µå»º DrawForm æ™‚ç›´æŽ¥æŠŠ &lt;code&gt;request.GET&lt;/code&gt; å‚³å…¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/views.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Retrieve all related members&lt;/span&gt;
    &lt;span class="n"&gt;form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GET&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_valid&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cleaned_data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# Raise 404 if no members are found given the group name&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;Http404&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;No member in group &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;
                      &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="c1"&gt;# Lucky draw&lt;/span&gt;
    &lt;span class="n"&gt;lucky_member&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”¨ &lt;code&gt;form.is_valid()&lt;/code&gt; å¯ä»¥é©—è¨¼æ¯å€‹æ¬„ä½çš„è³‡æ–™æ˜¯ä¸æ˜¯æ­£ç¢ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä¹Ÿé †ä¾¿æŠŠ /draw åŠ ä¸Š template å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_member/draw.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤çµæžœ&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ç±¤çµæžœ&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;lucky_member.name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;ï¼ˆåœ˜é«”ï¼š&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;lucky_member.group_name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/views.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/draw.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;lucky_member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;lucky_member&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ›´å¤š Forms çš„ä»‹ç´¹ä¸€æ¨£åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#forms"&gt;å®˜ç¶²&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;ç¸½çµ&lt;/h3&gt;
&lt;p&gt;åšå®Œçš„æˆå“åœ¨ &lt;a href="https://github.com/ccwang002/draw_member_django"&gt;Github&lt;/a&gt; ä¸Šï¼Œåƒè€ƒ README å°±å¯ä»¥è¨­å®šå¥½ç’°å¢ƒäº†ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ¨£å°±æŠŠ Django æœ€åŸºæœ¬çš„ Model, View, Template, Form å¹¾å€‹å¤§éƒ¨ä»½é«”é©—ä¸€éäº†ã€‚å¯ä»¥æ„Ÿè¦ºå‡ºä¾† Django æä¾›çš„åŠŸèƒ½æ¯” Flask å¤šå¾ˆå¤šï¼Œä½†ä¹Ÿä»£è¡¨è¦èŠ±æ›´å¤šçš„æ™‚å€™å­¸ç¿’ä½¿ç”¨å®ƒã€‚å…¶å¯¦æ”¹å¯«åˆ°æœ€å¾Œæˆ‘å€‘çš„ code éžå¸¸å°‘ï¼Œå¯ä»¥ç‚ºäº†çµæ§‹åŒ–çš„ code é‚„æ¯”è¼ƒå¤šã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶é€™ä¸ä»£è¡¨å°±å­¸æœƒ Django äº†ã€‚æœ€å¾Œä¾†ä»‹ç´¹å¹¾å€‹å¯ä»¥æŽ¥çºŒå­¸ç¿’çš„ Django è³‡æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers"&gt;ã€Šç‚ºç¨‹å¼äººå¯«çš„ Django Tutorial ã€‹&lt;/a&gt;æ˜¯å€‹çœŸæ­£å¾žé›¶åˆ°ä¸€çš„ 30 å¤©å­¸ç¿’è¦åŠƒï¼ˆé›–ç„¶æˆ‘å­¸äº†å¥½å¹¾å€‹æœˆ T___Tï¼‰ï¼Œæœ‰äº†é€™å€‹æŠ½ç±¤ç¨‹å¼çš„æ¦‚å¿µå†åŽ»è®€ä¸€æ¬¡æ‡‰è©²æœƒæ›´æ¸…æ¥šæ•´å€‹ Django çš„è¨­è¨ˆã€‚ä½œè€…ï¼šTzu-ping Chung (@uranusjr)&lt;/li&gt;
&lt;li&gt;&lt;a href="http://masteringdjango.com"&gt;&lt;em&gt;Mastering Django: Core&lt;/em&gt;&lt;/a&gt;, the successor to &lt;a href="http://www.djangobook.com/en/2.0/index.html"&gt;&lt;em&gt;The Django Book&lt;/em&gt;&lt;/a&gt; last updated in 2009, is the definitive guide to Django targeting the latest Django version 1.8 at the time of writing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šçš„ Django æŠ€èƒ½æ¨¹é¸æ“‡è«‹è¦‹ TP çš„ &lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers/blob/master/30-moving-on.md"&gt;lesson 30&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="details"&gt;Details&lt;/h3&gt;
&lt;p&gt;è·Ÿ Flask ä¸€æ¨£ï¼Œåº•ä¸‹è¨˜éŒ„ä¸€äº›ç´°ç¯€æˆ–æ”¹å–„ç­‰ç­‰ç‚ºäº†é¿å…ç¯‡å¹…éŽé•·ï¼ˆå·²ç¶“å¤ªé•·äº†ï¼‰è€Œç§»è‡³æ­¤çš„æ®µè½ã€‚&lt;/p&gt;
&lt;h4 id="raw-sql"&gt;Raw SQL&lt;/h4&gt;
&lt;p&gt;åœ¨ä»‹ç´¹ Django Model çš„æ™‚å€™ç›´æŽ¥ç”¨äº† ORMï¼Œä½†å¯¦éš›ä¸Š Django æ˜¯å¯ä»¥å¯« raw SQL äº†ï¼Œè€Œä¸”é‚„æœ‰ã€Œè°æ˜Žç‰ˆã€çš„ raw SQL èƒ½å¤ æ‹¿å›žå°æ‡‰çš„ model objectã€‚é¦¬ä¸Šä¾†çœ‹æ€Žéº¼å›žäº‹ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆä¾†çœ‹è°æ˜Žç‰ˆçš„ raw SQLï¼Œä½¿ç”¨ &lt;code&gt;Model.objects.raw&lt;/code&gt; æ‹¿å›žæ‰€æœ‰åœ˜é«”æ˜¯ K-ON é¡žçš„æˆå“¡ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;SELECT id, name, group_name&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;FROM draw_member_member&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;WHERE group_name LIKE &amp;#39;K-ON&lt;/span&gt;&lt;span class="si"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ç§‹å±± æ¾ª of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ç”°äº•ä¸­ å¾‹ of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ç´å¹ ç´¬ of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ä¸­é‡Ž æ¢“ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æœƒå›žå‚³ä¸€å€‹ RawQuerySetï¼Œè£¡é¢å…¶å¯¦ä¹Ÿæ˜¯ Member objectsï¼Œé€™æ˜¯é  Django åŽ»èªå°æ‡‰çš„ primary keyï¼Œä¹Ÿå°±æ˜¯èªªåœ¨ raw() SQL query è£¡ä¸€å®šè¦æ”¾ primary keyã€‚æ³¨æ„é‚£å€‹ &lt;code&gt;%&lt;/code&gt; éœ€è¦è¢« escape å› ç‚º raw() çš„ SQL query æ˜¯èƒ½æ”¾åƒæ•¸çš„ï¼ˆå°±åƒ Python å…§å»º str %-formattingï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽæˆ‘å€‘æ€Žéº¼çŸ¥é“ Member æ˜¯å­˜åœ¨å“ªå€‹ table å‘¢ï¼Ÿé è¨­æ˜¯ &lt;code&gt;&amp;lt;app&amp;gt;_&amp;lt;model&amp;gt;&lt;/code&gt;ï¼Œä½†è³‡è¨Šåœ¨ meta options è£¡çš„ &lt;code&gt;db_table&lt;/code&gt;ï¼Œä¹Ÿèƒ½è¢«è¦†å¯«ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_meta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;db_table&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;draw_member_member&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å› ç‚º Member è£¡é¢æœ‰åƒ nameã€group_name ç­‰æ¬„ä½ï¼Œåœ¨ä¸‹ query çš„æ™‚å€™ä¸ä¸€å®šéƒ½æœƒå¯«åœ¨ SELECT è£¡é¢æŠŠæ‹¿å€¼å›žä¾†ï¼Œé‚£éº¼é€™äº›æ¬„ä½å°±æ˜¯ deferred ç‹€æ…‹ï¼Œåªæœ‰åœ¨çœŸçš„æ‹¿å€¼æ™‚æ‰æœƒåŽ»è·Ÿ database è¦ã€‚ä¸€èˆ¬ä½¿ç”¨ä¸æœƒæœ‰æ„Ÿè¦ºå…©è€…çš„å·®ç•°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s2"&gt;&amp;quot;SELECT id FROM draw_member_member&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;))[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;draw_member.models.Member_Deferred_group_name_name&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_deferred_fields&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;{&amp;#39;group_name&amp;#39;, &amp;#39;name&amp;#39;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½†æˆ‘å°±æ˜¯ä¸æƒ³ç”¨ ORMï¼Œé€Ÿåº¦æ…¢ï¼Œä¹Ÿæ²’è¾¦æ³•å¯«è¤‡é›œçš„ queryï¼ˆæˆ°ï¼‰ã€‚é€™å°±å›žæ­¸åˆ°æœ€å‚³çµ±çš„ database connection, cursor é€™äº›æ¦‚å¿µï¼Œå°±åƒæ²’æœ‰ SQLAlchemy çš„ Flaskã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.db&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;connection&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;SELECT name&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;FROM draw_member_member&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;WHERE group_name LIKE &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;K-ON&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="go"&gt;[(&amp;#39;å¹³æ²¢ å”¯&amp;#39;,), (&amp;#39;ç§‹å±± æ¾ª&amp;#39;,), (&amp;#39;ç”°äº•ä¸­ å¾‹&amp;#39;,), (&amp;#39;ç´å¹ ç´¬&amp;#39;,), (&amp;#39;ä¸­é‡Ž æ¢“&amp;#39;,)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;SELECT member_id, time&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;FROM draw_member_history&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;LIMIT 3&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;[(8, datetime.datetime(2015, 10, 5, 17, 36, 41, 608078, tzinfo=&amp;lt;UTC&amp;gt;)),&lt;/span&gt;
&lt;span class="go"&gt; (11, datetime.datetime(2015, 10, 5, 17, 37, 26, 164830, tzinfo=&amp;lt;UTC&amp;gt;)),&lt;/span&gt;
&lt;span class="go"&gt; (11, datetime.datetime(2015, 10, 5, 17, 37, 37, 483697, tzinfo=&amp;lt;UTC&amp;gt;))]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here you go.&lt;/p&gt;
&lt;h4 id="better-queryset"&gt;Better QuerySet&lt;/h4&gt;
&lt;p&gt;çœ‹éŽäº† raw SQL ä¹‹å¾Œï¼Œæˆ‘å€‘ä¾†æƒ³æƒ³ ORM çš„æ”¹å–„å§ã€‚é›–ç„¶èªªæ¯æ¬¡è¦æŸ¥è©¢çš„æ™‚å€™åƒå¯« SQL ä¸€æ¨£æŠŠ query çµ„åˆå‡ºä¾†ä¹Ÿå¯ä»¥ï¼Œä½†ç”¨ ORM çš„å¥½è™•æ‡‰è©²æ˜¯èƒ½æŠŠé€™äº›å¯¦ä½œç´°ç¯€è·Ÿã€ŒåŒ…è£èµ·ä¾†ã€ã€‚ä¾‹å¦‚æœ€è¿‘ n æ¬¡æŠ½ç±¤è¨˜éŒ„ã€æ‰€æœ‰æˆå“¡çš„åœ˜é«”åç¨±ï¼ˆç›®å‰æ˜¯å¯«æ­»åœ¨ DrawForm è£¡é¢ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ™‚å€™å°±å¯ä»¥æŠŠå¸¸ç”¨çš„ query è®Šæˆä¸€å€‹ methodï¼Œä¾‹å¦‚æœ€è¿‘ 10 æ¬¡æŠ½ç±¤è¨˜éŒ„å°±åªè¦ç”¨ &lt;code&gt;History.objects.recent(10)&lt;/code&gt; å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;é€™å…¶å¯¦æœ‰å¾ˆå¤šåšæ³•ï¼Œåƒæ˜¯å¯«ä¸€å€‹ classmethodã€Override default Managerã€Override default QuerySetã€‚å“ªå€‹æ–¹æ³•æ¯”è¼ƒå¥½å‘¢ï¼Ÿåœ¨ &lt;a href="http://stackoverflow.com/a/2213341"&gt;StackOverflow&lt;/a&gt;ã€&lt;a href="https://groups.google.com/forum/#!topic/django-users/0WSdnWFTuUg"&gt;mail list&lt;/a&gt; éƒ½æœ‰è¨Žè«–ã€‚åŸºæœ¬ä¸Šéƒ½èƒ½é”åˆ°ç›¸åŒçš„æ•ˆæžœï¼Œä½†å¾Œå…©è€…çš„åšæ³•æ˜¯æ¯”è¼ƒåå¥½çš„ï¼Œå› ç‚º Manager(or QuerySet for Django 1.7+) è² è²¬è™•ç† model å°æ‡‰åˆ°çš„ database table ç­‰ç´šçš„æ“ä½œï¼Œä½† classmethod æ‡‰è©²æ˜¯è™•ç†å·²ç¶“å¾ž table row ä¸­æ‹¿å‡ºçš„ä¸€å€‹ model object ç›¸é—œçš„æ“ä½œã€‚å¦‚æžœæŠŠåŒæ¨£æ€§è³ªçš„ code æ”¾åœ¨ä¸€èµ·ï¼Œå°±æ‡‰è©²ä½¿ç”¨ Manager(QuerySet)ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸” TP ä¹Ÿåœ¨ Gitter ä¸Šé–‹ç¤ºäº†ï¼Œå°±æ˜¯é€™æ¨£ï¼ˆçµæ¡ˆï¼‰ã€‚ä¾†æ”¹å¯« modelã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_member/models.py&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MemberQuerySet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;QuerySet&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;unique_groups&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values_list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;flat&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;distinct&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HistoryQuerySet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;QuerySet&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;recent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[:&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;objects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MemberQuerySet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_manager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;objects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;HistoryQuerySet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_manager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åœ¨ Member æˆ‘å€‘å®šç¾©äº†ä¸€å€‹ &lt;code&gt;unique_groups&lt;/code&gt; æ‹¿å›žæ‰€æœ‰åœ˜é«”çš„åç¨±ï¼›åœ¨ History å®šç¾©äº† &lt;code&gt;recent&lt;/code&gt; æ‹¿å‡ºæŒ‰æ™‚é–“æŽ’åºæœ€å‰é¢ n å€‹ã€‚æ–°å®šç¾©çš„ &lt;code&gt;QuerySet.as_manager()&lt;/code&gt; å°±å–ä»£æŽ‰æœ¬ä¾†çš„ &lt;code&gt;Model.objects&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŽ¥è‘—ä¾†æ”¹å¯« view æŠŠä¹‹å‰å¯«çš„ query æ›æŽ‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#draw_member/views.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;recent_draws&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£å°±ç°¡æ½”ä¸€é»žã€‚å†ä¾†é †ä¾¿æŠŠ form æ”¹å¾—æ¯”è¼ƒå½ˆæ€§ï¼Œä¸è¦æŠŠåœ˜é«”åå¯«æ­»ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#draw_member/forms.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.models&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;member_group_choices&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;valid_groups&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unique_groups&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;choices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;grp&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;valid_groups&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;grp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grp&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ï¼ˆå…¨ï¼‰&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;choices&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;forms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Form&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;forms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ChoiceField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;member_group_choices&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="timezone"&gt;Timezone&lt;/h4&gt;
&lt;p&gt;æ„Ÿè¦ºæœ€è¿‘ä¸€ç›´åœ¨å¯«&lt;a href="../../09/datetime-sqlite/"&gt;æ™‚å€ç›¸é—œçš„æ±è¥¿&lt;/a&gt;å•Šã€‚åŸºæœ¬ä¸Š server è¨˜éŒ„çš„æ™‚é–“éƒ½ç”¨ UTC å•é¡Œå°±å°‘å¾ˆå¤šï¼Œä½†æœ€å¾Œé‚„æ˜¯è¦å‘ˆç¾ä¸€å€‹ä½¿ç”¨è€…ç”¨çš„æ™‚å€ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å•é¡Œæ˜¯ HTTP header è£¡é¢ä¸¦æ²’æœ‰é€™æ¨£çš„è³‡è¨Šï¼Œæ‰€ä»¥ä¸€ä¾†ç”¨ geoip åŽ»çŒœï¼ŒäºŒä¾†ç”¨å¯«å€‹ javascript åœ¨ä½¿ç”¨è€…è¼‰å…¥çš„æ™‚å€™åŽ»åˆ¤æ–·æ™‚å€ï¼Œç¸½ä¹‹æ˜¯å€‹è¦å¦å¤–è¨˜éŒ„çš„æ±è¥¿ã€‚ç´°ç¯€&lt;a href="https://docs.djangoproject.com/en/1.8/topics/i18n/timezones/#selecting-the-current-time-zone"&gt;å®˜ç¶²ä¸Šä¹Ÿæœ‰èªªæ˜Ž&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ–‡ä¸­æ˜¯ä½¿ç”¨ &lt;code&gt;activate('Aisa/Taipei')&lt;/code&gt; æŠŠæ™‚å€æ”¹æˆ UTC+8ã€‚é€™é‚Šä»‹ç´¹å¦ä¸€å€‹æ–¹å¼ï¼Œæ˜¯å¯«åœ¨ template è£¡é¢çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_member/templates/draw_member/history.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;load&lt;/span&gt; &lt;span class="nv"&gt;tz&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ç±¤æ­·å²ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="c"&gt;{# ... #}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;timezone&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;history&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;recent_histories&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="c"&gt;{# ... #}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endtimezone&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="post-form-and-csrf"&gt;POST form and CSRF&lt;/h4&gt;
&lt;p&gt;å¿˜è¨˜è¬›äº†ï¼Œæˆ‘å€‘çš„ form ç›®å‰æ˜¯ç”¨ &lt;code&gt;action="get"&lt;/code&gt;ï¼Œç•¶ç„¶å¯ä»¥æ”¹å›žç”¨ POSTï¼Œä¹Ÿå¾ˆç°¡å–®ï¼Œå°± GET æ›æˆ POST å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_site/views.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.views.decorators.http&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;require_POST&lt;/span&gt;

&lt;span class="nd"&gt;@require_POST&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Retrieve all related members&lt;/span&gt;
    &lt;span class="n"&gt;form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;POST&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_site/templates/home.html #}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é¦¬ä¸Šä¾†è©¦è©¦çœ‹ã€‚&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_csrf_failed.png"/&gt;
  &lt;p class="caption"&gt;POST form without CSRF token&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;æ‹¿åˆ°äº†ä¸€å€‹ 403 Forbidden &amp;ldquo;CSRF verification failed.&amp;rdquo;ã€‚CSRF (Cross Site Request Forgery) åœ¨ &lt;a href="https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"&gt;wiki&lt;/a&gt; æœ‰æ¯”è¼ƒå®Œæ•´çš„ä»‹ç´¹ï¼Œé€™æ˜¯ä¸€ç¨®æ”»æ“Šæ‰‹æ³•ï¼Œåœ¨ä½¿ç”¨è€…ç™»å…¥ç¶²ç«™ä¹‹å¾Œï¼ˆsession ç‚ºç™»å…¥ç‹€æ…‹ï¼‰ï¼Œå½é€ ä¸€å€‹è·Ÿç¶²ç«™ä¸Šä¸€æ¨£çš„ form ä¾†å½è£ä½¿ç”¨è€…çš„è¡Œç‚ºã€‚ä¾‹å¦‚è³¼ç¥¨ç³»çµ±è²·ç¥¨ï¼Œå¦‚æžœæ²’æª¢æŸ¥çš„è©±ï¼Œæˆ‘å¯ä»¥æ‹¿ä½¿ç”¨è€…çš„ session åŽ»ç¶²ç«™ä¸Šéš¨ä¾¿è²·ç¥¨ï¼Œç¶²ç«™éƒ½æœƒèªç‚ºæ˜¯ä½¿ç”¨è€…åœ¨æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/csrf/"&gt;CSRF token&lt;/a&gt; ç”¨ä¾†é˜²ç¯„é€™å€‹å½é€ ï¼Œåœ¨ç”¢ç”Ÿ form çš„æ™‚å€™ï¼Œç¶²ç«™æœƒå†ç”¢ç”Ÿä¸€å€‹æ¬„ä½çš„å€¼ï¼Œé€™å€‹æ¬„ä½çš„å€¼æ¯æ¬¡éƒ½æœƒæ”¹è®Šï¼Œé€™æ¨£å°±èƒ½ç¢ºå®šé€™å€‹ form æ˜¯å¾žç¶²ç«™ä¸Šæ‹¿åˆ°çš„ã€‚Django è™•ç† CSRF protection æ˜¯é€éŽ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/"&gt;Middleware&lt;/a&gt;ï¼Œä¸€å€‹ä»¥å‰æ²’æœ‰æåˆ°çš„æ¦‚å¿µï¼Œè¡¨ç¤ºä»–æ˜¯æ¯”è¼ƒåº•å±¤çš„æ±è¥¿ã€‚ç›¸å°è€Œè¨€ï¼Œä¹Ÿä¸ç”¨æ”¹æˆ‘å€‘çš„ codeï¼Œåœ¨é€™å€‹ä¾‹å­å°±åªè¦æŠŠ &lt;code&gt;{% csrf_token %}&lt;/code&gt; åŠ åˆ° form è£¡é¢å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;{# draw_site/templates/home.html #}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="c"&gt;{# ... #}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;csrf_token&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="zh"></category><category term="django"></category><category term="sqlite"></category><category term="python"></category></entry><entry><title>Datetime in SQLite and Python</title><link href="https://blog.liang2.tw/posts/2015/09/datetime-sqlite/" rel="alternate"></link><published>2015-09-28T12:00:00-05:00</published><updated>2015-09-28T12:00:00-05:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2015-09-28:/posts/2015/09/datetime-sqlite/</id><summary type="html">&lt;p&gt;æ•´ç†åœ¨ Python ä¸­è™•ç†æ™‚å€çš„å•é¡Œï¼Œä¸¦å¦‚ä½•è‡ª SQLite å­˜å–è€ƒæ…®æ™‚å€çš„æ™‚é–“&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¦æ­£ç¢ºè™•ç†æ™‚é–“ä¸¦ä¸å®¹æ˜“ã€‚æ‰¿æŽ¥&lt;a href="../flask-draw-member"&gt;æˆ‘å€‘å…ˆå‰çš„ä¾‹å­&lt;/a&gt;ï¼Œå…¶å¯¦æ˜¯ç›´æŽ¥æŠŠæ™‚é–“è½‰æ›å‡ºä¾†çš„å­—ä¸²å­˜åœ¨ SQLite è£¡ã€‚é€™æœ‰å¹¾å€‹å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯æ™‚å€çš„å•é¡Œã€‚æˆ‘å€‘ç›´æŽ¥æŠŠ server æ‰€åœ¨æ™‚å€çš„æ™‚é–“å­˜åˆ°è³‡æ–™åº«åŽ»ï¼Œå°åŒ—çš„æ™‚å€ç‚º &lt;a href="https://en.wikipedia.org/wiki/Asia/Taipei"&gt;Asia/Taipei&lt;/a&gt; (UTC+8)ã€‚å¦‚æžœä»Šå¤© server è·‘åˆ°å¦ä¸€å€‹æ™‚å€ï¼Œä¾‹å¦‚æ±äº¬ Asia/Tokyo (UTC+9) å¥½äº†ï¼Œé€™æ™‚å€™è³‡æ–™åº«è£¡å°±åŒ…å«äº†å…©å€‹æ™‚å€çš„æ™‚é–“ï¼Œä½†å› ç‚ºæ˜¯å­—ä¸²æ˜¯å®Œå…¨çœ‹ä¸å‡ºå·®ç•°çš„ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†ç”¨å­—ä¸²å­˜æ™‚é–“ä¹Ÿæœ‰ä¸€äº›å•é¡Œã€‚é¦–å…ˆæ˜¯æŽ’åºï¼Œé›–ç„¶æˆ‘å€‘çš„ä¾‹å­æ˜¯èƒ½æ­£ç¢ºçš„æŽ’åºï¼Œä½†å¦‚æžœæ™‚é–“æ ¼å¼æ›äº†ï¼ˆåƒ &lt;code&gt;%H:%M:%S %Y-%m-%d&lt;/code&gt;ï¼‰é‚£å°±ä¸ä¸€å®šã€‚å†ä¾†å¯ä»¥çœ‹åˆ°å¾ŒçºŒæƒ³è™•ç†æ™‚é–“å°±æœƒæ¯”è¼ƒè¤‡é›œã€‚ä¸éŽé€™ä¸€éƒ¨ä»½æ˜¯å› ç‚º SQLite æ²’æœ‰å°ˆé–€è™•ç†æ—¥æœŸæ™‚é–“çš„è³‡æ–™åž‹æ…‹ï¼Œåƒ PostgreSQL å°±èƒ½çœ‹å¾—æ‡‚ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æƒ³è¦æ­£ç¢ºè™•ç†æ™‚é–“æœ‰å¹¾å€‹è¦é»žï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜åˆ°è³‡æ–™åº«çš„æ™‚é–“æ‡‰è©²è¦ UTC ä¾†è¡¨ç¤º&lt;/li&gt;
&lt;li&gt;åœ¨è™•ç†æ™‚é–“æ™‚ï¼ˆæŽ’åºã€é¡¯ç¤ºã€è™•ç†æ™‚å€ï¼‰ï¼Œæ‡‰è©²è½‰æˆæ­£ç¢ºçš„è³‡æ–™æ ¼å¼ï¼ˆä¾‹å¦‚ &lt;a href="https://docs.python.org/3.5/library/datetime.html#datetime-objects"&gt;datetime&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å‘ˆç¾çµ¦ä½¿ç”¨è€…æ™‚å†è½‰æ›åˆ°è©²äººï¼ˆæˆ– serverï¼‰æ‰€åœ¨æ™‚å€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åº•ä¸‹æ˜¯æ¯”è¼ƒæ­£ç¢ºè™•ç†æ™‚é–“çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#timezone"&gt;æ™‚å€ï¼ˆTimezoneï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datetime-in-sqlite-again"&gt;Datetime in SQLite, again&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python-3-timezone"&gt;Python 3 å…§å»º timezone æ”¯æ´&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#python-sqlite-adapter"&gt;è®“ Python å…§å»º SQLite adapter æ”¯æ´æ™‚å€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="timezone"&gt;æ™‚å€ï¼ˆTimezoneï¼‰&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘éƒ½é‚„æ²’æœ‰è™•ç†éŽæ™‚å€ã€‚æ™‚å€åœ¨ Python å…§å»ºçš„ datetime åªæ˜¯å€‹ã€Œæ¦‚å¿µã€ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä½¿ç”¨è€…å¯ä»¥å‚³é€²åŽ»ä¸åŒçš„æ™‚å€ï¼ˆå­˜åœ¨ &lt;code&gt;datetime.tzinfo&lt;/code&gt; ä¸­ï¼‰ï¼ŒPython èƒ½é‡å°æœ‰æä¾›æ™‚å€çš„ datetime åšæ­£ç¢ºçš„åˆ¤æ–·ã€‚ä½†å°åŒ—çš„æ™‚å€æ˜¯å¤šå°‘ï¼Œç´ç´„çš„æ™‚å€æ˜¯å¤šå°‘å®ƒä¸çŸ¥é“ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºä»€éº¼ä¸è™•ç†å„åœ°æ™‚å€é€™éº¼é‡è¦çš„æ¦‚å¿µï¼Ÿå› ç‚ºæ™‚é–“è®Šå‹•çš„é€Ÿåº¦å¾ˆå¿«ï¼ŒåŠ ä¸Šæ—¥å…‰ç¯€ç´„æ™‚é–“æ¯å¹´å¯èƒ½éƒ½ä¸ä¸€æ¨£ï¼ŒPython ä¸‹ä¸€ç‰ˆé‚„æ²’å‡ºæ™‚å€çš„è³‡è¨Šå·²ç¶“æ›´æ–°äº†å¾ˆå¤šæ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤åœ¨ Python ä¸­å¯¦éš›ä¸Šæ™‚å€è™•ç†é å¾—æ˜¯ç¬¬ä¸‰æ–¹å¥—ä»¶ &lt;a href="http://pythonhosted.org/pytz/"&gt;pytz&lt;/a&gt;ã€‚åƒå®‰è£ Flask ä¸€æ¨£ï¼Œç”¨ &lt;code&gt;pip install pytz&lt;/code&gt; å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯¦éš›æ“ä½œçœ‹çœ‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;      &lt;span class="c1"&gt;# local time&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 16, 33, 39, 537111)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;   &lt;span class="c1"&gt;# UTC time&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 8, 33, 39, 538745)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é¦–å…ˆï¼Œå¯ä»¥çœ‹åˆ° datetime æœ¬èº«æä¾›äº† &lt;code&gt;now()&lt;/code&gt; ä»¥åŠ &lt;code&gt;utcnow()&lt;/code&gt; å…©å€‹ function ä¾†æ‹¿åˆ°ç¾åœ¨çš„æ™‚é–“ã€‚å°åŒ—æ˜¯ UTC+8 æ‰€ä»¥æ™‚é–“æ¯” UTC æ™‚é–“å­—é¢ä¸Šå¿« 8 å°æ™‚ã€‚æ³¨æ„åˆ°å…©å€‹å›žå‚³çš„ datetime ç‰©ä»¶éƒ½æ²’æœ‰åŒ…å«æ™‚å€çš„è³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;è™•ç†æ™‚é–“åŽŸå‰‡ä¸Šéƒ½ä»¥ UTC ç‚ºåŸºæº–ã€‚æˆ‘å€‘å»ºç«‹ä¸€å€‹ UTC çš„ç¾åœ¨æ™‚é–“å­˜åœ¨è®Šæ•¸ &lt;code&gt;utcnow&lt;/code&gt;ï¼Œä¸¦ä¸”ç”¨ pytz è™•ç†æ™‚é–“ã€‚Import pytz é€²ä¾†ï¼Œä¸¦ä¸”å®šç¾©äº†å…©å€‹æ™‚å€ï¼šUTC ä»¥åŠ TPEï¼ˆå°åŒ—æ™‚é–“ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 8, 38, 14, 738241)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 8, 38, 14, 738241, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 16, 38, 14, 738241, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç”¨ pytz å®šç¾©çš„æ™‚å€è™•ç† datetime ä¹‹å¾Œå°±æœƒå¤šäº† &lt;code&gt;tzinfo&lt;/code&gt; çš„è³‡è¨Šã€‚é€™æ™‚ä¹Ÿèƒ½æ­£ç¢ºæ¯”è¼ƒä¸åŒæ™‚å€çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•è™•ç†ä¸€å€‹ä»»æ„å®šç¾©çš„æ™‚é–“å‘¢ï¼Ÿä¾‹å¦‚ 2016 å¹´å°åŒ—å…ƒæ—¦å¥½äº†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;2016-01-01 00:00:00&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2016, 1, 1, 0, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 12, 31, 16, 0, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½¿ç”¨ &lt;code&gt;.localize(&amp;lt;datetime&amp;gt;)&lt;/code&gt; çµ¦äºˆä¸€å€‹åˆå§‹æ²’æœ‰æ™‚å€è³‡è¨Šçš„ &lt;code&gt;datetime&lt;/code&gt; æ™‚å€ã€‚æœ‰äº†æ™‚å€ä¹‹å¾Œï¼Œè¦åœ¨ä¸åŒæ™‚å€é–“è½‰æ›å°±ä½¿ç”¨ &lt;code&gt;.normalize(&amp;lt;datetime&amp;gt;)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥å†æŸ¥æŸ¥ç•¶å°åŒ— 2016 å…ƒæ—¦æ™‚ï¼Œç¾Žåœ‹æ±å²¸æ™‚é–“æ˜¯å¹¾é»žã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;est&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;US/Eastern&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;est&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 12, 31, 11, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;US/Eastern&amp;#39; EST-1 day, 19:00:00 STD&amp;gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä»¥å¾Œè¦çœ‹çƒè³½è½‰æ’­ã€é‡è¦ç™¼è¡¨å°±ä¸æœƒå†æžä¸æ¸…æ¥šæ™‚é–“äº†ã€‚&lt;/p&gt;
&lt;h3 id="datetime-in-sqlite-again"&gt;Datetime in SQLite, again&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æœƒè™•ç† datetime èˆ‡æ™‚å€äº†ï¼Œé‚£éº¼å°±ä¾†æ”¹å¯«ä¸€ä¸‹æœ¬ä¾† SQLite å­˜æ™‚é–“çš„æ–¹å¼ã€‚å…¶å¯¦ Python datetime æ”¯æ´ SQLite è½‰æ›ï¼ŒåŒæ¨£å¾ž&lt;a href="https://docs.python.org/3.5/library/sqlite3.html#default-adapters-and-converters"&gt;Python module èªªæ˜Žæ–‡ä»¶&lt;/a&gt;è£¡é¢æ‹¿å‡ºä¾†çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s2"&gt;&amp;quot;test.db&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;detect_types&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_DECLTYPES&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_COLNAMES&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;CREATE TABLE test(dt timestamp)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;sqlite3.Cursor object at 0x10a59b960&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è³‡æ–™æ¬„ä½çš„è¨­ç‚º &lt;code&gt;timestamp&lt;/code&gt;ï¼Œä¸¦ä¸”åœ¨é€£æŽ¥çš„æ™‚å€™è¨­å®š &lt;code&gt;PARSE_DECLTYPES&lt;/code&gt; åŠ &lt;code&gt;PARSE_COLNAMES&lt;/code&gt;ï¼Œç¨å¾Œå¯ä»¥çœ‹åˆ°ä»–å€‘çš„æ•ˆæžœã€‚
è¶•å¿«æŠŠæ™‚é–“å­˜é€²åŽ»å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 12, 48, 16, 671538)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="s1"&gt;&amp;#39;INSERT INTO test(dt) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;sqlite3.Cursor object at 0x1082380a0&amp;gt;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 12, 31, 16, 0, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc_dt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="s1"&gt;&amp;#39;INSERT INTO test(dt) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utc_dt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;sqlite3.Cursor object at 0x10a59b960&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å­˜äº†å…©å€‹æ™‚é–“ï¼Œä¸€å€‹æ˜¯ UTC çš„ç¾åœ¨æ™‚é–“ï¼Œå¦ä¸€å€‹æ˜¯ä»¥ UTC è¡¨ç¤ºçš„å°åŒ— 2016 å…ƒæ—¦ã€‚æ³¨æ„å…©å€‹æ™‚é–“éƒ½æŠŠ UTC æ™‚å€åŽ»æŽ‰äº†ï¼Œå› ç‚ºåœ¨æŸäº›æƒ…æ³åº•ä¸‹ SQLite èˆ‡ python çš„ datetime adapter æœƒçœ‹ä¸æ‡‚æ™‚å€ï¼ˆé€™æ˜¯å€‹ &lt;a href="https://bugs.python.org/issue19065"&gt;bug #19065&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœç”¨ SQLite å¯ä»¥çœ‹åˆ°æ™‚é–“éƒ½æ˜¯ä»¥ UTC å‘ˆç¾ã€‚ä»å¯ä»¥ç”¨å®ƒå…§å»ºçš„ &lt;code&gt;datetime('&amp;lt;UTC time&amp;gt;', 'localtime')&lt;/code&gt; æŠŠ UTC æ™‚é–“å­—ä¸²è½‰æ›æˆé›»è…¦çš„ç•¶åœ°æ™‚é–“ã€‚é€™æ¨£è™•ç†æ˜¯å®¹æ˜“èˆ‡å…¶ä»–æ‡‰ç”¨ç¨‹å¼ç›¸å®¹çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;-- sqlite3 test.db&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;schema&lt;/span&gt;
&lt;span class="go"&gt;CREATE TABLE test(dt timestamp);&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 12:48:16.671538&lt;/span&gt;
&lt;span class="go"&gt;2015-12-31 16:00:00&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;localtime&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 20:48:16&lt;/span&gt;
&lt;span class="go"&gt;2016-01-01 00:00:00&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†ç”¨ Python è®€å›žä¾†ä»ç„¶æ˜¯ datetime æ ¼å¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;ret_vals&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SELECT dt AS &amp;quot;[timestamp]&amp;quot; FROM test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;ret_vals&lt;/span&gt;
&lt;span class="go"&gt;[(datetime.datetime(2015, 9, 29, 12, 48, 16, 671538),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2015, 12, 31, 16, 0),)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;ret_vals&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2015, 9, 29, 20, 48, 16, 671538, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 1, 1, 0, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="python-3-timezone"&gt;Python 3 å…§å»º timezone æ”¯æ´&lt;/h4&gt;
&lt;p&gt;ç‚ºäº†å¯«é€™ç¯‡ blog åˆç ”ç©¶äº†ä¸€ä¸‹å…§å»ºçš„ datetime.timezoneã€‚Python 2 æ²’æœ‰é€™å€‹åŠŸèƒ½ï¼Œä¸éŽåŸºæœ¬çš„ timedelta æœ‰ï¼Œæ‰€ä»¥è¦è‡ªå·±åšæ‡‰è©²ä¹Ÿæ˜¯åšå¾—åˆ°â€¦å§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å…§å»ºçš„ datetime.timezone ç”±ä¸€å€‹ utcoffset åšå»ºç«‹ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å‚³å€‹ç›¸å°æ–¼ UTC çš„æ™‚é–“å·®ï¼Œä»¥ datetime.timedelta è¡¨ç¤ºã€‚ä¸€æ¨£å…§å»ºå¸¶æœ‰ UTC æ™‚å€ï¼Œé€™é‚Šè©¦è‘—å»ºäº†å°åŒ—ä»¥åŠæ±äº¬çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;dt&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 20, 40, 49, 347568)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_delta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_delta&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn_delta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jpn_delta&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æˆ‘äººåœ¨å°åŒ—ï¼Œæ‰€ä»¥ datetime.datetime.now() æœƒçµ¦æˆ‘å°åŒ—æ™‚é–“ï¼Œå†ç”¨ timedelta æ‰‹å‹•ç®—å‡ºå„æ™‚å€çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc_now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe_now&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;tpe_delta&lt;/span&gt;  &lt;span class="c1"&gt;# manually time shift&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn_now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;jpn_delta&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc_now&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 12, 40, 49, 347568)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt;
&lt;span class="go"&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç›´æŽ¥æ¯”è¼ƒé€™äº›ç®—å‡ºä¾†çš„æ™‚é–“ï¼Œä¸æ„å¤–ä¸ç›¸ç­‰ï¼Œå› ç‚ºé è¨­çš„ tzinfo æ˜¯ç©ºçš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 20, 40, 49, 347568, tzinfo=datetime.timezone(datetime.timedelta(0, 28800)))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;jpn&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;çµ¦äº†å„åœ°çš„æ™‚å€çš„ tzinfo ä¹‹å¾Œï¼Œå¯ä»¥çœ‹åˆ° datetime åœ¨åšæ¯”è¼ƒçš„æ™‚å€™æ˜¯æœ‰è€ƒæ…®æ™‚å€ä½ç§»çš„ã€‚&lt;/p&gt;
&lt;p&gt;æŽ¥è‘—å†ä¾†çœ‹ä¸€ä¸‹pytz èˆ‡å…§å»º datetime.timezone çš„ç›¸å®¹ç¨‹åº¦ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz_utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz_tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jpn_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;jpn&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 12, 40, 49, 347568, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz_tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ¯”è¼ƒè·Ÿè½‰æ›éƒ½æ²’æœ‰å•é¡Œï¼Œå¯ä»¥æ”¾å¿ƒè½‰æ›ã€‚&lt;/p&gt;
&lt;h3 id="python-sqlite-adapter"&gt;è®“ Python å…§å»º SQLite adapter æ”¯æ´æ™‚å€&lt;/h3&gt;
&lt;p&gt;çœ‹äº†ä¸€ä¸‹ &lt;a href="https://bugs.python.org/issue19065"&gt;Python issue 19065&lt;/a&gt;ï¼Œä¹‹æ‰€ä»¥æ²’æœ‰è§£æ±ºå…¶å¯¦æ˜¯ç¼º patchï¼Œå› ç‚ºç¾åœ¨çš„ patch ä¸¦ä¸ç›¸å®¹ Python 2.xï¼ˆæ²’æœ‰ datetime.timezoneï¼‰ï¼Œç„¶å¾Œ pysqlite çš„ç¶­è­·è€…ä¸¦æ²’æœ‰æƒ³è¦æ”¯æ´ timezone çš„æ„æ€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽé‚£åªæ˜¯å…§å»ºçš„ adapter for datetime.datetime objectï¼Œè¦è‡ªå·±åšä¹Ÿæ²’å•é¡Œã€‚åƒè€ƒ issue è£¡é¢æä¾›çš„è§£æ³•ï¼ˆåœ¨ Github &lt;a href="https://gist.github.com/acdha/6655391"&gt;gist&lt;/a&gt; ä¸Šï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# tz_aware_adpater.py&lt;/span&gt;
&lt;span class="c1"&gt;# Adapt from https://gist.github.com/acdha/6655391&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;tz_aware_timestamp_adapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;datepart&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;month&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;datepart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tz_offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rsplit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;tz_offset&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;00:00&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tz_offset&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;

    &lt;span class="n"&gt;timepart_full&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seconds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timepart_full&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;timepart_full&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;microseconds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;{:0&amp;lt;6.6}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;timepart_full&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;()))&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;microseconds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;

    &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;month&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;microseconds&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;tzinfo&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;

&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;register_converter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;timestamp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tz_aware_timestamp_adapter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;python3 -i tz_aware_adpater.py&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s1"&gt;&amp;#39;test.db&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;     &lt;span class="n"&gt;detect_types&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_DECLTYPES&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_COLNAMES&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;2016-06-03 08:00:00+08:00&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executemany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s1"&gt;&amp;#39;INSERT INTO test(dt) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt;&lt;span class="p"&gt;,),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt;&lt;span class="p"&gt;),)]&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å­˜äº†å…©å€‹å¸¶æœ‰æ™‚å€çš„æ™‚é–“ï¼ˆå…©å€‹æ™‚é–“æ˜¯ç›¸åŒçš„ï¼‰ã€‚å…ˆå¾ž SQLite ä¾†è®€è®€çœ‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 12:48:16.671538&lt;/span&gt;
&lt;span class="go"&gt;2015-12-31 16:00:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 08:00:00+08:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 00:00:00+00:00&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;localtime&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 20:48:16&lt;/span&gt;
&lt;span class="go"&gt;2016-01-01 00:00:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 08:00:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 08:00:00&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ™‚å€æ˜¯ç›´æŽ¥å¯«åˆ° SQLite è£¡é¢ï¼Œæ²’æœ‰çš„è©±å°±ç•¶æˆæ˜¯ UTC æ™‚å€ã€‚&lt;/p&gt;
&lt;p&gt;å†ç”¨ Python è®€å›žä¾†ï¼Œæ¸¬ä¸€ä¸‹ä¿®æ”¹çš„ adapterã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;dts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SELECT dt FROM test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;dts&lt;/span&gt;
&lt;span class="go"&gt;[(datetime.datetime(2015, 9, 29, 12, 48, 16, 671538),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2015, 12, 31, 16, 0),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2016, 6, 3, 8, 0, tzinfo=datetime.timezone(datetime.timedelta(0, 28800))),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2016, 6, 3, 0, 0, tzinfo=datetime.timezone.utc),)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astimezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dts&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:]]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è®€å›žä¾†æ²’æœ‰å•é¡Œï¼Œå¦‚æžœè¦å®Œæ•´è™•ç†æ‰€æœ‰æƒ…æ³ï¼ˆå‰é¢å…©å€‹ datetime æ˜¯ naive æ²’æœ‰æ™‚å€ï¼‰&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astimezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;  &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dts&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2015, 9, 29, 12, 48, 16, 671538, tzinfo=&amp;lt;UTC&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2015, 12, 31, 16, 0, tzinfo=&amp;lt;UTC&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 0, 0, tzinfo=&amp;lt;UTC&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 0, 0, tzinfo=&amp;lt;UTC&amp;gt;)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astimezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;  &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dts&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2015, 9, 29, 20, 48, 16, 671538, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 1, 1, 0, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_1"&gt;ç¸½çµ&lt;/h3&gt;
&lt;p&gt;æ™‚å€çœŸçš„å¾ˆç…©ï¼Œå°¤å…¶æ˜¯å¾ˆå¤šåœ°æ–¹ä¸ä¸€å®šéƒ½å®Œæ•´æ”¯æ´æ™‚å€ï¼Œæœ€å¥½çš„æƒ…æ³é‚„æ˜¯ç”¨ UTC æºé€šï¼Œåªæœ‰åœ¨çœŸçš„éœ€è¦æ™‚å†è½‰æ›æˆç•¶åœ°æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœå¤§å®¶å°æ™‚å€å¾ˆæœ‰èˆˆè¶£ï¼Œä¸ä¹…å‰ &lt;a href="https://www.python.org/dev/peps/pep-0495/"&gt;PEP 495&lt;/a&gt; å·²ç¶“è¢«æŽ¥å—ï¼Œæ²’æœ‰æ„å¤–æ‡‰è©²æœƒå‡ºç¾åœ¨ Python 3.6 è£¡é¢ï¼Œå®ƒè™•ç†çš„æ˜¯æ—¥å…‰ç¯€ç´„æ™‚é–“çš„å•é¡Œã€‚ï¼ˆæ„Ÿè¦ºåœ¨è‡ºç£å°æ—¥å…‰ç¯€ç´„æ™‚é–“å®Œå…¨æ²’æœ‰æ¦‚å¿µå•Šï¼‰&lt;/p&gt;
&lt;p&gt;ä¸å¾—ä¸èªªè¦æ­£ç¢ºè™•ç†æ™‚é–“â€¦å¾ˆéº»ç…©å•Šã€‚&lt;/p&gt;</content><category term="zh"></category><category term="datetime"></category><category term="pytz"></category><category term="sqlite"></category><category term="python"></category></entry><entry><title>ç”¨ Flask èˆ‡ SQLite æž¶æŠ½ç±¤ç¶²ç«™</title><link href="https://blog.liang2.tw/posts/2015/09/flask-draw-member/" rel="alternate"></link><published>2015-09-28T12:00:00-05:00</published><updated>2015-09-28T12:00:00-05:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2015-09-28:/posts/2015/09/flask-draw-member/</id><summary type="html">&lt;p&gt;ç‚ºäº†å¯¦é©—å®¤çš„å°ˆé¡Œç”Ÿè€Œå¯«ã€‚&lt;/p&gt;
&lt;p&gt;ç›®æ¨™å…¶å¯¦æ˜¯ Django + Django ORM + PostgreSQLï¼Œä¸éŽä¸€æ¬¡æŽ¥è§¸å¤ªå¤šæœƒæœ‰åæ•ˆæžœï¼Œå…ˆæ“ä½œæ¯”è¼ƒç°¡å–®çš„æ‰å¥½ä¸Šæ‰‹ã€‚æ‰€ä»¥é€™é‚Šè¬›çš„ä¸¦ä¸æ˜¯ best practiceï¼Œä½†ä½¿ç”¨æœ€å°‘ï¼ˆåº•å±¤ï¼‰çš„çŸ¥è­˜èˆ‡å·¥å…·ã€‚å¦‚æžœä¸€é–‹å§‹è®“å¤ªå¤šå¥—ä»¶ï¼ˆåƒ SQLAlchemyï¼‰åšæŽ‰äº†ç´°ç¯€éƒ¨ä»½ï¼Œåè€Œä¸å¤ªèƒ½æŽŒæ¡åˆ°é‡è¦çš„æ¦‚å¿µä»¥åŠç‚ºä»€éº¼éœ€è¦é€™äº›å¥—ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬ç¯‡æ–‡ç« éžå¸¸é•·ï¼Œæ‡‰è©²æ²’è¾¦æ³•å¹¾åˆ†é˜å…§è®€å®Œã€‚å°è±¡æ˜¯åˆå­¸è€…å­¸ç¿’ç°¡å–®ç¶²ç«™æž¶è¨­ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€™å€‹å°ˆæ¡ˆçš„ç›®æ¨™ï¼šå› ç‚ºå¤§å®¶ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç‚ºäº†å¯¦é©—å®¤çš„å°ˆé¡Œç”Ÿè€Œå¯«ã€‚&lt;/p&gt;
&lt;p&gt;ç›®æ¨™å…¶å¯¦æ˜¯ Django + Django ORM + PostgreSQLï¼Œä¸éŽä¸€æ¬¡æŽ¥è§¸å¤ªå¤šæœƒæœ‰åæ•ˆæžœï¼Œå…ˆæ“ä½œæ¯”è¼ƒç°¡å–®çš„æ‰å¥½ä¸Šæ‰‹ã€‚æ‰€ä»¥é€™é‚Šè¬›çš„ä¸¦ä¸æ˜¯ best practiceï¼Œä½†ä½¿ç”¨æœ€å°‘ï¼ˆåº•å±¤ï¼‰çš„çŸ¥è­˜èˆ‡å·¥å…·ã€‚å¦‚æžœä¸€é–‹å§‹è®“å¤ªå¤šå¥—ä»¶ï¼ˆåƒ SQLAlchemyï¼‰åšæŽ‰äº†ç´°ç¯€éƒ¨ä»½ï¼Œåè€Œä¸å¤ªèƒ½æŽŒæ¡åˆ°é‡è¦çš„æ¦‚å¿µä»¥åŠç‚ºä»€éº¼éœ€è¦é€™äº›å¥—ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬ç¯‡æ–‡ç« éžå¸¸é•·ï¼Œæ‡‰è©²æ²’è¾¦æ³•å¹¾åˆ†é˜å…§è®€å®Œã€‚å°è±¡æ˜¯åˆå­¸è€…å­¸ç¿’ç°¡å–®ç¶²ç«™æž¶è¨­ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€™å€‹å°ˆæ¡ˆçš„ç›®æ¨™ï¼šå› ç‚ºå¤§å®¶ meeting çš„æ™‚å€™éƒ½ä¸å•å•é¡Œï¼Œæ•™æŽˆéœ€è¦ä¸€å€‹æŠ½ç±¤é»žäººå•å•é¡Œçš„å·¥å…·ã€‚æˆ‘å€‘å¯¦é©—å®¤æœ‰åˆ†æˆå¹¾å€‹çµ„åˆ¥ï¼Œæ‰€ä»¥æŠ½ç±¤çš„æ™‚å€™ä¹Ÿè¦èƒ½é‡å°å–®å€‹çµ„åˆ¥æŠ½ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä½¿ç”¨ &lt;a href="https://zh.wikipedia.org/wiki/LoveLive!"&gt;LoveLive!&lt;/a&gt; é‚„æœ‰ &lt;a href="https://zh.wikipedia.org/wiki/K-ONï¼è¼•éŸ³éƒ¨"&gt;K-ON!&lt;/a&gt; çš„æˆå“¡ä¾†ç•¶ä¾‹å­ã€‚&lt;strong&gt;å…ˆè²æ˜Žæˆ‘å…©å€‹å‹•ç•«éƒ½æ²’æœ‰çœ‹éŽï¼Œå¦‚æžœæœ‰ä»€éº¼åå­—æ‰“éŒ¯è«‹å‘Šè¨´æˆ‘ï¼Œçµ•å°ä¸æ˜¯æ•…æ„çš„ã€‚&lt;/strong&gt;ï¼ˆ2016-06-14 æ›´æ–°ï¼šæˆ‘æŠŠå…©å€‹å‹•ç•«éƒ½çœ‹å®Œäº†ï¼ï¼‰&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;è³‡æ–™è¨­è¨ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç¶²ç«™æž¶æ§‹è¦åŠƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;å¯¦ä½œç’°å¢ƒè¨­å®š&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python"&gt;Python ç’°å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#flaskjinja2"&gt;å®‰è£ Flaskã€Jinja2 ç­‰å¥—ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sqlite-database"&gt;SQLite Database&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#csv"&gt;æŠŠ CSV å¯«é€²è³‡æ–™åº«&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#flask"&gt;Flask åŸºæœ¬æž¶æ§‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#flask-sqlite"&gt;Flask èˆ‡ SQLite è³‡æ–™åº«è®€å–&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#first-view-first-template"&gt;First view, first template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;æŠ½ç±¤åŠŸèƒ½&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#get-vs-post"&gt;GET vs POST&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#form"&gt;Form&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#request-form-post-handling-in-flask"&gt;Request (Form / POST) handling in Flask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#demo"&gt;Demo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#more-on-templates"&gt;More on templates&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_5"&gt;æ­·å²è¨˜éŒ„&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#datetime"&gt;æ™‚é–“è™•ç†ç”¨ datetime&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#whats-next"&gt;What&amp;rsquo;s Next&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#static-files-and-better-theme"&gt;Static files and better theme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#more-how-web-works"&gt;More how web works&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#object-relational-model-orm"&gt;Object Relational Model (ORM)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django"&gt;Django&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_6"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#details"&gt;Details&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sqlite-table-info"&gt;SQLite table info&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sqlite-foreign-key-check"&gt;SQLite foreign key check&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_7"&gt;é‡æ–°è®€å…¥è³‡æ–™&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datetime-in-sqlite-and-python"&gt;Datetime in SQLite and Python&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="_1"&gt;è³‡æ–™è¨­è¨ˆ&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å…ˆå‡è¨­æ‰€æœ‰æª”æ¡ˆéƒ½æ”¾åœ¨åŒå€‹è³‡æ–™å¤¾è£¡ï¼Œä¼°ä¸”å« &lt;code&gt;draw_member&lt;/code&gt;ã€‚ä¹‹å¾Œæ²’æœ‰é¡å¤–èªªæ˜Žçš„è©±ï¼Œéƒ½æ˜¯åœ¨é€™å€‹ç›®éŒ„ä¸‹æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åŽŸå§‹è³‡æ–™ç”¨ CSV æ ¼å¼ä¾†å„²å­˜ï¼Œæœ‰ã€Œåå­—ã€ä»¥åŠã€Œåœ˜é«”ã€å…©å€‹æ¬„ä½ã€‚ä¸éŽè€ƒæ…®åˆ°å¯èƒ½æœƒæŠŠæª”æ¡ˆåŒ¯å‡ºï¼Œåœ¨åŽŸå§‹æª”æ¡ˆå¤šåŠ ä¸€å€‹ã€Œæœ€è¿‘è¢«æŠ½åˆ°çš„æ—¥æœŸã€æ¬„ä½ï¼Œå¸Œæœ›æœ€è¿‘è¢«æŠ½åˆ°çš„æœƒæ¯”å…¶ä»–äººå†è¢«æŠ½åˆ°çš„æ©Ÿæœƒä½Žä¸€é»žã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹ CSV æª”æ¡ˆå‘½åç‚º &lt;code&gt;members.csv&lt;/code&gt;ã€‚ä¸€é–‹å§‹æ²’æœ‰äººè¢«æŠ½åˆ°ï¼Œæ‰€ä»¥æœ€å¾Œä¸€æ¬„éƒ½å…ˆè¨­æˆç©ºçš„&lt;sup id="fnref-1"&gt;&lt;a class="footnote-ref" href="#fn-1"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œç¬¬ä¸€è¡Œæ˜¯æ¯ä¸€æ¬„æ¬„ä½çš„åç¨±ã€‚å¦‚æžœå¾žè³‡æ–™åº«åŒ¯å‡ºï¼Œé€™æ¬„ä½å°±æœƒæœ‰å€¼ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;quot;åå­—&amp;quot;,&amp;quot;åœ˜é«”&amp;quot;,&amp;quot;æœ€è¿‘è¢«æŠ½åˆ°çš„æ—¥æœŸ&amp;quot;
&amp;quot;é«˜å‚ ç©‚ä¹ƒæžœ&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;çµ¢ç€¬ çµµé‡Œ&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;å— ã“ã¨ã‚Š&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;åœ’ç”° æµ·æœª&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;æ˜Ÿç©º å‡›&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;è¥¿æœ¨é‡Ž çœŸå§«&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;æ±æ¢ å¸Œ&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;å°æ³‰ èŠ±é™½&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;çŸ¢æ¾¤ ã«ã“&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;å¹³æ²¢ å”¯&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ç§‹å±± æ¾ª&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ç”°äº•ä¸­ å¾‹&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ç´å¹ ç´¬&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ä¸­é‡Ž æ¢“&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é¦–å…ˆæˆ‘å€‘å…ˆç¢ºå®šæœƒç”¨ Python æŠŠè³‡æ–™è®€å‡ºä¾†ã€‚åœ¨ Python ç•¶ä¸­æœ‰å€‹å« &lt;code&gt;csv&lt;/code&gt; çš„å…§å»ºæ¨¡çµ„ï¼ˆmoduleï¼‰å¯ä»¥è™•ç† CSV çš„æª”æ¡ˆè®€å¯«ã€‚åœ¨é€™é‚Šæˆ‘å€‘é¸ç”¨ &lt;a href="https://docs.python.org/3.5/library/csv.html#csv.DictReader"&gt;csv.DictReader&lt;/a&gt;ï¼Œå®ƒé è¨­æœƒæŠŠæª”æ¡ˆçš„ç¬¬ä¸€è¡Œç•¶æˆæ¬„ä½åç¨±ï¼Œç„¶å¾Œæ ¹æ“šé€™åç¨±ï¼Œæ¯ä¸€è¡Œéƒ½æœƒç”¢ç”Ÿä¸€å€‹ &lt;code&gt;dict&lt;/code&gt; ç‰©ä»¶ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./members.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥æŠŠé€™æ®µç¨‹å¼ç¢¼ç›´æŽ¥æ‰“åœ¨ Python REPL è£¡æˆ–è€…å­˜æˆä¸€å€‹æª”æ¡ˆå¾Œå†ç”¨ Python åŸ·è¡Œå®ƒï¼Œçµæžœéƒ½æœƒæ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;çµ¢ç€¬ çµµé‡Œ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;å— ã“ã¨ã‚Š&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ’ç”° æµ·æœª&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ˜Ÿç©º å‡›&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;è¥¿æœ¨é‡Ž çœŸå§«&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ±æ¢ å¸Œ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;å°æ³‰ èŠ±é™½&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;çŸ¢æ¾¤ ã«ã“&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;å¹³æ²¢ å”¯&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç§‹å±± æ¾ª&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç”°äº•ä¸­ å¾‹&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç´å¹ ç´¬&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ä¸­é‡Ž æ¢“&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¦‚æžœä¸è¦ç›´æŽ¥ &lt;code&gt;print(row)&lt;/code&gt; ï¼Œè€Œæ˜¯ç¨å¾®æ•´ç†ä¸€ä¸‹è³‡æ–™å†è¼¸å‡ºï¼Œæ”¹æˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./members.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{} of {}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å‰‡è¼¸å‡ºçµæžœæœƒæ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s
çµ¢ç€¬ çµµé‡Œ of Î¼&amp;#39;s
å— ã“ã¨ã‚Š of Î¼&amp;#39;s
åœ’ç”° æµ·æœª of Î¼&amp;#39;s
æ˜Ÿç©º å‡› of Î¼&amp;#39;s
è¥¿æœ¨é‡Ž çœŸå§« of Î¼&amp;#39;s
æ±æ¢ å¸Œ of Î¼&amp;#39;s
å°æ³‰ èŠ±é™½ of Î¼&amp;#39;s
çŸ¢æ¾¤ ã«ã“ of Î¼&amp;#39;s
å¹³æ²¢ å”¯ of K-ON!
ç§‹å±± æ¾ª of K-ON!
ç”°äº•ä¸­ å¾‹ of K-ON!
ç´å¹ ç´¬ of K-ON!
ä¸­é‡Ž æ¢“ of K-ON!
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£å°±ç¢ºå®šæˆ‘å€‘æœ‰è¾¦æ³•æŠŠè³‡æ–™ç”¨ Python è®€å–äº†ã€‚è¦æ‹¿æ¯å€‹æ¬„ä½çš„å…§å®¹ä¹Ÿå¾ˆç°¡å–®ï¼Œåƒè¦åå­—çš„è©±ï¼Œåªè¦ç”¨ &lt;code&gt;row['åå­—']&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;ç¶²ç«™æž¶æ§‹è¦åŠƒ&lt;/h3&gt;
&lt;p&gt;é€™å€‹æŠ½ç±¤ç¶²ç«™ä¸»è¦å°±å¹¾å€‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¦–é &lt;/strong&gt;å¯ä»¥é¸æ“‡å…¶ä¸­ä¸€å€‹åœ˜é«”æˆ–æ‰€æœ‰äººåŽ»æŠ½ç±¤&lt;ul&gt;
&lt;li&gt;é€å‡ºä¹‹å¾Œå¯ä»¥çœ‹åˆ°çµæžœ&lt;/li&gt;
&lt;li&gt;ä¸¦ä¸”æŠŠé€™å€‹æŠ½ç±¤çµæžœæ›´æ–°åˆ°æ­·å²è¨˜éŒ„è£¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­·å²è¨˜éŒ„&lt;/strong&gt;åˆ—å‡ºéŽåŽ»è¢«æŠ½åˆ°çš„è¨˜éŒ„&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°æˆå“¡&lt;/strong&gt;æ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼Œé‡æ–°è®€å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯ä¸€é æˆ‘å€‘è¦æœ‰å€‹åŠŸèƒ½è¡¨åˆ—ï¼Œæ–¹ä¾¿åŠŸèƒ½çš„åˆ‡æ›ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥è³‡æ–™åº«çš„éƒ¨ä»½æœƒæœ‰å…©å¼µè¡¨æ ¼ï¼š&lt;strong&gt;members&lt;/strong&gt; ä»¥åŠ &lt;strong&gt;draw_histories&lt;/strong&gt; åˆ†åˆ¥è¨˜éŒ„æˆå“¡ä»¥åŠè¢«æŠ½éŽçš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;pre style="font-family: Consolas, 'Courier New', monospace"&gt;
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ members             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id          INTEGER â”‚ &lt;â”€â”
    â”‚ name           TEXT â”‚   â”‚
    â”‚ group_name     TEXT â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ draw_histories      â”‚   â”‚ foreign
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ key
    â”‚ memberid    INTEGER â”‚ â”€â”€â”˜
    â”‚ time       DATETIME â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/pre&gt;

&lt;p&gt;Table &lt;strong&gt;members&lt;/strong&gt; æ‡‰è©²å¾ˆå¥½ç†è§£ï¼Œä¸€å€‹æ¬„ä½æ˜¯åå­— nameï¼Œä¸€å€‹æ˜¯åœ˜é«”åç¨± group_nameã€‚å…¶ä¸­ id é€™å€‹æ¬„ä½æ˜¯ç¨‹å¼å…§éƒ¨åœ¨ä½¿ç”¨çš„ï¼Œå®ƒæœƒåœ¨è®€å…¥è³‡æ–™çš„æ™‚å€™è‡ªå‹•ç”¢ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;Table &lt;strong&gt;draw_histories&lt;/strong&gt; è¨˜éŒ„æ¯æ¬¡æŠ½ç±¤ç™¼ç”Ÿçš„æ™‚é–“ time é‚„æœ‰èª°è¢«æŠ½åˆ° memberidï¼Œå¯ä»¥ç™¼ç¾ memberid æ˜¯ç”¨æˆå“¡çš„ idï¼Œå› æ­¤æˆ‘å€‘å¤šåŠ ä¸€å€‹é™åˆ¶æ˜¯é€™æ¬„ä½çš„å€¼æ‡‰è©²è¦åœ¨ members è£¡çš„ id ä¸­å‡ºç¾éŽã€‚&lt;/p&gt;
&lt;h3 id="_3"&gt;å¯¦ä½œç’°å¢ƒè¨­å®š&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘é¸ç”¨ &lt;a href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; æž¶è¨­ serverï¼Œå› ç‚ºå®ƒä¸€é–‹å§‹ç”¨ç›¸ç•¶ç°¡å–®ã€‚è³‡æ–™çš„éƒ¨ä»½æœƒè®€åˆ° &lt;a href="https://www.sqlite.org/"&gt;SQLite&lt;/a&gt; è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Flask&lt;/em&gt; is a microframework for Python based on Werkzeug, Jinja 2 and good intentions. (Flask official site)&lt;/p&gt;
&lt;p&gt;&lt;em&gt;SQLite&lt;/em&gt; is a software library that implements a self-contained, serverless, zero-configuration, transactional SQL database engine. (SQLite official site)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="python"&gt;Python ç’°å¢ƒ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href="https://www.python.org/downloads/"&gt;Python 3.5&lt;/a&gt;ã€‚ç†è«–ä¸Š SQLite å°±å·²ç¶“è£å¥½äº†èƒ½ç›´æŽ¥ä½¿ç”¨ã€‚ä¸€èˆ¬åœ¨é–‹ç™¼ Python ç¨‹å¼çš„æ™‚å€™æœƒä½¿ç”¨è™›æ“¬ç’°å¢ƒï¼Œå¥½è™•è™›æ“¬ç’°å¢ƒå®‰è£çš„ Python å¥—ä»¶å¯ä»¥ç¨ç«‹ç®¡ç†ï¼Œä¸å—ç³»çµ±æˆ–å…¶ä»–è™›æ“¬ç’°å¢ƒå½±éŸ¿ã€‚æˆ‘å€‘ç”¨å…§å»ºçš„ &lt;a href="https://docs.python.org/3.5/library/venv.html#module-venv"&gt;venv&lt;/a&gt; å»ºç«‹ä¸€å€‹åç¨±ç‚º &lt;code&gt;VENV&lt;/code&gt; çš„è™›æ“¬ç’°å¢ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ python3.5 -m venv VENV
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ™‚å€™ç›®éŒ„åº•ä¸‹å°±æœƒå¤šä¸€å€‹ &lt;code&gt;VENV&lt;/code&gt; è³‡æ–™å¤¾ï¼Œè£¡é¢æ˜¯å€‹å®Œæ•´çš„ Python åŸ·è¡Œçµæ§‹ï¼Œå°±å¥½åƒåœ¨é€™å€‹è·¯å¾‘å®‰è£ Python ä¸€æ¨£ã€‚å…ˆæš«æ™‚ä¸ç®¡å®ƒæ€Žéº¼åšåˆ°è™›æ“¬éš”é›¢ï¼ŒçŸ¥é“æ€Žéº¼ç”¨å°±å¥½ã€‚ä½¿ç”¨è·Ÿé›¢é–‹åˆ†åˆ¥æ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;source&lt;/span&gt; VENV/bin/activate
&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ which python
&lt;span class="c1"&gt;# /path/to/draw_member/VENV/bin/python&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ deactivate
$  &lt;span class="c1"&gt;# å‰é¢çš„ (VENV) æœƒæ¶ˆå¤±&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="flaskjinja2"&gt;å®‰è£ Flaskã€Jinja2 ç­‰å¥—ä»¶&lt;/h4&gt;
&lt;p&gt;Python ä½¿ç”¨ pip ç®¡ç†å®‰è£çš„å¥—ä»¶ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ pip install flask jinja2
&lt;span class="c1"&gt;# Collecting flask&lt;/span&gt;
&lt;span class="c1"&gt;# Collecting jinja2&lt;/span&gt;
&lt;span class="c1"&gt;# ... (é€£å¸¶è£äº†ç›¸é—œçš„å¥—ä»¶ï¼‰&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ™‚å€™å¦‚æžœæŸ¥çœ‹è£äº†å“ªäº›å¥—ä»¶å°±æœƒçœ‹åˆ°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ pip freeze
&lt;span class="c1"&gt;# Flask==0.10.1&lt;/span&gt;
&lt;span class="c1"&gt;# itsdangerous==0.24&lt;/span&gt;
&lt;span class="c1"&gt;# Jinja2==2.8&lt;/span&gt;
&lt;span class="c1"&gt;# MarkupSafe==0.23&lt;/span&gt;
&lt;span class="c1"&gt;# Werkzeug==0.10.4&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç‚ºäº†æ–¹ä¾¿ä¹‹å¾ŒæŠŠç’°å¢ƒå®‰è£åœ¨åˆ¥çš„é›»è…¦ä¸Šï¼Œè¨˜å¾—ç”¨&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip freeze &amp;gt; requirements.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŠŠå¥—ä»¶ç‰ˆæœ¬çš„è³‡è¨Šéƒ½å­˜åœ¨ä¸€å€‹æª”æ¡ˆè£¡çš„å¥½è™•æ˜¯ï¼Œä¸‹æ¬¡æŠŠè¦ç’°å¢ƒæž¶èµ·ä¾†å°±åªè¦&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install -r requirements.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å°±è¨­å®šå®Œæˆäº†ã€‚&lt;/p&gt;
&lt;h4 id="sqlite-database"&gt;SQLite Database&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘å…ˆæŠŠ SQLite æ¯å€‹è³‡æ–™è¡¨è¨­å®šå¥½ï¼Œé€™æ¨£ä¹‹å¾Œåœ¨å¯«ç¨‹å¼å°±åªè¦å°ˆå¿ƒè®€å¯«è³‡æ–™å°±å¥½äº†ã€‚æ ¹æ“šå‰é¢å»ºçš„æ¨¡åž‹ï¼Œæˆ‘å€‘å¯ä»¥è½‰æ›æˆ SQL èªžæ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- create_db.sql&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt; &lt;span class="k"&gt;PRIMARY&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt; &lt;span class="k"&gt;ASC&lt;/span&gt; &lt;span class="n"&gt;AUTOINCREMENT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;draw_histories&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;memberid&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="n"&gt;DATETIME&lt;/span&gt; &lt;span class="k"&gt;DEFAULT&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;now&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;localtime&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
    &lt;span class="k"&gt;FOREIGN&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;REFERENCES&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŠŠé€™ä¸² SQL å¯«åˆ°ä¸€å€‹æª”æ¡ˆ &lt;code&gt;create_db.sql&lt;/code&gt; å¾Œå°±å¯ä»¥å¯¦éš›æ¸¬è©¦ä¸€ä¸‹ã€‚æˆ‘å€‘æŠŠå…©å€‹æˆå“¡å¯«åˆ°æª”æ¡ˆè£¡é¢ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sqlite3 -init create_db.sql test.db
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;-- Loading resources from create_db.sql&lt;/span&gt;

&lt;span class="go"&gt;SQLite version 3.8.11.1 2015-07-29 20:00:57&lt;/span&gt;
&lt;span class="go"&gt;Enter &amp;quot;.help&amp;quot; for usage hints.&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Î¼&amp;#39;&amp;#39;s&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;å¹³æ²¢ å”¯&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="k"&gt;on&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;id|name|group_name&lt;/span&gt;
&lt;span class="go"&gt;1|é«˜å‚ ç©‚ä¹ƒæžœ|Î¼&amp;#39;s&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;sqlite3 -init xxx.sql&lt;/code&gt; æ„æ€æ˜¯æŠŠ &lt;code&gt;xxx.sql&lt;/code&gt; è£¡é¢çš„ SQL æŒ‡ä»¤éƒ½åŸ·è¡Œäº†ä¸€éï¼Œæ‰€ä»¥ä¸€é€²åˆ° SQLite shell è£¡é¢å°±å»ºç«‹å¥½è¡¨æ ¼äº†ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æˆ‘å€‘æ¨¡æ“¬å¹¾æ¬¡æŠ½ç±¤çš„éŽç¨‹ã€‚æ³¨æ„åˆ°æˆ‘å€‘ä¹‹å‰æœ‰å¯« &lt;strong&gt;draw_histories&lt;/strong&gt;.time çš„é è¨­å€¼ï¼Œæ‰€ä»¥æŠ½ç±¤åªè¦å¯«æ˜¯èª°å°±å¯ä»¥äº†ï¼Œæ™‚é–“ SQLite æœƒè‡ªå‹•æ ¹æ“šæŒ‡ä»¤åŸ·è¡Œçš„æ™‚é–“çµ¦å€¼ã€‚ä¸éŽæˆ‘å€‘éƒ½è©¦ä¸€ä¸‹å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;draw_histories&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;draw_histories&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-09-25 16:30&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ‰€ä»¥ç¬¬ä¸€æ¬¡ INSERT æŒ‡ä»¤æŠ½äº†æžœæžœä»¥åŠå°å”¯å„ä¸€æ¬¡ã€‚ç¬¬äºŒæ¬¡ INSERT å†æŠ½äº†ä¸€æ¬¡å°å”¯ï¼Œé€™æ¬¡é‚„æœ‰é¡å¤–æŒ‡å®šæ™‚é–“ç‚ºçš„ 9 æœˆ 25 è™Ÿä¸‹åˆ 4 é»žåŠã€‚é—œæ–¼ SQLite è£¡ &lt;code&gt;datetime&lt;/code&gt; çš„æ›´å¤šä½¿ç”¨æ–¹å¼å¯ä»¥åƒè€ƒ&lt;a href="https://sqlite.org/lang_datefunc.html"&gt;å®˜ç¶²èªªæ˜Žæ–‡ä»¶&lt;/a&gt;ï¼Œæˆ‘å€‘çš„ä¾‹å­åªè¦é€™æ¨£å°±è¶³å¤ äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;memberid|time&lt;/span&gt;
&lt;span class="go"&gt;1|2015-09-28 16:55:03&lt;/span&gt;
&lt;span class="go"&gt;2|2015-09-28 16:55:03&lt;/span&gt;
&lt;span class="go"&gt;2|2015-09-25 16:30:00&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å‰å…©å€‹å°±æ˜¯ç¬¬ä¸€æ¬¡ INSERT æ‰€å»ºç«‹çš„æŠ½ç±¤æ­·å²ï¼Œè·Ÿä½ ä¸‹æŒ‡ä»¤çš„æ™‚é–“æœ‰é—œã€‚ç¬¬äºŒæ¬¡ INSERT æœ‰çµ¦å®šæ™‚é–“ï¼Œæ‰€ä»¥è¨˜éŒ„æ°¸é æ˜¯ 9 æœˆ 25 è™Ÿä¸‹åˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;draw_histories&lt;/strong&gt; åªå„²å­˜äº† member_idï¼Œæˆ‘å€‘å¯ä»¥åšä¸€å€‹æ¯”è¼ƒè¤‡é›œçš„æŸ¥è©¢ï¼ŒæŠŠæˆå“¡çš„åå­—è·Ÿæ‰€å±¬åœ˜é«”ä¸€èµ·åˆ—å‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;draw_time&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;draw_histories&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="k"&gt;ASC&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;id|name|group_name|draw_time&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!|2015-09-25 16:30:00&lt;/span&gt;
&lt;span class="go"&gt;1|é«˜å‚ ç©‚ä¹ƒæžœ|Î¼&amp;#39;s|2015-09-28 16:55:03&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!|2015-09-28 16:55:03&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="csv"&gt;æŠŠ CSV å¯«é€²è³‡æ–™åº«&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å°±æŠŠä¹‹å¾Œè¦ç”¨çš„è³‡æ–™åº«å–åç‚º &lt;code&gt;members.db&lt;/code&gt;ã€‚æˆ‘å€‘å…ˆæŠŠåˆå§‹çš„è³‡æ–™å¯«é€²è³‡æ–™åº«è£¡ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šåªæœ‰å¤šä¸€å€‹åœ¨ Python è£¡æ“ä½œ SQLite çš„æ­¥é©Ÿã€‚é€éŽ Python å…§å»ºçš„ &lt;a href="https://docs.python.org/3.5/library/sqlite3.html"&gt;sqlite&lt;/a&gt; module å°±å¯ä»¥æŽ§åˆ¶è³‡æ–™åº«å­˜å–ã€‚å…ˆç¢ºå®šæœ‰é€™äº›æª”æ¡ˆäº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;members.csv&lt;/code&gt;: æ‰€æœ‰æˆå“¡è³‡æ–™&lt;/li&gt;
&lt;li&gt;&lt;code&gt;create_db.sql&lt;/code&gt;: è³‡æ–™åº« schema&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…ˆ import ç”¨åˆ°çš„ module&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŠŠæˆå“¡è³‡æ–™å¾ž CSV è®€é€²ä¾†ï¼Œè·Ÿä¹‹å‰ä¸€æ¨£ï¼Œåªæ˜¯æˆ‘å€‘ç¨å¾®æ•´ç†ä¸€ä¸‹æ ¼å¼ï¼Œå­˜åœ¨ &lt;code&gt;members&lt;/code&gt; é€™å€‹è®Šæ•¸ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./members.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;csv_reader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;csv_reader&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;
&lt;span class="go"&gt;[(&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;çµ¢ç€¬ çµµé‡Œ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;å— ã“ã¨ã‚Š&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;åœ’ç”° æµ·æœª&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; # ...&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;ä¸­é‡Ž æ¢“&amp;#39;, &amp;#39;K-ON!&amp;#39;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æŽ¥è‘—æ˜¯æ–°çš„éƒ¨ä»½ï¼Œè¦å…ˆç”¨ &lt;code&gt;sqlite3.connect()&lt;/code&gt; å»ºç«‹ SQLite database é€£ç·šï¼Œç„¶å¾Œå†ç”¨é€™å€‹é€£ç·šåŽ»ä¸‹ SQL æŒ‡ä»¤ã€‚é¦–å…ˆè¦æŠŠ table éƒ½å»ºç«‹å‡ºä¾†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;create_db.sql&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;create_db_sql&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;members.db&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executescript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;create_db_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;db.executescript('...')&lt;/code&gt; å¯ä»¥åŸ·è¡Œä¸€ç³»åˆ—çš„ SQL æŒ‡ä»¤ï¼ˆæ³¨æ„æŒ‡ä»¤é–“è¦æœ‰åˆ†è™Ÿï¼‰ã€‚å¦å¤–ä½¿ç”¨ &lt;code&gt;with db: ...&lt;/code&gt; ä½œç”¨æ˜¯æœƒ sqlite3 module æœƒè‡ªå‹•å¹«æˆ‘å€‘æŠŠä¸­é–“çš„ SQL æŒ‡ä»¤é€å‡º&lt;sup id="fnref-sqlite3 auto commit"&gt;&lt;a class="footnote-ref" href="#fn-sqlite3 auto commit"&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œç­‰åŒæ–¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executescript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;create_db_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†ä¾†æŠŠè®€é€²ä¾†çš„ &lt;code&gt;members&lt;/code&gt; è®Šæ•¸å¯«åˆ°è³‡æ–™è¡¨è£¡é¢ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executemany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="s1"&gt;&amp;#39;INSERT INTO  members (name, group_name) VALUES (?, ?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="n"&gt;members&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è©¦è‘—æŠŠè³‡æ–™è®€å‡ºä¾†ï¼Œç¢ºå®šçœŸçš„å­˜é€²åŽ»äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SELECT * FROM members LIMIT 3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;(1, &amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;)&lt;/span&gt;
&lt;span class="go"&gt;(2, &amp;#39;çµ¢ç€¬ çµµé‡Œ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;)&lt;/span&gt;
&lt;span class="go"&gt;(3, &amp;#39;å— ã“ã¨ã‚Š&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åˆ°äº†é€™é‚Šæˆ‘å€‘è³‡æ–™çš„éƒ¨ä»½æ²’å•é¡Œäº†ï¼ŒæŽ¥ä¸‹ä¾†å°±è¦è™•ç†ç¶²ç«™æµç¨‹æœ¬èº«ã€‚&lt;/p&gt;
&lt;h3 id="flask"&gt;Flask åŸºæœ¬æž¶æ§‹&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; çš„ web server å¯ä»¥æŠŠæ‰€æœ‰åŠŸèƒ½éƒ½å¯«åœ¨ä¸€å€‹æª”æ¡ˆï¼Œåœ¨é€™é‚Šå°±ä»¥ &lt;code&gt;draw_member.py&lt;/code&gt; ç‚ºä¾‹å­ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;
&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„ Flask server æž¶æ§‹ã€‚å…ˆä¾†æ¸¬è©¦çœ‹çœ‹ï¼Œéƒ½å·²ç¶“ç­‰å¾…ä¸€åƒå…­ç™¾å¤šå­—äº†ã€‚å…ˆæŠŠ server è·‘èµ·ä¾†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ python draw_member.py
 * Running on http://127.0.0.1:5000/ &lt;span class="o"&gt;(&lt;/span&gt;Press CTRL+C to quit&lt;span class="o"&gt;)&lt;/span&gt;
 * Restarting with stat
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å†ä¾†å¯ä»¥é–‹ç€è¦½å™¨è¨ªå• &lt;a href="http://localhost:5000/"&gt;http://localhost:5000/&lt;/a&gt;ï¼Œæˆ–è€…ç”¨ command line ä¾†è¨ªå•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ curl &lt;span class="s1"&gt;&amp;#39;http://localhost:5000/&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# &amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æœƒçœ‹åˆ° server å›žå‚³ã€ŒHello World!ã€ã€‚å¤ªæ„Ÿå‹•äº†ï¼åº•ä¸‹å…ˆèªªæ˜Žæ•´å€‹æµç¨‹èˆ‡ code çš„é—œä¿‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;app&lt;/code&gt; æ˜¯æ•´å€‹ Flask application çš„æ ¸å¿ƒç‰©ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æœ€å¾Œæˆ‘å€‘æœƒå‘¼å«å®ƒçš„ &lt;code&gt;.run()&lt;/code&gt; ä¾†ç”¢ç”Ÿä¸€å€‹å¯ä»¥å‹•çš„ web serverã€‚&lt;code&gt;debug=True&lt;/code&gt; è¡¨ç¤ºå¦‚æžœ server æœ‰éŒ¯èª¤çš„æ™‚å€™ Flask æœƒæä¾›æˆ‘å€‘å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯ï¼ŒåŒ…å«éŒ¯èª¤æ˜¯åœ¨å“ªå€‹ Python function è£¡ç”¢ç”Ÿçš„ï¼ŒéŒ¯èª¤æ™‚å„å€‹è®Šæ•¸çš„å€¼ç­‰ç­‰ã€‚å› ç‚ºé€™æ¨£æœƒä¹Ÿæœƒè®“æœ‰å¿ƒäººå£«çŸ¥é“ç¶²ç«™æ˜¯æ€Žéº¼é‹è¡Œçš„ï¼Œè®Šæ­£å¼ç¶²ç«™ï¼ˆä¸Š productionï¼‰æ™‚æœƒæŠŠé€™å€‹é¸é …é—œæŽ‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å®šç¾©äº†ä¸€å€‹ &lt;code&gt;index&lt;/code&gt; function ä¸¦ä¸”ç”¨ decorator æŠŠé€™å€‹å‡½å¼ç¶å®šåœ¨ &lt;code&gt;/&lt;/code&gt; è·¯å¾‘ä¹Ÿå°±æ˜¯é¦–é ä¸Šã€‚ä½¿ç”¨è€…è¨ªå• &lt;code&gt;/&lt;/code&gt; å°±æœƒè·‘åˆ°é€™å€‹ function è£¡ä¾†ã€‚&lt;/p&gt;
&lt;h3 id="flask-sqlite"&gt;Flask èˆ‡ SQLite è³‡æ–™åº«è®€å–&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å…ˆæŠŠè³‡æ–™åº«ç›¸é—œçš„å‡½å¼éƒ½å…ˆå¯«å¥½ï¼Œé€™é‚ŠåŸºæœ¬ä¸Šåƒç…§ &lt;a href="http://flask.pocoo.org/docs/0.10/patterns/sqlite3/#using-sqlite-3-with-flask"&gt;Flask å®˜ç¶² SQLite ä½¿ç”¨æ–¹å¼&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;

&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;SQLITE_DB_PATH&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;members.db&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;SQLITE_DB_SCHEMA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;create_db.sql&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;MEMBER_CSV_PATH&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;members.csv&amp;#39;&lt;/span&gt;


&lt;span class="c1"&gt;# SQLite3-related operations&lt;/span&gt;
&lt;span class="c1"&gt;# See SQLite3 usage pattern from Flask official doc&lt;/span&gt;
&lt;span class="c1"&gt;# http://flask.pocoo.org/docs/0.10/patterns/sqlite3/&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;getattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;_database&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_database&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SQLITE_DB_PATH&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c1"&gt;# Enable foreign key check&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PRAGMA foreign_keys = ON&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;teardown_appcontext&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;close_connection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exception&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;getattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;_database&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸€ä¸‹å­å¤šäº†å¾ˆå¤š codeï¼Œå¦‚æžœå¤ªè¤‡é›œå¯ä»¥å…ˆç•¶ä½œå°±æ˜¯é€™æ¨£å§ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦äº†è§£çš„éƒ¨ä»½ï¼Œç¬¬ä¸€æ˜¯ &lt;code&gt;g&lt;/code&gt; é€™å€‹è®Šæ•¸è£¡å¯ä»¥æ”¾å¾ˆå¤šéœ€è¦å‚³ä¾†å‚³åŽ»çš„è®Šæ•¸ï¼Œæ‰€ä»¥å°±æŠŠå»ºç«‹å¥½çš„è³‡æ–™åº«é€£ç·šæ”¾åœ¨ &lt;code&gt;g._database&lt;/code&gt;ã€‚å¹³å¸¸å¦‚æžœè¦ç”¨é€™å€‹é€£ç·šçš„è©±ï¼Œå°±ç”¨ &lt;code&gt;db = get_db()&lt;/code&gt; åŽ»æ‹¿ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒæ˜¯æˆ‘å€‘æŠŠè³‡æ–™çš„è·¯å¾‘ç­‰ç­‰ï¼Œéƒ½å¯«æˆè®Šæ•¸æ”¾åœ¨ç¨‹å¼ç¢¼çš„æœ€é–‹é ­ã€‚é€™æ˜¯å€‹å¥½ç¿’æ…£ï¼ŒæŠŠå¸¸æ•¸è·Ÿç¨‹å¼åˆ†é–‹ä¾†ï¼Œç®¡ç†æ‰æ–¹ä¾¿&lt;sup id="fnref-flask-config"&gt;&lt;a class="footnote-ref" href="#fn-flask-config"&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;h3 id="first-view-first-template"&gt;First view, first template&lt;/h3&gt;
&lt;p&gt;å…ˆä¾†åšé¦–é ï¼ŒæŠŠ HTML æ”¾åœ¨ &lt;code&gt;templates/index.html&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;width=device-width&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æˆå“¡æŠ½ç±¤&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åŠŸèƒ½åˆ—&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¦–é ï¼ˆæŠ½ç±¤ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æ­·å²è¨˜éŒ„&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æ¸…é™¤è¨˜éŒ„ã€æ›´æ–°æˆå“¡è³‡æ–™&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™åªæ˜¯å€‹å–®ç´”çš„é¦–é ï¼Œæœ‰å€‹æ¨™é¡Œï¼Œé‚„æœ‰å€‹åŠŸèƒ½åˆ—ï¼Œä½†æš«æ™‚éƒ½æ²’æœ‰åŠŸèƒ½ã€‚æˆ‘å€‘ä¿®æ”¹ä¸€ä¸‹ &lt;code&gt;draw_member.py&lt;/code&gt; è£¡å®šç¾©çš„ index è®“ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;

&lt;span class="nd"&gt;@app.route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;index.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é¦¬ä¸Šä¾†åŸ·è¡Œçœ‹çœ‹ï¼Œç”¨ä¸€æ¨£çš„æ–¹å¼ã€‚ä¸éŽä¹‹å‰åŸ·è¡Œçš„é‚£å€‹å¯èƒ½æ²’æœ‰çµæŸï¼Œè¨˜å¾—ä¸€å€‹ port åªèƒ½æœ‰ä¸€å€‹æœå‹™ï¼Œæ‰€ä»¥è¦ä¸æ˜¯ç”¨èˆŠçš„ï¼ˆFlask å¾ˆè°æ˜Žï¼Œåœ¨ &lt;code&gt;debug=True&lt;/code&gt; æ™‚çŸ¥é“æª”æ¡ˆè¢«æ›´æ–°æ™‚å°±æœƒç”¨æ–°çš„ï¼‰ï¼Œè¦ä¸æ˜¯å°±é—œæŽ‰å†é‡é–‹ä¸€å€‹æ–°çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‰“é–‹ç€è¦½å™¨è¨ªå• &lt;a href="http://localhost:5000"&gt;http://localhost:5000&lt;/a&gt; æ‡‰è©²æœƒå‡ºç¾åº•ä¸‹çš„ç•«é¢ã€‚&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_helloworld.png"/&gt;
  &lt;p class="caption"&gt;Flask Hello World&lt;/p&gt;
&lt;/div&gt;

&lt;h3 id="_4"&gt;æŠ½ç±¤åŠŸèƒ½&lt;/h3&gt;
&lt;p&gt;æŽ¥ä¸‹ä¾†è¦å¯¦ä½œæŠ½ç±¤çš„åŠŸèƒ½å•¦ï¼Œç…§å‰é¢èªªçš„ï¼Œæˆ‘å€‘åœ¨é¦–é æœƒè¨­ä¸€å€‹åœ˜é«”åˆ—è¡¨ï¼Œä½¿ç”¨è€…å°±æœƒé¸æ“‡æŸå€‹åœ˜é«”åŽ»æŠ½ç±¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¯¦ä½œä¹‹å‰è¦ä¾†èƒŒæ™¯ä»‹ç´¹ä¸€ä¸‹ï¼Œè¦å…ˆè¬›ä¸€ä¸‹ GET èˆ‡ POST çš„å·®ç•°ã€‚&lt;/p&gt;
&lt;h4 id="get-vs-post"&gt;GET vs POST&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨è€…å¹³å¸¸åœ¨è¨ªå•ç¶²ç«™æ™‚ï¼Œè©²äººè¼¸å…¥ä¸€å€‹ç¶²ç«™ã€é»žä¸€å€‹è¶…é€£å€ï¼Œé€™æ™‚å€™ç€è¦½å™¨æœƒç™¼é€ä¸€å€‹ GET request åˆ°å°æ‡‰çš„ server ä»¥åŠè·¯å¾‘ã€‚ç€è¦½å™¨ï¼ˆé€šå¸¸ï¼‰å°±æœƒå›žå‚³ä¸€å€‹å°æ‡‰çš„ HTML æª”æ¡ˆï¼Œç€è¦½å™¨å°±æœƒè² è²¬æŠŠå®ƒé¡¯ç¤ºåœ¨ç•«é¢ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä½†ç•¶ä½¿ç”¨è€…è·Ÿç¶²ç«™æœ‰æ›´å¤šäº’å‹•çš„æ™‚å€™ï¼Œå¸¸å¸¸æ˜¯è¦æŠŠä½¿ç”¨è€…çš„è³‡è¨Šé€çµ¦ç¶²ç«™æ™‚ï¼Œåƒå¸³è™Ÿç™»å…¥ã€å¡«å•å·è¡¨å–®ï¼Œæˆ–è€…åœ¨é€™é‚Šçš„é¸æ“‡æŸå€‹åœ˜é«”åŽ»æŠ½ç±¤ï¼Œé€™æ™‚å€™å°±æœƒé€éŽ POSTã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šçš„ GET/POST ä»¥åŠå…¶ä»–çš„ HTTP requestï¼Œå¯ä»¥åƒè€ƒ&lt;a href="https://archer1609wp.wordpress.com/2014/03/02/httppost%E8%88%87get/"&gt;ä¸€é å¼ä»‹ç´¹ï¼ˆä¸­ï¼‰&lt;/a&gt;æˆ–&lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTTP"&gt;éžå¸¸å®Œæ•´çš„ä»‹ç´¹åœ¨ Mozilla Developer Network (MDN)ï¼ˆè‹±ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="form"&gt;Form&lt;/h4&gt;
&lt;p&gt;æœ€å¸¸è¦‹çš„ POST å°±æ˜¯æ­é…&lt;a href="https://developer.mozilla.org/en/docs/Web/HTML/Element/form"&gt;è¡¨å–® (form)&lt;/a&gt; ä½¿ç”¨ã€‚åƒç™»å…¥è¦å¡«å¸³è™Ÿå¯†ç¢¼ã€å•å·å•é¡Œèˆ‡å›žç­”ï¼Œå°±å¾ˆå¸¸ç”¨ form å¯¦ä½œã€‚Form è£¡é¢æœ‰å¾ˆå¤šç¨® inputï¼Œä»£è¡¨ä½¿ç”¨è€…èƒ½å¡«çš„æ¬„ä½ï¼Œé¡žåž‹å¯èƒ½æ˜¯å–®é¸ã€è¤‡é¸ã€å–®è¡Œã€å¤šè¡Œã€å¯†æ–‡ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å°±å…ˆçœ‹ä¸€ä¸‹ form å¯¦éš›çš„é•·ç›¸å§ã€‚æ”¹å¯« &lt;code&gt;templates/index.html&lt;/code&gt;ï¼ŒåŠ ä¸Šä¸€å€‹æŠ½ç±¤é¸åœ˜é«”çš„ formã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="nt"&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;&lt;span class="c"&gt;&amp;lt;!-- æœ¬ä¾†æœ‰çš„ --&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;p&amp;gt;&lt;/span&gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&lt;span class="nt"&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;form&lt;/span&gt; &lt;span class="na"&gt;action=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/draw&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;label&lt;/span&gt; &lt;span class="na"&gt;for=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;åœ˜éšŠåç¨±ï¼š&lt;span class="nt"&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;Î¼&amp;#39;s
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;K-ON!&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;K-ON!
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ALL&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;checked&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;ï¼ˆå…¨ï¼‰
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;hr&amp;gt;&lt;/span&gt;&lt;span class="c"&gt;&amp;lt;!-- é€™æ˜¯åˆ†éš”ç·š --&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åŸºæœ¬ä¸ŠåŠ åœ¨ body è£¡é¢å°±å¯ä»¥ã€‚é€™å€‹ form åŒ…å«äº†ä¸€å€‹æ¨™ç±¤ï¼ŒæŒ‡å®šæ˜¯çµ¦åç‚º &lt;code&gt;group_name&lt;/code&gt; çš„ inputã€‚åº•ä¸‹æŽ¥å››å€‹ input tags ä½†å¯¦éš›ä¸Šåªæœ‰å…©å¤§å€‹ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€å¤§å€‹æ˜¯åœ˜é«”çš„å–®é¸é¸é …å…±ä¸‰å€‹ inputï¼Œæ³¨æ„åˆ°ä»–å€‘çš„ &lt;code&gt;name&lt;/code&gt; éƒ½æ˜¯ &lt;code&gt;group_name&lt;/code&gt; ä½† &lt;code&gt;value&lt;/code&gt; ä¸åŒï¼Œå¾Œé¢æŽ¥è‘—ä»–å€‘é¡¯ç¤ºçš„å­—ã€‚å…¶ä¸­ã€Œï¼ˆå…¨ï¼‰ã€å®ƒå¤šäº†ä¸€å€‹ &lt;code&gt;checked&lt;/code&gt; è¡¨ç¤ºé è¨­é¸æ“‡é€™å€‹é¸é …ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€å¤§å€‹æ˜¯ &lt;code&gt;type=submit&lt;/code&gt; çš„ inputï¼Œä»–å°±æ˜¯é€å‡ºçš„è¡¨å–®çš„æŒ‰éˆ•ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æ³¨æ„ form tag æœ¬èº«ã€‚&lt;code&gt;method="post"&lt;/code&gt; æ‡‰è©²å¾ˆå¥½ç†è§£ï¼Œè¡¨ç¤ºè¦é€å‡º POST requestï¼›&lt;code&gt;action="/draw"&lt;/code&gt; è¡¨ç¤ºé€™å€‹ POST è¦ç™¼åˆ° &lt;code&gt;/draw&lt;/code&gt; é€™å€‹è·¯å¾‘ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ¨£ï¼Œform åº•ä¸‹ä¹Ÿå¾ˆå¤šç´°ç¯€ï¼Œæ­¡è¿Žå†åŽ» &lt;a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms"&gt;MDN&lt;/a&gt; äº†è§£ã€‚&lt;/p&gt;
&lt;h4 id="request-form-post-handling-in-flask"&gt;Request (Form / POST) handling in Flask&lt;/h4&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘å€‘é¦¬ä¸Šä¾†å¯«è™•ç† &lt;code&gt;/draw&lt;/code&gt; POST çš„ view å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/draw&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# Get the database connection&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="c1"&gt;# Draw member ids from given group&lt;/span&gt;
    &lt;span class="c1"&gt;# If ALL is given then draw from all members&lt;/span&gt;
    &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;valid_members_sql&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;SELECT id FROM members &amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;cursor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;valid_members_sql&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;WHERE group_name = ?&amp;#39;&lt;/span&gt;
        &lt;span class="n"&gt;cursor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members_sql&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;valid_member_ids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;cursor&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="c1"&gt;# If no valid members return 404 (unlikely)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;valid_member_ids&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;err_msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;No members in group &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;err_msg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;

    &lt;span class="c1"&gt;# Randomly choice a member&lt;/span&gt;
    &lt;span class="n"&gt;lucky_member_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_member_ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# Obtain the lucy member&amp;#39;s information&lt;/span&gt;
    &lt;span class="n"&gt;member_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;member_group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;SELECT name, group_name FROM members WHERE id = ?&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lucky_member_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchone&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;p&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;ï¼ˆåœ˜é«”ï¼š&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;ï¼‰&amp;lt;/p&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;member_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;member_group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Flask æœƒæŠŠä½¿ç”¨è€…ç™¼çµ¦ server çš„ request å­˜åœ¨ &lt;code&gt;request&lt;/code&gt; è£¡é¢ï¼Œå…¶å¯¦ä½¿ç”¨è€…æœƒå‚³è »å¤šè³‡è¨Šçš„ï¼Œåƒè©²äººçš„èªžè¨€ã€ç”¨çš„ç€è¦½å™¨ã€æ™‚é–“ç­‰ç­‰ï¼Œé€™äº›éƒ½èƒ½åœ¨ &lt;code&gt;request&lt;/code&gt; æ‰¾åˆ°ã€‚è€Œä½¿ç”¨è€…å¡«å¥½çš„ form çš„å…§å®¹æœƒå­˜åœ¨ç•¶ä¸­ &lt;code&gt;request.form&lt;/code&gt; è£¡ï¼Œè€Œæˆ‘å€‘å…ˆå‰å®šç¾©åœ¨ form ä¸­ input name å°±æœƒè®Šæˆé€™é‚Šçš„ dict keyã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤å¦‚æžœè¦æ‹¿ä½¿ç”¨è€…æ±ºå®šçš„ &lt;code&gt;group_name&lt;/code&gt; æ™‚ï¼Œå°±æœƒå¯«æˆ &lt;code&gt;request.form.get('group_name', 'ALL')&lt;/code&gt;ã€‚é€™ç›¸ç•¶æ–¼ &lt;code&gt;request.form['group_name']&lt;/code&gt; ä½†åœ¨æ²’æœ‰é€™å€‹ key æ™‚å›žå‚³é è¨­å€¼ &lt;code&gt;'ALL'&lt;/code&gt;ã€‚æ­£å¸¸ä½¿ç”¨ä¸¦ä¸æœƒæ‰¾ä¸åˆ°é€™å€‹ keyï¼Œä½†ç¶²ç«™é–‹ç™¼è€…æ°¸é ä¸è¦ç›¸ä¿¡ä½¿ç”¨è€…æœƒä¹–ä¹–å›žå‚³é€™äº›å…§å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‹¿äº†åœ˜é«”åç¨±ä¹‹å¾Œï¼Œå°±ç”¨åœ˜é«”åç¨±åŽ»ä¸‹æŸ¥è©¢çš„ SQLã€‚åŒç†é€™åç¨±å¯èƒ½æ²’æœ‰çµæžœï¼Œé€™æ™‚å°±å›žå‚³ä¸€å€‹ HTTP status code ç‚º 404 çš„éŒ¯èª¤è¨Šæ¯ã€‚ä¸€èˆ¬æƒ…æ³ 4XX éƒ½ä»£è¡¨ä½¿ç”¨è€…çµ¦çš„è³‡æ–™æœ‰å•é¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‹¿åˆ°äº†æ‰€æœ‰æˆå“¡çš„ id å¾Œï¼Œç”¨äº†å€‹ &lt;code&gt;random.choice&lt;/code&gt; éš¨æ©ŸæŠ½ä¸€å€‹å‡ºä¾†ã€‚å¦‚åŒå­—é¢ä¸Šçš„æ„æ€ï¼Œ&lt;a href="https://docs.python.org/3.5/library/random.html#random.choice"&gt;random&lt;/a&gt; æ˜¯å€‹ Python å…§å»ºçš„ moduleã€‚å†æŠŠé€™å€‹ id æ‹¿åŽ»æŸ¥åå­—èˆ‡åœ˜é«”ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ç¸½å…±åšäº†å…©å€‹è³‡æ–™åº«æŸ¥è©¢ï¼Œç¬¬ä¸€æ¬¡æŠŠå¯èƒ½çš„ member id éƒ½å‚³å›žä¾†ï¼Œç¬¬äºŒæ¬¡æŠŠæŠ½ä¸­çš„äººçš„åå­—ã€åœ˜é«”éƒ½æ‹¿å›žä¾†ã€‚æš«æ™‚é‚„æ²’åšå¯«åˆ°æ­·å²çš„åŠŸèƒ½ï¼Œä½†é‚£å€‹ä¹Ÿä¸é›£ï¼Œä¹‹å¾Œå†èªªã€‚å…ˆä¸åš templateï¼ŒæŠŠçµæžœåŒ…åœ¨ HTML æœ€åŸºæœ¬çš„ &lt;code&gt;&amp;lt;p&amp;gt;&lt;/code&gt; å…ƒç´ å°±å‚³å›žä¾†ã€‚&lt;/p&gt;
&lt;h4 id="demo"&gt;Demo&lt;/h4&gt;
&lt;p&gt;é‡æ–°æ•´ç†é¦–é ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€å€‹è¡¨å–®ï¼ˆå»¢è©±ï¼‰ã€‚Flask çš„ web server å¾ˆè°æ˜Žï¼Œä¸ç”¨é‡æ–°å•Ÿå‹•å®ƒï¼Œæœƒè‡ªå‹•çœ‹åˆ°æª”æ¡ˆæœ‰æ›´æ–°åš reloadã€‚å¯ä»¥å›žåŽ»æ¯”å°ä¸€ä¸‹è‡ªå·±å¯«åœ¨ &lt;code&gt;index.html&lt;/code&gt; è£¡ HTML åœ¨ç€è¦½å™¨ä¸Šå‘ˆç¾çš„å°æ‡‰é—œä¿‚ã€‚&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_index_form.png"/&gt;
  &lt;p class="caption"&gt;æ–°çš„é¦–é ï¼Œå¤šäº†ä¸€å€‹è¡¨å–®&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;æŒ‰ä¸‹ Submit ä¹‹å¾Œå°±æœƒè·³åˆ°æŠ½ç±¤çµæžœï¼ˆæ³¨æ„ URL çš„è®ŠåŒ–ï¼‰&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_draw_result.png"/&gt;
  &lt;p class="caption"&gt;æŠ½ç±¤çµæžœ&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;é è¨ˆæ˜¯æŠ½å…¨éƒ¨ï¼Œä½ ä¹Ÿå¯ä»¥å›žåˆ°ä¸Šä¸€é ï¼Œé¸è‡ªå·±æƒ³è¦çš„åœ˜é«”ã€‚&lt;/p&gt;
&lt;p&gt;æœ€é‡è¦çš„åŠŸèƒ½å°±å®Œæˆå•¦ï¼å¦‚æžœè‡ªå·±ç¨‹å¼é‡åˆ°ä¸€äº›ç‹€æ³çš„è©±ï¼Œå¯ä»¥çœ‹&lt;a href="https://github.com/ccwang002/draw_member/blob/169d81650d8ca649c5484c43c05324885e7cb7fb/draw_member.py"&gt;æˆ‘å¯«çš„å®Œæ•´ç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="more-on-templates"&gt;More on templates&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰æˆ‘å€‘ &lt;code&gt;render_template&lt;/code&gt; å…¶å¯¦éƒ½æ˜¯å‚³ä¸€å€‹å®Œæ•´çš„ HTML å…§å®¹çµ¦å®ƒï¼Œä¸¦æ²’æœ‰ç”¨åˆ° template åŠŸèƒ½ã€‚Template æœ‰å¹¾å€‹ç”¨è™•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›†ä¸­é‡è¦†ç”¨åˆ°çš„ç‰‡æ®µã€çµæ§‹&lt;/li&gt;
&lt;li&gt;è®“ä¸€éƒ¨ä»½ HTML çš„å…§å®¹å—è®Šæ•¸æŽ§åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦¬ä¸Šä¾†æ”¹å¯«ä¸€ä¸‹å§ã€‚æˆ‘å€‘çš„åŠŸèƒ½è¡¨æ‡‰è©²æ¯ä¸€é éƒ½è¦å‡ºç¾ï¼Œå†ä¾†æˆ‘å€‘å¸Œæœ› &lt;code&gt;/draw&lt;/code&gt; çš„é é¢ä¹Ÿæ˜¯å€‹å®Œæ•´çš„ HTMLã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå…ˆæŠŠå¸¸ç”¨çš„éƒ¨ä»½ç¨ç«‹å‡ºä¾†ï¼Œåšæˆ &lt;code&gt;templates/base.html&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;&amp;lt;!-- templates/base.html --&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;meta&lt;/span&gt; &lt;span class="na"&gt;charset=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;meta&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;width=device-width&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;title&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æˆå“¡æŠ½ç±¤&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;hr&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;h3&amp;gt;&lt;/span&gt;åŠŸèƒ½åˆ—&lt;span class="nt"&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;ul&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;é¦–é ï¼ˆæŠ½ç±¤ï¼‰&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/history&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;æ­·å²è¨˜éŒ„&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;li&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/reset&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;æ¸…é™¤è¨˜éŒ„ã€æ›´æ–°æˆå“¡è³‡æ–™&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åƒåŠŸèƒ½åˆ—é€™ç¨®ä¸æœƒè®Šçš„å°±å¾ˆé©åˆæ”¾åœ¨é€™é‚Šã€‚è€Œæˆ‘å€‘çš„é¦–é å°±å¯ä»¥é‡è¦†ä½¿ç”¨é€™å€‹çµæ§‹ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;&amp;lt;!-- templates/index.html --&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;base.html&amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="nt"&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;p&amp;gt;&lt;/span&gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&lt;span class="nt"&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;form&lt;/span&gt; &lt;span class="na"&gt;action=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/draw&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;label&lt;/span&gt; &lt;span class="na"&gt;for=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;åœ˜éšŠåç¨±ï¼š&lt;span class="nt"&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;Î¼&amp;#39;s
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;K-ON!&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;K-ON!
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ALL&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;checked&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;ï¼ˆå…¨ï¼‰
  &lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥çœ‹åˆ°æœ€å¤§çš„å·®ç•°å°±æ˜¯æˆ‘å€‘çš„ &lt;code&gt;index.html&lt;/code&gt; è®Šç°¡å–®äº†ã€‚å®ƒå°±åƒç‰©ä»¶ç¹¼æ‰¿ä¸€æ¨£ï¼Œ&lt;code&gt;{% extends "base.html" %}&lt;/code&gt;ï¼Œè¡¨ç¤ºå…ˆæŠŠ &lt;code&gt;base.html&lt;/code&gt; çš„å…§å®¹æ”¾é€²ä¾†ï¼Œè€Œè£¡é¢å®šç¾©äº†å…©å€‹ blockï¼š&lt;code&gt;title&lt;/code&gt; ä»¥åŠ &lt;code&gt;content&lt;/code&gt;ã€‚Index æœ‰å®šç¾© content çš„å…§å®¹ï¼Œæ‰€ä»¥å°±å–ä»£æŽ‰åŽŸæœ¬å®šç¾©åœ¨ base è£¡ç©ºçš„ contentã€‚  Index ä¸¦æ²’æœ‰å®šç¾© titleï¼Œé‚£å°±æœƒç”¨åŽŸæœ¬ block å…§çš„å€¼ï¼Œå³ã€Œæˆå“¡æŠ½ç±¤ã€ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†è™•ç† &lt;code&gt;/draw&lt;/code&gt; çš„éƒ¨ä»½ï¼Œæˆ‘å€‘é™¤è€Œå†åˆ©ç”¨ &lt;code&gt;base.html&lt;/code&gt; ä¹‹å¤–ï¼Œé‚„è¦å¼•å…¥ template variable çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;&amp;lt;!-- templates/draw.html --&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;base.html&amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤çµæžœ&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;æŠ½ç±¤çµæžœ&lt;span class="nt"&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;p&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;ï¼ˆåœ˜é«”ï¼š&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;group&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;ï¼‰&lt;span class="nt"&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç‰¹åˆ¥çš„æ˜¯ &lt;code&gt;{{ name }}&lt;/code&gt; å’Œ &lt;code&gt;{{ group }}&lt;/code&gt;ã€‚é€™èªžæ³•è¡¨ç¤ºä»–å€‘çš„å€¼åˆ†åˆ¥å— &lt;code&gt;name&lt;/code&gt; å’Œ &lt;code&gt;group&lt;/code&gt; é€™å…©å€‹è®Šæ•¸æ±ºå®šï¼Œè®Šæ•¸çš„å€¼åœ¨ &lt;code&gt;render_template&lt;/code&gt; æ™‚æ‰æœƒæ±ºå®šã€‚è¦æ€Žéº¼æŠŠè®Šæ•¸çš„å€¼å‚³åˆ° template è£¡å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/draw&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="c1"&gt;# return &amp;#39;&amp;lt;p&amp;gt;%sï¼ˆåœ˜é«”ï¼š%sï¼‰&amp;lt;/p&amp;gt;&amp;#39; % (member_name, member_group_name)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;draw.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;member_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;member_group_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ”¹å¯«å¥½çš„ draw ä½¿ç”¨ template &lt;code&gt;templates/draw.html&lt;/code&gt;ï¼Œä¸¦åœ¨ &lt;code&gt;render_template&lt;/code&gt; æ™‚æŠŠè®Šæ•¸çš„å€¼éƒ½æ”¾é€²åŽ»ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ™‚å€™æ‰é‡æ–°æŠ½ç±¤å¯ä»¥çœ‹åˆ°æ–°çš„ template çš„è¼¸å‡ºçµæžœï¼ŒåŠŸèƒ½è¡¨ä¹Ÿå‡ºç¾äº†ã€‚&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_new_draw_result.png"/&gt;
&lt;/div&gt;

&lt;h3 id="_5"&gt;æ­·å²è¨˜éŒ„&lt;/h3&gt;
&lt;p&gt;è¨˜å¾—è¦åœ¨æŠ½ç±¤çš„æ™‚å€™æŠŠè¨˜éŒ„åŠ åˆ° database è£¡ã€‚å› ç‚ºä¹‹å‰æœ‰è¨­å¥½ schema é è¨­ç”¨ç¾åœ¨æ™‚é–“ç•¶æŠ½ç±¤æ™‚é–“ï¼Œæ‰€ä»¥æ™‚é–“çš„è™•ç†å®Œå…¨äº¤çµ¦ SQLiteã€‚ç”¨ SQL èªžæ³• &lt;code&gt;LIMIT 10&lt;/code&gt; ä»¥åŠ &lt;code&gt;ORDER BY&lt;/code&gt; é¸æ“‡æœ€è¿‘çš„åç­†ï¼ŒåŒæ™‚åœ¨æŸ¥çµæžœæ™‚ï¼Œä¹ŸåŒæ™‚æŸ¥è©¢ &lt;strong&gt;members&lt;/strong&gt; table å°æ‡‰çš„åå­—èˆ‡åœ˜é«”ã€‚é€™å€‹å°ˆæ¥­è¡“èªžå« &lt;a href="https://en.wikipedia.org/wiki/Join_%28SQL%29"&gt;JOIN&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠé€™å€‹ view æ”¾åœ¨ &lt;code&gt;/history&lt;/code&gt; è·¯å¾‘ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/draw&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="c1"&gt;# Update draw history&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;INSERT INTO draw_histories (memberid) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lucky_member_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="c1"&gt;# Render template&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;recent_histories&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;SELECT m.name, m.group_name, d.time &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;FROM draw_histories AS d, members as m &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;WHERE m.id == d.memberid &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ORDER BY d.time DESC &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;LIMIT 10&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;history.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;recent_histories&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;recent_histories&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åŒç†ä¹Ÿè¦å»ºç«‹å°æ‡‰çš„ templateã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;&amp;lt;!-- templates/history.html --&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;base.html&amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤æ­·å²&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;æŠ½ç±¤æ­·å²ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰&lt;span class="nt"&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;table&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;thead&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;tr&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;th&amp;gt;&lt;/span&gt;åå­—&lt;span class="nt"&gt;&amp;lt;/th&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;th&amp;gt;&lt;/span&gt;åœ˜é«”&lt;span class="nt"&gt;&amp;lt;/th&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;th&amp;gt;&lt;/span&gt;æŠ½ä¸­æ™‚é–“&lt;span class="nt"&gt;&amp;lt;/th&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;/thead&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;tbody&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;history&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;recent_histories&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;tr&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.0&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.1&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
      &lt;span class="nt"&gt;&amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.2&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;/tbody&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/table&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™é‚Šç”¨äº†æ–°çš„ template èªžæ³• for loopï¼Œæ¯æ¬¡ loop &lt;code&gt;history&lt;/code&gt; çš„å€¼éƒ½æœƒè®Šï¼Œè€Œä¸”é‚„å¯ä»¥å†å­˜å–å®ƒåº•ä¸‹çš„å±¬æ€§ï¼Œå¯«æˆ Python å°±åƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;recent_histories&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Flask ç”¨çš„ Jinja2 template åŠŸèƒ½å¾ˆå¤šï¼Œç¾åœ¨å„ä½å·²ç¶“æ¯”è¼ƒç†è§£ server çš„é‹ä½œäº†ï¼Œå¯ä»¥åŽ»é–±è®€ä¸€ä¸‹ &lt;a href="http://jinja.pocoo.org/docs/dev/templates/"&gt;Jinja2 å®˜ç¶²æ–‡ä»¶&lt;/a&gt;çœ‹å®Œæ•´çš„ä½¿ç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_history.png"/&gt;
&lt;/div&gt;

&lt;h4 id="datetime"&gt;æ™‚é–“è™•ç†ç”¨ datetime&lt;/h4&gt;
&lt;p&gt;å¦‚æžœæœ‰æ³¨æ„åˆ°çš„è©±ï¼Œæˆ‘å€‘ç”¨çš„æ™‚é–“å¾ž SQLite å›žå‚³å›žä¾†å…¶å¯¦æ˜¯å­—ä¸²ã€‚æƒ³è¦æ”¹å¯«æ™‚é–“æ ¼å¼æ€Žéº¼è¾¦ï¼Ÿé€™æ™‚å€™å°±è¦ç”¨ä¸Šå…§å»º module &lt;a href="https://docs.python.org/3.5/library/datetime.html#datetime-objects"&gt;datetime&lt;/a&gt; è£¡æä¾›çš„ &lt;code&gt;datetime&lt;/code&gt; ç‰©ä»¶ã€‚åŒæ™‚æˆ‘å€‘ä¹Ÿé †ä¾¿æŠŠæœ¬ä¾†ç”¨ &lt;code&gt;fetchall()&lt;/code&gt; çš„çµæžœï¼Œæ”¹æˆç”¨ dict è¡¨ç¤ºæ¯ä¸€ç­†æ­·å²ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;

&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;SELECT m.name, m.group_name, d.time AS &amp;quot;draw_time [timestamp]&amp;quot; &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;FROM draw_histories AS d, members as m &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;WHERE m.id == d.memberid &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ORDER BY d.time DESC &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;LIMIT 10&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;recent_histories&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;recent_histories&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;group&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;draw_time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strptime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;%Y-%m-&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s1"&gt; %H:%M:%S&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;history&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;recent_histories&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;tr&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.group&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.draw_time.strftime&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%Y å¹´ %m æœˆ %d æ—¥ %H æ™‚ %M åˆ†&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¯ä»¥çœ‹åˆ° for loop ä¸å†ä½¿ç”¨ 0, 1, 2 åŽ»æ‹¿æ¯ç­†æ­·å²å„æ¬„ä½çš„å€¼ï¼Œè€Œæ˜¯ç”¨æ¬„ä½åç¨±ï¼Œç›¸ç•¶æ–¼ &lt;code&gt;history['name']&lt;/code&gt;ã€‚é€™æ¨£çš„åšæ³•æ¯”è¼ƒå¥½ï¼Œå› ç‚ºç”¨æ•¸å­—ä¸€ä¸‹å°±å¿˜äº†ï¼Œéš¨ä¾¿èª¿æ•´ä¸€ä¸‹ view çš„å…§å®¹é †åºå°±ä¸ä¸€å®šæ˜¯é€™æ¨£äº†ï¼›å–®ç¨è®€ template ä¹Ÿèƒ½æ‡‚æ¯å€‹æ¬„ä½çš„æ„æ€ã€‚&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_history_zh.png"/&gt;
&lt;/div&gt;

&lt;h3 id="whats-next"&gt;What&amp;rsquo;s Next&lt;/h3&gt;
&lt;h3 id="static-files-and-better-theme"&gt;Static files and better theme&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘åªç”¨äº† HTML templateã€‚æƒ³è¦è®“ç¶²ç«™çœ‹èµ·ä¾†æ›´æ¼‚äº®ï¼Œå°±è¦å¯« CSS èˆ‡ Javascript (JS)ã€‚æœ‰åƒ Bootstrapã€PureCSSã€Semantic UI é€™é¡žçš„ã€Œframeworkã€ï¼Œå¥—ç”¨ä¹‹å¾Œèƒ½åœ¨çŸ­æ™‚é–“ç•«å‡ºç¾Žè§€å¯¦ç”¨çš„ç‰ˆé¢ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ CSSã€JSï¼Œä»¥åŠç«™ä¸Šå¤§å¤§å°çš„å…¶ä»–æª”æ¡ˆéƒ½å¿…éœ€è¦å¾ž server å‚³é€åˆ°ç”¨æˆ¶ç«¯ä¸Šï¼Œé€™é‚Šå°±æ˜¯ static files çš„è™•ç†ã€‚&lt;/p&gt;
&lt;h3 id="more-how-web-works"&gt;More how web works&lt;/h3&gt;
&lt;p&gt;é™¤äº† HTTP GETã€POST ä¹‹å¤–ï¼Œé‚„æœ‰ HTTPSã€sessionã€cookie ç­‰å¾ˆå¸¸è¦‹çš„æŠ€è¡“ã€‚&lt;/p&gt;
&lt;h3 id="object-relational-model-orm"&gt;Object Relational Model (ORM)&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘åªèˆ‰äº†ç´”å¯« SQL çš„ä¾‹å­ï¼Œä½†ç•¶å°ˆæ¡ˆè®Šè¤‡é›œçš„æ™‚å€™ï¼Œç´” SQL ç®¡ç†ä¸Šè¶Šä¾†è¶Šè¤‡é›œã€‚ORM æ˜¯ä¸€ç¨®è§£æ±ºçš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id="django"&gt;Django&lt;/h3&gt;
&lt;p&gt;ç•¶ç„¶å¯ä»¥ç¹¼çºŒæŠŠ Flask ç ”ç©¶ä¸‹åŽ»ï¼Œå®ƒä¹Ÿæ˜¯å€‹å¾ˆå¥½çš„ web frameworkã€‚ä¸éŽæˆ‘å€‘ä¸»è¦çš„ code base æ˜¯ Djangoã€‚æ‰€ä»¥å¸Œæœ›å¤§å®¶åœ¨äº†è§£ä¸€å€‹ web server (app) é•·å¾—åƒæ€Žæ¨£ä¹‹å¾Œï¼Œå°±å¯ä»¥é–‹å§‹å­¸ç¿’ Djangoã€‚Django èˆ‡ Flask æœ€å¤§çš„è¨­è¨ˆä¸åŒå°±æ˜¯ Django ä¸€é–‹å§‹å°±æä¾›äº†å¾ˆå¤šæ¨¡çµ„èˆ‡åŠŸèƒ½ï¼Œæ„Ÿè¦ºå¾ˆã€Œè‚¥ã€ï¼Œè€Œ Flask åªæä¾›äº†å¿…è¦çš„åŠŸèƒ½&lt;/p&gt;
&lt;h3 id="_6"&gt;ç¸½çµ&lt;/h3&gt;
&lt;p&gt;é€™æ¨£å°±æ˜¯ä¸€å€‹å®Œæ•´çš„æŠ½ç±¤çš„ç¶²ç«™äº†ã€‚å…¶å¯¦æž¶ç¶²ç«™çš„ä¸»è¦çŸ¥è­˜ä¹Ÿå·®ä¸å¤šæ˜¯é€™äº›ï¼Œå†ä¾†å°±æ˜¯ç´°ç¯€ä»¥åŠçŸ¥è­˜çš„åŠ å¼·ã€‚&lt;/p&gt;
&lt;p&gt;åšå¥½çš„æˆå“æˆ‘ä¹Ÿæ”¾åœ¨ &lt;a href="https://github.com/ccwang002/draw_member"&gt;Github&lt;/a&gt; ä¸Šäº†ï¼Œè£¡é¢çš„ commit log è¨˜éŒ„äº†å¹¾å€‹é‡è¦çš„æ­¥é©Ÿï¼Œæ‰€ä»¥æƒ³è¦çœ‹çœ‹æ¯ä¸€æ­¥çš„çµæžœå¯ä»¥ç”¨ &lt;code&gt;git checkout&lt;/code&gt; å›žåˆ°æ¯å€‹è¨˜éŒ„é»žï¼Œä¾‹å¦‚æƒ³è¦çœ‹æŠ½ç±¤åŠŸèƒ½å¯«å®Œï¼Œç”¨ä¸Š template çš„ç‰ˆæœ¬å°±å¯ä»¥åˆ° &lt;code&gt;git checkout f39fc1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;PS: æ²’æƒ³åˆ°æœƒå¯«é€™éº¼é•·å•Šâ€¦â€¦&lt;/p&gt;
&lt;h3 id="details"&gt;Details&lt;/h3&gt;
&lt;p&gt;åº•ä¸‹è¨˜äº†å¾ˆå¤šæŠ€è¡“ç´°ç¯€ï¼Œæœ‰èˆˆè¶£å†çœ‹å§ã€‚&lt;/p&gt;
&lt;h4 id="sqlite-table-info"&gt;SQLite table info&lt;/h4&gt;
&lt;p&gt;é™¤äº†ç”¨ &lt;code&gt;.schema&lt;/code&gt; åŽ»çœ‹æ¯å€‹ TABLE å»ºç«‹æ™‚çš„æŒ‡ä»¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨ &lt;code&gt;PRAGMA table_info&lt;/code&gt; åŽ»çœ‹æŸå€‹ table æ¯å€‹æ¬„ä½çš„è¨­å®šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;-- Run `sqlite -init create_db.sql`&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="k"&gt;on&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt; &lt;span class="k"&gt;column&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;table_info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="go"&gt;cid  name         type       notnul  dflt_value                    pk&lt;/span&gt;
&lt;span class="go"&gt;---  -----------  ---------  ------  ----------------------------  --&lt;/span&gt;
&lt;span class="go"&gt;0    id           INTEGER    0                                     1&lt;/span&gt;
&lt;span class="go"&gt;1    name         TEXT       1                                     0&lt;/span&gt;
&lt;span class="go"&gt;2    group_name   TEXT       0                                     0&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;table_info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="go"&gt;cid  name         type       notnul  dflt_value                    pk&lt;/span&gt;
&lt;span class="go"&gt;---  -----------  ---------  ------  ----------------------------  --&lt;/span&gt;
&lt;span class="go"&gt;0    memberid     INTEGER    0                                     0&lt;/span&gt;
&lt;span class="go"&gt;1    draw_time    DATETIME   0       datetime(&amp;#39;now&amp;#39;, &amp;#39;localtime&amp;#39;)  0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="sqlite-foreign-key-check"&gt;SQLite foreign key check&lt;/h4&gt;
&lt;p&gt;SQLite3 åœ¨æ¯”è¼ƒæ–°ç‰ˆæ‰æœƒåŽ»è™•ç† foreign key é™åˆ¶çš„åŠŸèƒ½ï¼Œåƒè€ƒ&lt;a href="https://www.sqlite.org/foreignkeys.html#fk_enable"&gt;å®˜ç¶²çš„èªªæ˜Ž&lt;/a&gt;ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;foreign_keys&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å¦‚æžœæ˜¯ 0 çš„è©±è¡¨ç¤º SQLite ä¸¦ä¸æœƒåŽ»æª¢æŸ¥ foreign keyã€‚é€™å¯ä»¥æ‰‹å‹•æ‰“é–‹æª¢æŸ¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;foreign_keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt; &lt;span class="n"&gt;foreign_keys&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;1&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="go"&gt;Error: FOREIGN KEY constraint failed&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="_7"&gt;é‡æ–°è®€å…¥è³‡æ–™&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘å…ˆåŒ…å¥½ä¸€å€‹ function &lt;code&gt;reset_db&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# draw_members.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;reset_db&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SQLITE_DB_SCHEMA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;create_db_sql&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="c1"&gt;# Reset database&lt;/span&gt;
    &lt;span class="c1"&gt;# Note that CREATE/DROP table are *immediately* committed&lt;/span&gt;
    &lt;span class="c1"&gt;# even inside a transaction&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DROP TABLE IF EXISTS draw_histories&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DROP TABLE IF EXISTS members&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executescript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;create_db_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# Read members CSV data&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MEMBER_CSV_PATH&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;csv_reader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;csv_reader&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="c1"&gt;# Write members into databse&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executemany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;INSERT INTO members (name, group_name) VALUES (?, ?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;members&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;reset_db()&lt;/code&gt; æœƒ DROP æŽ‰èˆŠçš„ database ï¼Œç„¶å¾Œå†ç”¨å‰›å‰›ä»‹ç´¹çš„æ–¹æ³•å†æŠŠè³‡æ–™å¾ž CSV è®€é€²ä¾†ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥é€™å€‹ function è¦æ€Žéº¼ä½¿ç”¨ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸€å€‹æ˜¯åƒä¹‹å‰ä¸€æ¨£ç¶å®šä¸€å€‹è·¯å¾‘ &lt;code&gt;@app.route('/reset')&lt;/code&gt;ï¼›å¦ä¸€å€‹æ–¹å¼æˆ‘å€‘å¯ä»¥é€éŽ python shell é”åˆ°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reset_db&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app_context&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;reset_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="datetime-in-sqlite-and-python"&gt;Datetime in SQLite and Python&lt;/h4&gt;
&lt;p&gt;é€™ç¯‡æ–‡ç« å¤ªé•·äº†ï¼Œå¯«åˆ°&lt;a href="../datetime-sqlite/#datetime-sqlite"&gt;ä¸‹ä¸€ç¯‡åŽ»&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;2016-06-14 æ›´æ–°ï¼šå¢žåŠ ä½¿ç”¨ &lt;code&gt;datetime.datetime&lt;/code&gt; çš„èªªæ˜Žé¿å…è·Ÿ module åç¨±æ··æ·† (credit: é¦¬åœ‹è–°)&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-1"&gt;
&lt;p&gt;åœ¨è³‡æ–™è™•ç†ä¸Šå…¶å¯¦æœƒæœ‰å€‹ NA çš„å€¼ä¾†å€åˆ†ã€Œç©ºã€ä»¥åŠã€Œç©ºå€¼ã€çš„æ¦‚å¿µã€‚ä¸éŽé€™ç”¨ Python å…§å»ºçš„ &lt;code&gt;csv.reader&lt;/code&gt; è™•ç†æœƒå¤ªè¤‡é›œå°±å…ˆç®—äº†ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-sqlite3 auto commit"&gt;
&lt;p&gt;åƒè€ƒ&lt;a href="https://docs.python.org/3.5/library/sqlite3.html#using-the-connection-as-a-context-manager"&gt;å®˜æ–¹èªªæ˜Žæ–‡ä»¶&lt;/a&gt;ï¼Œå®ƒæ˜¯åœ¨é€²å…¥ &lt;code&gt;with db: ...&lt;/code&gt; code block æ™‚é–‹å•Ÿä¸€å€‹ transactionï¼Œä¸¦åœ¨æ­£å¸¸é›¢é–‹çš„æ™‚å€™è‡ªå‹• commitã€‚å¦‚æžœä¸­é–“é‡åˆ°æ²’æœ‰è™•ç†çš„ Exception æ™‚ï¼Œå°±æœƒè‡ªå‹• roll backã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-sqlite3 auto commit" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-flask-config"&gt;
&lt;p&gt;å…¶å¯¦ Flask ç›¸é—œçš„è¨­å®šé€šå¸¸æ”¾åœ¨ &lt;code&gt;app.config&lt;/code&gt; è£¡é¢ï¼Œä¸éŽæˆ‘å€‘çš„ä¾‹å­æ²’å·®ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref-flask-config" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="zh"></category><category term="flask"></category><category term="sqlite"></category><category term="jinja2"></category><category term="python"></category></entry><entry><title>è¨­å®šéƒ¨è½æ ¼ç­†è¨˜</title><link href="https://blog.liang2.tw/posts/2015/09/blog-internals/" rel="alternate"></link><published>2015-09-21T00:00:00-05:00</published><updated>2015-09-21T00:00:00-05:00</updated><author><name>Liang2</name></author><id>tag:blog.liang2.tw,2015-09-21:/posts/2015/09/blog-internals/</id><summary type="html">&lt;p&gt;Blog å°æˆ‘ä¾†èªªï¼Œæœ€é‡è¦çš„å°±æ˜¯æ›¸å¯«çš„èˆ’é©åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€é–‹å§‹åœ¨è¨­å®š github CNAME çš„æ™‚å€™å°±è¨‚ç‚º &lt;code&gt;blog.liang2.tw&lt;/code&gt;ï¼Œä½†ä¸€ç›´ä»¥ä¾†éƒ½åªæ˜¯å€‹ä¸€é å¼çš„è‡ªæˆ‘ä»‹ç´¹&lt;sup id="fnref-1"&gt;&lt;a class="footnote-ref" href="#fn-1"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œç”¨ &lt;a href="http://semantic-ui.com/"&gt;SemanticUI&lt;/a&gt; æ‰‹åˆ»è€Œæˆã€‚ä¸éŽéƒ¨è½æ ¼å¦‚æžœæ¯ç¯‡æ–‡ç« éƒ½é‚„è¦æ‰‹åˆ»çš„è©±ï¼Œå¤§æ¦‚å°±ä¸æœƒæœ‰åŠ›æ°£å†å¯«å…§å®¹äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ç†äº†ä¸€ä¸‹æœ‰å¹¾å€‹ç›®æ¨™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè€ƒæ…®ç”¨ static site å› ç‚ºä¸æƒ³ç¶­è­· serverï¼Œè€Œä¸” â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Blog å°æˆ‘ä¾†èªªï¼Œæœ€é‡è¦çš„å°±æ˜¯æ›¸å¯«çš„èˆ’é©åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€é–‹å§‹åœ¨è¨­å®š github CNAME çš„æ™‚å€™å°±è¨‚ç‚º &lt;code&gt;blog.liang2.tw&lt;/code&gt;ï¼Œä½†ä¸€ç›´ä»¥ä¾†éƒ½åªæ˜¯å€‹ä¸€é å¼çš„è‡ªæˆ‘ä»‹ç´¹&lt;sup id="fnref-1"&gt;&lt;a class="footnote-ref" href="#fn-1"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œç”¨ &lt;a href="http://semantic-ui.com/"&gt;SemanticUI&lt;/a&gt; æ‰‹åˆ»è€Œæˆã€‚ä¸éŽéƒ¨è½æ ¼å¦‚æžœæ¯ç¯‡æ–‡ç« éƒ½é‚„è¦æ‰‹åˆ»çš„è©±ï¼Œå¤§æ¦‚å°±ä¸æœƒæœ‰åŠ›æ°£å†å¯«å…§å®¹äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ç†äº†ä¸€ä¸‹æœ‰å¹¾å€‹ç›®æ¨™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè€ƒæ…®ç”¨ static site å› ç‚ºä¸æƒ³ç¶­è­· serverï¼Œè€Œä¸” blog ä¹Ÿæ²’ä»€è¦ç‚«çš„ï¼Œç¾åœ¨å…‰ç”¨å‰ç«¯å°±å¯ä»¥åšåˆ°å¾ˆå¤šäº’å‹•åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;æœ€å¥½ site generator æ˜¯ç”¨ Python å¯¦ä½œï¼Œé€™æ¨£æƒ³è¦èª¿æ•´å®ƒçš„åŠŸèƒ½æ™‚ï¼Œæ¯”è¼ƒæ‡‚æ€Žéº¼æ”¹ &lt;/li&gt;
&lt;li&gt;èƒ½æ”¯æ´ markdown å’Œ reStructuredText æœ€å¥½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¯©å®Œä¹‹å¾Œé¸é …ä¹Ÿæ²’å¹¾å€‹ï¼š&lt;a href="http://docs.getpelican.com/"&gt;Pelican&lt;/a&gt;ã€&lt;a href="http://sphinx-doc.org/"&gt;Sphinx&lt;/a&gt;ï¼Œä½† Sphinx å¯èƒ½å° blog é–‹ç™¼çš„åŠŸèƒ½æ¯”è¼ƒå°‘ï¼Œæœ€å¤šäººç”¨çš„å¤§æ¦‚å°± Pelicanï¼Œæ‰€ä»¥å°±æ±ºå®šç”¨å®ƒäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ç†èµ·ä¾†ä¹Ÿåšäº†ä¸å°‘èª¿æ•´ï¼Œå°±åˆ—é»žå§ï¼š&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#pelican"&gt;Pelican ç°¡ä»‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#all-is-about-the-theme"&gt;All is about the theme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;å­—åž‹&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#webfont"&gt;ä¸­æ–‡ webfont&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ä¸­æ–‡æŽ’ç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#figure-caption"&gt;Figure caption&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#markdown-or-rst"&gt;Markdown or rst?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#to-do"&gt;To do&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#edit-2015-09-22"&gt;EDIT (2015-09-22)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#edit-2015-09-23"&gt;EDIT (2015-09-23)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="pelican"&gt;Pelican ç°¡ä»‹&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://docs.getpelican.com/"&gt;Pelican&lt;/a&gt; çµè«–ä¾†èªªä¸é›£ç†è§£ï¼Œè€Œä¸”è¦è‡ªè¨‚ blog theme ä¹Ÿä¸æœƒå¾ˆè¤‡é›œã€‚é¦–å…ˆè·Ÿ Sphinx ä¸€æ¨£ï¼Œç”¨å…§å»ºçš„ &lt;code&gt;pelican-quickstart&lt;/code&gt; é è¨­å€¼å°±èƒ½æž¶å¥½ä¸€å€‹å¯ä»¥å‹•çš„ã€‚ç›®éŒ„å¤§æ¦‚é•·é€™æ¨£&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;my_blog/
â”œâ”€â”€ content/
â”‚Â Â  â”œâ”€â”€ blog_post_1.md
â”‚Â Â  â””â”€â”€ blog_post_2.rst
â”œâ”€â”€ output/
â”œâ”€â”€ develop_server.sh*
â”œâ”€â”€ Makefile
â”œâ”€â”€ fabfile.py
â”œâ”€â”€ pelicanconf.py
â”œâ”€â”€ publishconf.py
â””â”€â”€ requirements.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Blog source éƒ½æ”¾åœ¨ content åº•ä¸‹ï¼Œè¨­å®šæª”åˆ†æˆ local ç”¨çš„ &lt;code&gt;pelicanconf.py&lt;/code&gt; ä»¥åŠ deploy ç”¨çš„ &lt;code&gt;publishconf.py&lt;/code&gt;ã€‚ä¸¦ä¸”æä¾›äº†åƒ Fabricã€Makeã€shell script ç­‰è‡ªå‹•åŒ–è…³æœ¬æŠŠ source ç”¨ theme template render æˆä¸€å€‹éœæ…‹ç¶²ç«™ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é è¨­æœƒè¼¸å‡ºåˆ° &lt;code&gt;output/&lt;/code&gt;ï¼Œåˆ°æ™‚å€™ deploy å°±æŠŠé€™å€‹è³‡æ–™å¤¾çš„å…§å®¹ä¸Ÿåˆ° server ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ¯ç¯‡æ–‡ç« å¯ä»¥ç”¨ markdown æˆ–è€… reStructuredText(rst) ä¾†å¯«ï¼Œæ¦‚å¿µä¸Šåƒé€™æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;---
Title: Hello World
Date: 2016-01-16 18:00
Tags: world, programming
Category: test
Slug: hello-world
---

Hello [World]

[World]: https://en.wikipedia.org/wiki/World
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gh"&gt;Hello World&lt;/span&gt;
&lt;span class="gh"&gt;##############&lt;/span&gt;

&lt;span class="nc"&gt;:date:&lt;/span&gt; &lt;span class="nf"&gt;2016-01-16 18:00&lt;/span&gt;
&lt;span class="nc"&gt;:tags:&lt;/span&gt; &lt;span class="nf"&gt;world, programming&lt;/span&gt;
&lt;span class="nc"&gt;:category:&lt;/span&gt; &lt;span class="nf"&gt;test&lt;/span&gt;
&lt;span class="nc"&gt;:slug:&lt;/span&gt; &lt;span class="nf"&gt;hello-world&lt;/span&gt;

Hello World_

&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="nt"&gt;_World:&lt;/span&gt; https://en.wikipedia.org/wiki/World
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£å·²ç¶“è¨­å®šå¥½äº†æ¨™é¡Œã€åˆ†é¡žã€æ¨™ç±¤ã€ç™¼å¸ƒæ—¥æœŸé‚„æœ‰ slugï¼ˆæœ‰é»žåƒæ–‡ç« çš„ IDï¼‰ç®—å¾ˆå®Œæ•´äº†ã€‚æœ€ä½Žè¦æ±‚è‡³å°‘æœ‰æ¨™é¡Œã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œèª¿æ•´äº†ä¸€ä¸‹ static file çš„è·¯å¾‘ã€‚æˆ‘æŠŠæ–‡ç« æŒ‰å¹´æœˆåˆ†é–‹ï¼Œæ¯å€‹å­è³‡æ–™å¤¾è£¡æœ‰ç•¶æœˆçš„åœ–ã€æª”æ¡ˆç­‰ç­‰ã€‚URL ä¹Ÿæ˜¯ä»¥å¹´æœˆç‚ºå–®ä½ã€‚å…¶å¯¦æœ€ç†æƒ³çš„æ‡‰è©²æ˜¯æœ‰å€‹ hash ä¹‹é¡žçš„æ±è¥¿ &lt;code&gt;/posts/2015/09/abcd/&lt;/code&gt; ç­‰åŒæ–¼ &lt;code&gt;/posts/2015/09/abcd-my-post/&lt;/code&gt; æ¯”è¼ƒå¥½åˆ†äº«ã€‚æ‰¾äº†ä¸€ä¸‹å¥½åƒæ²’é€™åŠŸèƒ½ï¼Œä¸éŽæ²’æœ‰å®ƒå½±éŸ¿ä¹Ÿä¸åš´é‡ï¼Œæš«ä¸”ä¸ç†ã€‚&lt;/p&gt;
&lt;h3 id="all-is-about-the-theme"&gt;All is about the theme&lt;/h3&gt;
&lt;p&gt;ä¸€é–‹å§‹æœ€èŠ±æ™‚é–“å°±æ˜¯æ‰¾å€‹å¥½ä¸»é¡Œäº†ã€‚å…§å»ºçš„ä¸»é¡Œå¯¦ç”¨æ€§ä¸å·®ï¼Œä½†åˆæ¬¡çœ‹çµæ§‹å¤ªè¤‡é›œï¼Œå†ä¾†æˆ‘å–œæ­¡æ›´ç°¡æ½”çš„ç‰ˆé¢ï¼Œä¹Ÿå¸Œæœ›æœ‰å¯«å¥½ responsive layoutã€‚&lt;/p&gt;
&lt;p&gt;Pelican å¤§éƒ¨ä»½çš„ä¸»é¡Œéƒ½é›†ä¸­åœ¨ &lt;a href="http://pelicanthemes.com/"&gt;http://pelicanthemes.com/&lt;/a&gt;ï¼Œæœ‰ç¸®åœ–å¾ˆå¥½æŒ‘é¸ï¼Œè€Œä¸” theme è·Ÿå…§å®¹æ˜¯åˆ†é–‹çš„ï¼Œæ› theme åªæ˜¯æ”¹ config è£¡ &lt;code&gt;THEME&lt;/code&gt; é€™è®Šæ•¸è€Œå·²ï¼Œä¸å–œæ­¡å°±æ›ã€‚é¸äº†ä¸€é™£å­æŒ‘åˆ° &lt;a href="https://github.com/alexandrevicenzi/flex"&gt;Flex&lt;/a&gt;ï¼Œä»–ä¸æ˜¯æˆ‘æœ€å–œæ­¡çš„ç‰ˆåž‹ï¼Œæˆ‘æ¯”è¼ƒå–œæ­¡å–®æ¬„å¼ç½®ä¸­ï¼Œä½†æ„å¤–åªæœ‰å°‘æ•¸ä¸»é¡Œæ»¿è¶³ä¸Šè¿°æ¢ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Theme template ç”¨ Jinja2ï¼Œä¸€é–‹å§‹åªè¦èª¿æ•´ &lt;code&gt;base&lt;/code&gt;ã€&lt;code&gt;index&lt;/code&gt;ã€&lt;code&gt;article&lt;/code&gt;ã€&lt;code&gt;page&lt;/code&gt; é€™å¹¾é è·Ÿ blog æœ€ç›¸é—œçš„å°±èƒ½æ”¹è®Šä¸»è¦çš„å¤–è§€ã€‚å¥½åœ¨å…©æ¬„å¼çš„ç¶²é  code è®€èµ·ä¾†ä¹Ÿå¾ˆèˆ’é©ã€‚çœ‹äº†ä¸€ä¸‹åªè¦æŠŠ responsive èª¿æ•´ä¸€ä¸‹ï¼Œè®“æ‰‹æ©Ÿå…§æ–‡å¯¬åº¦å¤ ã€å¾ˆå¤§çš„èž¢å¹•ä¸è¦æ»¿ç‰ˆæ•´é«”çœ‹èµ·ä¾†å°±å·®ä¸å¤šã€‚å¤§è‡´ä¸Š theme å°±é€™æ¨£å®šä¸‹ä¾†äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç´°éƒ¨çš„ CSS ä¿®æ­£ï¼ŒFlex æœ‰ç”¨ &lt;a href="http://lesscss.org/"&gt;LESS&lt;/a&gt; å’Œ &lt;a href="http://gulpjs.com/"&gt;gulp&lt;/a&gt; è™•ç†å‰ç«¯çš„è¨­å®šã€‚LESS è®Šæ•¸è·Ÿ nesting rules ä¸æœƒè®“ CSS è®Šå¾—å¾ˆé«’ï¼›æ¯æ¬¡æ”¹å®Œè·‘å€‹ gulp å°±æœ‰æ–°çš„ &lt;code&gt;style.min.css&lt;/code&gt; å¾ˆæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;å”¯ä¸€è¨ŽåŽ­å·¦å´çš„å¤§é ­ç…§ï¼Œæœ‰å¤ ç…©çš„ï¼Œè€Œä¸”é‚„è¦å¢žåŠ  54KB çš„æµé‡ã€‚é‚„å†æƒ³è©²æ”¾ä»€éº¼ä¾†é—œæŽ‰å®ƒï¼Œæ”¾åˆéŸ³å¥½äº†ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;å­—åž‹&lt;/h3&gt;
&lt;p&gt;å› ç‚ºè‡ªç”¨ OSXï¼Œæœ‰æ™‚å€™éƒ½æœƒå¿˜äº†åœ¨ Windows ä¸Šçš„å­—é«”æœ‰å¤šæ‚²å“€ã€‚&lt;/p&gt;
&lt;p&gt;Flex å…§å»ºç”¨ Google webfont ä¾†è™•ç†è‹±æ–‡å­—é«”ï¼Œç‚ºäº†å¼•è¨€é‚„æœ‰å®Œæ•´æ€§å¤šåŠ äº†ä¸€çµ„ serif å­—é«” &lt;a href="https://www.google.com/fonts/specimen/Crimson+Text"&gt;Crimson Text&lt;/a&gt;ã€‚æˆ‘å–œæ­¡é€™ç¨® Garamond é¡žçš„å¤å…¸è¥¯ç·šå­—ã€‚å‰›å‰›ç™¼ç¾å®ƒæ˜¯&lt;a href="https://github.com/skosch/Crimson"&gt;é–‹æºçš„ (SIL 1.1)&lt;/a&gt;ï¼Œniceã€‚ï¼ˆå¤§é™¸ç¶²å‹è¡¨ç¤ºï¼šâ€¦â€¦ï¼‰&lt;/p&gt;
&lt;h4 id="webfont"&gt;ä¸­æ–‡ webfont&lt;/h4&gt;
&lt;p&gt;éº»ç…©çš„å°±æ˜¯ä¸­æ–‡å­—åž‹ã€‚ç›´æŽ¥æ”¾æ£„ç³»çµ±å…§å»ºï¼Œä½†æœ€å¾Œæœ‰æŠŠ Noto Sans CJK å’Œ Source Hans Sans åŠ é€²ä¾†ç•¶å‚™ç”¨ã€‚ä¸€ç›´éƒ½æœ‰æƒ³å˜—è©¦ &lt;a href="http://justfont.com"&gt;justfont&lt;/a&gt; æŽ¨å‡ºçš„ webfont åŠŸèƒ½ã€‚å®ƒé‹ä½œæ™‚æœƒåµŒå…¥ä¸€å€‹ javascriptï¼Œçœ‹é€™é ç¶²é ç”¨åˆ°å“ªäº›ä¸­æ–‡å­—ï¼Œæ‰åŽ»è¦é€™äº›ä¸­æ–‡å­—çš„å­—åž‹ä¾†åŠ é€Ÿè¼‰å…¥ã€‚ä½¿ç”¨ä¸Šå°±è·Ÿ Google webfont ä¸€æ¨£ï¼Œå®˜ç¶²æ•™å­¸è€ƒæ…®äº†å¾ˆå¤šä½¿ç”¨æƒ…æ³ï¼Œå…¶å¯¦æ²’åšä»€éº¼è¨­å®šå°±å¥½äº†ï¼Œæˆ‘ä»¥ç‚ºè¦èª¿å¾ˆå¤šæ±è¥¿æ‰çœ‹å¾—åˆ°æ•ˆæžœï¼Œæœ€å¾Œåªæ”¹äº† &lt;code&gt;font-family&lt;/code&gt; å°±å®Œå·¥ã€‚ä»–çš„è¨­å®šä¹Ÿèƒ½ä¿ç•™åŽŸæœ¬è‹±æ–‡å­—çš„å­—åž‹ã€‚&lt;/p&gt;
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/justfont_setting.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;Justfont è¨­å®š&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;å…è²»çš„è©¦ç”¨æ²’å•é¡Œä¹‹å¾Œå°±åˆ·ä¸‹åŽ»äº†ã€‚èªªçœŸçš„å…è²»åªèƒ½ç¶å…©å€‹å­—åž‹ï¼Œè¨­å®šå¥½å…§æ–‡ä»¥åŠå…§æ–‡ç²—é«” quota å°±ç”¨å®Œäº†ï¼Œç¾åœ¨ 100,000 page views/year å¤§ç´„ NTD 350/year ä¹Ÿä¸è²´ã€‚æ—¢ç„¶ä»˜è²»äº†ç•¶ç„¶è¦è©¦è©¦ä¿¡é»‘é«”ï¼Œé›»è…¦ç‰ˆçš„åˆ°ç¾åœ¨é‚„è²·ä¸èµ·å•Šã€‚è¨­äº†å…©å€‹å­—é‡ï¼Œä¸€æ¨£åŠ äº†ä¸€å¥—æ¥·é«”ç•¶å¼•è¨€ç”¨ã€‚æ¥·é«”ä¹Ÿé¸äº†æ¯”è¼ƒç§€æ°£çš„ cwTeX æ¥·ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿè¨±æœªä¾†æœƒè©¦è©¦çœ‹ä»¿å®‹é«”ï¼Œä½†æˆ‘æœ‰é»žæ“”å¿ƒèž¢å¹•é¡¯ç¤ºçš„æ•ˆæžœï¼ˆç”¨ Retina è¡¨ç¤ºè§£æžåº¦ç„¡æ„Ÿï¼‰ï¼Œè€Œä¸” justfont æä¾›çš„ï¼ˆä»¿ï¼‰å®‹é«”ä¹Ÿæ²’æœ‰æ¯”ä¿¡é»‘é«”æ›´å–œæ­¡ï¼Œé€™å¯¦é©—æš«ä¸”æ“±ç½®ã€‚&lt;/p&gt;
&lt;h4 id="_2"&gt;ä¸­æ–‡æŽ’ç‰ˆ&lt;/h4&gt;
&lt;p&gt;å—åˆ° COSCUP 2015 Bobby Tung çµ¦çš„æ¼”è¬›&lt;a href="http://www.slideshare.net/bobby3302/w3c-51661297"&gt;ã€Šä¸­æ–‡æŽ’ç‰ˆéœ€æ±‚ä»¥åŠæˆ‘åœ¨W3Cçœ‹åˆ°çš„äº‹æƒ…ã€‹&lt;/a&gt;æ‰€æ„Ÿå¬ï¼Œè¦ºå¾—å¦‚æžœè‡ªå·±ä¸ä¸€é–‹å§‹å¥½å¥½åšç¶²é ä¸­æ–‡æŽ’ç‰ˆï¼Œä¹‹å¾Œè‚¯å®šæ›´æ‡¶å¾—æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æœ€å¾Œé‚„æ˜¯æœ‰æ‰€å¦¥å”å•¦ï¼ˆè·ªï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ®µè½å‰å¾Œé‚„æ˜¯æœ‰ç•™ç™½ï¼Œé€™ä¸»è¦æ˜¯å…¼é¡§è‹±æ–‡æŽ’ç‰ˆï¼Œå› ç‚ºä¸çŸ¥é“æ€Žéº¼åœ¨ä¸åŒèªžè¨€å¥—ä¸åŒçš„ç‰ˆåž‹ï¼Œè‹±æ–‡æ®µè½æ˜¯å‰å¾Œç•™å¤§é–“è·ã€‚å†ä¾†æˆ‘åœ¨ç´”æ–‡å­—çš„æ™‚å€™ä¹Ÿå¾ˆç¿’æ…£æ®µè½å‰å¾Œç©ºä¸€è¡Œï¼Œæ„Ÿè¦ºè¦–è¦ºä¸Šé€™æ¨£æ¯”è¼ƒèˆ’é©ï¼ˆä¹Ÿè¨±æ˜¯è¡Œé«˜ä¸å¤ â€¦â€¦ï¼‰ã€‚ &lt;del&gt;&lt;code&gt;margin&lt;/code&gt; ä¹Ÿæ˜¯è¨­ç‚º &lt;code&gt;1em&lt;/code&gt;ã€‚&lt;/del&gt;ï¼ˆEDIT: è¦‹æ–‡æœ«ï¼‰&lt;/p&gt;
&lt;p&gt;æ®µè½é¦–è¡Œç¸®æŽ’æœ€å¾Œä¹Ÿæ²’æœ‰æ”¾ï¼Œä¸»å› æ˜¯æ–‡å¥éƒ½è »çŸ­çš„ï¼Œæœ‰é»žæ€ªï¼›å†ä¾† markdown parser æœƒæŠŠæˆ‘çš„å…¨å½¢ç©ºç™½åƒæŽ‰ï¼Œé›£ä»¥ç†è§£ï¼ˆä½† rst ä¸æœƒï¼‰ï¼ŒçœŸè¦åŠ åªèƒ½ç”¨&lt;code&gt;&amp;amp;#x3000;&lt;/code&gt;ç¡¬åŠ ã€‚ä¸­è‹±äº¤é›œçš„æ®µè½ä¸­æ–‡å­—æœƒç„¡æ³•å°é½Šï¼Œä¸éŽå°±æš«æ™‚ç®—äº†ï¼Œç¾åœ¨ä¸­è‹±æ–‡çš„å­—é‡èƒ½ä¸€æ¨£å·²ç¶“å¾ˆæ„Ÿå‹•äº†ã€‚&lt;/p&gt;
&lt;p&gt;300 çš„ä¸­æ–‡å­—çš„ç¢ºæœ‰é»žç´°ï¼Œæˆ‘æŠŠå­—èª¿å¤§äº†æˆ 18pxï¼Œé‚„ç‰¹åˆ¥æ‹¿çµ¦æˆ‘çˆ¸åª½çœ‹ï¼Œç¢ºå®šä»–å€‘çœ‹å¾—åˆ°é€™äº›å­— XD &lt;/p&gt;
&lt;p&gt;åšåˆ°é€™è£¡å…¶å¯¦é‚„è »æ»¿æ„äº†ï¼Œé•·å¾—åƒé€™æ¨£ï¼š&lt;/p&gt;
&lt;div class="figure align-center" style="width: 250px"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/blog_mobile.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;æ‰‹æ©Ÿä¸Šçš„æ¨£å­&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div class="figure"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/blog_desktop.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;é›»è…¦èž¢å¹•çš„æ¨£å­&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h3 id="figure-caption"&gt;Figure caption&lt;/h3&gt;
&lt;p&gt;åœ–çš„ä¸‹é¢é‚„è »å¸¸æœƒæ”¾ä¸€äº›åœ–èªªã€reference ä¹‹é¡žã€‚ç¯„ä¾‹ä¸Šé¢å°±æœ‰ã€‚åœ¨ markdown ä¸å®¹æ˜“é”æˆé€™æ•ˆæžœï¼Œå› ç‚ºå®ƒçš„èªžæ³•æ²’é€™éº¼è¤‡é›œï¼›ä½† rst æœ¬ä¾†å°±æœ‰æ”¯æ´é€™æ¨£çš„èªžæ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;role&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; fig

&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; {filename}pics.jpg
    &lt;span class="nc"&gt;:align:&lt;/span&gt; &lt;span class="nf"&gt;center&lt;/span&gt;

    &lt;span class="na"&gt;:fig:&lt;/span&gt;&lt;span class="nv"&gt;`Figure 1:`&lt;/span&gt; The figure caption.

    The legend consists of all elements after the caption.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é€™æ¨£å°±æœƒè®Šæˆ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;figure align-center&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;img&lt;/span&gt; &lt;span class="na"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{filename}pics.jpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;caption&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;span&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fig&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Figure 1:&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;span&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; The figure caption&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;legend&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;The legend consists of all elements after the caption.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åœ¨ markdown åŸºæœ¬ä¸Šå°±æ‰‹æ‰“ä¸Šé¢é‚£ä¸€ä¸² HTMLï¼Œå…¶å¯¦ä¹Ÿé‚„å¥½ï¼Œåªæ˜¯é†œäº†ä¸€é»žã€‚çœŸçš„å¯«å¾—å¾ˆç…©æ™‚å†æƒ³å¯« plugin ä¾†åšé€™ä»¶äº‹ã€‚&lt;/p&gt;
&lt;h3 id="markdown-or-rst"&gt;Markdown or rst?&lt;/h3&gt;
&lt;p&gt;æ—¥å¸¸çš„ç·¨è¼¯æ‡‰è©²é‚„æ˜¯ä»¥ markdown ç‚ºä¸»ï¼Œçœ‹çœ‹ç²¾ç¾Žçš„ &lt;a href="http://macdown.uranusjr.com/"&gt;Macdown&lt;/a&gt; ç·¨è¼¯å™¨å¦‚æ­¤å¥½ç”¨ã€‚ä½†å¦‚æžœæ˜¯å¾ˆè¤‡é›œçš„æª”æ¡ˆï¼ˆåˆ†æžæœ‰å…¬å¼æœ‰åœ–è¡¨ä»€éº¼çš„ï¼‰å¯èƒ½å°±æœƒè€ƒæ…® rstï¼›rst ç¼ºé»žå°±æ˜¯èªžæ³•æœ‰é»žè¤‡é›œï¼Œè€Œä¸”å¾ˆå¤šèªžæ³•ä»°è³´å¥ä¸­ç©ºç™½ï¼Œä½¿å¾—ä¸é©ç”¨ä¸­æ–‡ï¼Œç„¶å¾Œæˆ‘çš„ vim linter æœƒä¸€ç›´æŠ±æ€¨å®ƒæœ‰å¾ˆå¤šæ²’çœ‹éŽçš„ directivesã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽå¾ˆé«˜èˆˆ Pelican æŠŠå…©è€…æ•´åˆçš„å¾ˆå¥½ï¼Œå…©å€‹éƒ½èƒ½ç”¨å°±èƒ½è¦–æƒ…æ³è½‰æ›ï¼Œä½† template ä¹Ÿä¸ç”¨å¯«å…©ä»½ã€‚&lt;/p&gt;
&lt;h3 id="to-do"&gt;To do&lt;/h3&gt;
&lt;p&gt;é€™ä¹‹å¤–é‚„åŠ ä¸Šäº† LaTeX MathJaxã€Smartypants ç­‰å°ç´°ç¯€ï¼Œä¸éŽæ•´é«”ä¾†èªª blog å®¢è£½åŒ–å°±å®Œæˆäº†ã€‚ä¹Ÿè¨±æœªä¾†ç”¨åˆ°ä»€éº¼å†åŠ å§ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æƒ³åˆ°çš„ä¸€äº›å•é¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¨™é¡Œå­—é‡ï¼šæœ¬ä¾†æ˜¯è·Ÿå…§æ–‡åŒå­—é‡ï¼Œä½†æ„Ÿè¦ºé•·æ–‡æœƒæŠ“ä¸åˆ°æ®µè½ï¼Œå…ˆæ”¹æˆç²—é«”ï¼Œå¸Œæœ›çŸ­æ–‡ä¸è¦å› ç‚ºé€™æ¨£è®Šå¾—å¾ˆæ··äº‚ã€‚&lt;/li&gt;
&lt;li&gt;Jupyter notebook includeï¼šé‚„æ²’æœ‰è©¦ç›´æŽ¥åµŒå…¥ nb çš„åŠŸèƒ½ï¼Œæˆ‘æƒ³æ‡‰è©²ä¹Ÿæ˜¯èª¿æ•´ CSS é‚£é¡žçš„å·¥ï¼ˆå‰ç«¯å¥½ç´¯å¥½é›£å•Šâ€¦ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="(https://github.com/getpelican/pelican-plugins)"&gt;Pelican plugin&lt;/a&gt; è£¡é¢åŒ…å«äº†å¾ˆå¤šæ¨£çš„å¥—ä»¶ï¼Œæˆ‘çŒœå¾ˆå¤šé‡åˆ°çš„å•é¡Œï¼Œå‰äººéƒ½è§£æŽ‰äº†å§ï¼Ÿâ€¦â€¦å§ xdd&lt;/p&gt;
&lt;h3 id="edit-2015-09-22"&gt;EDIT (2015-09-22)&lt;/h3&gt;
&lt;p&gt;çœ‹ä¾†çœ‹åŽ»ï¼Œåˆèª¿æ•´äº†å¾ˆå¤šæ±è¥¿ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå­—é«”å¤§å°èª¿å°æˆ 16px åˆèª¿å›ž 18pxã€‚æœƒé¸æ“‡ 16px æ˜¯å› ç‚ºæˆ‘ç™¼ç¾åœ¨ 13&amp;#34; ç­†é›»ä¸Šé–±è®€æœƒè®Šå¾—å¾ˆæ“ ã€‚èª¿å›žä¾†æ˜¯å› ç‚ºåœ¨å¤§èž¢å¹•ä¸Šçœ‹çœŸçš„å¤ªå°äº†ï¼Œè‡ªå·±éƒ½éœ€è¦æ”¾å¤§ä¾†çœ‹ã€‚è€Œä¸”ç™¼ç¾æœ¬ä¾† 13&amp;#34; ä¸Šå¾ˆæ“ çš„å•é¡Œä¸¦ä¸æ˜¯å­—é«”ï¼Œè€Œæ˜¯ä¸€è¡Œæ–‡å­—çš„å­—æ•¸ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€è¡Œæ–‡å­—å¤ªå¤šæœƒå½±éŸ¿åˆ°é–±è®€çš„æ•ˆçŽ‡ã€‚PTT ä¸€è¡Œæœ€å¤š 39 å€‹ä¸­æ–‡å­—ï¼Œä½†æ‡‰è©²å¾ˆå°‘æ–‡ç« æ˜¯æ‰“æ»¿çš„ï¼Œå¤§ç´„éƒ½æ‰“å€‹äº”åˆ°å…«æˆå¯¬ï¼Œä¹Ÿå°±æ˜¯åœ¨ 20-32 å€‹ä¸­æ–‡å­—ã€‚è‹±æ–‡çš„è©±å¤§ç´„åœ¨ 12-15 å€‹å­—ã€‚æˆ‘è‡ªå·±èª¿äº†å¾ˆå¤šç‰ˆæœ¬ä¹Ÿå·®ä¸å¤šæ˜¯é€™å€‹æ•¸å­—ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ç†æƒ³çš„æ–‡ç« å¯¬åº¦è¦æ»¿è¶³ä¸­ã€è‹±æ–‡çš„å­—æ•¸ã€‚ä¸­æ–‡å­—å¯¬åº¦æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨æ±ºå®šä¸€è¡Œæœ‰å¤šå°‘å€‹ä¸­æ–‡å­—ä¹‹å¾Œï¼Œå°±è¦æƒ³è¾¦æ³•èª¿æ•´è‹±æ–‡å­—é«”è®“ä¸€è¡Œè‹±æ–‡å­—æ•¸å‰›å¥½ã€‚åŽŸæœ¬ä½¿ç”¨çš„ Source Pro Sans ç¨å¾®çª„äº†ä¸€é»žï¼Œæœƒè®“ç´”è‹±æ–‡çš„é é¢çœ‹èµ·ä¾†æœ‰é»žæ“ ï¼Œå­—é‡ 400 çš„æ™‚å€™å°±å¥½å¤šäº†ï¼Œä½†ä¸­æ–‡å°±è®Šå¾—ä¸é©åˆå…§æ–‡ã€‚æœ€å¾Œæ›æˆ Latoï¼Œä¹Ÿæ˜¯å¾ˆæ™®åŠçš„å­—é«”ï¼Œä¸éŽå…¶å¯¦æ²’å¯¬å¤šå°‘ã€‚å¦‚æžœé‚„æ˜¯è¦ºå¾—å¾ˆæ“ å°±åªå¥½æ›æˆ Open Sans äº†ï¼Œä½†æˆ‘è¦ºå¾—å®ƒå°±æœ‰é»žé¬†æ•£ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œå…§æ–‡å¯¬ 738px (41em) æˆ– 828px (46em)ï¼Œå¯¦éš›ä¸€è¡Œæœ€å¤§ç‚º 612px (34em)ã€‚ä¸€è¡Œæœ€å¤š 34 å€‹ä¸­æ–‡å­—ã€å¤§ç´„ 14 å€‹è‹±æ–‡å­—ï¼ˆ80 å€‹å­—å…ƒï¼‰ï¼›ç¨‹å¼ç¢¼ä¸€è¡Œæœ€å¤šåªèƒ½æ”¾ 74 å€‹å­—å…ƒï¼ŒçŸ­äº†ä¸€é»žé»žä½†é‚„å¯ä»¥æŽ¥å—ã€‚&lt;/p&gt;
&lt;p&gt;æ„å¤–çš„å°ç™¼ç¾ï¼Œåœ¨å…§æ–‡è®Šçª„ä¹‹å¾Œï¼Œé‚„å¯ä»¥åŠ ä¸Šå³å´çš„ sidenoteï¼Œåƒæ˜¯ &lt;a href="http://www.daveliepmann.com/tufte-css/"&gt;Tufte CSS&lt;/a&gt; é€™æ¨£ï¼Œæœ‰æ™‚æœƒæ¯” footnote å¥½ç”¨ï¼Œä½†å¯èƒ½åˆè®Šå›žå…§å®¹å¤ªæ“ çš„ç‹€æ…‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œæ˜¯åœ¨æ®µè½å‰å¾Œè·é›¢èª¿æ•´ï¼ŒæŠŠæ¨™é¡ŒæŽ¥å…§æ–‡çš„é–“è·è®Šå°äº†ï¼Œä½†æ®µè½é–“çš„é–“è·èª¿å¤§ã€‚å­¸åˆ°äº†ä¸€äº›ä»¥å‰ä¸æœƒçš„ CSS èªžæ³•ï¼Œåƒ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nt"&gt;p&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;margin-top&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;1.5&lt;/span&gt;&lt;span class="kt"&gt;em&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä»£è¡¨é¸å–ç›¸é„°çš„ p å…ƒç´ ï¼Œé€™æ¨£å¯ä»¥é¿å…ç›´æŽ¥æ”¹ p çš„ margin è®“ p èˆ‡ h*ã€ulã€pre ç­‰é–“è·å¤ªå¯¬çš„ç‹€æ³ã€‚&lt;strong&gt;å‰ç«¯çœŸçš„å¤ªç¥žå¦™äº†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="edit-2015-09-23"&gt;EDIT (2015-09-23)&lt;/h3&gt;
&lt;p&gt;å¦å¤– smartypants æœ‰æ™‚å€™æœ‰é»žç…©ï¼Œåƒæ˜¯è¡¨é” 13 å‹æ™‚&lt;/p&gt;
&lt;p class="center"&gt;&lt;span style="font-size: 4em; line-height: 1em;"&gt;13" vs 13&amp;#34;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;ä¸æŠŠ &lt;code&gt;"&lt;/code&gt;ï¼ˆQUOTATION MARK &lt;code&gt;\u0022&lt;/code&gt;ï¼‰ç›´æŽ¥å¯«æˆ &lt;code&gt;&amp;amp;#34;&lt;/code&gt; å°±æœƒè¢«è½‰æ›æˆå·¦é‚Šé‚£æ¨£ &lt;code&gt;â€&lt;/code&gt;ï¼ˆRIGHT DOUBLE QUOTATION MARK &lt;code&gt;\u201D&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¹ŸæŠŠè¡¨æ ¼çš„æ ¼å¼åŠ ä¸Šï¼Œä»¿é€  bootstrap è¡¨æ ¼ overflow æ™‚æœƒè®Šæˆ block å¯ä»¥æ»‘å‹•è‘—çœ‹ã€‚&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-1"&gt;
&lt;p&gt;ä»¥å‰éƒ¨è½æ ¼çš„é•·ç›¸ï¼š
&lt;div class="figure align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/oldsite.png"/&gt;
&lt;/div&gt;&amp;#160;&lt;a class="footnote-backref" href="#fnref-1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="zh"></category><category term="pelican"></category><category term="blog"></category><category term="python"></category></entry></feed>