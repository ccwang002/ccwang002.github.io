<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Liang-Bo Wang's Blog - osx</title><link href="https://blog.liang2.tw/" rel="alternate"></link><link href="https://blog.liang2.tw/feeds/tag_osx.atom.xml" rel="self"></link><id>https://blog.liang2.tw/</id><updated>2022-02-18T21:49:53-06:00</updated><entry><title>安裝 PostgreSQL 9 於 Debian Jessie / OSX</title><link href="https://blog.liang2.tw/posts/2016/01/postgresql-install/" rel="alternate"></link><published>2016-01-25T17:00:00-06:00</published><updated>2022-02-18T21:49:53-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-25:/posts/2016/01/postgresql-install/</id><summary type="html">&lt;p&gt;平常用最多的是 &lt;a href="https://www.sqlite.org/"&gt;SQLite&lt;/a&gt;，但 &lt;a href="http://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt; 有很多好用的功能，每次要用想不起來怎麼裝。總之把相關設定的筆記存在這。&lt;/p&gt;
&lt;p&gt;用 &lt;a href="https://www.debian.org/releases/stable/"&gt;Debian Jessie&lt;/a&gt; (Debian 8.3) 與 OSX …&lt;/p&gt;</summary><content type="html">&lt;p&gt;平常用最多的是 &lt;a href="https://www.sqlite.org/"&gt;SQLite&lt;/a&gt;，但 &lt;a href="http://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt; 有很多好用的功能，每次要用想不起來怎麼裝。總之把相關設定的筆記存在這。&lt;/p&gt;
&lt;p&gt;用 &lt;a href="https://www.debian.org/releases/stable/"&gt;Debian Jessie&lt;/a&gt; (Debian 8.3) 與 OSX &lt;a href="http://brew.sh/"&gt;Homebrew&lt;/a&gt; 舉例。不過 OSX 大概也不會沒事把 PostgreSQL 開著，主要是著重在 Debian 的環境設定上。目前 PostgreSQL 出到 9.5 但 Debian stable 是 9.4。基本設定應該完全沒差別。&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;安裝 PostgreSQL&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#osx"&gt;安裝在 OSX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#debian-jessie"&gt;安裝在 Debian Jessie&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#database"&gt;初始個人的 Database&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#postgresql_1"&gt;建立同使用者名稱的 PostgreSQL 帳號&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database_1"&gt;建立與帳號同名稱的 database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#psql"&gt;用使用者帳號連接 psql&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#psql_1"&gt;psql 指令&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database_2"&gt;刪除使用者、Database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;進階主題&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#psql_2"&gt;透過 psql 創建使用者帳號、資料庫&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql-logging"&gt;PostgreSQL Logging&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#logging-postgresql"&gt;Logging 讓 PostgreSQL 自己管&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#logging-systemd"&gt;Logging 透過 Systemd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#reference"&gt;Reference&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="postgresql"&gt;安裝 PostgreSQL&lt;/h2&gt;
&lt;h3 id="osx"&gt;安裝在 OSX&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;brew install postgresql&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;要用的時候手動把 PostgreSQL server 打開，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;postgres -D /usr/local/var/postgres&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;PostgreSQL 的設定參考 Debian 的版本。&lt;/p&gt;
&lt;h3 id="debian-jessie"&gt;安裝在 Debian Jessie&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo apt-get install postgresql-9.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;現在系統服務都由 &lt;a href="http://freedesktop.org/wiki/Software/systemd/"&gt;Systemd&lt;/a&gt; 管理了，檢查 PostgreSQL 有沒有跑起來透過 &lt;code&gt;systemctl&lt;/code&gt; 這指令就可以。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;systemctl status postgresql.service
&lt;span class="go"&gt;● postgresql.service - PostgreSQL RDBMS&lt;/span&gt;
&lt;span class="go"&gt;   Loaded: loaded (/lib/systemd/system/postgresql.service; enabled)&lt;/span&gt;
&lt;span class="go"&gt;   Active: inactive (dead) since Mon 2016-01-25 17:26:08 CST; 4s ago&lt;/span&gt;
&lt;span class="go"&gt;  Process: 913 ExecStart=/bin/true (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt; Main PID: 913 (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;不過這 service 看不太到什麼運行的資訊，其實是個 dummy service，它會 trigger 可能很多個 PostgreSQL database cluster 什麼的。預設只有一個 &lt;code&gt;main&lt;/code&gt; 的 cluster。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;systemctl status postgresql@9.4-main.service
&lt;span class="go"&gt;● postgresql@9.4-main.service - PostgreSQL Cluster 9.4-main&lt;/span&gt;
&lt;span class="go"&gt;   Loaded: loaded (/lib/systemd/system/postgresql@.service; disabled)&lt;/span&gt;
&lt;span class="go"&gt;   Active: active (running) since Mon 2016-01-25 17:26:30 CST; 4min 7s ago&lt;/span&gt;
&lt;span class="go"&gt;  Process: 9641 ExecStop=/usr/bin/pg_ctlcluster -m fast %i stop (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt;  Process: 9717 ExecStart=postgresql@%i %i start (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt; Main PID: 9723 (postgres)&lt;/span&gt;
&lt;span class="go"&gt;   CGroup: /system.slice/system-postgresql.slice/postgresql@9.4-main.service&lt;/span&gt;
&lt;span class="go"&gt;           ├─9723 /usr/lib/postgresql/9.4/bin/postgres -D /var/lib/postgresql/9.4/main -c config_file=/etc/postgr...&lt;/span&gt;
&lt;span class="go"&gt;           ├─9725 postgres: checkpointer process&lt;/span&gt;
&lt;span class="go"&gt;           ├─9726 postgres: writer process&lt;/span&gt;
&lt;span class="go"&gt;           ├─9727 postgres: wal writer process&lt;/span&gt;
&lt;span class="go"&gt;           ├─9728 postgres: autovacuum launcher process&lt;/span&gt;
&lt;span class="go"&gt;           └─9729 postgres: stats collector process&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="database"&gt;初始個人的 Database&lt;/h2&gt;
&lt;p&gt;在 OSX 上用 homebrew 安裝 PostgreSQL 的使用者會有 superuser 的權限，反正是本地開發也沒差，建 database 等設定都比較簡單。&lt;/p&gt;
&lt;p&gt;在 Debian 上的話，有這 superuser 權限的使用者為 &lt;code&gt;postgres&lt;/code&gt;。所以預設使用者（這邊以 &lt;code&gt;vm&lt;/code&gt; 為例）會無法連線。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;psql
&lt;span class="go"&gt;psql: FATAL:  role &amp;quot;vm&amp;quot; does not exist&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;切到 root 再切到 postgres 身份就能用 &lt;code&gt;psql&lt;/code&gt; （PostgreSQL 的 REPL shell）連到 database。用 &lt;code&gt;\q&lt;/code&gt; 就可以退出 psql。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres psql
&lt;span class="go"&gt;[sudo] password for vm:&lt;/span&gt;
&lt;span class="go"&gt;psql (9.4.5)&lt;/span&gt;
&lt;span class="go"&gt;Type &amp;quot;help&amp;quot; for help.&lt;/span&gt;

&lt;span class="go"&gt;postgres=# \q&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但用 postgres 這 superuser 去連資料庫不是很安全，一開始養成好習慣應該用個人帳號。所以接下來要完成：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;建立同使用者名稱的 PostgreSQL 帳號&lt;/li&gt;
&lt;li&gt;建立與帳號同名稱的 database&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="postgresql_1"&gt;建立同使用者名稱的 PostgreSQL 帳號&lt;/h3&gt;
&lt;p&gt;在 Debian 上可以用 &lt;code&gt;$USER&lt;/code&gt; 來抓到現在登入者的帳號，即使用 sudo 切換身份這環境變數的值不會變。（讀 &lt;a href="https://help.ubuntu.com/community/PostgreSQL"&gt;Ubuntu wiki&lt;/a&gt; 看到的技巧）&lt;/p&gt;
&lt;p&gt;擔心的話就直接在有 &lt;code&gt;$USER&lt;/code&gt; 的地方打出帳號即可。先確認一下，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;vm@vm-debian:~$ echo $&lt;/span&gt;USER
&lt;span class="go"&gt;vm&lt;/span&gt;
&lt;span class="gp"&gt;vm@vm-debian:~$ &lt;/span&gt;sudo -u postgres &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$USER&lt;/span&gt;
&lt;span class="go"&gt;vm&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;建立使用者是透過 &lt;code&gt;createuser&lt;/code&gt; 這指令。這是使用者帳號就不給太多權限。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres createuser --interactive &lt;span class="nv"&gt;$USER&lt;/span&gt;
&lt;span class="go"&gt;Shall the new role be a superuser? (y/n) n&lt;/span&gt;
&lt;span class="go"&gt;Shall the new role be allowed to create databases? (y/n) n&lt;/span&gt;
&lt;span class="go"&gt;Shall the new role be allowed to create more new roles? (y/n) n&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時候透過 &lt;code&gt;psql&lt;/code&gt; 看就會多一個使用者。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;-- Run with command `sudo -u postgres psql`&lt;/span&gt;
&lt;span class="gp"&gt;postgres=#&lt;/span&gt; &lt;span class="kp"&gt;\du&lt;/span&gt;
                             &lt;span class="n"&gt;List&lt;/span&gt; &lt;span class="k"&gt;of&lt;/span&gt; &lt;span class="n"&gt;roles&lt;/span&gt;
 &lt;span class="k"&gt;Role&lt;/span&gt; &lt;span class="k"&gt;name&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;                   &lt;span class="n"&gt;Attributes&lt;/span&gt;                   &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt; &lt;span class="k"&gt;of&lt;/span&gt;
&lt;span class="c1"&gt;-----------+------------------------------------------------+-----------&lt;/span&gt;
 &lt;span class="n"&gt;postgres&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Superuser&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;Create&lt;/span&gt; &lt;span class="k"&gt;role&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;Create&lt;/span&gt; &lt;span class="n"&gt;DB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Replication&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
 &lt;span class="n"&gt;vm&lt;/span&gt;        &lt;span class="o"&gt;|&lt;/span&gt;                                                &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="database_1"&gt;建立與帳號同名稱的 database&lt;/h3&gt;
&lt;p&gt;透過 &lt;code&gt;createdb&lt;/code&gt; 這指令。把與帳號同名 database 的 owner 設定成該帳號。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres createdb --owner&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt; &lt;span class="nv"&gt;$USER&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;要多建別的 database 給這帳號也沒問題，例如名為 &lt;code&gt;vm_database&lt;/code&gt; 的 database，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres createdb --owner&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt; vm_database
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="psql"&gt;用使用者帳號連接 psql&lt;/h3&gt;
&lt;p&gt;這時候打 &lt;code&gt;psql&lt;/code&gt; 就沒問題了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;psql
&lt;span class="go"&gt;psql (9.4.5)&lt;/span&gt;
&lt;span class="go"&gt;Type &amp;quot;help&amp;quot; for help.&lt;/span&gt;

&lt;span class="go"&gt;vm=&amp;gt; \conninfo&lt;/span&gt;
&lt;span class="go"&gt;You are connected to database &amp;quot;vm&amp;quot; as user &amp;quot;vm&amp;quot; via socket in &amp;quot;/var/run/postgresql&amp;quot; at port &amp;quot;5432&amp;quot;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Prompt 從 &lt;code&gt;#=&lt;/code&gt; 變成 &lt;code&gt;=&amp;gt;&lt;/code&gt; 表示現在連線的使用者不是 superuser。透過 psql 的指令 &lt;code&gt;\l&lt;/code&gt; 或 &lt;code&gt;\l+&lt;/code&gt; 可以看現在所有的 database：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;vm=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;\l&lt;/span&gt;
&lt;span class="go"&gt;                                   List of databases&lt;/span&gt;
&lt;span class="go"&gt;    Name     |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges&lt;/span&gt;
&lt;span class="go"&gt;-------------+----------+----------+-------------+-------------+-----------------------&lt;/span&gt;
&lt;span class="go"&gt; postgres    | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |&lt;/span&gt;
&lt;span class="go"&gt; template0   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +&lt;/span&gt;
&lt;span class="go"&gt;             |          |          |             |             | postgres=CTc/postgres&lt;/span&gt;
&lt;span class="go"&gt; template1   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +&lt;/span&gt;
&lt;span class="go"&gt;             |          |          |             |             | postgres=CTc/postgres&lt;/span&gt;
&lt;span class="go"&gt; vm          | vm       | UTF8     | en_US.UTF-8 | en_US.UTF-8 |&lt;/span&gt;
&lt;span class="go"&gt; vm_database | vm       | UTF8     | en_US.UTF-8 | en_US.UTF-8 |&lt;/span&gt;
&lt;span class="go"&gt;(5 rows)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;連另一個 database &lt;code&gt;vm_database&lt;/code&gt; 也很簡單，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;psql -d vm_database
&lt;span class="go"&gt;psql (9.4.5)&lt;/span&gt;
&lt;span class="go"&gt;Type &amp;quot;help&amp;quot; for help.&lt;/span&gt;

&lt;span class="go"&gt;vm_database=&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="psql_1"&gt;psql 指令&lt;/h2&gt;
&lt;p&gt;psql 的指令很多，用 &lt;code&gt;\?&lt;/code&gt; 可以看到列表。完整的版本可以見&lt;a href="http://www.postgresql.org/docs/9.4/static/app-psql.html#APP-PSQL-META-COMMANDS"&gt;官網 psql meta-commands&lt;/a&gt; 的介紹。底下列幾個常用的：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;\l          # list all database
\d          # list tables in current database
\du         # list roles
\conninfo   # show current SQL connection
\q          # quit
help        # print a hub message for all kinds of help
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="database_2"&gt;刪除使用者、Database&lt;/h2&gt;
&lt;p&gt;各有一個指令對應。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;dropuser &amp;lt;usr&amp;gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;dropdb &amp;lt;db&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_1"&gt;進階主題&lt;/h2&gt;
&lt;h3 id="psql_2"&gt;透過 psql 創建使用者帳號、資料庫&lt;/h3&gt;
&lt;p&gt;Ref: &lt;a href="http://www.cyberciti.biz/faq/howto-add-postgresql-user-account/"&gt;http://www.cyberciti.biz/faq/howto-add-postgresql-user-account/&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;-- Run with command `sudo -u postgres psql -d template1`&lt;/span&gt;
&lt;span class="gp"&gt;template1=#&lt;/span&gt; &lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="k"&gt;PASSWORD&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;pwd&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="gp"&gt;template1=#&lt;/span&gt; &lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="gp"&gt;template1=#&lt;/span&gt; &lt;span class="k"&gt;GRANT&lt;/span&gt; &lt;span class="k"&gt;ALL&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="postgresql-logging"&gt;PostgreSQL Logging&lt;/h3&gt;
&lt;p&gt;設定在 &lt;code&gt;/etc/postgresql/9.4/main/postgresql.conf&lt;/code&gt; 裡。不同管理 log 的方式就要選擇不同的 &lt;code&gt;log_destination&lt;/code&gt;。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;PostgreSQL 自己管：&lt;code&gt;stderr&lt;/code&gt;, &amp;hellip;&lt;/li&gt;
&lt;li&gt;透過 &lt;a href="http://freedesktop.org/wiki/Software/systemd/"&gt;Systemd&lt;/a&gt;：&lt;code&gt;syslog&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;不過我沒深入研究就是，看那個 conf 裡很多設定可以調整。設定修改後要 restart PostgreSQL cluster，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo systemctl restart postgresql.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="logging-postgresql"&gt;Logging 讓 PostgreSQL 自己管&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# At /etc/postgresql/9.4/main/postgresql.conf&lt;/span&gt;
&lt;span class="na"&gt;log_destination&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;stderr&amp;#39; &lt;/span&gt;
&lt;span class="na"&gt;logging_collector&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;on                              &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Log files 預設寫在 &lt;code&gt;/var/lib/postgresql/9.4/main/pg_log/&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id="logging-systemd"&gt;Logging 透過 Systemd&lt;/h4&gt;
&lt;p&gt;我覺得 systemd 的優點之一就是能把 log 都集中管理，只要照它的規則，就能用一樣的方法管理 logging 是蠻方便的。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# At /etc/postgresql/9.4/main/postgresql.conf&lt;/span&gt;
&lt;span class="na"&gt;log_destination&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;syslog&amp;#39;  &lt;/span&gt;
&lt;span class="na"&gt;logging_collector&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;off   # on 也只會說被導向到 syslog 了                             &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;這時候重啟服務，再看 &lt;code&gt;systemctl status&lt;/code&gt; 就能看到最近的 log 了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;systemctl status postgresql@9.4-main
&lt;span class="go"&gt;● postgresql@9.4-main.service - PostgreSQL Cluster 9.4-main&lt;/span&gt;
&lt;span class="go"&gt;   Loaded: loaded (/lib/systemd/system/postgresql@.service; disabled)&lt;/span&gt;
&lt;span class="go"&gt;   Active: active (running) since Mon 2016-01-25 17:52:02 CST; 1min 13s ago&lt;/span&gt;
&lt;span class="go"&gt;  Process: 14632 ExecStop=/usr/bin/pg_ctlcluster -m fast %i stop (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt;  Process: 14641 ExecStart=postgresql@%i %i start (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt; Main PID: 14648 (postgres)&lt;/span&gt;
&lt;span class="go"&gt;   CGroup: /system.slice/system-postgresql.slice/postgresql@9.4-main.service&lt;/span&gt;
&lt;span class="go"&gt;           ├─14648 /usr/lib/postgresql/9.4/bin/postgres -D /var/lib/postgresql/9.4/main -c config_file=/etc/postg...&lt;/span&gt;
&lt;span class="go"&gt;           ├─14650 postgres: checkpointer process&lt;/span&gt;
&lt;span class="go"&gt;           ├─14651 postgres: writer process&lt;/span&gt;
&lt;span class="go"&gt;           ├─14652 postgres: wal writer process&lt;/span&gt;
&lt;span class="go"&gt;           ├─14653 postgres: autovacuum launcher process&lt;/span&gt;
&lt;span class="go"&gt;           └─14654 postgres: stats collector process&lt;/span&gt;

&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14648]: [1-1] 2016-01-25 17:52:00 CST [14648-1] LOG:  ending log output to stderr&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14648]: [1-2] 2016-01-25 17:52:00 CST [14648-2] HINT:  Future log output ...log&amp;quot;.&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14649]: [2-1] 2016-01-25 17:52:00 CST [14649-1] LOG:  database system was...9 CST&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14649]: [3-1] 2016-01-25 17:52:00 CST [14649-2] LOG:  MultiXact member wr...abled&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14648]: [2-1] 2016-01-25 17:52:00 CST [14648-3] LOG:  database system is ...tions&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14653]: [2-1] 2016-01-25 17:52:00 CST [14653-1] LOG:  autovacuum launcher started&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14658]: [3-1] 2016-01-25 17:52:00 CST [14658-1] [unknown]@[unknown] LOG: ...acket&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:38 vm-debian postgres[14793]: [3-1] 2016-01-25 17:52:38 CST [14793-1] root@root FATAL:  role &amp;quot;r...exist&lt;/span&gt;
&lt;span class="go"&gt;Hint: Some lines were ellipsized, use -l to show in full.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;或用 systemd 標準看 log 的方式 &lt;code&gt;journalctl&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;journalctl -u postgresql@9.4-main 
&lt;span class="go"&gt;-- Logs begin at Mon 2016-01-25 16:46:25 CST, end at Mon 2016-01-25 19:22:07 CST. --&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [1-1] 2016-01-25 17:47:06 CST [13699-1] LOG:  redirecting log output to logging collector process&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [1-2] 2016-01-25 17:47:06 CST [13699-2] HINT:  Future log output will appear in directory &amp;quot;pg_log&amp;quot;.&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [2-1] 2016-01-25 17:47:06 CST [13699-3] LOG:  ending log output to stderr&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [2-2] 2016-01-25 17:47:06 CST [13699-4] HINT:  Future log output will go to log destination &amp;quot;syslog&amp;quot;.&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13701]: [3-1] 2016-01-25 17:47:06 CST [13701-1] LOG:  database system was shut down at 2016-01-25 17:47:05 CST&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13701]: [4-1] 2016-01-25 17:47:06 CST [13701-2] LOG:  MultiXact member wraparound protections are now enabled&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [3-1] 2016-01-25 17:47:06 CST [13699-5] LOG:  database system is ready to accept connections&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13705]: [3-1] 2016-01-25 17:47:06 CST [13705-1] LOG:  autovacuum launcher started&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:07 vm-debian postgres[13710]: [4-1] 2016-01-25 17:47:07 CST [13710-1] [unknown]@[unknown] LOG:  incomplete startup packet&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:49:30 vm-debian postgres[14170]: [4-1] 2016-01-25 17:49:30 CST [14170-1] root@root FATAL:  role &amp;quot;root&amp;quot; does not exist&lt;/span&gt;
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="reference"&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-9-4-on-debian-8"&gt;How to Install and Use PostgreSQL 9.4 on Debian 8&lt;/a&gt; by Digital Ocean&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/PostgreSQL"&gt;PostgreSQL&lt;/a&gt; on Arch Wiki&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/PostgreSql"&gt;PostgreSQL&lt;/a&gt; on Debian wiki&lt;/li&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/PostgreSQL"&gt;PostgreSQL&lt;/a&gt; on Ubuntu wiki&lt;/li&gt;
&lt;/ul&gt;</content><category term="Coding"></category><category term="zh"></category><category term="postgresql"></category><category term="debian"></category><category term="osx"></category></entry></feed>