<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Liang-Bo Wang's Blog</title><link href="https://blog.liang2.tw/" rel="alternate"></link><link href="https://blog.liang2.tw/feeds/all.atom.xml" rel="self"></link><id>https://blog.liang2.tw/</id><updated>2022-10-05T18:47:48-05:00</updated><entry><title>Use DuckDB in ensembldb to query Ensembl's genome annotations</title><link href="https://blog.liang2.tw/posts/2022/10/use-duckdb-in-ensembldb/" rel="alternate"></link><published>2022-10-05T00:00:00-05:00</published><updated>2022-10-05T18:47:48-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2022-10-05:/posts/2022/10/use-duckdb-in-ensembldb/</id><summary type="html">&lt;p&gt;I have been using ensembldb to query genome annotations locally, which stores the Ensembl annotations in a offline SQLite database. By replacing the database engine with DuckDB, genome-wide queries are faster with small impact on gene specific queries (depending on the usage). DuckDB database&amp;rsquo;s file size is also smaller, and it can be even smaller by offloading the tables to external Parquet files.&lt;/p&gt;</summary><content type="html">&lt;!-- cSpell:words sexchrom OLAP Hsapiens pyarrow ensdb zstandard zstd --&gt;

&lt;p&gt;To query genome annotations locally, &lt;a href="https://bioconductor.org/packages/release/bioc/html/ensembldb.html"&gt;ensembldb&lt;/a&gt; has been my go-to approach.
While I&amp;rsquo;ve already said many good things about this R package (&lt;a href="https://blog.liang2.tw/posts/2016/05/biocondutor-ensembl-reference/"&gt;1&lt;/a&gt;, &lt;a href="https://blog.liang2.tw/posts/2017/11/use-ensdb-database-in-python/"&gt;2&lt;/a&gt;, &lt;a href="https://blog.liang2.tw/posts/2019/01/build-ensdb-from-local-mysql/"&gt;3&lt;/a&gt;), here&amp;rsquo;s a summary of my favorite features:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;I can use the same Ensembl version throughout my project (as a SQLite database)&lt;/li&gt;
&lt;li&gt;I can query the genome-wide annotations and their locations easily and offline&lt;/li&gt;
&lt;li&gt;Nice integration to R&amp;rsquo;s ecosystem that I can easily combine the extracted annotations with my data and other annotations using &lt;a href="https://bioconductor.org/packages/release/bioc/html/GenomicRanges.html"&gt;GenomicRanges&lt;/a&gt; and &lt;a href="https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html"&gt;SummarizedExperiment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Language agnostic to use its database (say, &lt;a href="https://blog.liang2.tw/posts/2017/11/use-ensdb-database-in-python/"&gt;I can query the same db in Python&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Since &lt;a href="https://duckdb.org/"&gt;DuckDB&lt;/a&gt; is designed for analytical query workloads (aka &lt;a href="https://en.wikipedia.org/wiki/Online_analytical_processing"&gt;OLAP&lt;/a&gt;), I decided to convert ensembldb&amp;rsquo;s SQLite database to DuckDB and try it in some of my common analysis scenarios.
DuckDB has a similar look-and-feel to SQLite.
Also, it uses a columnar storage and supports query into external &lt;a href="https://parquet.apache.org/"&gt;Apache Parquet&lt;/a&gt; and &lt;a href="https://arrow.apache.org/"&gt;Apache Arrow&lt;/a&gt; tables.
I tried out some of these user-friendly features in this exercise.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#convert-ensembldbs-database-to-duckdb-through-parquet"&gt;Convert ensembldb&amp;rsquo;s database to DuckDB through Parquet&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#load-parquet-tables-to-duckdb"&gt;Load Parquet tables to DuckDB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database-file-size-comparison"&gt;Database file size comparison&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#use-duckdb-in-ensembldb"&gt;Use DuckDB in ensembldb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#benchmark-the-databases"&gt;Benchmark the databases&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#genome-wide-annotation-query"&gt;Genome-wide annotation query&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#another-genome-wide-annotation-query"&gt;Another genome-wide annotation query&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#gene-specific-lookup"&gt;Gene-specific lookup&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="convert-ensembldbs-database-to-duckdb-through-parquet"&gt;Convert ensembldb&amp;rsquo;s database to DuckDB through Parquet&lt;/h2&gt;
&lt;p&gt;The first step is to convert ensembldb&amp;rsquo;s SQLite database to DuckDB&lt;sup id="fnref:sqlite-to-duckdb"&gt;&lt;a class="footnote-ref" href="#fn:sqlite-to-duckdb"&gt;1&lt;/a&gt;&lt;/sup&gt;.
I decided to export the SQLite tables as individual Parquet files, and then reload them back to DuckDB.
So we could also test the DuckDB&amp;rsquo;s ability to query external parquet files directly.&lt;/p&gt;
&lt;p&gt;For this exercise, I used the &lt;a href="https://www.ensembl.org/Homo_sapiens/"&gt;latest Ensembl release&lt;/a&gt; (v107).
We can download the corresponding SQLite database from &lt;a href="https://annotationhub.bioconductor.org/package2/AHEnsDbs"&gt;AnnotationHub&amp;rsquo;s web interface&lt;/a&gt; (its object ID is &lt;a href="https://annotationhub.bioconductor.org/ahid/AH104864"&gt;AH104864&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl -Lo EnsDb.Hsapiens.v107.sqlite &lt;span class="se"&gt;\&lt;/span&gt;
    https://annotationhub.bioconductor.org/fetch/111610
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We use &lt;a href="https://www.sqlalchemy.org/"&gt;SQLAlchemy&lt;/a&gt; to fetch the schema of all the tables:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sqlalchemy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;MetaData&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;create_engine&lt;/span&gt;

&lt;span class="n"&gt;engine&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;create_engine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;sqlite:///EnsDb.Hsapiens.v107.sqlite&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;metadata&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MetaData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;metadata&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reflect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then list all the tables and their column data types:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;db_tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;metadata&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sorted_tables&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;table&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;db_tables&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;: &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;, &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt; (&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;)&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;# chromosome: seq_name (TEXT), seq_length (INTEGER), is_circular (INTEGER)&lt;/span&gt;
&lt;span class="c1"&gt;# gene: gene_id (TEXT), gene_name (TEXT), gene_biotype (TEXT),&lt;/span&gt;
&lt;span class="c1"&gt;#   gene_seq_start (INTEGER), gene_seq_end (INTEGER),&lt;/span&gt;
&lt;span class="c1"&gt;#   seq_name (TEXT), seq_strand (INTEGER),...&lt;/span&gt;
&lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With the correct data type mapping, we can export all the tables as Parquet by &lt;a href="https://pandas.pydata.org/"&gt;pandas&lt;/a&gt; and &lt;a href="https://arrow.apache.org/docs/python/index.html"&gt;PyArrow&lt;/a&gt;.
Since there are quite many text columns, I also used &lt;a href="https://facebook.github.io/zstd/"&gt;zstandard&lt;/a&gt; to compress the Parquet (with a higher compression level):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pyarrow&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pa&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pyarrow.parquet&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pq&lt;/span&gt;

&lt;span class="n"&gt;sqlite_to_pyarrow_type_mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;TEXT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;string&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;INTEGER&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int64&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;REAL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;float64&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Read each SQLite table as a Arrow table&lt;/span&gt;
&lt;span class="n"&gt;arrow_tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;table&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;metadata&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sorted_tables&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# Construct the corresponding pyarrow schema&lt;/span&gt;
        &lt;span class="n"&gt;schema&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;
            &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sqlite_to_pyarrow_type_mapping&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;
        &lt;span class="p"&gt;])&lt;/span&gt;
        &lt;span class="n"&gt;arrow_tables&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_pandas&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_sql_table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;coerce_float&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;preserve_index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Write each Arrow table to a zstd compressed Parquet&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;table_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;table&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;arrow_tables&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;pq&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write_table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ensdb_v107/&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;table_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;.parquet&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;compression&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;zstd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;compression_level&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="load-parquet-tables-to-duckdb"&gt;Load Parquet tables to DuckDB&lt;/h3&gt;
&lt;p&gt;Finally, we can load the exported Parquet tables to DuckDB.
Here I tested a few approaches:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Create views to the external Parquet files (no content loaded to the db)&lt;/li&gt;
&lt;li&gt;Load the full content&lt;/li&gt;
&lt;li&gt;Load the full content and index the tables (same as the original SQLite db)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Since DuckDB has native support for Parquet files, the syntax is straightforward:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;-- Install and activate the extension&lt;/span&gt;
&lt;span class="n"&gt;INSTALL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parquet&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LOAD&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parquet&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="c1"&gt;-- To create views to external Parquet&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VIEW&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;table&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./ensdb_v107/&amp;lt;table&amp;gt;.parquet&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="c1"&gt;-- To load the full content from external Parquet&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;table&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./ensdb_v107/&amp;lt;table&amp;gt;.parquet&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="c1"&gt;-- To index the table (use .schema to get the original index definitions)&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UNIQUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene_gene_id_idx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene_gene_name_idx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gene_name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene_seq_name_idx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seq_name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that I didn&amp;rsquo;t try to &amp;ldquo;optimize&amp;rdquo; the table indices for my queries.
I simply mirrored the same index definition from the original SQLite database.&lt;/p&gt;
&lt;p&gt;DuckDB&amp;rsquo;s commandline interface works like SQLite.
And it keeps the database in a single file too.
The full conversion including the Parquet step took about 10 seconds to complete.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;duckdb -echo ensdb_v107.duckdb &amp;lt; create_duckdb.sql
duckdb -readonly ensdb_v107.duckdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="database-file-size-comparison"&gt;Database file size comparison&lt;/h3&gt;
&lt;p&gt;Here shows the file size of the databases created with different settings:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Database&lt;/th&gt;
&lt;th style="text-align: right;"&gt;File size&lt;/th&gt;
&lt;th style="text-align: right;"&gt;(%)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;SQLite no indexed&lt;/td&gt;
&lt;td style="text-align: right;"&gt;243MB&lt;/td&gt;
&lt;td style="text-align: right;"&gt;57.9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;strong&gt;SQLite (original)&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;strong&gt;420MB&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;strong&gt;100.0&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;DuckDB with external Parquets&lt;/td&gt;
&lt;td style="text-align: right;"&gt;37.6MB&lt;/td&gt;
&lt;td style="text-align: right;"&gt;9.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;DuckDB&lt;/td&gt;
&lt;td style="text-align: right;"&gt;169MB&lt;/td&gt;
&lt;td style="text-align: right;"&gt;40.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;DuckDB indexed&lt;/td&gt;
&lt;td style="text-align: right;"&gt;528MB&lt;/td&gt;
&lt;td style="text-align: right;"&gt;125.7&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;DuckDB with external Parquets yields the smallest file (~9% of the original size).
It&amp;rsquo;s probably due to a lot of text columns in the database, and zstd compression works really well for the plain text.
This approach could make the ensembldb database more portable.
Say, it&amp;rsquo;s possible to commit it directly into the analysis project&amp;rsquo;s GitHub repo.&lt;/p&gt;
&lt;p&gt;By loading the actual data into DuckDB (without indices), the file grows considerably due to no compression.
Though it is slightly smaller than its SQLite counterpart.
I wonder if this is due to the columnar storage being more space efficient than row storage.
After indexing the DuckDB database, it surprisingly grows to be much larger than SQLite.
I don&amp;rsquo;t know DuckDB&amp;rsquo;s indexing methods enough to understand what happened here.
Since DuckDB is still actively developing its indexing algorithm, I suppose this could be optimized in the future.&lt;/p&gt;
&lt;p&gt;Now we have the databases ready.
Let&amp;rsquo;s see how they perform.&lt;/p&gt;
&lt;!-- cSpell:words dbdir mircrobenchmark noidx EGFR --&gt;

&lt;h2 id="use-duckdb-in-ensembldb"&gt;Use DuckDB in ensembldb&lt;/h2&gt;
&lt;p&gt;It&amp;rsquo;s painless to tell ensembldb to use DuckDB instead.
&lt;a href="https://duckdb.org/docs/api/r"&gt;DuckDB&amp;rsquo;s R client&lt;/a&gt; already implements R&amp;rsquo;s DBI interface, and ensembldb &lt;a href="https://jorainer.github.io/ensembldb/reference/EnsDb.html"&gt;accepts a DBI connection&lt;/a&gt; to create a EnsDb object.
So we already have everything we need:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;duckdb&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ensembldb&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;edb_sqlite&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;EnsDb&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;EnsDb.Hsapiens.v107.sqlite&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;conn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;dbConnect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;duckdb&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;dbdir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ensdb_v107.duckdb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;read_only&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;edb_duckdb&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;EnsDb&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;dbDisconnect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;conn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shutdown&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c1"&gt;# disconnect after usage&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;All the downstream usage of ensembldb is the same from here.&lt;/p&gt;
&lt;h2 id="benchmark-the-databases"&gt;Benchmark the databases&lt;/h2&gt;
&lt;p&gt;Now we have the original SQLite database and three DuckDB databases constructed with various settings ready to use in ensembldb.
Here I tested two scenarios: a genome-wide annotation query and a gene-specific lookup.&lt;/p&gt;
&lt;p&gt;To make the query more realistic and complicated, I also applied a filter to all queries to select annotations only from the canonical chromosomes and remove all LRG genes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;standard_filter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;AnnotationFilter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="n"&gt;seq_name&lt;/span&gt; &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;22&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;X&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Y&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;MT&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;
        &lt;span class="n"&gt;gene_biotype&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;LRG_gene&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I use &lt;a href="https://cran.r-project.org/web/packages/microbenchmark/index.html"&gt;microbenchmark&lt;/a&gt; to benchmark the same query from different databases.
It works like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mbm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;microbenchmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;sqlite_noidx&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;some&lt;/span&gt; &lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;sqlite&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kc"&gt;...&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;duckdb_parquet&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kc"&gt;...&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;duckdb&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kc"&gt;...&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;duckdb_idx&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kc"&gt;...&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="n"&gt;times&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;20&lt;/span&gt;  &lt;span class="c1"&gt;# 50 times for faster queries&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mbm&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="genome-wide-annotation-query"&gt;Genome-wide annotation query&lt;/h3&gt;
&lt;p&gt;The first genome-wide query finds the 5&amp;rsquo;UTR genomic ranges of all the transcripts.
This is one of the most computationally intensive built-in queries I know, involving some genomic range arithmics and querying over multiple tables.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;five_utr_per_tx&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;fiveUTRsByTranscript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;edb&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;filter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;standard_filter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;five_utr_per_tx&lt;/span&gt; &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c1"&gt;## GRangesList object of length 6:&lt;/span&gt;
&lt;span class="c1"&gt;## $ENST00000000442&lt;/span&gt;
&lt;span class="c1"&gt;## GRanges object with 2 ranges and 4 metadata columns:&lt;/span&gt;
&lt;span class="c1"&gt;##       seqnames            ranges strand |   gene_biotype    seq_name&lt;/span&gt;
&lt;span class="c1"&gt;##          &amp;lt;Rle&amp;gt;         &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt; |    &amp;lt;character&amp;gt; &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;##   [1]       11 64305524-64305736      + | protein_coding          11&lt;/span&gt;
&lt;span class="c1"&gt;##   [2]       11 64307168-64307179      + | protein_coding          11&lt;/span&gt;
&lt;span class="c1"&gt;##               exon_id exon_rank&lt;/span&gt;
&lt;span class="c1"&gt;##           &amp;lt;character&amp;gt; &amp;lt;integer&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;##   [1] ENSE00001884684         1&lt;/span&gt;
&lt;span class="c1"&gt;##   [2] ENSE00001195360         2&lt;/span&gt;
&lt;span class="c1"&gt;##   -------&lt;/span&gt;
&lt;span class="c1"&gt;##   seqinfo: 25 sequences (1 circular) from GRCh38 genome&lt;/span&gt;
&lt;span class="c1"&gt;##&lt;/span&gt;
&lt;span class="c1"&gt;## ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here is the microbenchmark results by running the same query in all databases:&lt;/p&gt;
&lt;figure class="invert-in-dark-mode"&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/10/use-duckdb-in-ensembldb/pics/benchmark_genomewide_5utr_by_tx.png"&gt;
    &lt;figcaption&gt;Benchmark results of extracting genome-wide 5'UTR locations per transcript.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;There is a huge performance increase for all DuckDB databases, since this query pretty much scans over the full table.
Overall, DuckDB runs 3+ times faster than SQLite.&lt;/p&gt;
&lt;p&gt;In many cases, there are always a few runs in each database that take significantly more time.
This trend is quite consistent as I re-run the benchmarks multiple times.
While I haven&amp;rsquo;t investigated these outliers, I think this is due to the first run(s) being un-cached.
Surprisingly, DuckDB with indices run much slower than that without indices (especially the first run).
Though the index might be useless in sequential scans, I guess the slowdown could be due to the bigger file (longer to cache) or the query planner accidentally traversing over indices.&lt;/p&gt;
&lt;h2 id="another-genome-wide-annotation-query"&gt;Another genome-wide annotation query&lt;/h2&gt;
&lt;p&gt;The other genome-wide query finds the transcripts of all the genes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;tx_per_gene&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;transcriptsBy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;edb&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;gene&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;filter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;standard_filter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tx_per_gene&lt;/span&gt; &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c1"&gt;## GRangesList object of length 6:&lt;/span&gt;
&lt;span class="c1"&gt;## $ENSG00000000003&lt;/span&gt;
&lt;span class="c1"&gt;## GRanges object with 5 ranges and 12 metadata columns:&lt;/span&gt;
&lt;span class="c1"&gt;##       seqnames              ranges strand |           tx_id&lt;/span&gt;
&lt;span class="c1"&gt;##          &amp;lt;Rle&amp;gt;           &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt; |     &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;##   [1]        X 100633442-100639991      - | ENST00000494424&lt;/span&gt;
&lt;span class="c1"&gt;##   [2]        X 100627109-100637104      - | ENST00000612152&lt;/span&gt;
&lt;span class="c1"&gt;##   [3]        X 100632063-100637104      - | ENST00000614008&lt;/span&gt;
&lt;span class="c1"&gt;##   [4]        X 100627108-100636806      - | ENST00000373020&lt;/span&gt;
&lt;span class="c1"&gt;##   [5]        X 100632541-100636689      - | ENST00000496771&lt;/span&gt;
&lt;span class="c1"&gt;##                 tx_biotype tx_cds_seq_start tx_cds_seq_end         gene_id&lt;/span&gt;
&lt;span class="c1"&gt;##                &amp;lt;character&amp;gt;        &amp;lt;integer&amp;gt;      &amp;lt;integer&amp;gt;     &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;##   [1] processed_transcript             &amp;lt;NA&amp;gt;           &amp;lt;NA&amp;gt; ENSG00000000003&lt;/span&gt;
&lt;span class="c1"&gt;##   [2]       protein_coding        100630798      100635569 ENSG00000000003&lt;/span&gt;
&lt;span class="c1"&gt;##   [3]       protein_coding        100632063      100635569 ENSG00000000003&lt;/span&gt;
&lt;span class="c1"&gt;##   [4]       protein_coding        100630798      100636694 ENSG00000000003&lt;/span&gt;
&lt;span class="c1"&gt;##   [5] processed_transcript             &amp;lt;NA&amp;gt;           &amp;lt;NA&amp;gt; ENSG00000000003&lt;/span&gt;
&lt;span class="c1"&gt;## ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Similarly, here are the benchmark results:&lt;/p&gt;
&lt;figure class="invert-in-dark-mode"&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/10/use-duckdb-in-ensembldb/pics/benchmark_genomewide_tx_by_gene.png"&gt;
    &lt;figcaption&gt;Benchmark of extracting genome-wide gene isoforms.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;This query tells more or less the same story with only a notable difference.
In this case, fully loaded DuckDB with and without indices share the same performance.
Interestingly, all the DuckDB runtimes are in a bimodal distribution.
I don&amp;rsquo;t know why.&lt;/p&gt;
&lt;h3 id="gene-specific-lookup"&gt;Gene-specific lookup&lt;/h3&gt;
&lt;p&gt;My another main scenario is to look up the annotations of a specific gene.
Let&amp;rsquo;s simulate this kind of queries by retrieving all the transcripts of a gene &amp;ldquo;EGFR&amp;rdquo;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;egfr_tx&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;transcripts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;edb&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;filter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;AnnotationFilter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="n"&gt;gene_name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;EGFR&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;egfr_tx&lt;/span&gt;
&lt;span class="c1"&gt;## GRanges object with 14 ranges and 12 metadata columns:&lt;/span&gt;
&lt;span class="c1"&gt;##                   seqnames            ranges strand |           tx_id&lt;/span&gt;
&lt;span class="c1"&gt;##                      &amp;lt;Rle&amp;gt;         &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt; |     &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000344576        7 55019017-55171037      + | ENST00000344576&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000275493        7 55019017-55211628      + | ENST00000275493&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000455089        7 55019021-55203076      + | ENST00000455089&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000342916        7 55019032-55168635      + | ENST00000342916&lt;/span&gt;
&lt;span class="c1"&gt;##         LRG_304t1        7 55019032-55207338      + |       LRG_304t1&lt;/span&gt;
&lt;span class="c1"&gt;##               ...      ...               ...    ... .             ...&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000450046        7 55109723-55211536      + | ENST00000450046&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000700145        7 55163753-55205865      + | ENST00000700145&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000485503        7 55192811-55200802      + | ENST00000485503&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000700146        7 55198272-55208067      + | ENST00000700146&lt;/span&gt;
&lt;span class="c1"&gt;##   ENST00000700147        7 55200573-55206016      + | ENST00000700147&lt;/span&gt;
&lt;span class="c1"&gt;## ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure class="invert-in-dark-mode"&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/10/use-duckdb-in-ensembldb/pics/benchmark_extract_specific_gene.png"&gt;
    &lt;figcaption&gt;Benchmark of extracting the annotations of a specific gene.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;SQLite with indices undoubtedly has the best performance.
Understandably, it&amp;rsquo;s been fine tuned for this very use case (extracting a few rows using indices).
And SQLite without an index takes the most time to complete, so it&amp;rsquo;s necessary to always index the tables.&lt;/p&gt;
&lt;p&gt;The performance of all three DuckDB databases fall in between the two extremes of SQLite dbs.
Unlike SQLite, indexed DuckDB only speeds up the query a little bit (21.0ms vs 22.4ms on average).
Given the worse performance of one of the genome-wide queries above using the indexed DuckDB db,
I think it&amp;rsquo;s optional to create indices for ensembldb&amp;rsquo;s DuckDB dbs.&lt;/p&gt;
&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;Here is the overview of the benchmarking results together with the db&amp;rsquo;s file size.
The table below displays the performance in average speed-up ratio (and the worst case ratio) over the original SQLite db (ratio the higher the better):&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Database&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Size (%)&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Genome I&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Genome II&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Gene-specific lookup&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;SQLite no indexed&lt;/td&gt;
&lt;td style="text-align: right;"&gt;57.9&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.61 (0.78)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.88 (1.02)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.044 (0.12)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;strong&gt;SQLite (original)&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;strong&gt;100.0&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;strong&gt;1.00 (1.00)&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;strong&gt;1.00 (1.00)&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;strong&gt;1.00 (1.00)&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;DuckDB w. ext. Parquets&lt;/td&gt;
&lt;td style="text-align: right;"&gt;9.0&lt;/td&gt;
&lt;td style="text-align: right;"&gt;3.36 (3.69)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;4.14 (4.63)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.15 (0.35)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;DuckDB&lt;/td&gt;
&lt;td style="text-align: right;"&gt;40.2&lt;/td&gt;
&lt;td style="text-align: right;"&gt;4.70 (4.76)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;6.30 (6.73)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.61 (0.81)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;DuckDB indexed&lt;/td&gt;
&lt;td style="text-align: right;"&gt;125.7&lt;/td&gt;
&lt;td style="text-align: right;"&gt;3.66 (1.87)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;6.29 (6.33)&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.65 (1.80)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Overall, DuckDB shows impressive performance increase for genome-wide queries.
It uses up less storage too.
While DuckDB is slower than SQLite when it comes to gene-specific lookups, since we are talking about tens of milliseconds per query, unless we are running thousands of these queries, the performance impact is minimal.
On the other hand, genome-wide queries are saving seconds per query.&lt;/p&gt;
&lt;p&gt;As the benchmark results shown, we could replace the original ensembldb database with a DuckDB database by loading the tables and removing the indices.
If the user is willing to sacrifice some performance in gene-specific lookups, DuckDB with external Parquet files only uses &amp;lt; 10% of the original disk space but it still runs faster for genome-wide queries.&lt;/p&gt;
&lt;p&gt;While the default indices copied from SQLite are not very helpful, I didn&amp;rsquo;t tune the indices to maximally speed up the gene-specific lookups.
We can probably also tune the Parquet compression ratio to find a better balance between the decompression speed and file size.
Note that DuckDB&amp;rsquo;s file format is not stabilized yet, so the database needs to be re-created in newer DuckDB versions.&lt;/p&gt;
&lt;p&gt;All in all, I think DuckDB advertises itself accurately when it comes to analytical query workloads.
It shows good performance when it queries a large portion of its content.
By having a similar interface to SQLite and clients in popular languages (R, Python, and etc),
it&amp;rsquo;s easy to change an existing SQLite usecase to use DuckDB.
My small exercise with ensembldb has convinced me to try out DuckDB in more scenarios too.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:sqlite-to-duckdb"&gt;
&lt;p&gt;There is an official extension &lt;a href="https://github.com/duckdblabs/sqlite_scanner"&gt;sqlite_scanner&lt;/a&gt; currently under development that lets a DuckDB attach directly to a SQLite database.
So in the future, it could be much easier to convert SQLite to DuckDB.&amp;#160;&lt;a class="footnote-backref" href="#fnref:sqlite-to-duckdb" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="r"></category><category term="python"></category><category term="ensembldb"></category><category term="sqlite"></category><category term="duckdb"></category></entry><entry><title>Thesis in LaTeX</title><link href="https://blog.liang2.tw/posts/2022/03/thesis-latex/" rel="alternate"></link><published>2022-03-12T00:00:00-06:00</published><updated>2022-06-25T15:46:57-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2022-03-12:/posts/2022/03/thesis-latex/</id><summary type="html">&lt;!-- cSpell:words zotero WUSTL --&gt;

&lt;p&gt;A few months ago, I finished &lt;a href="https://github.com/ccwang002/phd-thesis"&gt;my PhD thesis&lt;/a&gt; in LaTeX.
The WUSTL LaTeX template I could find has a long history&lt;sup id="fnref:note-template-history"&gt;&lt;a class="footnote-ref" href="#fn:note-template-history"&gt;1&lt;/a&gt;&lt;/sup&gt;, which has a relative lengthy implementation and includes unnecessary code.
I didn&amp;rsquo;t feel comfortable to build on top of it.&lt;/p&gt;
&lt;p&gt;I ended up rewriting the template â€¦&lt;/p&gt;</summary><content type="html">&lt;!-- cSpell:words zotero WUSTL --&gt;

&lt;p&gt;A few months ago, I finished &lt;a href="https://github.com/ccwang002/phd-thesis"&gt;my PhD thesis&lt;/a&gt; in LaTeX.
The WUSTL LaTeX template I could find has a long history&lt;sup id="fnref:note-template-history"&gt;&lt;a class="footnote-ref" href="#fn:note-template-history"&gt;1&lt;/a&gt;&lt;/sup&gt;, which has a relative lengthy implementation and includes unnecessary code.
I didn&amp;rsquo;t feel comfortable to build on top of it.&lt;/p&gt;
&lt;p&gt;I ended up rewriting the template based on the &lt;a href="https://www.ctan.org/pkg/memoir"&gt;memoir&lt;/a&gt; package, which is designed for long documents like book and thesis.
Overall I enjoyed my experience writing in LaTeX, so I wanted to share my LaTeX setup and my experience of editing a long document.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#writing-thesis-in-latex-is-easy-and-rewarding-once-its-set-up"&gt;Writing thesis in LaTeX is easy and rewarding (once it&amp;rsquo;s set up)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#my-latex-setup"&gt;My LaTeX setup&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#bibliography-management-with-zotero-and-better-bibtex"&gt;Bibliography management with Zotero and Better BibTeX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#overflowing-legend-of-large-figures"&gt;Overflowing legend of large figures&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#folder-structure"&gt;Folder structure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#github-online-editing-workflow"&gt;GitHub online editing workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#package-recommendation-to-start-a-new-latex-template"&gt;Package recommendation to start a new LaTeX template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#why-i-didnt-use-latex-a-lot-during-my-phd"&gt;Why I didn&amp;rsquo;t use LaTeX a lot during my PhD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#types-of-documents-i-will-write-in-latex-in-future"&gt;Types of documents I will write in LaTeX in future&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="writing-thesis-in-latex-is-easy-and-rewarding-once-its-set-up"&gt;Writing thesis in LaTeX is easy and rewarding (once it&amp;rsquo;s set up)&lt;/h2&gt;
&lt;p&gt;The advantages of LaTeX and its ecosystem&lt;sup id="fnref:latex-advantages"&gt;&lt;a class="footnote-ref" href="#fn:latex-advantages"&gt;2&lt;/a&gt;&lt;/sup&gt; over WYSIWYG editors (e.g., Word and Google Doc) are more obvious when the document gets longer, as WYSIWYG editors start to slow down, say, to change the figure style across the whole document, or to swap some figures and sections.
On the other hand, the LaTeX workflow remains the same.
While the compilation takes longer, it usually runs in the background and I have adapted to only check the output periodically.
I appreciate its reliability and modularity when my document gets really long.
I can just focus on the writing.&lt;/p&gt;
&lt;p&gt;The hardest part is the setup of a LaTeX document.&lt;/p&gt;
&lt;p&gt;What are the &amp;ldquo;recommended&amp;rdquo; packages? What are all these parameters of the packages and commands? How to set up the folder structure? How do I make a figure block whose caption overflows to the next page (and any other visual components)? Finally, not to mention the time I spent fixing the errors and the debugging when the code doesn&amp;rsquo;t work as expected.&lt;/p&gt;
&lt;p&gt;Now, after some time going over the documentations, I wanted to write down my setup for future usage.&lt;/p&gt;
&lt;h2 id="my-latex-setup"&gt;My LaTeX setup&lt;/h2&gt;
&lt;p&gt;I prefer the combination of LuaLaTeX (XeLaTeX) and BibLaTeX/Biber.
Both LaTeX engines can utilize system fonts and support Unicode.
As for the bibliography management, BibLaTeX is more customizable.&lt;/p&gt;
&lt;h3 id="bibliography-management-with-zotero-and-better-bibtex"&gt;Bibliography management with Zotero and Better BibTeX&lt;/h3&gt;
&lt;p&gt;I manage all my reference in &lt;a href="https://www.zotero.org/"&gt;Zotero&lt;/a&gt;.
&lt;a href="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/"&gt;My Zotero setup&lt;/a&gt; (Zotero + &lt;a href="https://github.com/jlegewie/zotfile"&gt;Zotfile&lt;/a&gt;) has been the same over the past 6 years, which is surprisingly stable in the software world.
Zotero has builtin support to export the reference in BibTeX and BibLaTeX formats.&lt;/p&gt;
&lt;p&gt;To further integrate Zotero to the LaTeX workflow, &lt;a href="https://retorque.re/zotero-better-bibtex/"&gt;Better BibTeX for Zotero&lt;/a&gt; plugin comes in handy.
The plugin can customize the citation key generation, and it can automatically export the &lt;code&gt;.bib&lt;/code&gt; file when the reference changes.&lt;/p&gt;
&lt;p&gt;I currently have the following rule for the citation key generation:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[auth+initials:lower]_[authorLast+initials:lower][&amp;gt;1]:[shorttitle2_2][year]
|[Auth+initials:lower:(unknown)]:[Title:capitalize:substring=1,64][year]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The key will try to extract the first and last author of the paper, the first two words of the title, and the publication year.
If the reference is not a article (mostly websites), it will try to use the author, title, and year when available.&lt;/p&gt;
&lt;p&gt;Under this rule, for example, the citation key of the famous CRISPR paper (&lt;a href="https://pubmed.ncbi.nlm.nih.gov/22745249/"&gt;doi:10.1126/science.1225829&lt;/a&gt;):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Jinek, M., Chylinski, K., Fonfara, I., Hauer, M., Doudna, J.A., and Charpentier, E. (2012). A programmable dual-RNA-guided DNA endonuclease in adaptive bacterial immunity. Science 337, 816â€“821.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;becomes &lt;code&gt;jinekm_charpentiere:ProgrammableDualRNAguided2012&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Better BibTeX also allows fixing the citation key, which is useful to keep a nickname of some commonly referred publications, or to maintain backward compatibility.&lt;/p&gt;
&lt;h3 id="overflowing-legend-of-large-figures"&gt;Overflowing legend of large figures&lt;/h3&gt;
&lt;p&gt;A feature I found very useful is to allow figure caption/legend to overflow to the next page, which is common in many journals.
Usually the figure is large, taking up the full page, and has multiple panels combined into one file.
And the remaining figure legend need to be put at the next page.
Here&amp;rsquo;s an example of the desired behavior:&lt;/p&gt;
&lt;figure class="full-img invert-in-dark-mode"&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/03/thesis-latex/pics/fig_legend_first_half.png"&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/03/thesis-latex/pics/fig_legend_second_half.png"&gt;
    &lt;figcaption&gt;Example of the figure legend overflow.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;To create &amp;ldquo;fake&amp;rdquo; panels for &lt;a href="https://www.ctan.org/pkg/subcaption"&gt;subcaption&lt;/a&gt; to keep track of the reference, I followed &lt;a href="https://tex.stackexchange.com/a/255790"&gt;the suggestion on LaTeX Stack Exchange&lt;/a&gt; to create a hidden anchor for the label using &lt;code&gt;\phantomsubcaption&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To allow the figure legend/caption to overflow, two figure environments are constructed side by side.
Then I used a quotation helper function &lt;code&gt;\sourceatright&lt;/code&gt; by memoir to place the &amp;ldquo;(legend continued on next page)&amp;rdquo; right aligned to the end of legend.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s the final helper functions in the permeable:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;% Allowing subcaptions when all figure panels are combined&lt;/span&gt;
&lt;span class="c"&gt;% into one source image. Require subcaption package.&lt;/span&gt;
&lt;span class="c"&gt;% Based on https://tex.stackexchange.com/a/255790&lt;/span&gt;
&lt;span class="k"&gt;\newcommand&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\phantomlabel&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;[1]&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="c"&gt;%&lt;/span&gt;
    &lt;span class="k"&gt;\parbox&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;0pt&lt;span class="nb"&gt;}{&lt;/span&gt;&lt;span class="k"&gt;\phantomsubcaption\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;#1&lt;span class="nb"&gt;}}&lt;/span&gt;&lt;span class="c"&gt;%&lt;/span&gt;
&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;% Note for figure caption spanning multiple pages&lt;/span&gt;
&lt;span class="k"&gt;\newcommand&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\legendcontdnote&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;&lt;span class="k"&gt;\sourceatright&lt;/span&gt;&lt;span class="na"&gt;[2em]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="c"&gt;%&lt;/span&gt;
        &lt;span class="k"&gt;\footnotesize\itshape&lt;/span&gt;(legend continued on next page)&lt;span class="c"&gt;%&lt;/span&gt;
&lt;span class="nb"&gt;}}&lt;/span&gt;
&lt;span class="k"&gt;\newcommand&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\legendcontdref&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;[1]&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\emph&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;(&lt;span class="k"&gt;\fref&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;#1&lt;span class="nb"&gt;}&lt;/span&gt; continued)&lt;span class="nb"&gt;}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And the following shows an example usage:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure&lt;span class="nb"&gt;}&lt;/span&gt;[p]  &lt;span class="c"&gt;% usually large and will need a full page&lt;/span&gt;
    &lt;span class="k"&gt;\centering&lt;/span&gt;
    &lt;span class="k"&gt;\phantomlabel&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:panel-a&lt;span class="nb"&gt;}&lt;/span&gt;  &lt;span class="c"&gt;% hidden label of each figure panel&lt;/span&gt;
    &lt;span class="k"&gt;\phantomlabel&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:panel-b&lt;span class="nb"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;\phantomlabel&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:panel-c&lt;span class="nb"&gt;}&lt;/span&gt;
    ...
    &lt;span class="k"&gt;\includegraphics&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figures/myfigure.pdf&lt;span class="nb"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;\caption&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="c"&gt;%&lt;/span&gt;
        Overview of the whole figure.
        &lt;span class="k"&gt;\subref&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:panel-a&lt;span class="nb"&gt;}&lt;/span&gt;
        Some description about panel A.
        &lt;span class="k"&gt;\legendcontdnote&lt;/span&gt;
    &lt;span class="nb"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:myfigure&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure&lt;span class="nb"&gt;}&lt;/span&gt;[t]  &lt;span class="c"&gt;% place at the top of the very next page&lt;/span&gt;
    &lt;span class="k"&gt;\centering&lt;/span&gt;
    &lt;span class="k"&gt;\legend&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="c"&gt;%&lt;/span&gt;
        &lt;span class="k"&gt;\legendcontdref&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:myfigure&lt;span class="nb"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;\subref&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:panel-b&lt;span class="nb"&gt;}&lt;/span&gt;
        Some description about panel B.
        &lt;span class="k"&gt;\subref&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig:panel-c&lt;span class="nb"&gt;}&lt;/span&gt;
        Some description about panel C.
        ...
    &lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="folder-structure"&gt;Folder structure&lt;/h3&gt;
&lt;p&gt;I have a very typical folder structure of a thesis:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;wustlthesis.cls     # document class
thesis.tex          # main file (structure and settings)
abstract.tex
acknowledgments.tex
chapters/           # text per chapter
  â”œâ”€â”€ XX_name.tex
  â””â”€â”€ ...
figures/            # figures per chapter
  â”œâ”€â”€ chapXX_name/
  â””â”€â”€ ...
fonts/              # External fonts
.github/workflows/  # Autobuild GitHub workflows
README.md           # Instructions to build the file
latexmkrc           # latexmk settings
references.bib      # Bibliography in BibLaTex
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The main goal of the folder structure is to organize the materials by chapters.
I also keep all the related files together so the project is standalone and reproducible.&lt;/p&gt;
&lt;h3 id="github-online-editing-workflow"&gt;GitHub online editing workflow&lt;/h3&gt;
&lt;p&gt;Another pain point of LaTeX setup is the installation of the toolchains (TexLive, MacTex, and etc).
Sometimes I want to work on the document on other&amp;rsquo;s laptop for just a while, to fix an obvious typo or to write down some ideas.
Also a working LaTeX toolchain always read to use will help others to adapt the workflow much more easily.&lt;/p&gt;
&lt;p&gt;Turn out I can tap into the continuous integration and continuous delivery (CI/CD) service provided by the online code repositories.
On GitHub, such service is &lt;a href="https://docs.github.com/en/actions/using-workflows"&gt;GitHub Actions&lt;/a&gt;, allowing user to provide custom Docker image and run arbitrary code.&lt;/p&gt;
&lt;p&gt;Luckily, someone has already laid out the ground work by preparing a TeXLive environment into a GitHub Action workflow: &lt;a href="https://github.com/xu-cheng/latex-action"&gt;https://github.com/xu-cheng/latex-action&lt;/a&gt;.
Below is an example of creating an online workflow to build the document using LuaLaTeX:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# .github/workflows/build_latex.yml&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;Build LaTeX PDF&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="nt"&gt;on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;push&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="nt"&gt;jobs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;runs-on&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;ubuntu-latest&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;steps&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;Check out Git Repository&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;uses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;actions/checkout@v2&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;Build LaTeX files&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;uses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;xu-cheng/latex-action@v2&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;root_file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;thesis.tex&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;latexmk_use_lualatex&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;true&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;Check if PDF file is generated&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p p-Indicator"&gt;|&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="no"&gt;file thesis.pdf | grep -q &amp;#39; PDF &amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;Upload PDF&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;uses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;actions/upload-artifact@v2&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;with&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;PDF&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;thesis.pdf&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The workflow is triggered on every git push. Here is an example of my WUSTL thesis template (&lt;a href="https://github.com/ccwang002/wustl-latex-dissertation-template/actions/workflows/build_latex.yml"&gt;link&lt;/a&gt;):&lt;/p&gt;
&lt;figure&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/03/thesis-latex/pics/github_actions_overview.png"&gt;
    &lt;figcaption&gt;Overview of all the online LaTeX document compilation jobs using GitHub actions.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Not only the workflow records the output messages useful to debug, the final PDF output is stored as an artifact.
I no longer need to install LaTeX locally.&lt;/p&gt;
&lt;figure&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/03/thesis-latex/pics/github_actions_artifact.png"&gt;
    &lt;figcaption&gt;Auto-generated PDF output of the document.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;By putting everything in a GitHub repo, I can also use &lt;a href="https://docs.github.com/en/codespaces/the-githubdev-web-based-editor"&gt;GitHub&amp;rsquo;s online editor&lt;/a&gt; to work on my document in a web browser anywhere.
Together with GitHub Actions, it can be an alternative to online LaTeX platform like Overleaf; hacky but more flexible.&lt;/p&gt;
&lt;figure class="full-img"&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/03/thesis-latex/pics/github_online_editor.png"&gt;
    &lt;figcaption&gt;Online editor of a LaTeX project in a GitHub repository.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Currently, the online workflow is not fully optimized.
My full thesis takes about 6&amp;ndash;12 minutes to complete on GitHub, while locally, a full run without cache takes about 3&amp;ndash;5 minutes.
And incremental local builds can be much faster with caches.
By caching the environment and the intermediate outputs, the online workflow can be faster.&lt;/p&gt;
&lt;h2 id="package-recommendation-to-start-a-new-latex-template"&gt;Package recommendation to start a new LaTeX template&lt;/h2&gt;
&lt;p&gt;I look into a few package alternatives while updating the thesis template.&lt;/p&gt;
&lt;p&gt;For a new template/project, start with &lt;a href="https://www.ctan.org/pkg/memoir"&gt;memoir&lt;/a&gt;, seriously.&lt;/p&gt;
&lt;p&gt;Memoir is certainly a giant package and has a very lengthy documentation (~600 pages).
But it pretty much covers &amp;gt; 90% of the possible formatting I can possibly think of.
The first few chapters of its documentation (up to &amp;ldquo;Paragraphs and Lists&amp;rdquo; chapter) are very useful to get the main components and structures in place.&lt;/p&gt;
&lt;p&gt;While memoir is powerful and covers everything, I do wish certain aspects of it can be better. The chapter title styling is complicated and difficult.
My another issue is the lack of examples.
I understand the current documentation is already crazily long.
But memoir has &lt;em&gt;many many&lt;/em&gt; options and features that I sometimes find it difficult to comprehend how to use a specific feature.
Maybe more examples or code snippets can be added in a separate documentation.&lt;/p&gt;
&lt;p&gt;With memoir, very few additional packages are required.
Here is a short list of packages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/microtype"&gt;microtype&lt;/a&gt;: final touch on the typography. pure black magic in my view&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/enumitem"&gt;enumitem&lt;/a&gt;: list environment customization&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/threeparttable"&gt;threeparttable&lt;/a&gt;: pretty table styling and in-table notes&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.ctan.org/pkg/subcaption"&gt;subcaption&lt;/a&gt;: subfloat references&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/hyperref"&gt;hyperref&lt;/a&gt;: link and PDF metadata&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/graphicx"&gt;graphicx&lt;/a&gt;: external graphics&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/fontspec"&gt;fontspec&lt;/a&gt;: custom system fonts&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/csquotes"&gt;csquotes&lt;/a&gt;: quotes&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ctan.org/pkg/babel"&gt;babel&lt;/a&gt;: localization&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each package is powerful in their specific usage.
Their documentations are worth reading to fully utilize the package.&lt;/p&gt;
&lt;h2 id="why-i-didnt-use-latex-a-lot-during-my-phd"&gt;Why I didn&amp;rsquo;t use LaTeX a lot during my PhD&lt;/h2&gt;
&lt;p&gt;I didn&amp;rsquo;t really have many chances to use LaTeX during my PhD.
It&amp;rsquo;s usually not worth the effort to use LaTeX for documents less than 50 pages.&lt;/p&gt;
&lt;p&gt;The most common documents I need to produce are presentations and manuscripts, and I don&amp;rsquo;t think LaTeX is useful here.
My presentations are figure heavy.
Many figures are clipped from webpages, tool outputs, and other papers.
They are messy and require post-editing like croppings and overlays, which are easier to do interactively; PowerPoint wins.
Moreover, I need to finish my slides in a short time.
LaTeX is not the right tool.&lt;/p&gt;
&lt;p&gt;As for the manuscripts, the figures and text are managed separately, so there is no need to work on how to insert the figures at the right location in text.
The main text editing is about citations.
While LaTeX is good at them, Zotero can manage citations and bibliography easily on Google Docs, Word, and LibreOffice Writer.
Another main hassle of manuscript editing is collaboration.
While it&amp;rsquo;s possible for LaTeX, the existing services have a high entry bar with little benefit.&lt;/p&gt;
&lt;h2 id="types-of-documents-i-will-write-in-latex-in-future"&gt;Types of documents I will write in LaTeX in future&lt;/h2&gt;
&lt;p&gt;If I need to write a report longer than 50 pages, I will write in LaTeX and use my thesis setup.&lt;/p&gt;
&lt;p&gt;I also have been updating my CV in LaTeX.
While I am playing with LaTeX for my thesis, I also applied the new things I learned to &lt;a href="https://github.com/ccwang002/cv"&gt;my CV&lt;/a&gt;.
In fact, I applied a different theme and rewrote many parts of the theme to utilize the awesome packages.
I like my new CV to be clean, minimalist, and easy to extend.
I don&amp;rsquo;t know yet if I want to create my one-page resume in LaTeX.&lt;/p&gt;
&lt;p&gt;So is LaTeX worth learning if I am not going to write a book or a long report in future?&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s a bad investment in time for sure, since I have been putting hours in learning LaTeX.
But I have since been paying more attention to typography and layout of my documents in general.
I appreciate certain aesthetics of the printings.
And by trying to fulfill the desired look and feel in my documents, I&amp;rsquo;ve also improved my editing skills in all WYSIWYG editors (even Adobe InDesign) and webpages (CSS).
It&amp;rsquo;s hard to beat that artistic satisfaction of getting the style right.&lt;/p&gt;
&lt;p&gt;I am glad that I learned LaTeX.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:note-template-history"&gt;
&lt;p&gt;The history of the existing template goes way back to 1995.
I tried to summarize the history I can be find from the file comments &lt;a href="https://github.com/ccwang002/wustl-latex-dissertation-template/#origin-of-this-template"&gt;here&lt;/a&gt;.&amp;#160;&lt;a class="footnote-backref" href="#fnref:note-template-history" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:latex-advantages"&gt;
&lt;p&gt;Here are the advantages LaTeX I appreciate the most:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Precise control of the layout&lt;/li&gt;
&lt;li&gt;Automatic positioning of float objects (figures and tables)&lt;/li&gt;
&lt;li&gt;Programmable and reusable visual components, especially those provided by the packages&lt;/li&gt;
&lt;li&gt;Excellent bibliography management&lt;/li&gt;
&lt;li&gt;Excellent equation display&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class="footnote-backref" href="#fnref:latex-advantages" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="en"></category><category term="latex"></category></entry><entry><title>Fix Fira Code font ligatures and features</title><link href="https://blog.liang2.tw/posts/2022/03/fix-fira-code-font-features/" rel="alternate"></link><published>2022-03-01T00:00:00-06:00</published><updated>2022-05-13T12:50:28-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2022-03-01:/posts/2022/03/fix-fira-code-font-features/</id><summary type="html">&lt;p&gt;&lt;a href="https://github.com/tonsky/FiraCode"&gt;Fira Code&lt;/a&gt; has been my choice of the programming font for a while. It&amp;rsquo;s also the default monospace font of my blog.
I like its ligatures such as &lt;code&gt;&amp;gt;=&lt;/code&gt; and connected lines &lt;code&gt;======&lt;/code&gt; &lt;code&gt;------&lt;/code&gt;.
It evens renders the progress bar nicely &lt;code&gt;î¸ƒî¸„î¸„î¸„î¸î¸î¸‚&lt;/code&gt;.
It makes my plain text documents look neat.&lt;/p&gt;
&lt;p&gt;That said, I â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://github.com/tonsky/FiraCode"&gt;Fira Code&lt;/a&gt; has been my choice of the programming font for a while. It&amp;rsquo;s also the default monospace font of my blog.
I like its ligatures such as &lt;code&gt;&amp;gt;=&lt;/code&gt; and connected lines &lt;code&gt;======&lt;/code&gt; &lt;code&gt;------&lt;/code&gt;.
It evens renders the progress bar nicely &lt;code&gt;î¸ƒî¸„î¸„î¸„î¸î¸î¸‚&lt;/code&gt;.
It makes my plain text documents look neat.&lt;/p&gt;
&lt;p&gt;That said, I don&amp;rsquo;t like the default ampersands &lt;code&gt;&amp;amp;&lt;/code&gt; and the at signs &lt;code&gt;@&lt;/code&gt;.
I find them harder to read than their traditional looks.
To change their looks, we can enable the alternative ligatures and features of the font using &lt;a href="https://ilovetypography.com/OpenType/opentype-features.html"&gt;different OpenType features&lt;/a&gt; (see also &lt;a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Fonts/OpenType_fonts_guide"&gt;the guide on MDN&lt;/a&gt;).
In this case, &lt;code&gt;ss05&lt;/code&gt; and &lt;code&gt;ss08&lt;/code&gt; enable the traditional looks of ampersands and at signs, respectively.
Most modern editors and word processors are able to configure the feature sets in use.&lt;/p&gt;
&lt;figure&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/03/fix-fira-code-font-features/pics/fira_code_comparison.png"&gt;
    &lt;figcaption&gt;Comparison of the Fira Code rendering with and without the features fixed (ss01, ss03, ss05, and ss08).&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Unfortunately, I encounter programs that are unable to configure the font features.
While tools like &lt;a href="https://twardoch.github.io/fonttools-opentype-feature-freezer/"&gt;pyftfeatfreeze (OpenType Feature Freezer)&lt;/a&gt; are able to swap specific glyphs by directly editing the font file, ligatures of those glyphs may fail.
For example, &lt;code&gt;ss08&lt;/code&gt; feature (e.g., &lt;code&gt;==&lt;/code&gt;, &lt;code&gt;!=&lt;/code&gt;, and &lt;code&gt;===&lt;/code&gt;) won&amp;rsquo;t be permanently enabled using this approach.&lt;/p&gt;
&lt;h2 id="permanently-fix-the-font-features-using-the-official-build-script-update-in-2022-03"&gt;Permanently fix the font features using the official build script (update in 2022-03)&lt;/h2&gt;
&lt;p&gt;Thanks to the &lt;a href="https://github.com/tonsky/FiraCode/pull/1387"&gt;pull request by &lt;code&gt;@Daxtorim&lt;/code&gt;&lt;/a&gt; a few days after this post was published, we now are able to permanently fix the font features using the official build script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;docker run -it --rm &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="nv"&gt;$PWD&lt;/span&gt;:/opt/FiraCode &lt;span class="se"&gt;\&lt;/span&gt;
    tonsky/firacode:latest &lt;span class="se"&gt;\&lt;/span&gt;
    ./FiraCode/script/build.sh &lt;span class="se"&gt;\&lt;/span&gt;
    -f &lt;span class="s2"&gt;&amp;quot;ss01,ss03,ss05,ss08&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    -n &lt;span class="s2"&gt;&amp;quot;Fira Code ss01 ss03 ss05 ss08&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Rename the generated TTFs&lt;/span&gt;
parallel &lt;span class="s1"&gt;&amp;#39;mv {} {.}.ss1358_enabled.ttf&amp;#39;&lt;/span&gt; ::: distr/ttf/&lt;span class="s1"&gt;&amp;#39;Fira Code ss01 ss03 ss05 ss08&amp;#39;&lt;/span&gt;/*.ttf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And that&amp;rsquo;s it!
This is the easiest solution and it works straight out of the box.
Praise the open source community :)
I still kept the original instructions below to manually create the patches since that&amp;rsquo;s what happens behind the scene.&lt;/p&gt;
&lt;h2 id="permanently-fix-the-font-features"&gt;Permanently fix the font features&lt;/h2&gt;
&lt;p&gt;By changing the source code of the font generation, it should be possible to permanently fix any font features (aka patching).
As mentioned by &lt;a href="https://github.com/tonsky/FiraCode/issues/869#issuecomment-548006778"&gt;the original author (&lt;code&gt;@tonsky&lt;/code&gt;)&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There is probably a simpler approach to patching the font, just concat whatever code there is in ssXX and add it to the end of calt feature.
That should work on the current version of the font, but youâ€™ll need to do your own research on which scripts to use for that&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;And that&amp;rsquo;s exactly my patch for &lt;code&gt;FiraCode.glyphs&lt;/code&gt;.
Copy all the content of the features (say, ss01, ss03, ss05, and ss08) to &lt;code&gt;calt&lt;/code&gt;. So the original code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# FiraCode.glyphs
{
code = &amp;quot;lookup less_bar_greater ...
... underscores;\012&amp;quot;;
name = calt;
},
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;becomes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
code = &amp;quot;lookup less_bar_greater ...
... underscores;\012
# ss01\012  sub r by r.ss01;
# ss03\012  sub ampersand by ampersand.ss03;...
# ss05\012  sub at by at.ss05;\012sub asciitilde.spacer&amp;#39;; ...
# ss08\012  sub equal_equal.liga by equal_equal.ss08;...
&amp;quot;;
name = calt;
},
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then build the font from the &lt;code&gt;.glyphs&lt;/code&gt; file using the Docker image:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;docker run -it --rm &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="nv"&gt;$PWD&lt;/span&gt;:/opt/FiraCode &lt;span class="se"&gt;\&lt;/span&gt;
    tonsky/firacode ./FiraCode/script/build.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To set a different font name for the feature fixed fonts, I use &lt;a href="https://twardoch.github.io/fonttools-opentype-feature-freezer/"&gt;pyftfeatfreeze&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;parallel &lt;span class="se"&gt;\&lt;/span&gt;
    pyftfeatfreeze &lt;span class="se"&gt;\&lt;/span&gt;
        --suffix --usesuffix&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;#39;ss01 ss03 ss05 ss08&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        -v -n &lt;span class="se"&gt;\&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;{}&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;features_enabled/{/.}.ss1358_enabled.ttf&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        ::: ttf/*.ttf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Coding"></category><category term="en"></category><category term="font"></category></entry><entry><title>Change the blog commenting system to utterances</title><link href="https://blog.liang2.tw/posts/2022/02/blog-comment-utterances/" rel="alternate"></link><published>2022-02-20T00:00:00-06:00</published><updated>2022-05-13T12:52:11-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2022-02-20:/posts/2022/02/blog-comment-utterances/</id><summary type="html">&lt;p&gt;My blog is statically generated, so it needs an external service for commenting. I chose &lt;a href="https://disqus.com/"&gt;Disqus&lt;/a&gt; when I started my blog because it was a popular choice, and it is free and easy to setup. However, there&amp;rsquo;s been increasing concern about its extensive user tracking, ads, and therefore a â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;My blog is statically generated, so it needs an external service for commenting. I chose &lt;a href="https://disqus.com/"&gt;Disqus&lt;/a&gt; when I started my blog because it was a popular choice, and it is free and easy to setup. However, there&amp;rsquo;s been increasing concern about its extensive user tracking, ads, and therefore a toll on the page loading performance&lt;sup id="fnref:disqus downsides"&gt;&lt;a class="footnote-ref" href="#fn:disqus downsides"&gt;1&lt;/a&gt;&lt;/sup&gt;. Heck, I don&amp;rsquo;t even load Disqus myself when I check my own blog:&lt;/p&gt;
&lt;figure&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/02/blog-comment-utterances/pics/disqus_blocked_by_privacy_badger_screenshot.png"&gt;
    &lt;figcaption&gt;What my blog looks like from my end, where Disqus is blocked by &lt;a href="https://privacybadger.org/Privacy"&gt;Privacy Badger&lt;/a&gt; by default.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Recently, I was finally able to look into the alternatives to Disqus. I landed on &lt;a href="https://utteranc.es/"&gt;utterances&lt;/a&gt;, a commenting widget based on GitHub Issues. I like it for a few reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Free and open source&lt;/li&gt;
&lt;li&gt;No trackings and ads (for now at least)&lt;/li&gt;
&lt;li&gt;Comments are tied to the blog&amp;rsquo;s code repository&lt;/li&gt;
&lt;li&gt;Moderation using existing GitHub tools/interface&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Switch to a new commenting systems can be hard due to the loss of the old comments. But since there are only a total of 75 comments on my blog, I don&amp;rsquo;t have a lot to miss :) I did back up the old comments because I enjoyed the discussions, and they are one of the main motiviations to keep me going. Disqus offers a way to export all the comments, and here is the frequency of all the comments over time:&lt;/p&gt;
&lt;figure&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/02/blog-comment-utterances/pics/number_comments_per_post.png"&gt;
    &lt;figcaption&gt;Number of comments on my blog over time&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Since this post, my blog will be using the new utterances comment widget. For comparison, I attached a screenshot of the old interface using Disqus below:&lt;/p&gt;
&lt;figure&gt;
    &lt;img src="https://blog.liang2.tw/posts/2022/02/blog-comment-utterances/pics/disqus_screenshot.png"&gt;
    &lt;figcaption&gt;Old commenting widget using Disqus on my blog.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:disqus downsides"&gt;
&lt;p&gt;There are already many summaries on these issues. For example: &lt;a href="https://donw.io/post/github-comments/"&gt;&lt;em&gt;Replacing Disqus with  Comments&lt;/em&gt;&lt;/a&gt; (&lt;a href="https://news.ycombinator.com/item?id=14170041"&gt;Discussion on Hacker News&lt;/a&gt;) and &lt;a href="https://supunkavinda.blog/disqus"&gt;&lt;em&gt;Disqus, the dark commenting system&lt;/em&gt;&lt;/a&gt; (&lt;a href="https://news.ycombinator.com/item?id=26033052"&gt;Discussion on Hacker News&lt;/a&gt;).&amp;#160;&lt;a class="footnote-backref" href="#fnref:disqus downsides" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="en"></category></entry><entry><title>ID cross reference with exact protein sequence identity using UniParc</title><link href="https://blog.liang2.tw/posts/2020/07/id-crossref-exact-protein-uniparc/" rel="alternate"></link><published>2020-07-24T00:00:00-05:00</published><updated>2022-05-13T12:52:49-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2020-07-24:/posts/2020/07/id-crossref-exact-protein-uniparc/</id><summary type="html">&lt;p&gt;&lt;em&gt;TL;DR: Many existing ID mappings between different biological ID systems (RefSeq/Ensembl/UniProt) don&amp;rsquo;t consider if the IDs have the same exact protein sequence. When the exact sequence is needed, UniParc can be used to cross-reference the IDs. I will demonstrate how to use UniParc to map RefSeq â€¦&lt;/em&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;TL;DR: Many existing ID mappings between different biological ID systems (RefSeq/Ensembl/UniProt) don&amp;rsquo;t consider if the IDs have the same exact protein sequence. When the exact sequence is needed, UniParc can be used to cross-reference the IDs. I will demonstrate how to use UniParc to map RefSeq human proteins to UniProt and Ensembl at scale.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;You can skip to the solution if you already know what&amp;rsquo;s the problem I want to tackle.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#camps-of-biological-ids"&gt;Camps of biological IDs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#challenges-to-map-ids-with-exact-sequence-identity"&gt;Challenges to map IDs with exact sequence identity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#why-mapping-with-exact-sequence-identity"&gt;Why mapping with exact sequence identity?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#uniparc-comes-into-rescue-for-protein-sequence-identity"&gt;UniParc comes into rescue for protein sequence identity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#programatic-uniparc-access-using-its-xml"&gt;Programatic UniParc access using its XML&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="camps-of-biological-ids"&gt;Camps of biological IDs&lt;/h3&gt;
&lt;p&gt;There are a few &amp;ldquo;camps&amp;rdquo; of biological IDs that are used by many (human) databases and datasets: &lt;a href="https://ensembl.org/"&gt;Ensembl&lt;/a&gt;, &lt;a href="https://www.ncbi.nlm.nih.gov/refseq/"&gt;RefSeq&lt;/a&gt; (plus &lt;a href="https://www.ncbi.nlm.nih.gov/gene/"&gt;NCBI/Entrez Gene&lt;/a&gt;), and &lt;a href="https://www.uniprot.org/"&gt;UniProt&lt;/a&gt;. Each ID camp is comprehensive independently, containing gene-level, transcript-level, and protein-level information using their own systems of IDs. Unfortunately, all three ID systems/camps are useful in their own way, making the choice of the &amp;ldquo;favorite&amp;rdquo; ID system really divided for different databases and datasets.&lt;/p&gt;
&lt;p&gt;To get a sense of these &amp;ldquo;ID camps&amp;rdquo; and how information is connected through them and across them, this great illustration from &lt;a href="https://biodbnet-abcc.ncifcrf.gov/dbInfo/netGraph.php"&gt;bioDBnet&lt;/a&gt; sums it all (it&amp;rsquo;s huge):&lt;/p&gt;
&lt;figure&gt;
    &lt;img src="https://blog.liang2.tw/posts/2020/07/id-crossref-exact-protein-uniparc/pics/bioDBnet.jpg"&gt;
    &lt;figcaption&gt;Best illustration of the complex ID crossref: bioDBnet Network Diagram (&lt;a href="https://biodbnet-abcc.ncifcrf.gov/dbInfo/netGraph.php"&gt;source&lt;/a&gt;)&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id="challenges-to-map-ids-with-exact-sequence-identity"&gt;Challenges to map IDs with exact sequence identity&lt;/h3&gt;
&lt;p&gt;It&amp;rsquo;s usually straightforward to cross reference within each ID camp, as long as one has the versioned ID and a copy of that camp&amp;rsquo;s ID system. For example, to know the gene symbol of &lt;code&gt;ENSP00000368632.3&lt;/code&gt;, I can easily use &lt;a href="https://bioconductor.org/packages/release/bioc/html/ensembldb.html"&gt;ensembldb&lt;/a&gt;, a lite copy of Ensembl&amp;rsquo;s ID system, to find out it is translated from transcript &lt;code&gt;ENST00000379328.9&lt;/code&gt;, which is one of the transcripts of gene &lt;code&gt;ENSG00000107485.18&lt;/code&gt;, whose gene symbol is &lt;code&gt;GATA3&lt;/code&gt;. Easy peasy. The story goes the same for RefSeq and UniProt (albeit this one is more protein centric).&lt;/p&gt;
&lt;p&gt;However, things get messy when one wants to cross reference across ID camps. While both official and third-party services (e.g., &lt;a href="https://biodbnet-abcc.ncifcrf.gov/"&gt;bioDBnet&lt;/a&gt; and &lt;a href="https://david.ncifcrf.gov/home.jsp"&gt;DAVID&lt;/a&gt;) exist, they don&amp;rsquo;t guarantee sequence identity match. In this post, I will focus on the protein sequence. For example, bioDBnet says &lt;code&gt;ENSP00000368632&lt;/code&gt; can be mapped to (note the lack of version):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RefSeq: NP_002042, NP_001002295, &amp;hellip;&lt;/li&gt;
&lt;li&gt;UniProt: P23771, &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;But when considering their sequence being identical, ENSP00000368632.3 should only match NP_001002295.1 in RefSeq, and the non-canonical form of UniProt P23771-2 (sequence version 1). The other IDs don&amp;rsquo;t have the exact same protein sequence because of an 1aa deletion. To complicate things more, many mappings don&amp;rsquo;t handle ID versions, and sequence often changes across ID versions. Without tracking the versioned ID, it&amp;rsquo;s impossible to say which IDs have the same sequence.&lt;/p&gt;
&lt;p&gt;Let me be clear that there is nothing wrong about these services. They&amp;rsquo;re built so people can map IDs at high level and increase the number of mappable IDs, which is extremely useful in its own way. In fact, a lot of IDs simply cannot be mapped when consider exact sequence identity.&lt;/p&gt;
&lt;p&gt;For transcripts the situation isn&amp;rsquo;t any better because many mapped transcripts of different ID camps have different UTR sequences. I will probably write another post to touch on transcript ID mapping. The short answer is that the &lt;a href="https://www.ncbi.nlm.nih.gov/refseq/MANE/"&gt;MANE&lt;/a&gt; project started by RefSeq and Ensembl is working on the problem.&lt;/p&gt;
&lt;h3 id="why-mapping-with-exact-sequence-identity"&gt;Why mapping with exact sequence identity?&lt;/h3&gt;
&lt;p&gt;Well, when do I need ID mapping with exact protein sequence identity? My use case is to map post-translation modifications (PTMs) from RefSeq to UniProt. CPTAC detected loads of PTMs (mostly phosphosites) using RefSeq as the peptide spectral library (peptide search database). But a lot of what we know about a protein is from UniProt. So I need a reliable way to map a specific amino acid of one RefSeq protein to its UniProt counterpart. I&amp;rsquo;ve been using existing services for the job, but they not perfect.&lt;/p&gt;
&lt;p&gt;For example, we found a phosphosite NP_001317366.1 (PTPN11) p.Y546. PTPN11 corresponds to Q06124 in UniProt reviewed proteome (the current canonical isoform is Q06124-2 seq. ver3). But you won&amp;rsquo;t find anything (e.g. antibody) about this site at 546aa because sequences of NP_001317366.1 and Q06124-2 don&amp;rsquo;t match. This phosphosite actually maps to Q06124-2 p.Y542.&lt;/p&gt;
&lt;p&gt;While one can argue that I should re-run the peptide search using UniProt, this solution only works around the problem. The problem comes back when I want to map the Ensembl based mutations to UniProt. I am also aware that two proteins with different sequence can be biologically different, and we shouldn&amp;rsquo;t just blindly integrate their annotation. I totally agree, so the integration should be further validated. Due to the nature of the shotgun proteomics, as long as the peptide sequence of the PTM site can be found in both proteins, it&amp;rsquo;s fairly possible that the site can be mapped to both. This topic has been on my mind &lt;a href="https://twitter.com/lbwang2/status/1238144323218288643"&gt;for a while&lt;/a&gt;. I&amp;rsquo;ll write about it once I figure out the details. Anyway, mapping PTMs between different protein sequences is my next step, and it goes beyond the scope of this post.&lt;/p&gt;
&lt;h3 id="uniparc-comes-into-rescue-for-protein-sequence-identity"&gt;UniParc comes into rescue for protein sequence identity&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://www.uniprot.org/uniparc/"&gt;The UniProt Archive (UniParc)&lt;/a&gt; is a comprehensive and non-redundant database that contains most of the publicly available protein sequences in the world. Proteins may exist in different source databases and in multiple copies in the same database. UniParc avoided such redundancy by storing each unique sequence only once and giving it a stable and unique identifier (UPI) making it possible to identify the same protein from different source databases. A UPI is never removed, changed or reassigned. UniParc contains only protein sequences.&lt;/p&gt;
&lt;p&gt;(source: &lt;a href="https://www.uniprot.org/help/uniparc"&gt;UniParc help page&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;UniParc is a collection of non-redundant protein sequence archive. The UniParc ID and sequence is permanently stable, but the cross-references associated to one UniParc entry may change over time. All of its properties make UniParc perfect to be the identifer to map across ID camps. UniParc IDs can be queried using the &lt;a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check"&gt;CRC64-ISO checksum&lt;/a&gt; of the protein sequence.&lt;/p&gt;
&lt;p&gt;For example, let&amp;rsquo;s find the UniPrac ID of &lt;code&gt;NP_001317366.1&lt;/code&gt;. First, we obtain its protein sequence in FASTA from NCBI:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;refseq_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;NP_001317366.1&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;curl -Lo &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$refseq_id&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;.fasta &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=protein&amp;amp;id=&lt;/span&gt;&lt;span class="nv"&gt;$refseq_id&lt;/span&gt;&lt;span class="s2"&gt;&amp;amp;rettype=fasta&amp;amp;retmode=text&amp;quot;&lt;/span&gt;

&lt;span class="gp"&gt;$ &lt;/span&gt;head -n &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$refseq_id&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;.fasta
&lt;span class="go"&gt;&amp;gt;NP_001317366.1 tyrosine-protein phosphatase non-receptor type 11 isoform 3 [Homo sapiens]&lt;/span&gt;
&lt;span class="go"&gt;MTSRRWFHPNITGVEAENLLLTRGVDGSFLARPSKSNPGDFTLSVRRNGAVTHIKIQNTGDYYDLYGGEK&lt;/span&gt;
&lt;span class="go"&gt;FATLAELVQYYMEHHGQLKEKNGDVIELKYPLNCADPTSERWFHGHLSGKEAEKLLTEKGKHGSFLVRES&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then calculate the CRC64 checksum (there are a few packages capable, or use &lt;a href="https://www.ebi.ac.uk/Tools/so/seqcksum/"&gt;EBI&amp;rsquo;s checksum calculator&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pysam&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;FastaFile&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;crc64iso&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;crc64iso&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;fa&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;FastaFile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;NP_001317366.1.fasta&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fa&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fa&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;references&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;crc64iso&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;crc64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seq&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;37E8BFC7ECA2D03F&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Search &lt;code&gt;checksum:37E8BFC7ECA2D03F&lt;/code&gt; on UniParc gives an unique entry&lt;sup id="fnref:checksum-collision"&gt;&lt;a class="footnote-ref" href="#fn:checksum-collision"&gt;1&lt;/a&gt;&lt;/sup&gt; &lt;code&gt;UPI000041C017&lt;/code&gt;: &lt;a href="https://www.uniprot.org/uniparc/?query=checksum%3A37E8BFC7ECA2D03F&amp;amp;sort=score&amp;amp;direct=yes"&gt;https://www.uniprot.org/uniparc/?query=checksum%3A37E8BFC7ECA2D03F&amp;amp;sort=score&amp;amp;direct=yes&lt;/a&gt;.&lt;/p&gt;
&lt;figure class="full-img"&gt;
    &lt;img src="https://blog.liang2.tw/posts/2020/07/id-crossref-exact-protein-uniparc/pics/uniparc_UPI000041C017.png"&gt;
    &lt;figcaption&gt;UniParc entry &lt;a href="https://www.uniprot.org/uniparc/UPI000041C017"&gt;UPI000041C017&lt;/a&gt; and all of its human ID cross references with exact sequence identity.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;All the external IDs listed here have the identical protein sequence to &lt;code&gt;NP_001317366.1&lt;/code&gt;, which of course includes itself. UniParc also marks the IDs inactive if they are superseded by a newer version or become obsolete, which is quite useful for data forensics.&lt;/p&gt;
&lt;h3 id="programatic-uniparc-access-using-its-xml"&gt;Programatic UniParc access using its XML&lt;/h3&gt;
&lt;p&gt;To extract UniParc&amp;rsquo;s cross reference, it&amp;rsquo;s easiest to parse its XML, which is also easy to download in bulk.
Continue to use &lt;code&gt;UPI000041C017&lt;/code&gt; (&lt;code&gt;NP_001317366.1&lt;/code&gt;) as the example,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;curl -LO https://www.uniprot.org/uniparc/UPI000041C017.xml
&lt;span class="gp"&gt;$ &lt;/span&gt;head -n &lt;span class="m"&gt;10&lt;/span&gt; UPI000041C017.xml
&lt;span class="go"&gt;&amp;lt;?xml version=&amp;#39;1.0&amp;#39; encoding=&amp;#39;UTF-8&amp;#39;?&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;uniparc xmlns=&amp;quot;http://uniprot.org/uniparc&amp;quot; xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xsi:schemaLocation=&amp;quot;http://uniprot.org/uniparc http://www.uniprot.org/docs/uniparc.xsd&amp;quot; version=&amp;quot;2020_03&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;entry dataset=&amp;quot;uniparc&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;accession&amp;gt;UPI000041C017&amp;lt;/accession&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;dbReference type=&amp;quot;UniProtKB/Swiss-Prot&amp;quot; id=&amp;quot;Q06124&amp;quot; version_i=&amp;quot;2&amp;quot; active=&amp;quot;N&amp;quot; version=&amp;quot;2&amp;quot; created=&amp;quot;2005-12-20&amp;quot; last=&amp;quot;2019-11-13&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;property type=&amp;quot;NCBI_GI&amp;quot; value=&amp;quot;84028248&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;property type=&amp;quot;NCBI_taxonomy_id&amp;quot; value=&amp;quot;9606&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;property type=&amp;quot;protein_name&amp;quot; value=&amp;quot;Tyrosine-protein phosphatase non-receptor type 11&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;property type=&amp;quot;gene_name&amp;quot; value=&amp;quot;PTPN11&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;/dbReference&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;While I don&amp;rsquo;t find XML easy to read, I&amp;rsquo;ve figured out &lt;a href="https://blog.liang2.tw/posts/2018/01/read-uniprotkb-xml/"&gt;a way&lt;/a&gt; before to parse XMLs as a JSON-like dictionary given its schema. Let&amp;rsquo;s define a function to flatten the nested structure and only select the information we want:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse_dbref&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;entry&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;    Parse Ensembl/UniProt/RefSeq IDs of an UniParc entry.&lt;/span&gt;

&lt;span class="sd"&gt;    Keep both active and inactive IDs.&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;ref_ids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;db_type&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Ensembl&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;UniProt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;RefSeq&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
        &lt;span class="n"&gt;ids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;entry&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dbReference&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;startswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;db_type&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="c1"&gt;# Skip non-human entries&lt;/span&gt;
                &lt;span class="n"&gt;ncbi_taxid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@value&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;property&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;NCBI_taxonomy_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                    &lt;span class="kc"&gt;None&lt;/span&gt;
                &lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ncbi_taxid&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;9606&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="k"&gt;continue&lt;/span&gt;

                &lt;span class="c1"&gt;# Make versioned ID&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;@version&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="c1"&gt;# Use the UniParc internal version (for UniProt)&lt;/span&gt;
                    &lt;span class="n"&gt;id_str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@version_i&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
                &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;id_str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@version&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
                &lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id_str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;ref_ids&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;db_type&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;ref_ids&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://pypi.org/project/xmlschema/"&gt;xmlschema&lt;/a&gt; makes it really easy to parse a XML with schema:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;xmlschema&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pprint&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;pprint&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;xs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;xmlschema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;XMLSchema&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://www.uniprot.org/docs/uniparc.xsd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;errors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;xs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UPI000041C017.xml&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;validation&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;lax&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pprint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parse_dbref&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;entry&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="go"&gt;{&amp;#39;Ensembl&amp;#39;: [&amp;#39;ENSP00000489597.1&amp;#39;],&lt;/span&gt;
&lt;span class="go"&gt; &amp;#39;RefSeq&amp;#39;: [&amp;#39;NP_001317366.1&amp;#39;, &amp;#39;XP_006719589.1&amp;#39;],&lt;/span&gt;
&lt;span class="go"&gt; &amp;#39;UniProt&amp;#39;: [&amp;#39;Q06124-1.1&amp;#39;, &amp;#39;Q06124.2&amp;#39;]}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;VoilÃ &lt;/em&gt;, we can now map across ID camps with confidence!&lt;/p&gt;
&lt;p&gt;This method can be applied to a large number of queries efficiently. By reading in a FASTA of protein sequences of interest, we can build URLs to UniParc XML per protein entry using its checksum, and pass the URLs as an &lt;a href="https://aria2.github.io/"&gt;aria2&lt;/a&gt;'s input file &lt;code&gt;xml.links&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;https://www.uniprot.org/uniparc/?query=checksum%3A{crc64_checksum}&amp;amp;format=xml
    out={protein_id}.xml

...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And download all the links in batch:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;aria2c -c -j5 --max-overall-download-limit&lt;span class="o"&gt;=&lt;/span&gt;10M -i xml.links
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="summary"&gt;Summary&lt;/h3&gt;
&lt;p&gt;We solve the ID mapping with exact protein sequence identity between Ensembl/RefSeq/UniProt camps through UniParc.&lt;/p&gt;
&lt;p&gt;Note that the version of UniProt entries is a bit confusing. For example, &lt;code&gt;Q06124.2&lt;/code&gt; means the sequence version 2 of &lt;code&gt;Q06124&lt;/code&gt;. But finding UniProt&amp;rsquo;s sequence version is not that straightforward, and the UniProt isoforms unlike the canonical isoform lack version tracking. As a result, while processing UniProt associated annotation, I will always add UniParc IDs or keep its protein sequence for future reference.&lt;/p&gt;
&lt;p&gt;RefSeq and Ensembl protein IDs are always versioned. Thus it&amp;rsquo;s highly recommended to keep the versioned ID for these two systems.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:checksum-collision"&gt;
&lt;p&gt;It&amp;rsquo;s possible that two different protein sequences have the same checksum, though very unlikely.
So always double check so do this in batch.&amp;#160;&lt;a class="footnote-backref" href="#fnref:checksum-collision" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="id-crossref"></category><category term="cptac"></category></entry><entry><title>Identify the Ensembl release from versioned IDs</title><link href="https://blog.liang2.tw/posts/2020/06/identify-ensembl-release-ver/" rel="alternate"></link><published>2020-06-08T00:00:00-05:00</published><updated>2022-05-13T12:52:58-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2020-06-08:/posts/2020/06/identify-ensembl-release-ver/</id><summary type="html">&lt;p&gt;I often received data that was annotated by an unknown Ensembl release/version.&lt;/p&gt;
&lt;p&gt;It could be the Ensembl IDs in a gene expression matrix, a VEP annotated MAF file, or even a customized GTF. The documentation of those files wasn&amp;rsquo;t always clear about the annotation in use. However, it â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;I often received data that was annotated by an unknown Ensembl release/version.&lt;/p&gt;
&lt;p&gt;It could be the Ensembl IDs in a gene expression matrix, a VEP annotated MAF file, or even a customized GTF. The documentation of those files wasn&amp;rsquo;t always clear about the annotation in use. However, it&amp;rsquo;s sometimes necessary to know the exact Ensembl release. Say, I want to reproduce the result, or to pass the output to the extended downstream workflow. While the tiny difference between adjacent releases is only annoying, &lt;a href="https://betatark.ensembl.org/web/statistics/"&gt;thousands of changes per release&lt;/a&gt; add up quickly to be obvious inconsistency when using releases across different years.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s possible to pinpoint the Ensembl release using the ID versions. For example, ENSG00000119772.15 (DNMT3A) only existed in Ensembl releases 79 and 80; ENST00000275493.7 (EGFR) remains alive since release 96. By checking the ID history on &lt;a href="https://ensembl.org"&gt;https://ensembl.org&lt;/a&gt;, I can identify the possible Ensembl releases my data uses. A handy URL shortcut to accompany the investigation is &lt;code&gt;ensembl.org/id/&amp;lt;ensembl_id&amp;gt;&lt;/code&gt;, which can redirect to the different page tabs depends on the ID types (e.g., ENSG to genes and ENST to transcript).&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2020/06/identify-ensembl-release-ver/pics/ensembl_r100_dnmt3A_id_history.png"&gt;
  &lt;figcaption&gt;ID history of ENSG00000119772 (DNMT3A) (&lt;a href="https://www.ensembl.org/Homo_sapiens/Gene/Idhistory?g=ENSG00000119772"&gt;source&lt;/a&gt;)&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;With &lt;a href="https://betatark.ensembl.org/"&gt;Ensembl Tark&lt;/a&gt;, I wrote &lt;a href="https://gist.github.com/ccwang002/829a5420a47adfb3be597ed3ea8a0a29"&gt;a Python script&lt;/a&gt; to automate the query. Given a list of versioned Ensembl IDs&lt;sup id="fnref:versioned-id"&gt;&lt;a class="footnote-ref" href="#fn:versioned-id"&gt;1&lt;/a&gt;&lt;/sup&gt;, the script will identify the possible Ensembl releases. The IDs can be genes, transcripts, or proteins. Based on my testing, the script can identify Ensembl release range with less than 30 IDs.&lt;/p&gt;
&lt;p&gt;Here is an example list of IDs:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ENST00000426449.4
ENST00000434817.4
ENSP00000222254.6
ENSP00000477864.1
ENSG00000170266.14
ENSG00000238009.5
ENSG00000173705.7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And the output of the script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;python check_possible_ensembl_releases.py ensembl_ids.list
&lt;span class="go"&gt;[2020-06-09 13:00:48][INFO   ] Querying for 7 Ensembl IDs&lt;/span&gt;
&lt;span class="go"&gt;[2020-06-09 13:00:49][INFO   ] Only Ensembl releases 75â€“99 are supported by Ensembl Tark. IDs outside the range may not be identified.&lt;/span&gt;
&lt;span class="go"&gt;ENSP00000477864.1 in Ensembl releases 76â€“99&lt;/span&gt;
&lt;span class="go"&gt;ENSG00000173705.7 in Ensembl releases 79â€“80&lt;/span&gt;
&lt;span class="go"&gt;ENSG00000238009.5 in Ensembl releases 79â€“80&lt;/span&gt;
&lt;span class="go"&gt;ENST00000434817.4 in Ensembl releases 79â€“80&lt;/span&gt;
&lt;span class="go"&gt;ENSP00000222254.6 in Ensembl releases 75â€“99&lt;/span&gt;
&lt;span class="go"&gt;ENSG00000170266.14 in Ensembl releases 79â€“80&lt;/span&gt;
&lt;span class="go"&gt;ENST00000426449.4 in Ensembl releases 79â€“80&lt;/span&gt;
&lt;span class="go"&gt;Possible Ensembl releases are: 79, 80&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In this case, Ensembl releases 79 and 80 have the same gene model.&lt;/p&gt;
&lt;p&gt;The script basically uses Tark&amp;rsquo;s REST APIs to get the release range for each ID, and find the intersection of all the ranges. It runs on Python 3.8 and uses aiohttp 3.6 for concurrent API calls. Tark currently has records from release 75 (2014) to 99 (2020), so this approach will fail if the IDs are too old (or too new, but I think it will include the latest r100 soon). I limited the maximal concurrent calls â‰¤ 5 so I don&amp;rsquo;t overwhelm the Tark service.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://betatark.ensembl.org/"&gt;Tark&lt;/a&gt; is a great website/service that compares the transcripts between different versions or even different sources (Ensembl vs RefSeq)! It can tell you what exon or UTR was changed, something quick tricky to set up because one has to import databases for every Ensembl release and even RefSeq releases. Tark is currently in beta, but I hope it can be stable and remained updated.&lt;/p&gt;
&lt;p&gt;And this is just another point that it&amp;rsquo;s usually a good idea to include versioned IDs in the data.&lt;/p&gt;
&lt;p&gt;Now I can go back digging the history of my data :)&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:versioned-id"&gt;
&lt;p&gt;It&amp;rsquo;s probably possible to apply the same approach without Ensembl ID version (e.g., ENSG00000119772), but one might need a lot of them because IDs are much more stable.&amp;#160;&lt;a class="footnote-backref" href="#fnref:versioned-id" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category></entry><entry><title>Generate Venn diagrams easily</title><link href="https://blog.liang2.tw/posts/2019/04/generate-venn-svg/" rel="alternate"></link><published>2019-04-20T00:00:00-05:00</published><updated>2022-05-13T12:53:14-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2019-04-20:/posts/2019/04/generate-venn-svg/</id><summary type="html">&lt;p&gt;I find myself generating Venn diagrams quite often.  While there are many available Venn diagram plotting libraries available, they don&amp;rsquo;t always fit my need.  My inputs of the diagram are the set sizes rather than lists of observations.  And after drawing the Venn diagram, I often edit them to â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;I find myself generating Venn diagrams quite often.  While there are many available Venn diagram plotting libraries available, they don&amp;rsquo;t always fit my need.  My inputs of the diagram are the set sizes rather than lists of observations.  And after drawing the Venn diagram, I often edit them to integrate with other figures, so I prefer a vector format like SVG, which not all the libraries offer.&lt;/p&gt;
&lt;p&gt;So I made &lt;a href="https://observablehq.com/@ccwang002/simple-venn-diagram-generator"&gt;an Observable Notebook&lt;/a&gt; that allows me to interactively modify the Venn diagram, and download the output as a SVG file. It&amp;rsquo;s built on the &lt;a href="https://github.com/benfred/venn.js/"&gt;venn.js&lt;/a&gt; library, which does all the heavy lifting.&lt;/p&gt;
&lt;p&gt;Here is the screenshot of the diagram drawing interface (see it live on &lt;a href="https://observablehq.com/@ccwang002/simple-venn-diagram-generator"&gt;the notebook&lt;/a&gt;):&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2019/04/generate-venn-svg/pics/venn_nb.png"&gt;
  &lt;figcaption&gt;Screenshot of the Observable Notebook&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The set sizes can be easily tweaked by editing the &lt;code&gt;sets&lt;/code&gt; variable. The colors of the two sets can be configured by clicking on the color blocks. There is a button to download the generated Venn diagram. Finally, everything changes will interactively reflect on the diagram.&lt;/p&gt;
&lt;p&gt;What&amp;rsquo;s more cool about the Observable Notebook is I can simply modify the code to change the output. If I want to a new set to have a three-way Venn diagram, I just need to update the &lt;code&gt;sets&lt;/code&gt;. For example, copy paste the following to the notebook:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nx"&gt;sets&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;sets&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;label&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;size&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;1700&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;set0_color&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;sets&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;label&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;size&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;1350&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;set1_color&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;sets&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;label&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;size&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;700&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;green&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;sets&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;size&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;1200&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;sets&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;size&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;500&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;sets&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;size&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;450&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;sets&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;size&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;350&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And I will get the following new Venn diagram in SVG:&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2019/04/generate-venn-svg/pics/threeway_venn.svg"&gt;
&lt;/figure&gt;

&lt;p&gt;I hope now I will spend less time figuring out how to draw a Venn diagram.&lt;/p&gt;</content><category term="Bioinfo"></category><category term="en"></category></entry><entry><title>Store GDC genome as a Seqinfo object</title><link href="https://blog.liang2.tw/posts/2019/02/gdc-seqinfo/" rel="alternate"></link><published>2019-02-26T00:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2019-02-26:/posts/2019/02/gdc-seqinfo/</id><summary type="html">&lt;p&gt;Genomic Data Commons (GDC) hosted by NCI is the place to harmonize past and future genomic data, such as TCGA, TARGET, and CPTAC projects. GDC has its own genome reference, &lt;a href="https://gdc.cancer.gov/about-data/data-harmonization-and-generation/gdc-reference-files"&gt;&lt;code&gt;GRCh38.d1.vd1&lt;/code&gt;&lt;/a&gt;, which has 2,779 &amp;ldquo;chromosomes&amp;rdquo; including decoys and virus sequences. That said, the canonical chromosomes of GRCh38 â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Genomic Data Commons (GDC) hosted by NCI is the place to harmonize past and future genomic data, such as TCGA, TARGET, and CPTAC projects. GDC has its own genome reference, &lt;a href="https://gdc.cancer.gov/about-data/data-harmonization-and-generation/gdc-reference-files"&gt;&lt;code&gt;GRCh38.d1.vd1&lt;/code&gt;&lt;/a&gt;, which has 2,779 &amp;ldquo;chromosomes&amp;rdquo; including decoys and virus sequences. That said, the canonical chromosomes of GRCh38.d1.vd1 (e.g., chr1 to chr22, chrM, chrX, and chrY) are identical to that of hg38 and GRCh38. So all these three genome references can be used interchangeably.&lt;/p&gt;
&lt;p&gt;Anyway, I was trying to correctly store the full GRCh38.d1.vd1 genome information in the &lt;code&gt;GRanges&lt;/code&gt; and &lt;code&gt;GRangesList&lt;/code&gt; R objects, which can be done by creating a &lt;code&gt;Seqinfo&lt;/code&gt; object representing all its chromosomes. It was also fun to get familiar with the genomic data structures in R. &lt;/p&gt;
&lt;h3 id="build-gdcs-seqinfo"&gt;Build GDC&amp;rsquo;s Seqinfo&lt;/h3&gt;
&lt;p&gt;First, we need the length and the name of all chromosomes in GRCh38.d1.vd1.  I used samtools to extract the information as a &lt;code&gt;.dict&lt;/code&gt; file from the genome reference FASTA file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;GDC_REF_FA_URL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://api.gdc.cancer.gov/data/254f697d-310d-4d7d-a27b-27fbf767a834&amp;#39;&lt;/span&gt;
curl -Lo GRCh38.d1.vd1.fa.tar.gz &lt;span class="nv"&gt;$GDC_REF_FA_URL&lt;/span&gt;
samtools dict &lt;span class="se"&gt;\&lt;/span&gt;
    -a &lt;span class="s1"&gt;&amp;#39;GRCh38.d1.vd1&amp;#39;&lt;/span&gt; -s &lt;span class="s1"&gt;&amp;#39;Homo sapiens&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    -u &lt;span class="nv"&gt;$GDC_REF_FA_URL&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    GRCh38.d1.vd1.fa.tar.gz &amp;gt; GRCh38.d1.vd1.dict

head -n &lt;span class="m"&gt;3&lt;/span&gt; GRCh38.d1.vd1.dict
&lt;span class="c1"&gt;# @HD   VN:1.0  SO:unsorted&lt;/span&gt;
&lt;span class="c1"&gt;# @SQ   SN:chr1 LN:248956422    M5:6aef897c3d6ff0c78aff06ac189178dd UR:https://api.gdc.cancer.gov/data/254f697d-310d-4d7d-a27b-27fbf767a834 AS:GRCh38.d1.vd1    SP:Homo sapiens&lt;/span&gt;
&lt;span class="c1"&gt;# @SQ   SN:chr2 LN:242193529    M5:f98db672eb0993dcfdabafe2a882905c UR:https://api.gdc.cancer.gov/data/254f697d-310d-4d7d-a27b-27fbf767a834 AS:GRCh38.d1.vd1    SP:Homo sapiens&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Seqinfo also requires the information of whether a chromosome is circular. In GDC&amp;rsquo;s case,  mitochondria chromosome and all viruses sequences are circular. Combining all the information together, we can construct the Seqinfo object describing the genome GRCh38.d1.vd1.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tidyverse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GenomeInfoDb&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;gdc_simple_tbl&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;read_tsv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;./GRCh38.d1.vd1.dict&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
    &lt;span class="n"&gt;skip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="c1"&gt;# Skip the first line (@HQ ...)&lt;/span&gt;
    &lt;span class="n"&gt;col_names&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;SQ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;chrom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;length&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;md5sum&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;URI&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;assembly&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;species&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;
    &lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chrom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;
    &lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chrom&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;str_sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chrom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; 
           &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;as.integer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;str_sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
           &lt;span class="n"&gt;circular&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;case_when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
               &lt;span class="n"&gt;chrom&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;chrM&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
               &lt;span class="n"&gt;chrom&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;chrEBV&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
               &lt;span class="nf"&gt;startsWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chrom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;HPV&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
               &lt;span class="kc"&gt;TRUE&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="kc"&gt;FALSE&lt;/span&gt;
           &lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="n"&gt;gdc_seqinfo&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;Seqinfo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;seqnames&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gdc_simple_tbl&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;chrom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;seqlengths&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gdc_simple_tbl&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;isCircular&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gdc_simple_tbl&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;circular&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;genome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;GRCh38.d1.vd1&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now we can supply it to any &lt;code&gt;GRanges&lt;/code&gt; object coming out from any GDC&amp;rsquo;s sequencing data.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;gdc_seqinfo&lt;/span&gt;
&lt;span class="go"&gt;Seqinfo object with 2779 sequences (191 circular) from GRCh38.d1.vd1 genome:&lt;/span&gt;
&lt;span class="go"&gt;  seqnames   seqlengths isCircular        genome&lt;/span&gt;
&lt;span class="go"&gt;  chr1        248956422      FALSE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  chr2        242193529      FALSE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  chr3        198295559      FALSE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  chr4        190214555      FALSE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  chr5        181538259      FALSE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  ...               ...        ...           ...&lt;/span&gt;
&lt;span class="go"&gt;  HPV-mKN2         7299       TRUE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  HPV-mKN3         7251       TRUE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  HPV-mL55         7177       TRUE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  HPV-mRTRX7       7731       TRUE GRCh38.d1.vd1&lt;/span&gt;
&lt;span class="go"&gt;  HPV-mSD2         7300       TRUE GRCh38.d1.vd1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I store the &lt;code&gt;gdc_seqinfo&lt;/code&gt; as a RDS file (&lt;a href="https://blog.liang2.tw/posts/2019/02/gdc-seqinfo/results/seqinfo_GRCh38.d1.vd1.rds"&gt;link&lt;/a&gt; here) so I can re-use it easily.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;gdc_seqinfo&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;readRDS&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;seqinfo_GRCh38.d1.vd1.rds&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="r"></category><category term="bioconductor"></category></entry><entry><title>Build EnsDb from a local Ensembl MySQL database</title><link href="https://blog.liang2.tw/posts/2019/01/build-ensdb-from-local-mysql/" rel="alternate"></link><published>2019-01-08T00:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2019-01-08:/posts/2019/01/build-ensdb-from-local-mysql/</id><summary type="html">&lt;p&gt;In some occasions, I need to access the older version of Ensembl human transcripts. For example, the mutation calls generated by the &lt;a href="https://gdc.cancer.gov/"&gt;NCI&amp;rsquo;s Genomic Data Common&lt;/a&gt; pipeline are annotated by Ensembl v84. To programmatically query the Ensembl annotations, I use the EnsDb SQLite database created by &lt;a href="https://bioconductor.org/packages/release/bioc/html/ensembldb.html"&gt;ensembldb&lt;/a&gt;, which is â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;In some occasions, I need to access the older version of Ensembl human transcripts. For example, the mutation calls generated by the &lt;a href="https://gdc.cancer.gov/"&gt;NCI&amp;rsquo;s Genomic Data Common&lt;/a&gt; pipeline are annotated by Ensembl v84. To programmatically query the Ensembl annotations, I use the EnsDb SQLite database created by &lt;a href="https://bioconductor.org/packages/release/bioc/html/ensembldb.html"&gt;ensembldb&lt;/a&gt;, which is a R package I enjoy using (see &lt;a href="https://blog.liang2.tw/posts/2017/11/use-ensdb-database-in-python/"&gt;my previous post&lt;/a&gt; for its usage).&lt;/p&gt;
&lt;p&gt;The EnsDbs of the recent versions of Ensembl (v87+) are available on AnnotationHub. However, the older versions are not available, and they don&amp;rsquo;t get updated when ensembldb introduces a new feature. For example, now newer EnsDbs include the transcript and gene ID version (&lt;a href="https://github.com/jotsetung/ensembldb/issues/89"&gt;github issue&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;In my case, I need to build a EnsDb of Ensembl v84. &lt;a href="https://bioconductor.org/packages/release/bioc/vignettes/ensembldb/inst/doc/ensembldb.html#10_getting_or_building_ensdb_databasespackages"&gt;The ensembldb&amp;rsquo;s documentation&lt;/a&gt; describes how to build one from the public Ensembl MySQL server. However, this method will take more than a day to complete. I started to look for other methods. After some trial and error, I managed to create my EnsDb fast by connecting to a local Ensembl database that I built. Surprisingly the setup wasn&amp;rsquo;t difficult at all, and it only took about an hour to build the EnsDb.&lt;/p&gt;
&lt;p&gt;Here are my notes of how to create the EnsDB from a local Ensembl MySQL database. I use macOS but the steps can be easily modified to work on other OSes.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#ensembl-vm"&gt;Ensembl VM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#build-a-local-ensembl-v84-mysql-database"&gt;Build a local Ensembl v84 MySQL database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#build-ensdb-from-the-local-mysql-database"&gt;Build EnsDB from the local MySQL database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#remove-mysql"&gt;Remove MySQL&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="ensembl-vm"&gt;Ensembl VM&lt;/h3&gt;
&lt;p&gt;To create a EnsDB from a Ensembl MySQL database, we need to the Ensembl Perl APIs. And the easiest setup is by a &lt;a href="http://www.ensembl.org/info/data/virtual_machine.html"&gt;Ensembl virtual machine&lt;/a&gt;. We just need to import the VM image using VirtualBox and install the ensembldb R package inside the      VM, then it is ready to build the EnsDb. I recommend the VM to have more memory than the default 1GB since a larger memory helps build the R packages and EnsDb.&lt;/p&gt;
&lt;h3 id="build-a-local-ensembl-v84-mysql-database"&gt;Build a local Ensembl v84 MySQL database&lt;/h3&gt;
&lt;p&gt;Ensembl provides &lt;a href="https://www.ensembl.org/info/docs/webcode/mirror/install/ensembl-data.html"&gt;the MySQL database dump&lt;/a&gt; to allow easy import of their data of any version. Assuming the working directory is &lt;code&gt;~/Documents/Ensembl_MySQL_mirror/&lt;/code&gt;, we first copy the database dump by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~/Documents/Ensembl_MySQL_mirror

&lt;span class="c1"&gt;# Download the db dump&lt;/span&gt;
rsync -a rsync://ftp.ensembl.org/ensembl/pub/release-84/mysql/homo_sapiens_core_84_38 .

&lt;span class="c1"&gt;# MySQL doesn&amp;#39;t accept compressed db dump files so we decompress them&lt;/span&gt;
gunzip *.txt.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;While downloading the data, we also need to install the MySQL server. I install &lt;a href="http://www.ensembl.org/info/data/mysql.html"&gt;the same or similar version of MySQL&lt;/a&gt; Ensembl is currently using, which is 5.6 at the time of writing. On macOS, Homebrew can specify the version of MySQL to be installed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;brew install mysql@5.6
&lt;span class="c1"&gt;# And launch the MySQL server&lt;/span&gt;
/usr/local/opt/mysql@5.6/bin/mysql.server start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;First we create a database whose name matches the Ensembl version (v84):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DATABASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;homo_sapiens_core_84_38&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we load the table schema and Ensembl data:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/usr/local/opt/mysql@5.6/bin/mysql -u root &lt;span class="se"&gt;\&lt;/span&gt;
    homo_sapiens_core_84_38 &amp;lt; homo_sapiens_core_84_38.sql

/usr/local/opt/mysql@5.6/bin/mysqlimport &lt;span class="se"&gt;\&lt;/span&gt;
    -u root &lt;span class="se"&gt;\&lt;/span&gt;
    --fields-terminated-by&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;\t&amp;#39;&lt;/span&gt; --fields_escaped_by&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;  &lt;span class="se"&gt;\&lt;/span&gt;
    homo_sapiens_core_84_38 -L *.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Finally, we modify the MySQL config at &lt;code&gt;/usr/local/etc/my.cnf&lt;/code&gt; to accept remote database connection, so our VM can access the database on the host machine. I don&amp;rsquo;t use MySQL for anything else, so I simply let MySQL binds to all the possible IP addresses my machine has:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[mysqld]
bind-address = *
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that this is not a secure configuration. To be secure, there should be a designated MySQL user with limited permission and a stricter connection setting. Restart MySQL to load the new config:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/usr/local/opt/mysql@5.6/bin/mysql.server restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Write down an (local) IP address of our host machine.&lt;/p&gt;
&lt;h3 id="build-ensdb-from-the-local-mysql-database"&gt;Build EnsDB from the local MySQL database&lt;/h3&gt;
&lt;p&gt;Now we can come back to the vm and build the EnsDb v84. Run the following R script to build the EnsDb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ensembldb&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;fetchTablesFromEnsembl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="m"&gt;84&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;species&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;human&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;root&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;lt;our host IP&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;3306&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;DBFile&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;makeEnsemblSQLiteFromTables&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The EnsDb SQLite database will be availabe under the working directory. We can test the new EnsDb by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;edb&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;EnsDb&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DBFile&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="remove-mysql"&gt;Remove MySQL&lt;/h3&gt;
&lt;p&gt;If there is no other need of MySQL, we can uninstall it and remove all its databases by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;brew remove mysql@5.6
rm -rf /usr/local/var/mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="r"></category><category term="bioconductor"></category><category term="sqlite"></category><category term="ensembldb"></category></entry><entry><title>Make Firefox fullscreen borderless on macOS</title><link href="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/" rel="alternate"></link><published>2018-12-13T00:00:00-06:00</published><updated>2022-05-13T12:59:01-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2018-12-13:/posts/2018/12/firefox-borderless-fullscreen-macos/</id><summary type="html">&lt;p&gt;EDIT 2021-06-01: In Firefox 89+, there&amp;rsquo;s a default option &amp;ldquo;Hide Toolbar&amp;rdquo; in the fullscreen mode that automatically hides the toolbar. So the customization is no longer needed.&lt;/p&gt;
&lt;p&gt;Firefox fullscreen on macOS by default contains the address bar and the tab bar. I usually don&amp;rsquo;t really need the full â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;EDIT 2021-06-01: In Firefox 89+, there&amp;rsquo;s a default option &amp;ldquo;Hide Toolbar&amp;rdquo; in the fullscreen mode that automatically hides the toolbar. So the customization is no longer needed.&lt;/p&gt;
&lt;p&gt;Firefox fullscreen on macOS by default contains the address bar and the tab bar. I usually don&amp;rsquo;t really need the full vertical space for web page, so those bars aren&amp;rsquo;t a problem. But when I access a RStudio Server on Firefox, I always want to have more vertical space. As shown in the screenshot below, the address bar and the tab bar of Firefox are unnecessary, and they may be quite distracting. If those bars are hidden and only show up upon request when Firefox enters fullscreen, the vertical space can be saved and the interface will remain clean.&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/rstudio_fullscreen.png"&gt;
  &lt;p class="caption"&gt;&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;It turns out that Firefox controls its user interface styling using CSS. So we can set the shape of the window tabs, the height of the address bar, and more by adding a CSS file at &lt;code&gt;~/Library/Application Support/Firefox/Profiles/&amp;lt;profile&amp;gt;/chrome/userChrome.css&lt;/code&gt;. In Firefox 69+, we need to set &lt;code&gt;toolkit.legacyUserProfileCustomizations.stylesheets=true&lt;/code&gt; in &lt;code&gt;about:config&lt;/code&gt; to enable the CSS styling (&lt;a href="https://www.userchrome.org/how-create-userchrome-css.html"&gt;more details here&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;My modification was based on &lt;a href="https://apple.stackexchange.com/a/313241"&gt;this answer on Stack Exchange&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;navigator-toolbox&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;inFullscreen&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;height&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="kt"&gt;rem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;margin-bottom&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;-0.5&lt;/span&gt;&lt;span class="kt"&gt;rem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;opacity&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;overflow&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;hidden&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;z-index&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;navigator-toolbox&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;inFullscreen&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;hover&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;navigator-toolbox&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;inFullscreen&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;focus-within&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c"&gt;/*&lt;/span&gt;
&lt;span class="c"&gt;     * Add some padding between the navbar and the top screen edge&lt;/span&gt;
&lt;span class="c"&gt;     * to be more visible while the macOS hidden menu bar shows up.&lt;/span&gt;
&lt;span class="c"&gt;     * The macOS menubar will hide after a few seconds.&lt;/span&gt;
&lt;span class="c"&gt;     */&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;padding-top&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.5&lt;/span&gt;&lt;span class="kt"&gt;rem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;height&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;auto&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;margin-bottom&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="kt"&gt;rem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;opacity&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;overflow&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;visible&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that the Firefox needs to be restarted to get the styling in effect. Here is how the Firefox fullscreen looks like after applying the &lt;code&gt;userChrome.css&lt;/code&gt; above.&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/rstudio_fullscreen.modified.png"&gt;
&lt;/figure&gt;

&lt;p&gt;Now the RStudio Server web page feels like a native app, similar to what RStudio Desktop offers. Both address and tab bars are hidden by default, and when the mouse hovers to the top, they get visible again.&lt;/p&gt;
&lt;figure&gt;
  &lt;video auto autoplay loop&gt;
    &lt;source src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_switch_tabs.webm" type="video/webm"&gt;
    &lt;source src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_switch_tabs.mp4" type="video/mp4"&gt;
    Your browser doesn't support HTML5 video. You can still download the &lt;a href="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_switch_tabs.mp4"&gt;screencast&lt;/a&gt; and view it locally.
  &lt;/video&gt;
  &lt;figcaption&gt;Switch tabs in the borderless fullscreen of Firefox.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Those top bars will show up as well when they are in focus by shortkeys. For example, âŒ˜ + L will get focus on the address bar. It is useful when I want to launch a quick search in a new tab.&lt;/p&gt;
&lt;figure&gt;
  &lt;video controls&gt;
    &lt;source src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_focus.webm" type="video/webm"&gt;
    &lt;source src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_focus.mp4" type="video/mp4"&gt;
    Your browser doesn't support HTML5 video. You can still download the &lt;a href="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_focus.mp4"&gt;screencast&lt;/a&gt; and view it locally.
  &lt;/video&gt;
  &lt;figcaption&gt;Address bar is shown automatically when it is focused using shortkey.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;In &lt;code&gt;userChrome.css&lt;/code&gt;, I added a small padding between the bars and the top border to make them more accessible by mouse. When the mouse moves to the top, macOS&amp;rsquo;s menu bar will pop up as well, and both Firefox and macOS will overlap. The macOS one will go away first, but the mouse has to stay on the Firefox bars so they don&amp;rsquo;t disappear either.&lt;/p&gt;
&lt;figure&gt;
  &lt;video controls&gt;
    &lt;source src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_hover_for_menubar.webm" type="video/webm"&gt;
    &lt;source src="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_hover_for_menubar.mp4" type="video/mp4"&gt;
    Your browser doesn't support HTML5 video. You can still download the &lt;a href="https://blog.liang2.tw/posts/2018/12/firefox-borderless-fullscreen-macos/pics/fullscreen_hover_for_menubar.mp4"&gt;screencast&lt;/a&gt; and view it locally.
  &lt;/video&gt;
&lt;/figure&gt;

&lt;p&gt;The overlapping of Firefox bars and macOS menubar is still a bit annoying, which will require some practice to navigate between them by mouse. I will probably rely more on the shortkeys instead. Anyway, I now have more vertical space and the modification of &lt;code&gt;userChrome.css&lt;/code&gt; works fine for now.&lt;/p&gt;
&lt;p&gt;For more information about modifying the Firefox user interface, there is &lt;a href="https://www.userchrome.org/"&gt;a website&lt;/a&gt; that introduces &lt;code&gt;userChrome.css&lt;/code&gt; in depth.&lt;/p&gt;
&lt;h3 id="notes-for-screencast-encoding"&gt;Notes for screencast encoding&lt;/h3&gt;
&lt;p&gt;I modified the command from my &lt;a href="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/"&gt;previous post&lt;/a&gt; to shrink the file size of the original QuickTime screencasts using FFmpeg. More encoding parameters can be found at FFmpeg&amp;rsquo;s wiki (&lt;a href="https://trac.ffmpeg.org/wiki/Encode/VP9"&gt;VP9&lt;/a&gt; and &lt;a href="https://trac.ffmpeg.org/wiki/Encode/H.264"&gt;H.264&lt;/a&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# VP9 (WEBM)&lt;/span&gt;
ffmpeg -i fullscreen_switch_tabs.mov &lt;span class="se"&gt;\&lt;/span&gt;
    -vcodec libvpx-vp9 -b:v 200K &lt;span class="se"&gt;\&lt;/span&gt;
    -pass &lt;span class="m"&gt;1&lt;/span&gt; -an -r &lt;span class="m"&gt;24&lt;/span&gt; -f webm /dev/null
ffmpeg -i fullscreen_switch_tabs.mov &lt;span class="se"&gt;\&lt;/span&gt;
    -vcodec libvpx-vp9 -b:v 200K &lt;span class="se"&gt;\&lt;/span&gt;
    -pass &lt;span class="m"&gt;2&lt;/span&gt; -an -r &lt;span class="m"&gt;24&lt;/span&gt; fullscreen_switch_tabs.webm

&lt;span class="c1"&gt;# H.264 (MP4)&lt;/span&gt;
ffmpeg -i fullscreen_switch_tabs.mov &lt;span class="se"&gt;\&lt;/span&gt;
    -vcodec h264 &lt;span class="se"&gt;\&lt;/span&gt;
    -strict -2 -crf &lt;span class="m"&gt;40&lt;/span&gt; -preset slow -r &lt;span class="m"&gt;24&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    fullscreen_switch_tabs.mp4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;EDIT 2020-06-13: Added extra &lt;code&gt;about:config&lt;/code&gt; settings in Firefox 69+ and fixed the styling. I also increased the top margin since the new address bar is taller.&lt;/p&gt;</content><category term="Coding"></category><category term="en"></category></entry><entry><title>GPG Key Transition</title><link href="https://blog.liang2.tw/posts/2018/10/gpg-key-transition-2018/" rel="alternate"></link><published>2018-10-20T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2018-10-20:/posts/2018/10/gpg-key-transition-2018/</id><summary type="html">&lt;p&gt;I am transiting my GPG key again.  However, for this time, I expect to use the new GPG master key longer and will start building this identity unless there is a concern about the key strength or I accidentally lose the key. &lt;/p&gt;
&lt;p&gt;Back in &lt;a href="https://blog.liang2.tw/posts/2016/12/gpg-key-transition-2016/"&gt;my GPG key transition in 2016 â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;I am transiting my GPG key again.  However, for this time, I expect to use the new GPG master key longer and will start building this identity unless there is a concern about the key strength or I accidentally lose the key. &lt;/p&gt;
&lt;p&gt;Back in &lt;a href="https://blog.liang2.tw/posts/2016/12/gpg-key-transition-2016/"&gt;my GPG key transition in 2016&lt;/a&gt;, I&amp;rsquo;ve created the subkeys for daily usage and isolated the master key into a secret offline place. I learned more about PGP throughout the years, sadly though, I still seldom have a chance to use it extensively in my daily life. &lt;/p&gt;
&lt;p&gt;This time, I am moving the subkeys to a YubiKey. I found &lt;a href="https://github.com/drduh/YubiKey-Guide"&gt;drduh&amp;rsquo;s guide&lt;/a&gt; on GitHub very informative to set up both the GPG key and the yubikey, as well as get my hands on the various possible applications. Another notable change is that I no longer set an expiration date on my master key.&lt;/p&gt;
&lt;p&gt;I will revoke my old keys once the transition is done.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

I am transitioning GPG keys from an old 4096-bit RSA key to a new
4096-bit RSA key.  The old key will continue to be valid for some
time, but I prefer all new correspondance to be encrypted in the new
key, and will be making all signatures going forward with the new key.

This transition document is signed with both keys to validate the
transition.

The old key, which I am transitioning away from, is:

  pub   rsa4096/0x44D10E44730992C4 2016-12-04 [SC] [expires: 2018-12-04]
        Key fingerprint = 85DF A3EB 72CD DE7D 3F2A  127C 44D1 0E44 7309 92C4

The new key, to which I am transitioning to, is:

  pub   rsa4096/0x69BAE333BC4DC4BA 2018-10-17 [SC]
        Key fingerprint = 978B 49B8 EFB7 02F3 3B3F  F2E5 69BA E333 BC4D C4BA

To fetch the full new key from a public key server using GnuPG, run:

  gpg --recv-key 0x69BAE333BC4DC4BA

If you have already validated my old key, you can then validate that
the new key is signed by my old key:

  gpg --check-sigs 0x69BAE333BC4DC4BA

Please contact me via e-mail at &amp;lt;me@liang2.tw&amp;gt; if you have any
questions about this document or this transition.

                                            Liang-Bo Wang
                                            (liang2, ccwang002)
                                            me@liang2.tw
                                            Oct 20, 2018
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEExQ3ldlbp0O+Zc1vXBS+kcT+kX08FAlvLdGkACgkQBS+kcT+k
X092fw/8DFGIIMHtf3JAt8nGth8Y94oyTgrorqzu7TXCxvUiGk6Qd/WBLiMvh//9
7mVounqtPSGuYHiWm6gtDlT+YRoFoJH3IZ9aboMzd8e/p4TspKhXAsF5bhp6U9ED
HCds+VRoVBGPtO3Ogizl5wpynYp7OzwqgwTteFlJ167mmqL05n/xLHnsvii3UFO4
MWwWMxVmwvEpJINsYOJ+mFxOXeD23ckKt3GQh2NF2Dpa+apEvq5l9vjmk4Vnqau2
WKXygbz1Rm0b629dblV8vU9iwgIsSlXz8oopkETadpkaGk9s/p8AYPupmqfCiwHx
/gYlAgIV0DmePfOjYGZ0RJTVHFnG5ong3kUyoeuAwCMWLC/QQ6pCIL+pRnXOT1/q
oXCTK7HUUZjWpRyHf/ptHpQOeYH+AuYAYJNwQA3xjzv57kkGT/gR3Q4APmA6l5lN
swHVL63QYjcKCNm+fR7pr2ka50WSrerFyLWinAT9G9w+h/31Zcl0cBqEM45nlaye
B5fYaU/G6ehFxWgVEjS7z7FSLQVNJu7aAXVZy9QlKcduNXBUZsDkcDI1iyKVhvl4
41SNhLXMO2Jk69kHtuE803/aVgw8N3Y/E5zjlBNXWSpPMPFeKZl9W6eqnl50kQcd
fKbZGV8bxFl40iBi4mfIrdOXrBQ9Oohp7UVWTHG1qYMruVRmW3aJAjMEAQEKAB0W
IQS66Rw2AWA1VmCbiTP4R473V2p7VwUCW8t0bgAKCRD4R473V2p7V8DqD/9YpnFP
usbOW9p3GwUgbvqPdefLszFZZb5LNsgL9eTSKwMUTn5AGldFquDM3hbjiZ+e/nbD
TwFKbKRt//48R5UTYsYJVxcNVW3CXxMtl+8B5PJORfUbz0/HSEsnKTMlHP1M4ybw
gZCI45sP4wT1prU3ngkZGHJJY9ojNOCrzHA+DVEp+vROn/zyg6AbLcr0+/yjCHO0
pxDbGUgEOV93GFKXl85u7qCXUTrIt2fkeFeEQoh248oBJQHPjD9WyOV/O3QNdT7d
6g7lJcSSpwevtTsWFaWCxRM2IwHlXJiWU/9bA2Jrb8E07mJGlmil7xCe4rPFD69F
/y9MBfMG0KVjAFgs6vAR5zHnN865d18JCunQ4OhY0tDnhi4q3O0OdehGqyX92pwL
hMKtHRHLuhYoDud2kdxizmtov1bHghO0kKSTlDGhZvs9Fpod4MKQHaZx4VbpA8np
OpmPBkX7+34AmnLnJP2GOA4UhsRpX1iyqTaGePjhtA0gqz5285bL02JGx/m7HDtX
MYI4yoc3rdZz37axnRinWmW7Lu5JmQGeVLJZ7Z2b83BEHVnapXPW2kFp8PcqbNnA
Lbb9XLkbHNOaiC4EFm07uFmMVkV6aKW3xV1YIlDeovRfNC0cyZDnUNFqaDGtZAeO
UifqHyDqNjBJX0a8miUMZDOXsZFD2jzm3pjS/Q==
=JRPp
-----END PGP SIGNATURE-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Coding"></category><category term="en"></category><category term="gpg"></category></entry><entry><title>Access gene annotation using gffutils</title><link href="https://blog.liang2.tw/posts/2018/06/gene-annotation-using-gffutils/" rel="alternate"></link><published>2018-06-22T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2018-06-22:/posts/2018/06/gene-annotation-using-gffutils/</id><summary type="html">&lt;p&gt;Recently, I had to access gene annotations in multiple versions from multiple sources such as Ensembl, GENCODE, and UCSC. I used to rely on the R/Bioconductor ecosystem to query the coordinates of a gene annotation. There are existing Bioconductor packages ready for Ensembl and UCSC annotations (more info in â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Recently, I had to access gene annotations in multiple versions from multiple sources such as Ensembl, GENCODE, and UCSC. I used to rely on the R/Bioconductor ecosystem to query the coordinates of a gene annotation. There are existing Bioconductor packages ready for Ensembl and UCSC annotations (more info in my previous posts: &lt;a href="https://blog.liang2.tw/posts/2016/05/biocondutor-ensembl-reference/"&gt;Ensembl&lt;/a&gt; and &lt;a href="https://blog.liang2.tw/2016Talk-Genomics-in-R/"&gt;UCSC&lt;/a&gt;), and one can create a new customized TxDb given a GTF/GFF file. However, the project I was working on was written in Python, so I went on searching for similar alternatives in Python.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s how I found &lt;a href="https://daler.github.io/gffutils/"&gt;gffutils&lt;/a&gt;, a Python package to access gene annotations from GTF/GFF files. &lt;code&gt;gffutils&lt;/code&gt; first imports the annotations from the GTF/GFF file into a SQLite database. The package also provides some abstraction on top of the database schema, so user can retrieve an annotation without talking to the database directly using repetitive SQL commands. Database enables fast random access to any gene annotation. &lt;/p&gt;
&lt;p&gt;I will use GENCODE v19, an annotation used by many TCGA GRCh37/hg19 projects, as an example to demo the usage of gffutils. My project requires the coordinates of UTRs and exons of all the transcripts in use.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#usage-example"&gt;Usage example&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#single-feature-access"&gt;Single feature access&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#gene-model-coordinates-of-a-transcript"&gt;Gene model coordinates of a transcript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#feature-selection"&gt;Feature selection&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#direct-operation-on-the-database"&gt;Direct operation on the database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#discussions"&gt;Discussions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="usage-example"&gt;Usage example&lt;/h3&gt;
&lt;p&gt;To use gffutils to query GENCODE annotation, we need to create the database first. The comprehensive gene annotation GTF can be downloaded from &lt;a href="https://www.gencodegenes.org/releases/19.html"&gt;the GENCODE website&lt;/a&gt; (&lt;a href="ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_19/gencode.v19.annotation.gtf.gz"&gt;URL to the GTF&lt;/a&gt;). The database creation is handled by gffutils&amp;rsquo;s &lt;code&gt;create_db&lt;/code&gt; function. It will take a few minutes to run and the database will be at &lt;code&gt;gencode_v19.db&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;gffutils&lt;/span&gt;

&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gffutils&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create_db&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;./gencode.v19.annotation.gtf.gz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;dbfn&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gencode_v19.db&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;verbose&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;merge_strategy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;error&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;disable_infer_transcripts&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;disable_infer_genes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Committing changes: 2619000 features&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Populating features table and first-order relations: 2619443 features&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Creating relations(parent) index&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Creating relations(child) index&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Creating features(featuretype) index&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Creating features (seqid, start, end) index&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Creating features (seqid, start, end, strand) index&lt;/span&gt;
&lt;span class="c1"&gt;# INFO - Running ANALYSE features&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once the database is created, we don&amp;rsquo;t have to repeat the same process but load the database directly as a FeatureDB object:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gffutils&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FeatureDB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./gencode_v19.db&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="single-feature-access"&gt;Single feature access&lt;/h4&gt;
&lt;p&gt;One can then access the annotations of a gene or transcript by its ID. Using a transcript of TP53 as an example,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;gene&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ENSG00000141510.11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="n"&gt;gene&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;Feature gene (chr17:7565097-7590856[-]) at 0x7fac828deeb8&amp;gt;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ENST00000269305.4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;Feature transcript (chr17:7571720-7590856[-]) at 0x7fac828f8080&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can then access the details of the transcript:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;featuretype&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;source&lt;/span&gt;
&lt;span class="go"&gt;(&amp;#39;transcript&amp;#39;, &amp;#39;HAVANA&amp;#39;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;chrom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strand&lt;/span&gt;
&lt;span class="go"&gt;(&amp;#39;chr17&amp;#39;, 7571720, 7590856, &amp;#39;-&amp;#39;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;[(&amp;#39;gene_id&amp;#39;, [&amp;#39;ENSG00000141510.11&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;transcript_id&amp;#39;, [&amp;#39;ENST00000269305.4&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;gene_type&amp;#39;, [&amp;#39;protein_coding&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;gene_status&amp;#39;, [&amp;#39;KNOWN&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;gene_name&amp;#39;, [&amp;#39;TP53&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;transcript_type&amp;#39;, [&amp;#39;protein_coding&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;transcript_status&amp;#39;, [&amp;#39;KNOWN&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;transcript_name&amp;#39;, [&amp;#39;TP53-001&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;level&amp;#39;, [&amp;#39;2&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;protein_id&amp;#39;, [&amp;#39;ENSP00000269305.4&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;tag&amp;#39;, [&amp;#39;basic&amp;#39;, &amp;#39;appris_principal&amp;#39;, &amp;#39;CCDS&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;ccdsid&amp;#39;, [&amp;#39;CCDS11118.1&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;havana_gene&amp;#39;, [&amp;#39;OTTHUMG00000162125.4&amp;#39;]),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;havana_transcript&amp;#39;, [&amp;#39;OTTHUMT00000367397.1&amp;#39;])]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="gene-model-coordinates-of-a-transcript"&gt;Gene model coordinates of a transcript&lt;/h4&gt;
&lt;p&gt;To find the coordinates of its exons and UTRs, we use &lt;a href="https://daler.github.io/gffutils/autodocs/gffutils.interface.FeatureDB.children.html#gffutils.interface.FeatureDB.children"&gt;&lt;code&gt;FeatureDB.children()&lt;/code&gt;&lt;/a&gt; which takes an Feature object or its ID and retrieves all the features belong to this feature. TP53 is on the reverse strand of the chromosome, so we can further sort the features by their end position:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;children&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;order_by&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;             
&lt;span class="go"&gt;[&amp;lt;Feature transcript (chr17:7571720-7590856[-]) at 0x7fac828922e8&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature UTR (chr17:7590695-7590856[-]) at 0x7fac82892208&amp;gt;, &lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature exon (chr17:7590695-7590856[-]) at 0x7fac828922b0&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature UTR (chr17:7579913-7579940[-]) at 0x7fac828925c0&amp;gt;, &lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature exon (chr17:7579839-7579940[-]) at 0x7fac828928d0&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature CDS (chr17:7579839-7579912[-]) at 0x7fac82892c18&amp;gt;, &lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature start_codon (chr17:7579910-7579912[-]) at 0x7fac82892f28&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; ...&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature CDS (chr17:7572930-7573008[-]) at 0x7fac828277b8&amp;gt;, &lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature exon (chr17:7571720-7573008[-]) at 0x7fac82827b38&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature UTR (chr17:7571720-7572929[-]) at 0x7fac82827eb8&amp;gt;,       &lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature stop_codon (chr17:7572927-7572929[-]) at 0x7fac828fca90&amp;gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We have retrieved the UTRs, CDSs and exons of the transcript. Note that UTR is considered a part of an exon in gene annotation terminology. We should use CDSs as the exons that will be translated to amino acids. &lt;code&gt;FeatureDB.children()&lt;/code&gt; provides a way to subset the feature type it returns:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;children&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;order_by&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;featuretype&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;CDS&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;UTR&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Feature UTR (chr17:7590695-7590856[-]) at 0x7fac8283d7f0&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature UTR (chr17:7579913-7579940[-]) at 0x7fac8283d710&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature CDS (chr17:7579839-7579912[-]) at 0x7fac8283d7b8&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; ...&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature CDS (chr17:7572930-7573008[-]) at 0x7fac82846470&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Feature UTR (chr17:7571720-7572929[-]) at 0x7fac828467b8&amp;gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now the gene model of TP53 becomes clearly visible.&lt;/p&gt;
&lt;h4 id="feature-selection"&gt;Feature selection&lt;/h4&gt;
&lt;p&gt;To select all the transcripts in the database, there is a &lt;code&gt;FeatureDB.all_features()&lt;/code&gt; function. Here we want to select only the basic GENOCODE transcripts and count the number of different gene types:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;collections&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Counter&lt;/span&gt;
&lt;span class="c1"&gt;# All the transcripts of basic GENCODE v19&lt;/span&gt;
&lt;span class="n"&gt;all_basic_txs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;tx&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all_features&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;featuretype&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;transcript&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tag&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;basic&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;Counter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gene_type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;tx&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;all_basic_txs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;most_common&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# [(&amp;#39;protein_coding&amp;#39;, 67186),&lt;/span&gt;
&lt;span class="c1"&gt;#  (&amp;#39;antisense&amp;#39;, 9160),&lt;/span&gt;
&lt;span class="c1"&gt;#  (&amp;#39;lincRNA&amp;#39;, 7121),&lt;/span&gt;
&lt;span class="c1"&gt;#  (&amp;#39;miRNA&amp;#39;, 3055),&lt;/span&gt;
&lt;span class="c1"&gt;#  (&amp;#39;misc_RNA&amp;#39;, 2034)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="direct-operation-on-the-database"&gt;Direct operation on the database&lt;/h3&gt;
&lt;p&gt;Since gffutils is just a abstraction layer on top of the database, we can always talk to the underlying SQLite database directly by writing SQL commands. The database schema is available on &lt;a href="https://daler.github.io/gffutils/database-schema.html"&gt;the gffutils&amp;rsquo;s documentation&lt;/a&gt;. Under the hood, FeatureDB object maintains a SQLite connection at &lt;code&gt;FeatureDB.conn&lt;/code&gt; and a helper function to run a single SQL command via &lt;code&gt;FeatureDB.execute()&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;For example, GENCODE stores the full version of a transcript ID but in many occasion, such information is not available. Say if we only know the TP53 transcript ID is &lt;code&gt;ENST00000269305&lt;/code&gt;, then we can write a SQL query to find the matching ID: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;conn&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;sqlite3.Connection at 0x7fac89423490&amp;gt;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;cur&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;SELECT id FROM features &amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;   &lt;span class="s2"&gt;&amp;quot;WHERE featuretype=&amp;#39;transcript&amp;#39; AND id LIKE &amp;#39;ENST00000269305.%&amp;#39;;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;cur&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchone&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;ENST00000269305.4&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We can even tweak the SQLite behavior by setting &lt;a href="https://www.sqlite.org/pragma.html"&gt;the &lt;code&gt;PRAGMA&lt;/code&gt; statements&lt;/a&gt;. gffutils has already added default pragma to optimize database query, including less database integrity and large memory size:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pragmas&lt;/span&gt;
&lt;span class="go"&gt;{&amp;#39;synchronous&amp;#39;: &amp;#39;NORMAL&amp;#39;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;#39;journal_mode&amp;#39;: &amp;#39;MEMORY&amp;#39;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;#39;main.page_size&amp;#39;: 4096,&lt;/span&gt;
&lt;span class="go"&gt; &amp;#39;main.cache_size&amp;#39;: 10000}&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PRAGMA temp_store=MEMORY&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PRAGMA cache_size=-1000000&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c1"&gt;# Use 1GB memory&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="discussions"&gt;Discussions&lt;/h3&gt;
&lt;p&gt;gffutils provides a SQLite-based gene annotation storage in Python. Though it may not be as feature complete as what user may get in R, it is highly customizable and can be easily integrated with other Python functions. Like the Bioconductor packages GenomicFeatures and EnsDb, they all use a SQLite database under the hood. As shown in &lt;a href="https://blog.liang2.tw/posts/2017/11/use-ensdb-database-in-python/"&gt;another post&lt;/a&gt;, we can actually connect to those databases built by R packages directly, so user can access information from other sources such as UniProt isoforms and gene names.&lt;/p&gt;
&lt;p&gt;In my opinion, all the approaches mentioned above are always better than trying to bake one&amp;rsquo;s own from scratch. Those packages are backed by numerous tests and are built from reliable or the original data sources. Besides multiple existing solutions in R and Python, one can always access the databases built by those packages from different languages, so it is quite unlikely to build something from scratch anyway.&lt;/p&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="python"></category><category term="sqlite"></category></entry><entry><title>Read UniProtKB in XML format</title><link href="https://blog.liang2.tw/posts/2018/01/read-uniprotkb-xml/" rel="alternate"></link><published>2018-01-28T00:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2018-01-28:/posts/2018/01/read-uniprotkb-xml/</id><summary type="html">&lt;p&gt;UniProt Knowledge Base (&lt;a href="http://www.uniprot.org/help/uniprotkb"&gt;UniProtKB&lt;/a&gt;) provides &lt;a href="https://www.uniprot.org/help/programmatic_access"&gt;various methods&lt;/a&gt; to access their data. I settled on their XML format since no additional parsing code is required and the format is well defined, which comes with a schema. Plus, it turns out that databases such as &lt;a href="http://pdbml.pdb.org/"&gt;PDB&lt;/a&gt; also provide their data export in â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;UniProt Knowledge Base (&lt;a href="http://www.uniprot.org/help/uniprotkb"&gt;UniProtKB&lt;/a&gt;) provides &lt;a href="https://www.uniprot.org/help/programmatic_access"&gt;various methods&lt;/a&gt; to access their data. I settled on their XML format since no additional parsing code is required and the format is well defined, which comes with a schema. Plus, it turns out that databases such as &lt;a href="http://pdbml.pdb.org/"&gt;PDB&lt;/a&gt; also provide their data export in XML format and the corresponding schema so the method can be applied elsewhere. &lt;/p&gt;
&lt;p&gt;Here I will show how to read XML with its schema in Python using &lt;a href="https://pypi.org/project/xmlschema/"&gt;xmlschema&lt;/a&gt;.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#other-ways-to-read-uniprotkb-data-in-bulk"&gt;Other ways to read UniProtKB data in bulk&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#xml-and-xml-schema"&gt;XML and XML schema&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#read-uniprot-xml-by-xmlschema"&gt;Read UniProt XML by xmlschema&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="other-ways-to-read-uniprotkb-data-in-bulk"&gt;Other ways to read UniProtKB data in bulk&lt;/h2&gt;
&lt;p&gt;UniProtKB at least provides REST, SPARQL, XML, and a flat text file for its data access. &lt;/p&gt;
&lt;p&gt;RESTful APIs work very well to access a small proportion of data and usually are my way to go for data access, but it will put too much load on the server if I want a lot of information from tens of thousands of entries. Ideally, UniProtKB&amp;rsquo;s data won&amp;rsquo;t change very often so I&amp;rsquo;d like to hit the database once per entry and cache the results locally. &lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/SPARQL"&gt;SPARQL&lt;/a&gt; is kind of similar to REST but can directly query on UniProtKB&amp;rsquo;s &lt;a href="https://en.wikipedia.org/wiki/Resource_Description_Framework"&gt;RDF&lt;/a&gt; file, thus one can retrieve whatever information available in a complex way. I started my research on this method but I got overwhelmed by the technical details and eventually gave up. I feel like more tutorials or examples on how to access the SPARQL interface will be very helpful.&lt;/p&gt;
&lt;p&gt;UniProtKB&amp;rsquo;s flat text file has been a popular way to parse its data. I mean, it has &lt;a href="https://www.uniprot.org/docs/userman.htm"&gt;its own manual&lt;/a&gt;, and one can download a full entry&amp;rsquo;s data easily. But this requires writing a custom parser in Python. More code means more bugs, and I will worry about whether my parser works every time UniProt updates.&lt;/p&gt;
&lt;h2 id="xml-and-xml-schema"&gt;XML and XML schema&lt;/h2&gt;
&lt;p&gt;XML data are structured. For example, this is what entry &lt;a href="https://www.uniprot.org/uniprot/P51587"&gt;P51587&lt;/a&gt; looks like in XML format:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;uniprot&lt;/span&gt; &lt;span class="na"&gt;xmlns=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://uniprot.org/uniprot&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;xmlns:xsi=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://uniprot.org/uniprot http://www.uniprot.org/support/docs/uniprot.xsd&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;entry&lt;/span&gt; &lt;span class="na"&gt;dataset=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Swiss-Prot&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;created=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1996-10-01&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;modified=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;2017-12-20&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;version=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;201&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;accession&amp;gt;&lt;/span&gt;P51587&lt;span class="nt"&gt;&amp;lt;/accession&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;accession&amp;gt;&lt;/span&gt;O00183&lt;span class="nt"&gt;&amp;lt;/accession&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;accession&amp;gt;&lt;/span&gt;O15008&lt;span class="nt"&gt;&amp;lt;/accession&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;accession&amp;gt;&lt;/span&gt;Q13879&lt;span class="nt"&gt;&amp;lt;/accession&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;accession&amp;gt;&lt;/span&gt;Q5TBJ7&lt;span class="nt"&gt;&amp;lt;/accession&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;BRCA2_HUMAN&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;protein&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;recommendedName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;fullName&amp;gt;&lt;/span&gt;Breast cancer type 2 susceptibility protein&lt;span class="nt"&gt;&amp;lt;/fullName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/recommendedName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;alternativeName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;fullName&amp;gt;&lt;/span&gt;Fanconi anemia group D1 protein&lt;span class="nt"&gt;&amp;lt;/fullName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/alternativeName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/protein&amp;gt;&lt;/span&gt;
&lt;span class="cm"&gt;&amp;lt;!-- ...  --&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/entry&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/uniprot&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The file is available at &lt;a href="https://www.uniprot.org/uniprot/P04637.xml"&gt;https://www.uniprot.org/uniprot/P04637.xml&lt;/a&gt;. Basically, all the information about this entry should be available in this file, as long as one knows how to query the XML via &lt;a href="https://en.wikipedia.org/wiki/XPath"&gt;XPath&lt;/a&gt;. However, I find XML file harder to read alone, especially without any guide of how the file was constructed.&lt;/p&gt;
&lt;p&gt;UniProt XML is constructed based on its XML schema, available as an XSD file at &lt;a href="http://www.uniprot.org/support/docs/uniprot.xsd"&gt;http://www.uniprot.org/support/docs/uniprot.xsd&lt;/a&gt;. The schema not only helps understand the XML content, it also validates whether the XML is valid. In other words, since all UniProt XMLs are validated by its schema, one can expect to parse all their data the same as what the schema has defined. XML schema is also part of the &lt;a href="https://www.w3.org/XML/Schema"&gt;W3C standard&lt;/a&gt; and wildly used.&lt;/p&gt;
&lt;h2 id="read-uniprot-xml-by-xmlschema"&gt;Read UniProt XML by xmlschema&lt;/h2&gt;
&lt;p&gt;I use &lt;a href="https://pypi.org/project/xmlschema/"&gt;xmlschema&lt;/a&gt; to read XML with its schema in Python. Instead of using XPath, one can actually convert the XML content into a dictionary-like format, which can be easily passed to other Python functions.&lt;/p&gt;
&lt;p&gt;Using same entry &lt;a href="https://www.uniprot.org/uniprot/P51587"&gt;P51587&lt;/a&gt; as an example,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;xmlschema&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;xmlschema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;XMLSchema&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://www.uniprot.org/docs/uniprot.xsd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;entry_dict&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./P51587.xml&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;entry_dict&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;dict_keys([&amp;#39;@xsi:schemaLocation&amp;#39;, &amp;#39;entry&amp;#39;, &amp;#39;copyright&amp;#39;])&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;entry_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;entry&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)[:&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[&amp;#39;@dataset&amp;#39;, &amp;#39;@created&amp;#39;, &amp;#39;@modified&amp;#39;, &amp;#39;@version&amp;#39;, &amp;#39;accession&amp;#39;, &amp;#39;name&amp;#39;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I don&amp;rsquo;t need any custom code to read the XML content structurally. For example, to get all the accession IDs of this entry,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;accession&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[&amp;#39;P51587&amp;#39;, &amp;#39;O00183&amp;#39;, &amp;#39;O15008&amp;#39;, &amp;#39;Q13879&amp;#39;, &amp;#39;Q5TBJ7&amp;#39;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To get the protein names,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;protein&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;{&amp;#39;alternativeName&amp;#39;: [{&amp;#39;fullName&amp;#39;: &amp;#39;Fanconi anemia group D1 protein&amp;#39;}],&lt;/span&gt;
&lt;span class="go"&gt; &amp;#39;recommendedName&amp;#39;: {&amp;#39;fullName&amp;#39;: &amp;#39;Breast cancer type 2 susceptibility protein&amp;#39;}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;One can compare the dictionary converted result with the original XML. I&amp;rsquo;d like to end the demo with a more complicated example that finds all the sequence variants:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;seq_variants&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sequence variant&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;variation&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;feature&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;location&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;position&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;@position&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
&lt;span class="gp"&gt;... &lt;/span&gt;  &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;original&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;variation&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;seq_variants&lt;/span&gt;&lt;span class="p"&gt;][:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[(25, &amp;#39;G&amp;#39;, &amp;#39;R&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (31, &amp;#39;W&amp;#39;, &amp;#39;C&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (31, &amp;#39;W&amp;#39;, &amp;#39;R&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (32, &amp;#39;F&amp;#39;, &amp;#39;L&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (42, &amp;#39;Y&amp;#39;, &amp;#39;C&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (53, &amp;#39;K&amp;#39;, &amp;#39;R&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (60, &amp;#39;N&amp;#39;, &amp;#39;S&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (64, &amp;#39;T&amp;#39;, &amp;#39;I&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (75, &amp;#39;A&amp;#39;, &amp;#39;P&amp;#39;),&lt;/span&gt;
&lt;span class="go"&gt; (81, &amp;#39;F&amp;#39;, &amp;#39;L&amp;#39;)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;Using UniProt&amp;rsquo;s XML and its schema can read all the data in a structured fashion without a custom parser. Once downloading the XML files of interest, one could basically query everything locally, which is very helpful to retrieve substantial information from UniProt, say, extracting all the citations for certain protein feature.&lt;/p&gt;
&lt;p&gt;XML schema really helps users to understand the data structure and it also helps the database developers validate their data export. I hope someday all the databases should have this validation enforced.&lt;/p&gt;
&lt;p&gt;However, one may find XML format tedious and not human-friendly to read. JSON has been popular and used heavily by RESTful APIs. The specification of &lt;a href="http://json-schema.org/"&gt;JSON schema&lt;/a&gt; exists, but it is not a W3C standard yet. &lt;/p&gt;
&lt;p&gt;SPARQL and RDF, part of the attempt for the Semantic web can be a universal query interface solving the same problem more elegantly, though the entry level is a bit high with limited learning resources available.&lt;/p&gt;
&lt;p&gt;For now, reading bulk data in XML with its schema seems to be the mature way to go with abundant support.&lt;/p&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="python"></category><category term="uniprot"></category></entry><entry><title>Ad hoc bioinformatic analysis in database</title><link href="https://blog.liang2.tw/posts/2018/01/ad-hoc-bioinfo-analysis-in-database/" rel="alternate"></link><published>2018-01-20T00:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2018-01-20:/posts/2018/01/ad-hoc-bioinfo-analysis-in-database/</id><summary type="html">&lt;p&gt;Recently I&amp;rsquo;ve found that bioinformatic analysis in a database is not hard at all and the database set up wasn&amp;rsquo;t as daunting as it sounds, especially when the data are tabular. I used to start my analysis with loading everything into R or Python, and then figuring out â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Recently I&amp;rsquo;ve found that bioinformatic analysis in a database is not hard at all and the database set up wasn&amp;rsquo;t as daunting as it sounds, especially when the data are tabular. I used to start my analysis with loading everything into R or Python, and then figuring out all the filtering and grouping commands with my favorite R or Python packages. However, the data size would be bound by memory and the analysis might be slow unless additional optimization was applied. On the other hand, databases have already solved the problems by mapping the data to disk and indexing. Therefore I&amp;rsquo;d like to share my recent experience on using databases for bioinfo analysis.&lt;/p&gt;
&lt;p&gt;Note that if one is interested in the actual tips of using databases for analysis, feel free to skip the whole background section.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#background"&gt;Background&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#reading-tabular-data-in-bioinformatics"&gt;Reading tabular data in bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database"&gt;Database&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#tabular-data-io-in-database"&gt;Tabular data IO in database&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sqlite"&gt;SQLite&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#loading-compressed-data-with-named-pipe"&gt;Loading compressed data with named pipe&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#benchmark"&gt;Benchmark&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#pandas-python"&gt;pandas (Python)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sqlite_1"&gt;SQLite&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql_1"&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#result"&gt;Result&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="background"&gt;Background&lt;/h2&gt;
&lt;h3 id="reading-tabular-data-in-bioinformatics"&gt;Reading tabular data in bioinformatics&lt;/h3&gt;
&lt;p&gt;Tabular data are everywhere in bioinformatics. To record gene expressions, variants or cross reference IDs between different annotation systems or databases, data are stored in various tabular-like formats, such as BED, GTF, MAF, and VCF, which can usually be normalized to the standard CSV and TSV files. Starting with the raw data, we apply different kinds of filtering and grouping to pick up the records of interest. For example, we might subset the data within a genomic region, select transcripts above an expression threshold, or group the data by the same transcript across multiple samples.&lt;/p&gt;
&lt;p&gt;Researchers have developed numerous tools to select the data of interest. In Python, numpy and pandas dominate the analysis; in R, data.frame, tibble, and data.table are all widely used. However, all the tools above only work if the data can be fit into memory. Unfortunately, bioinformatics data can go beyond 10GB easily these days. It has been difficult to analyze everything in memory. Even using a powerful server with a few hundreds GB of memory, the overhead of loading all data into memory can be time-consuming. To make things worse, when joining multiple data together, the magnitude of the issues above will be multiplied.&lt;/p&gt;
&lt;p&gt;One might argue that in Python there are packages like &lt;a href="http://xarray.pydata.org/en/stable/"&gt;xarray&lt;/a&gt; and &lt;a href="https://dask.pydata.org/en/latest/"&gt;dask&lt;/a&gt; capable of handling out-of-memory multi-dimensional array. But they are only useful for handling numerical data. In bioinformatics, metadata are frequently used and consist of many text columns, where numpy doesn&amp;rsquo;t have the same computing advantage as numerical columns. For example, gene expression only makes sense if it comes with the gene symbol, the transcript id, and the sample id.&lt;/p&gt;
&lt;h3 id="database"&gt;Database&lt;/h3&gt;
&lt;p&gt;Databases have been solving the out-of-memory data analysis for decades, and it also comes with several advantages. First, the language databases use is standardized, known as Structured Query Language (SQL). SQL is expressive, which means instead of writing how to load or query the data, one writes what the data or the query look like. Databases support concurrent reads, enabling query in parallel. Second, One can speed up the queries by setting up indexes. Different types of indexes and different combinations of columns can be added to boost the query. Lastly, databases are persistent, so one only needs to load the data once.&lt;/p&gt;
&lt;p&gt;I mainly use two databases: &lt;a href="https://sqlite.org/"&gt;SQLite&lt;/a&gt; and &lt;a href="https://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt;. SQLite&amp;rsquo;s database is just a single file on disk and it doesn&amp;rsquo;t need any configuration to run. In fact SQLite ships with Python, available as the &lt;a href="https://docs.python.org/3/library/sqlite3.html"&gt;&lt;code&gt;sqlite&lt;/code&gt; module&lt;/a&gt;. SQLite works very well in my case.&lt;/p&gt;
&lt;p&gt;PostgreSQL is a more feature-rich database and has better concurrency support such as multiple writers at the same time. &lt;a href="https://www.postgresql.org/docs/current/static/indexes-types.html"&gt;Its advanced indexing&lt;/a&gt; and &lt;a href="https://www.postgresql.org/docs/current/static/datatype.html"&gt;data types&lt;/a&gt; might be helpful for genomic range query. The downside is that it requires some configurations and its installation is not as easy as SQLite. Though the basic PostgreSQL setup is actually just a few commands on Debian Linux, one probably needs to go through some documentation to understand what they are about and how to tweak the config.&lt;/p&gt;
&lt;p&gt;The most annoying thing I found using a database in the past was to load my data, where I had to create the table by &lt;code&gt;CREATE TABLE ...&lt;/code&gt; and insert all my data by multiple &lt;code&gt;INSERT INTO ... VALUES ...&lt;/code&gt; statements. But recently I found that many databases have some built-in utilities to make the process easy and fast. Also, it is not hard to programmatically generate the statements through packages like &lt;a href="https://www.sqlalchemy.org/"&gt;SQLAlchemy&lt;/a&gt;. Therefore, I will share some experience of using databases here.&lt;/p&gt;
&lt;h2 id="tabular-data-io-in-database"&gt;Tabular data IO in database&lt;/h2&gt;
&lt;h3 id="sqlite"&gt;SQLite&lt;/h3&gt;
&lt;p&gt;For SQLite, use &lt;code&gt;.mode csv&lt;/code&gt; with &lt;a href="https://www.sqlite.org/cli.html#csv"&gt;&lt;code&gt;.import&lt;/code&gt; statement&lt;/a&gt; to load in data. SQLite will create the table automatically by using the first row as the column names if the table doesn&amp;rsquo;t exist. One can create the table before the loading to define each column&amp;rsquo;s data type, otherwise, columns are just &lt;code&gt;TEXT&lt;/code&gt; type. &lt;code&gt;.separator&lt;/code&gt; controls the delimiter character SQLite uses between columns.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;separator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="c1"&gt;-- For TSV files&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/tsv&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To export data, use &lt;code&gt;.once&lt;/code&gt; statement followed by the query:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;-- Export columns name&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;once&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/output.tsv&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;-- Export all data in the table&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Commands above can be scripted into SQLite like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlite3 mydb.sqlite &amp;lt; load_data.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="postgresql"&gt;PostgreSQL&lt;/h3&gt;
&lt;p&gt;For PostgreSQL, the built-in solution is to use the &lt;a href="https://www.postgresql.org/docs/current/static/sql-copy.html"&gt;&lt;code&gt;COPY&lt;/code&gt; statement&lt;/a&gt; or the &lt;a href="https://www.postgresql.org/docs/current/static/app-psql.html#APP-PSQL-META-COMMANDS-COPY"&gt;&lt;code&gt;\copy&lt;/code&gt; metacommand&lt;/a&gt; to import or export data. &lt;code&gt;COPY&lt;/code&gt; runs faster than the equivalent &lt;code&gt;INSERT&lt;/code&gt; statements. Besides built-in commands, an external tool &lt;a href="https://pgloader.io/"&gt;pgloader&lt;/a&gt; has been very helpful for the data loading, whose loading process is more flexible.&lt;/p&gt;
&lt;p&gt;In this post, I won&amp;rsquo;t dive into details of their usage. There will be an example in the benchmark section.&lt;/p&gt;
&lt;h3 id="loading-compressed-data-with-named-pipe"&gt;Loading compressed data with named pipe&lt;/h3&gt;
&lt;p&gt;Many tabular data are compressed by gzip or bgzip to save the disk space. To decompress the file and load into the database without storing the uncompressed file somewhere first, one can consider using &lt;a href="https://www.linuxjournal.com/article/2156"&gt;named pipe&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The idea is to decompress the file to a named pipe and read the data in a database from the named pipe. A named pipe can be created by &lt;code&gt;mkfifo&lt;/code&gt;.  For example,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mkfifo mypipe
gunzip -c mydata.tsv.gz &amp;gt; mypipe &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The trailing &lt;code&gt;&amp;amp;&lt;/code&gt; makes the decompress command running in the background to keep everything in one shell session. Then read the data in SQLite as if it were a file like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;.import mypipe mytable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The trick here can be further expanded to any preprocessing in any language. One can simply preprocess the file and write the output to a named pipe. The database can read from the named pipe without storing the full intermediate output on disk. Plus, by piping between commands more CPU cores are utilized.&lt;/p&gt;
&lt;h2 id="benchmark"&gt;Benchmark&lt;/h2&gt;
&lt;p&gt;To give an idea of the data processing time in databases, I used all the &lt;a href="https://www.synapse.org/#!Synapse:syn7214402/wiki/405297"&gt;somatic variants from TCGA MC3&lt;/a&gt; as a demonstration. The goal here is to count the number of variants by different transcript and its mutation type. So the output result will be something like the following:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Transcript ID&lt;/th&gt;
&lt;th&gt;Mutation type&lt;/th&gt;
&lt;th&gt;Count&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ENST00000000233&lt;/td&gt;
&lt;td&gt;3&amp;rsquo;UTR&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ENST00000000233&lt;/td&gt;
&lt;td&gt;Frame_Shift_Del&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ENST00000000233&lt;/td&gt;
&lt;td&gt;Intron&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;After filtering out all the silent mutations, there are about total 2.8 million variants making up 614MB of disk space.&lt;/p&gt;
&lt;p&gt;I used three methods to load and group the variants: pandas, SQLite, and PostgreSQL. Their code is shown below.&lt;/p&gt;
&lt;h3 id="pandas-python"&gt;pandas (Python)&lt;/h3&gt;
&lt;p&gt;Standard pandas IO code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;


&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;mc3_filtered.tsv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;names&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;chrom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;strand&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;mutation_type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ref_allele&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;alt_allele&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;transcript_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;hgvs_c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;hgvs_p&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;p_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;p_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;normal_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tumor_id&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;],&lt;/span&gt;
    &lt;span class="n"&gt;dtype&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;chrom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;strand&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cdna_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;p_start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;p_end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;grp_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;groupby&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;transcript_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;mutation_type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;alt_allele&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reset_index&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;grp_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_csv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;out.pandas.tsv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sep&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\t&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="sqlite_1"&gt;SQLite&lt;/h3&gt;
&lt;p&gt;I set some &lt;code&gt;PRAGMA ...&lt;/code&gt; statements at the beginning to control some of the SQLite settings. It tells SQLite to use more cache, create temporary tables in memory and disable all the transaction recovery settings. SQLite by default writes everything to the disk first before changing the actual database content so if the program fails or any exception occurs, it can recover all the transactions properly. In our case, we don&amp;rsquo;t care about the integrity of the database.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache_size&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mi"&gt;4192000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;-- Use 2GB RAM as cache&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;temp_store&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;MEMORY&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;synchronous&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;OFF&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;journal_mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;OFF&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;locking_mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;EXCLUSIVE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;separator&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mc3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;chrom&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;start&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;end&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;strand&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ref_allele&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;alt_allele&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;hgvs_c&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;hgvs_p&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;cdna_start&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;cdna_end&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;p_start&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;p_end&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;normal_id&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;tumor_id&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mc3_filtered&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tsv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mc3&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;-- Create an index to speed up grouping on the same columns&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mc3_idx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mc3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="c1"&gt;-- Output&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;once&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqlite&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tsv&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;COUNT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alt_allele&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mc3&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;GROUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="postgresql_1"&gt;PostgreSQL&lt;/h3&gt;
&lt;p&gt;I used &lt;a href="https://pgloader.io/"&gt;pgloader&lt;/a&gt; to load the data into a local PostgreSQL database &lt;code&gt;test_mc3&lt;/code&gt;. pgloader can take a script of its own mini-language.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;LOAD CSV
    FROM &amp;#39;mc3_filtered.tsv&amp;#39;
    INTO postgresql:///test_mc3?mc3
    WITH fields terminated by &amp;#39;\t&amp;#39;,
         fields not enclosed,
         drop indexes
    BEFORE LOAD DO
    $$ DROP TABLE IF EXISTS mc3; $$,
    $$ CREATE TABLE mc3 (
            chrom       TEXT,
            &amp;quot;start&amp;quot;     BIGINT,
            &amp;quot;end&amp;quot;       BIGINT,
            strand      SMALLINT,
            mutation_type   TEXT,
            ref_allele  TEXT,
            alt_allele  TEXT,
            transcript_id   TEXT,
            hgvs_c      TEXT,
            hgvs_p      TEXT,
            cdna_start  INT,
            cdna_end    INT,
            p_start     INT,
            p_end       INT,
            normal_id   TEXT,
            tumor_id    TEXT
        );
    $$,
    $$ CREATE INDEX mc3_idx ON mc3 (transcript_id, mutation_type); $$
;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To do the grouping analysis, I used the built-in &lt;code&gt;COPY&lt;/code&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;COPY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;COUNT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alt_allele&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mc3&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;GROUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;transcript_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mutation_type&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/private/tmp/mc3/MC3/out.psql.tsv&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;FORMAT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="result"&gt;Result&lt;/h3&gt;
&lt;p&gt;I didn&amp;rsquo;t run it systematically but a few repeats showed the similar numbers.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Method&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Read data (sec)&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Group-by analysis (sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Pandas&lt;/td&gt;
&lt;td style="text-align: right;"&gt;10.7&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;SQLite&lt;/td&gt;
&lt;td style="text-align: right;"&gt;27.7&lt;/td&gt;
&lt;td style="text-align: right;"&gt;4.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;PostgreSQL&lt;/td&gt;
&lt;td style="text-align: right;"&gt;82.6&lt;/td&gt;
&lt;td style="text-align: right;"&gt;13.5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;In this case, all data can be loaded into memory easily, so pandas gave the best performance here. It actually took nearly no-time to complete the grouping.&lt;/p&gt;
&lt;p&gt;All databases ran much slower on loading data than pandas. PostgreSQL seems to run a lot more slower than SQLite, which I think it has something to do with my server configuration, say, not enough cache size, or not enough working memory for the group-by operation. I feel like PostgreSQL can be faster but anyway this&amp;rsquo;s the result I have so far. Note that all the databases are stored on a PCIe SSD disk. If they were on a normal hard drive, the database creation will take a much longer time.&lt;/p&gt;
&lt;p&gt;However, after the data are loaded into the database, the speed of the query alone is comparable to pandas. Because for pandas, one cannot skip the step of reading data so if the analysis is on a frequently used dataset, database like SQLite can yield better performance. Once the data get larger than the memory capacity, special care will be needed to make the pandas&amp;rsquo; approach work, whereas database can scale up with little fuss.&lt;/p&gt;
&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;My post provides a different solution to work with tabular data by working in a database. In-memory approaches like pandas work very efficiently at a small dataset but one will have to code the &amp;ldquo;how-tos&amp;rdquo; to scale to a larger dataset that cannot feed into memory (or the overhead is too high). On the other hand, databases can easily scale to a few hundred GBs in size and the query is fast. For analysis on a frequently used dataset, loading data into the database first might be a good idea.&lt;/p&gt;
&lt;p&gt;Another good thing about databases is that SQL makes joining across tables easily. One can easily join across multiple tables, say, expand the gene annotation and doesn&amp;rsquo;t have to worry how to implement it. With indexing, the joining can be fast. In pandas, one generates many objects representing the joining results, but those objects cannot be easily shared between scripts. Relying on storing the intermediate objects on disk, the accumulated overhead might be significant. Projects like &lt;a href="https://arrow.apache.org/"&gt;Apache Arrow&lt;/a&gt; might solve the in-memory object passing ultimately, but its development is still in the early phase. As for databases, one can define reusable views for the joining logic and filtering results. The post didn&amp;rsquo;t really touch this part so I probably need another benchmark or post to back my thoughts.&lt;/p&gt;
&lt;p&gt;If one is analyzing variants, using databases or SQL in general has been backed up by many pratical projects. People at &lt;a href="http://quinlanlab.org/"&gt;Quinlab Lab&lt;/a&gt; hace been building &lt;a href="https://github.com/quinlan-lab/vcf2db"&gt;vcf2db&lt;/a&gt; to load variants into databases for downstream annotation and analysis. To scale way up to terabytes or petabytes of variant data, &lt;a href="https://cloud.google.com/genomics/v1/analyze-variants"&gt;Google Cloud Genomics&lt;/a&gt; provides an interface to store and query variants in BigQuery, where users use standard SQL to select the variants of interest.&lt;/p&gt;
&lt;p&gt;However, working in pandas gives users great room for flexibility. For example, one can iterate over rows and do some complex transformation of the value. Maybe it would be the optimal solution to use &lt;a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_sql.html#pandas.read_sql"&gt;&lt;code&gt;pandas.read_sql&lt;/code&gt;&lt;/a&gt; to run a query in a database.&lt;/p&gt;
&lt;p&gt;It seems to me like many people rely too much on the features of some special file formats such as bgzip and tabix and have forgotten the generic yet flexible approach using databases. Those formats often optimize the random access by a given genomic query by indexing. In databases, such index is analogous to &lt;code&gt;(chrom, start, -end)&lt;/code&gt; or even GiST index on Range type in PostgreSQL. It might be slower in databases, but aside from the performance, one can continue to query the records in the same way in databases. For special format, the functionality will be much limited.&lt;/p&gt;
&lt;p&gt;Now I will give the database approach a try before writing my own data wrangling script.&lt;/p&gt;
&lt;p&gt;EDIT 2018-01-28: Add real world examples of using databases to store variant data.&lt;/p&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="python"></category><category term="pandas"></category><category term="sqlite"></category><category term="postgresql"></category></entry><entry><title>Using EnsDb's annotation database in Python</title><link href="https://blog.liang2.tw/posts/2017/11/use-ensdb-database-in-python/" rel="alternate"></link><published>2017-11-17T00:00:00-06:00</published><updated>2022-05-13T12:53:21-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2017-11-17:/posts/2017/11/use-ensdb-database-in-python/</id><summary type="html">&lt;p&gt;How to find and download the EnsDb, the Ensembl genomic annotation in SQLite database made by R package ensembldb, and use it in Python application.&lt;/p&gt;</summary><content type="html">&lt;p&gt;I found that there isn&amp;rsquo;t a systematic way to query and convert genomic annotation IDs in Python. At least there isn&amp;rsquo;t one as good as &lt;a href="https://www.bioconductor.org/help/workflows/annotation/annotation/"&gt;what R/Bioconductor currently has&lt;/a&gt;. If you&amp;rsquo;ve never heard of R/Bioconductor annotation tool stack before, check out &lt;a href="https://www.bioconductor.org/help/workflows/annotation/annotation/"&gt;the official workflow&lt;/a&gt; or &lt;a href="https://blog.liang2.tw/posts/2016/05/biocondutor-ensembl-reference/"&gt;my post in 2016&lt;/a&gt; specific for querying Ensembl annotations.&lt;/p&gt;
&lt;p&gt;Although I enjoy using R for genomic annotation conversion, a few days ago I wanted to do the same thing inside my text processing script in Python. I might be able to re-write the script in R but I feel like R is not really the right tool for this task and on top of it, I don&amp;rsquo;t know how to write an efficent text processing in R&lt;sup id="fnref:r-text-processing"&gt;&lt;a class="footnote-ref" href="#fn:r-text-processing"&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Knowing the fact that all annotations in R are stored in single-file SQLite databases, I should be able to connect the database directly Python or any other language and wirte SQL query to retrieve the same information. So my question now becomes to how to extract or find the path to the databases. Turn out that many new Bioconductor annotation packages are hosted via &lt;a href="https://bioconductor.org/packages/release/bioc/html/AnnotationHub.html"&gt;AnnotationHub&lt;/a&gt;, and user can search for the annotation package and retrieve them locally by their ID. For example, all the recent Ensembl releases, e.g., &lt;code&gt;EnsDb.Hsapiens.vXX&lt;/code&gt;, are available on AnnotationHub.&lt;/p&gt;
&lt;p&gt;After digging around a bit, I am able to query the AnnotationHub, download the correct EnsDB SQLite database file, and make SQL queries for the annotation ID conversion without any R package. I will share the details in the rest of the post.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#annotationhub-web-interface"&gt;AnnotationHub web interface&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#manual-query-in-annotationhub"&gt;Manual query in AnnotationHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#manual-query-in-ensdb"&gt;Manual query in EnsDB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;But before we start with the details, I want to clarify that it wasn&amp;rsquo;t my intention to persuade people away from the current R ecosystem. The current R ecosystem is great and I will recommend people to stick with it as much as you can. I am pretty sure I will hit a lot of issues if I want to do more complex analysis or queries without the help of what R packages provide.&lt;/p&gt;
&lt;h2 id="annotationhub-web-interface"&gt;AnnotationHub web interface&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;EDIT 2019-01-29&lt;/strong&gt;&lt;br&gt;
Now AnnotationHub has a nice &lt;a href="https://annotationhub.bioconductor.org/"&gt;web interface&lt;/a&gt;. With the new API, we can search and download all the EnsDb annotation objects on AnnotationHub by visiting &lt;a href="https://annotationhub.bioconductor.org/package2/AHEnsDbs"&gt;https://annotationhub.bioconductor.org/package2/AHEnsDbs&lt;/a&gt;:&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2017/11/use-ensdb-database-in-python/pics/annotataionhub_web_interface.png"/&gt;
  &lt;figcaption&gt;The web query interface of AnnotationHub&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The following section is the old way to navigate through AnnotationHub&amp;rsquo;s database.&lt;/p&gt;
&lt;h2 id="manual-query-in-annotationhub"&gt;Manual query in AnnotationHub&lt;/h2&gt;
&lt;p&gt;When one wants to use the R package AnnotationHub, the common usage is&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AnnotationHub&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ah&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;AnnotationHub&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c1"&gt;## snapshotDate(): 2017-10-27&lt;/span&gt;

&lt;span class="nf"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ah&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;EnsDb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Homo sapiens&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The function call &lt;code&gt;AnnotationHub()&lt;/code&gt; will download the latest version of the metadata of all available annotation object. The subsequent &lt;code&gt;query(...)&lt;/code&gt; function will talk to the local metadata database.&lt;/p&gt;
&lt;p&gt;Now let&amp;rsquo;s do it manually without any R function calls.&lt;/p&gt;
&lt;p&gt;The default &lt;a href="https://bioconductor.org/packages/release/bioc/html/AnnotationHub.html"&gt;AnnotationHub&lt;/a&gt; is at &lt;a href="https://annotationhub.bioconductor.org/"&gt;https://annotationhub.bioconductor.org/&lt;/a&gt;. By visiting the page we can find several relevant endpoints:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/metadata/annotationhub.sqlite3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/fetch/:id # id =&amp;gt; rdatapaths.id&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So as long as we get the &lt;code&gt;rdatapaths.id&lt;/code&gt; of the EnsDb using the metadata, we can download it via the &lt;code&gt;/fetch/:id&lt;/code&gt; endpoint.&lt;/p&gt;
&lt;p&gt;After downloading the metadata database &lt;code&gt;https://annotationhub.bioconductor.org/metadata/annotationhub.sqlite3&lt;/code&gt;, we can inspect it in SQLite3 by connecting it directly:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sqlite3 annotationhub.sqlite3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Some useful commands to inspect a foreign database (or the ultimate help command &lt;code&gt;.help&lt;/code&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;column&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;biocversions       rdatapaths         schema_info        test&lt;/span&gt;
&lt;span class="go"&gt;input_sources      recipes            statuses           timestamp&lt;/span&gt;
&lt;span class="go"&gt;location_prefixes  resources          tags&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;schema&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rdatapaths&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;CREATE TABLE `rdatapaths`(`id` integer DEFAULT (NULL) NOT NULL PRIMARY KEY , `rdatapath` varchar(255) DEFAULT (NULL) NULL, `rdataclass` varchar(255) DEFAULT (NULL) NULL, `resource_id` integer DEFAULT (NULL) NULL, `dispatchclass` varchar(255) DEFAULT (NULL) NULL, CONSTRAINT `rdatapaths_ibfk_1` FOREIGN KEY (`resource_id`) REFERENCES `resources`(`id`));&lt;/span&gt;
&lt;span class="go"&gt;CREATE INDEX `rdatapaths_resource_id` ON `rdatapaths` (`resource_id`);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So let&amp;rsquo;s make a SQL query to find all Human&amp;rsquo;s EnsDb:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ah_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rdp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rdatapaths_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rdp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rdatapath&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;resources&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rdatapaths&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rdp&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rdp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resource_id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIKE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;%EnsDb for Homo Sapiens%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;-- ah_id       rdatapaths_id  rdatapath                               title&lt;/span&gt;
&lt;span class="c1"&gt;-- ----------  -------------  --------------------------------------  -- ---------------------------------&lt;/span&gt;
&lt;span class="c1"&gt;-- AH53211     59949          AHEnsDbs/v87/EnsDb.Hsapiens.v87.sqlite  Ensembl 87 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;span class="c1"&gt;-- AH53715     60453          AHEnsDbs/v88/EnsDb.Hsapiens.v88.sqlite  Ensembl 88 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;span class="c1"&gt;-- AH56681     63419          AHEnsDbs/v89/EnsDb.Hsapiens.v89.sqlite  Ensembl 89 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;span class="c1"&gt;-- AH57757     64495          AHEnsDbs/v90/EnsDb.Hsapiens.v90.sqlite  Ensembl 90 EnsDb for Homo Sapiens&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;All the Ensembl releases 87+ are available! I will use the release 90 for example. we can download it by its rdatapaths id:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;wget -O EnsDb.Hsapiens.v90.sqlite https://annotationhub.bioconductor.org/fetch/64495
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;For older Ensembl release, one may need to &lt;a href="https://bioconductor.org/packages/release/bioc/vignettes/ensembldb/inst/doc/ensembldb.html#102_building_annotation_packages"&gt;build the SQLite database based by the instructions from ensembldb&lt;/a&gt;.  For the last GRCh37 release, Ensembl release 75, one can download the source of the Bioconductor annotation package &lt;a href="https://bioconductor.org/packages/release/data/annotation/html/EnsDb.Hsapiens.v75.html"&gt;&lt;code&gt;EnsDb.Hsapiens.v75&lt;/code&gt;&lt;/a&gt; and extract it. The database will be under &lt;code&gt;inst/extdata&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="manual-query-in-ensdb"&gt;Manual query in EnsDB&lt;/h2&gt;
&lt;p&gt;EnsDb SQLite database are Ensembl annotation databases created by the R package &lt;a href="https://bioconductor.org/packages/release/bioc/html/ensembldb.html"&gt;ensembldb&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here I will show how to find a transcript&amp;rsquo;s gene name, its genomic location, and all its exon locations given its Ensembl transcript ID.&lt;/p&gt;
&lt;p&gt;First connect the database by &lt;code&gt;sqlite3 EnsDb.Hsapiens.v90.sqlite&lt;/code&gt;. Its table design is very straightforward:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;chromosome      exon            metadata        protein_domain  tx2exon&lt;/span&gt;
&lt;span class="go"&gt;entrezgene      gene            protein         tx              uniprot&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So it didn&amp;rsquo;t take me long to figure out how to join the transcript and gene information:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tx_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seq_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seq_strand&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gene&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ENST00000358731&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;-- tx_id            gene_id          gene_name   seq_name    seq_strand&lt;/span&gt;
&lt;span class="c1"&gt;-- ---------------  ---------------  ----------  ----------  ----------&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000358731  ENSG00000145734  BDP1        5           1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And for the genomic ranges of its exon:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exon_idx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exon_seq_start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exon_seq_end&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx2exon&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;JOIN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exon&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx2exon&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exon_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exon&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exon_id&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tx_id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ENST00000380139&amp;#39;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exon_idx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;-- tx_id            exon_idx    exon_seq_start  exon_seq_end&lt;/span&gt;
&lt;span class="c1"&gt;-- ---------------  ----------  --------------  ------------&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  1           32427904        32428133&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  2           32407645        32407772&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  3           32407250        32407338&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  4           32404203        32404271&lt;/span&gt;
&lt;span class="c1"&gt;-- ENST00000380139  5           32400723        32403200&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;All the coordinates are 1-based and the ranges are inclusive.&lt;/p&gt;
&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;By downloading the underlying annotation database, one can do the same annotation query out of R language and sometimes it may be helpful. I feel like instead of trying to come up with my own layout of annotation mapping across multiple sources, it is more reliable to use a more official build. On the other hand, it is very hard to get the annotation mapping correct and there are tons of corner cases that require careful and systematic decisions. So I don&amp;rsquo;t really recommend to build my own mapping at the first place anyway. The method here should help the situation of annotation query out of R a bit.&lt;/p&gt;
&lt;p&gt;Potentially one can try copy the full R infrastructure but using the same underlying database and replicate the same experience to other languages, but it might require substantial work to get the infrastructure done and correct.&lt;/p&gt;
&lt;p&gt;EDIT 2017-12-13: Add instructions of using older Ensembl release.&lt;br&gt;
EDIT 2019-01-29: Add the web interface of AnnotationHub.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:r-text-processing"&gt;
&lt;p&gt;Based on my impression, my R expert friends would probably recommend me to write it with R-cpp, which I think would be over-kill for such a small task. But my impression can be wrong. Feel free to share your thoughts!&amp;#160;&lt;a class="footnote-backref" href="#fnref:r-text-processing" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="python"></category><category term="r"></category><category term="bioconductor"></category><category term="ensembldb"></category></entry><entry><title>Use Snakemake on Google cloud</title><link href="https://blog.liang2.tw/posts/2017/08/snakemake-google-cloud/" rel="alternate"></link><published>2017-08-10T00:00:00-05:00</published><updated>2022-05-13T12:53:38-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2017-08-10:/posts/2017/08/snakemake-google-cloud/</id><summary type="html">&lt;p&gt;&lt;em&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Run a RNA-seq pipeline using Snakemake locally and later port it to Google Cloud. Snakemake can parallelize jobs of a pipeline and even across machines.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://snakemake.readthedocs.io/"&gt;Snakemake&lt;/a&gt; has been my favorite workflow management system for a while. I came across it while writing &lt;a href="https://www.dropbox.com/s/u7aa2mbsto77wwy/thesis_upload.pdf?dl=0"&gt;my master thesis&lt;/a&gt; and from the â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Run a RNA-seq pipeline using Snakemake locally and later port it to Google Cloud. Snakemake can parallelize jobs of a pipeline and even across machines.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://snakemake.readthedocs.io/"&gt;Snakemake&lt;/a&gt; has been my favorite workflow management system for a while. I came across it while writing &lt;a href="https://www.dropbox.com/s/u7aa2mbsto77wwy/thesis_upload.pdf?dl=0"&gt;my master thesis&lt;/a&gt; and from the first look, it already appeared to be extremely flexible and powerful. I got some time to play with it during my lab rotation and now after joining the lab, I am using it in my many research projects.  With more and more projects in lab relying on virtualization like &lt;a href="https://www.docker.com/"&gt;Docker&lt;/a&gt;, package management like &lt;a href="https://bioconda.github.io/"&gt;bioconda&lt;/a&gt;, and cloud computing like &lt;a href="https://cloud.google.com/"&gt;Google Cloud&lt;/a&gt;, I would like to continue using Snakemake in those scenarios as well. Hence this post to write down all the details.&lt;/p&gt;
&lt;p&gt;The post will introduce the Snakemake by writing the pipeline locally, then gradually move towards to Docker and more Google Cloud products, e.g., Google Cloud Storage, Google Compute Engine (GCE), and Google Container Engine (GKE). &lt;a href="https://snakemake.readthedocs.io/en/stable/tutorial/tutorial.html"&gt;Snakemake tutorial&lt;/a&gt; is a good place to start with to understand how Snakemake works.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#rna-seq-dataset-and-pipeline-for-demonstration"&gt;RNA-seq dataset and pipeline for demonstration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#installation-of-snakemake-and-all-related-tools"&gt;Installation of snakemake and all related tools&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#snakemake-local-pipeline-execution"&gt;Snakemake local pipeline execution&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#genome-reference-index-build-how-to-write-snakemake-rules"&gt;Genome reference index build (How to write snakemake rules)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#run-snakemake"&gt;Run Snakemake&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sample-alignment-how-to-write-a-general-rule"&gt;Sample alignment (How to write a general rule)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#transcript-assement"&gt;Transcript assement&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#job-dependencies-and-dag"&gt;Job dependencies and DAG&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#snakemake-on-google-cloud"&gt;Snakemake on Google Cloud&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#move-input-files-to-the-cloud-from-google-cloud-storage"&gt;Move input files to the cloud (from Google Cloud Storage)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#store-output-files-on-the-cloud"&gt;Store output files on the cloud&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#dockerize-the-environment"&gt;Dockerize the environment&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#use-google-cloud-storage-in-docker-image"&gt;Use Google Cloud Storage in Docker image&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#google-container-engine-gke"&gt;Google Container Engine (GKE)&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#potential-issues-of-using-gke-with-snakemake"&gt;Potential issues of using GKE with Snakemake&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="rna-seq-dataset-and-pipeline-for-demonstration"&gt;RNA-seq dataset and pipeline for demonstration&lt;/h2&gt;
&lt;p&gt;In this example, I will use &lt;code&gt;~/snakemake_example&lt;/code&gt; to store all the files and output. Make sure you change all the paths to be relative to the actual folder in your machine.&lt;/p&gt;
&lt;p&gt;The demo pipeline will be a RNA-seq pipeline for transcript-level expression analysis, often called the &lt;a href="https://www.nature.com/nprot/journal/v11/n9/full/nprot.2016.095.html"&gt;&lt;em&gt;new Tuxedo&lt;/em&gt;&lt;/a&gt; pipeline involving &lt;a href="https://ccb.jhu.edu/software/hisat2/"&gt;HISAT2&lt;/a&gt; and &lt;a href="https://ccb.jhu.edu/software/stringtie/"&gt;StringTie&lt;/a&gt;. The RNA-seq dataset is from &lt;a href="https://github.com/griffithlab/rnaseq_tutorial/"&gt;Griffith Lab&amp;rsquo;s RNA-seq tutorial&lt;/a&gt; which,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;hellip; consists of two commercially available RNA samples: Universal Human Reference (UHR) and Human Brain Reference (HBR). The UHR is total RNA isolated from a diverse set of 10 cancer cell lines. The HBR is total RNA isolated from the brains of 23 Caucasians, male and female, of varying age but mostly 60-80 years old.&lt;/p&gt;
&lt;p&gt;(From the wiki page &lt;a href="[griffith-lab-data]"&gt;&amp;ldquo;RNA-seq Data&amp;rdquo;&lt;/a&gt; of the tutorial)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Our RNA-seq raw data are the 10% downsampled FASTQ files for these samples. For the human genome reference, only the chromosome 22 from GRCh38 is used. The gene annotation is from &lt;a href="http://dec2016.archive.ensembl.org/Homo_sapiens/Info/Index"&gt;Ensembl Version 87&lt;/a&gt;.  Let&amp;rsquo;s download all the samples and annotations.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~/snakemake_example
&lt;span class="gp"&gt;$ &lt;/span&gt;wget https://storage.googleapis.com/lbwang-playground/snakemake_rnaseq/griffithlab_brain_vs_uhr.tar.gz
&lt;span class="gp"&gt;$ &lt;/span&gt;tar xf griffithlab_brain_vs_uhr.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now you should have the following file structure:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;~/snakemake_example
â”œâ”€â”€ griffithlab_brain_vs_uhr/
â”‚Â Â  â”œâ”€â”€ GRCh38_Ens87_chr22_ERCC/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ chr22_ERCC92.fa
â”‚Â Â  â”‚Â Â  â””â”€â”€ genes_chr22_ERCC92.gtf
â”‚Â Â  â””â”€â”€ HBR_UHR_ERCC_ds_10pc/
â”‚Â Â      â”œâ”€â”€ HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1.fastq.gz
â”‚Â Â      â”œâ”€â”€ HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2.fastq.gz
â”‚Â Â      â”œâ”€â”€ ...
â”‚Â Â      â”œâ”€â”€ UHR_Rep3_ERCC-Mix1_Build37-ErccTranscripts-chr22.read1.fastq.gz
â”‚Â Â      â””â”€â”€ UHR_Rep3_ERCC-Mix1_Build37-ErccTranscripts-chr22.read2.fastq.gz
â””â”€â”€ griffithlab_brain_vs_uhr.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="installation-of-snakemake-and-all-related-tools"&gt;Installation of snakemake and all related tools&lt;/h2&gt;
&lt;p&gt;After installing &lt;a href="https://conda.io/miniconda.html"&gt;conda&lt;/a&gt; and setting up &lt;a href="https://bioconda.github.io/"&gt;bioconda&lt;/a&gt;, the installation is simple. All the dependencies are kept in a conda environment called &lt;code&gt;new_tuxedo&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;conda create -n new_tuxedo &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="nv"&gt;python&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.6 snakemake hisat2 stringtie samtools
&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;source&lt;/span&gt; activate new_tuxedo        &lt;span class="c1"&gt;# Use the conda env&lt;/span&gt;
&lt;span class="gp gp-VirtualEnv"&gt;(new_tuxedo)&lt;/span&gt; &lt;span class="gp"&gt;$ &lt;/span&gt;hisat2 --version     &lt;span class="c1"&gt;# Tools are available in the env&lt;/span&gt;
&lt;span class="go"&gt;/Users/liang/miniconda3/envs/new_tuxedo/bin/hisat2-align-s version 2.1.0&lt;/span&gt;
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="gp gp-VirtualEnv"&gt;(new_tuxedo)&lt;/span&gt; &lt;span class="gp"&gt;$ &lt;/span&gt;deactivate           &lt;span class="c1"&gt;# Exit the env&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;hisat2 --version                  &lt;span class="c1"&gt;# Tools are isolated in the env&lt;/span&gt;
&lt;span class="go"&gt;bash: hisat2: command not found&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;All the following steps should be run inside this conda environment unless it&amp;rsquo;s specified otherwise.&lt;/p&gt;
&lt;h2 id="snakemake-local-pipeline-execution"&gt;Snakemake local pipeline execution&lt;/h2&gt;
&lt;p&gt;The RNA-seq pipeline largely consists of the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Build HISAT2 genome reference index for alignment&lt;/li&gt;
&lt;li&gt;Align sample reads to the genome by HISAT2&lt;/li&gt;
&lt;li&gt;Assemble per-sample transcripts by StringTie&lt;/li&gt;
&lt;li&gt;Merge per-sample transcripts by StringTie&lt;/li&gt;
&lt;li&gt;Quantify transcript abundance by StringTie&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To get the taste of how to write a Snakemake pipeline, I will implement it gradually by breaking it into three major parts: genome reference index build, alignment, and transcript assessment.&lt;/p&gt;
&lt;h3 id="genome-reference-index-build-how-to-write-snakemake-rules"&gt;Genome reference index build (How to write snakemake rules)&lt;/h3&gt;
&lt;p&gt;To build the genome reference, we need to extract the splice sites and exons by two of the HISAT2 scripts, &lt;code&gt;hisat2_extract_splice_sites.py&lt;/code&gt; and &lt;code&gt;hisat2_extract_exons.py&lt;/code&gt;. Then we call &lt;code&gt;hisat2-build&lt;/code&gt; to build the index. Create a new file at &lt;code&gt;~/snakemake_example/Snakefile&lt;/code&gt; with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;GENOME_FA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/chr22_ERCC92.fa&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;extract_genome_splice_sites&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.ss&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_extract_splice_sites.py &lt;/span&gt;&lt;span class="si"&gt;{input}&lt;/span&gt;&lt;span class="s2"&gt; &amp;gt; &lt;/span&gt;&lt;span class="si"&gt;{output}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;extract_genome_exons&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.exon&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_extract_exons.py &lt;/span&gt;&lt;span class="si"&gt;{input}&lt;/span&gt;&lt;span class="s2"&gt; &amp;gt; &lt;/span&gt;&lt;span class="si"&gt;{output}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;build_hisat_index&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;genome_fa&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GENOME_FA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;splice_sites&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.ss&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;exons&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.exon&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="se"&gt;{{&lt;/span&gt;&lt;span class="s2"&gt;ix&lt;/span&gt;&lt;span class="se"&gt;}}&lt;/span&gt;&lt;span class="s2"&gt;.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/build.log&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2-build -p &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{input.genome_fa}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;--ss &lt;/span&gt;&lt;span class="si"&gt;{input.splice_sites}&lt;/span&gt;&lt;span class="s2"&gt; --exon &lt;/span&gt;&lt;span class="si"&gt;{input.exons}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{HISAT2_INDEX_PREFIX}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;2&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{log}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Overall &lt;code&gt;Snakefile&lt;/code&gt; is Python-based, so one can define variables and functions, import Python libraries, and use all the string operations as one does in the Python source code.  Here I defined some constants to the genome reference files (&lt;code&gt;GENOME_FA&lt;/code&gt; and &lt;code&gt;GENOME_GTF&lt;/code&gt;) and the output index prefix (&lt;code&gt;HISAT2_INDEX_PREFIX&lt;/code&gt;) because they will get quite repetitive and specifying them at the front can make future modifications easier.&lt;/p&gt;
&lt;p&gt;In case one hasn&amp;rsquo;t read the &lt;a href="https://snakemake.readthedocs.io/en/stable/tutorial/tutorial.html"&gt;Snakemake Tutorial&lt;/a&gt;, here is an overview of the Snakemake pipeline execution.  A Snakemake rule is similar to a Makefile rule.  In a rule, one can specify the input pattern and the output pattern of a rule, as well as the command to run for this rule.  When snakemake runs, all the output user wants to generate will be translated into a sets of rules to be run.  Based on the desired output, Snakemake will find the rule that can generate them (matching the rule&amp;rsquo;s output pattern) and the required input.  The finding process can be traversed rules after rules, that is, some input of a rule depends on the output of another rule, until all the inputs are available.  Then Snakemake will start to generate the output by running the commands each rule gives.&lt;/p&gt;
&lt;p&gt;Now we can look at the three rules in our current &lt;code&gt;Snakefile&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The first rule &lt;code&gt;extract_genome_splice_sites&lt;/code&gt; extracts the genome splice sites. The input file is &lt;code&gt;GENOME_GTF&lt;/code&gt; which is the Ensembl gene annotation. The output is a file at &lt;code&gt;hisat2_index/chr22_ERCC92.ss&lt;/code&gt;. The command to generate the output from the given input is a shell command. The command contains some variables, &lt;code&gt;{input}&lt;/code&gt; and &lt;code&gt;{output}&lt;/code&gt;, where Snakemake will fill in them with the sepcified intput and output. So when the first rule is activated, Snakemake will let Bash shell to run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hisat2_extract_splice_sites.py &lt;span class="se"&gt;\&lt;/span&gt;
    griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf &lt;span class="se"&gt;\&lt;/span&gt;
    &amp;gt; hisat2_index/chr22_ERCC92.ss
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The second rule &lt;code&gt;extract_genome_exons&lt;/code&gt; is quite similar to the first one, but extracts the genome exons and stores it in &lt;code&gt;hisat2_index/chr22_ERCC92.exon&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The third rule &lt;code&gt;build_hisat_index&lt;/code&gt; builds the actual index. Input can be multiple files, in this case there are three entries, including the chromosome sequence, splice sites and exons. One can later refer only to input of the same entry by their entry name. For example, &lt;code&gt;{input.genome_fa}&lt;/code&gt; means the chromosome sequence FASTA file.&lt;/p&gt;
&lt;p&gt;The output of the third rule is &lt;code&gt;expand(f"{HISAT2_INDEX_PREFIX}.{{ix}}.ht2", ix=range(1, 9))&lt;/code&gt;, where &lt;code&gt;expand(...)&lt;/code&gt; is a Snakemake function which can interpolate a string pattern into an array of strings. In this case the generate index files are &lt;code&gt;&amp;lt;index_prefix&amp;gt;.1.ht2&lt;/code&gt;, &amp;hellip; ,&lt;code&gt;&amp;lt;index_prefix&amp;gt;.8.ht2&lt;/code&gt;. Instead of specifies the output eight times, we use &lt;code&gt;expand&lt;/code&gt; and pass a variable &lt;code&gt;ix&lt;/code&gt; to iterate from 1 to 8. The double curly brackets are to escape the &lt;code&gt;f"..."&lt;/code&gt; f-string interpolation (see &lt;a href="https://docs.python.org/3/whatsnew/3.6.html#whatsnew36-pep498"&gt;the Python documentation&lt;/a&gt;). So the whole process to interpret the output is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="se"&gt;{{&lt;/span&gt;&lt;span class="s2"&gt;ix&lt;/span&gt;&lt;span class="se"&gt;}}&lt;/span&gt;&lt;span class="s2"&gt;.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.&lt;/span&gt;&lt;span class="si"&gt;{ix}&lt;/span&gt;&lt;span class="s2"&gt;.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.1.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.2.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92.8.ht2&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;For the rest of the entries such as &lt;code&gt;threads&lt;/code&gt;, and &lt;code&gt;log&lt;/code&gt;, one can find more information at &lt;a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html"&gt;the Snakemake documentation about Rules&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id="run-snakemake"&gt;Run Snakemake&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s build the genome reference index.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;snakemake -j &lt;span class="m"&gt;8&lt;/span&gt; -p build_hisat_index
&lt;span class="go"&gt;Provided cores: 8&lt;/span&gt;
&lt;span class="go"&gt;Rules claiming more threads will be scaled down.&lt;/span&gt;
&lt;span class="go"&gt;Job counts:&lt;/span&gt;
&lt;span class="go"&gt;    count   jobs&lt;/span&gt;
&lt;span class="go"&gt;    1   build_hisat_index&lt;/span&gt;
&lt;span class="go"&gt;    1   extract_genome_exons&lt;/span&gt;
&lt;span class="go"&gt;    1   extract_genome_splice_sites&lt;/span&gt;
&lt;span class="go"&gt;    3&lt;/span&gt;

&lt;span class="go"&gt;rule extract_genome_exons:&lt;/span&gt;
&lt;span class="go"&gt;    input: griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf&lt;/span&gt;
&lt;span class="go"&gt;    output: hisat2_index/chr22_ERCC92.exon&lt;/span&gt;
&lt;span class="go"&gt;    jobid: 1&lt;/span&gt;

&lt;span class="go"&gt;hisat2_extract_exons.py griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf &amp;gt; hisat2_index/chr22_ERCC92.exon&lt;/span&gt;
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;3 of 3 steps (100%) done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The command &lt;code&gt;snakemake -j 8 -p build_hisat_index&lt;/code&gt; means:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-j 8&lt;/code&gt;: Use 8 cores&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-p&lt;/code&gt;: Print the actual command of each job&lt;/li&gt;
&lt;li&gt;&lt;code&gt;build_hisat_index&lt;/code&gt;: The rule or certain output to be generated&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If one runs it again, one will find that snakemake won&amp;rsquo;t do anything since all the output are present and updated.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;snakemake -j &lt;span class="m"&gt;8&lt;/span&gt; -p build_hisat_index
&lt;span class="go"&gt;Nothing to be done.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="sample-alignment-how-to-write-a-general-rule"&gt;Sample alignment (How to write a general rule)&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s write the rule to do the sample alignment. Append the &lt;code&gt;Snakefile&lt;/code&gt; with the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;glob_wildcards&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s1"&gt;.read1.fastq.gz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_hisat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;hisat2_index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="se"&gt;{{&lt;/span&gt;&lt;span class="s2"&gt;ix&lt;/span&gt;&lt;span class="se"&gt;}}&lt;/span&gt;&lt;span class="s2"&gt;.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="n"&gt;fastq1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.read1.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;fastq2&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.read2.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;align_hisat2/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.bam&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;align_hisat2/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.log&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2 -p &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; --dta -x &lt;/span&gt;&lt;span class="si"&gt;{HISAT2_INDEX_PREFIX}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-1 &lt;/span&gt;&lt;span class="si"&gt;{input.fastq1}&lt;/span&gt;&lt;span class="s2"&gt; -2 &lt;/span&gt;&lt;span class="si"&gt;{input.fastq2}&lt;/span&gt;&lt;span class="s2"&gt; 2&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{log}&lt;/span&gt;&lt;span class="s2"&gt; | &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;samtools sort -@ &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; -o &lt;/span&gt;&lt;span class="si"&gt;{output}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_all_samples&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;align_hisat2/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.bam&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There are two rules here but only &lt;code&gt;align_hisat&lt;/code&gt; does the real work. The rule looks familar but there are something new. There is a unresolved variable &lt;code&gt;{sample}&lt;/code&gt; in input, output and log entries, such as &lt;code&gt;fastq1=".../{sample}.read1.fastq.gz"&lt;/code&gt;. So this rule will apply to all outputs that match the pattern &lt;code&gt;align_hisat2/{sample}.bam&lt;/code&gt;. For example, given an output &lt;code&gt;align_hisat2/mysample.bam&lt;/code&gt;, Snakemake will look for the inputs &lt;code&gt;griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/mysample.read1.fastq.gz&lt;/code&gt;, where &lt;code&gt;sample = "mysample"&lt;/code&gt; in this case.&lt;/p&gt;
&lt;p&gt;To get the names of all the samples, we use &lt;code&gt;glob_wildcards(...)&lt;/code&gt; which finds all the files that match the given string pattern, and collects the possible values of the variables in the string pattern as a list. Hence all the sample names are stored in &lt;code&gt;SAMPLES&lt;/code&gt;, and the other rule takes input of all samples&amp;rsquo; BAM files to generate alignment of all samples.&lt;/p&gt;
&lt;p&gt;Now run Snakemake again with a different rule target:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;snakemake -j 8 -p align_all_samples
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This time pay attention to the CPU usage (say, using &lt;a href="http://hisham.hm/htop/"&gt;&lt;code&gt;htop&lt;/code&gt;&lt;/a&gt;), one should find out that snakemake runs jobs in parallel, and tries to use as many cores as possible.&lt;/p&gt;
&lt;h3 id="transcript-assement"&gt;Transcript assement&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s complete the whole pipeline by adding all StringTie steps to &lt;code&gt;Snakefile&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_assemble&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;genome_gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;bam&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;align_hisat2/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.bam&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;stringtie/assembled/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.gtf&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;stringtie -p &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; -G &lt;/span&gt;&lt;span class="si"&gt;{input.genome_gtf}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-o &lt;/span&gt;&lt;span class="si"&gt;{output}&lt;/span&gt;&lt;span class="s2"&gt; -l &lt;/span&gt;&lt;span class="si"&gt;{wildcards.sample}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{input.bam}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_merge_list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/assembled/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;stringtie/merged_list.txt&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;gtf&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gtf&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resolve&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_merge&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;genome_gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;merged_list&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/merged_list.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;sample_gtfs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/assembled/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;stringtie/merged.gtf&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;stringtie --merge -p &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; -G &lt;/span&gt;&lt;span class="si"&gt;{input.genome_gtf}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-o &lt;/span&gt;&lt;span class="si"&gt;{output}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{input.merged_list}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;stringtie_quant&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;merged_gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/merged.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;sample_bam&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;align_hisat2/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.bam&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/quant/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;ctabs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;stringtie/quant/{{sample}}/&lt;/span&gt;&lt;span class="si"&gt;{name}&lt;/span&gt;&lt;span class="s2"&gt;.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;i2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;i_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;t_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;threads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;stringtie -e -B -p &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; -G &lt;/span&gt;&lt;span class="si"&gt;{input.merged_gtf}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-o &lt;/span&gt;&lt;span class="si"&gt;{output.gtf}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{input.sample_bam}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;quant_all_samples&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/quant/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Most rules are similar to the previous ones except for &lt;code&gt;stringtie_merge_list&lt;/code&gt;. This step a file is generated to contain list of paths to all the samples&amp;rsquo; GTF file. Instead of running some command (no &lt;code&gt;shell&lt;/code&gt; entry), a &lt;code&gt;run&lt;/code&gt; entry is used to write a Python code snippet to generate the file.&lt;/p&gt;
&lt;p&gt;Another thing to be noted is the output entry &lt;code&gt;ctabs=...&lt;/code&gt; of &lt;code&gt;stringtie_quant&lt;/code&gt;. The following lines are equivalent:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Before expansion&lt;/span&gt;
&lt;span class="n"&gt;ctabs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stringtie/quant/{{sample}}/&lt;/span&gt;&lt;span class="si"&gt;{name}&lt;/span&gt;&lt;span class="s2"&gt;.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;i2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e2t&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;i_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;e_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;t_data&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# After expansion&lt;/span&gt;
&lt;span class="n"&gt;ctabs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stringtie/quant/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;/i2t.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stringtie/quant/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;/e2t.ctab&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stringtie/quant/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;/t_data.ctab&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The full &lt;code&gt;Snakefile&lt;/code&gt; can be found &lt;a href="https://gist.github.com/ccwang002/2659b19439b6205284c0ae68ca06345d"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id="job-dependencies-and-dag"&gt;Job dependencies and DAG&lt;/h3&gt;
&lt;p&gt;Now with the pipeline complete, we can further look at the how all the rules are chained with each other. Snakemake has a command to generate the job depedency graph (a DAG):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;snakemake --dag quant_all_samples | dot -Tsvg &amp;gt; dag.svg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure class="full-img"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2017/08/snakemake-google-cloud/pics/snakemake_rnaseq_dag.svg"/&gt;
  &lt;figcaption&gt;Snakemake job dependency graph.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Snakemake generates such DAG first before execution, where each node represents a job. As long as two nodes have no connected edges and their input exist, they can be executed parallely. This is a powerful feature to pipeline management, which can use the resources in a fin grain.&lt;/p&gt;
&lt;p&gt;A simpler graph that shows rules instead of jobs can be generated by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;snakemake --rulegraph quant_all_samples | dot -Tsvg &amp;gt; ruledag.svg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2017/08/snakemake-google-cloud/pics/snakemake_rnaseq_ruledag.svg"/&gt;
  &lt;figcaption&gt;Snakemake rule dependency graph.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id="snakemake-on-google-cloud"&gt;Snakemake on Google Cloud&lt;/h2&gt;
&lt;p&gt;Now we start to move our Snakemake pipeline to the Google Cloud. To complete all the following steps, one needs a Google account and has a bucket on the Google Cloud with write access. That is, be able to upload the output back to Google Cloud Storage. Snakemake is able to download/upload files from the cloud, one needs to &lt;a href="https://cloud.google.com/sdk/downloads"&gt;set up the Google Cloud SDK on the local machine&lt;/a&gt; and create the default application credentials:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gcloud auth application-default login
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Also, install the neccessary Python packages to give Snakemake the access to storage API:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;conda install google-cloud-storage
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Actually snakemake support remote files from many more providers. More detail can be found at &lt;a href="https://snakemake.readthedocs.io/en/stable/snakefiles/remote_files.html"&gt;the Snakemake documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Note that although one can run this section on a local machine, this step will be significantly faster if one runs it on a Google Computer Engine (GCE) instance. It also saves extra bandwidth and fees.&lt;/p&gt;
&lt;h3 id="move-input-files-to-the-cloud-from-google-cloud-storage"&gt;Move input files to the cloud (from Google Cloud Storage)&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s modify the &lt;code&gt;Snakefile&lt;/code&gt; to use the reference and FASTQ files from Google Cloud Storage. Replace those file paths with the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;snakemake.remote.GS&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;RemoteProvider&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;GSRemoteProvider&lt;/span&gt;
&lt;span class="n"&gt;GS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;GSRemoteProvider&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lbwang-playground/snakemake_rnaseq&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;GENOME_FA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/chr22_ERCC92.fa&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;GENOME_GTF&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/genes_chr22_ERCC92.gtf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;SAMPLES&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;glob_wildcards&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s1"&gt;.read1.fastq.gz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# rule extract_genome_splice_sites:&lt;/span&gt;
&lt;span class="c1"&gt;# ...&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_hisat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;hisat2_index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="se"&gt;{{&lt;/span&gt;&lt;span class="s2"&gt;ix&lt;/span&gt;&lt;span class="se"&gt;}}&lt;/span&gt;&lt;span class="s2"&gt;.ht2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ix&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="n"&gt;fastq1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.read1.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;fastq2&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GS_PREFIX&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/griffithlab_brain_vs_uhr/HBR_UHR_ERCC_ds_10pc/&lt;/span&gt;&lt;span class="si"&gt;{sample}&lt;/span&gt;&lt;span class="s2"&gt;.read2.fastq.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now all the file paths are on Google Cloud Storage under the bucket &lt;code&gt;lbwang-playground&lt;/code&gt;. For example, &lt;code&gt;GENOME_FA&lt;/code&gt; points to &lt;code&gt;gs://lbwang-playground/snakemake_rnaseq/griffithlab_brain_vs_uhr/GRCh38_Ens87_chr22_ERCC/chr22_ERCC92.fa&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;One could launch Snakemake again:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;snakemake --timestamp -p --verbose --keep-remote -j 8 quant_all_samples
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="store-output-files-on-the-cloud"&gt;Store output files on the cloud&lt;/h3&gt;
&lt;p&gt;Although we could replace all the file paths to &lt;code&gt;GS.remote(...)&lt;/code&gt;, there is a simpler way to replace every path through the command line option. On top of that, we need to add a &lt;code&gt;FULL_HISAT2_INDEX_PREFIX&lt;/code&gt; variable to reflect the path change that prepends the path under the writable bucket. Replace all &lt;code&gt;{WRITABLE_BUCKET_PATH}&lt;/code&gt; with a writable Google Cloud Storage bucket.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;FULL_HISAT2_INDEX_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{WRITABLE_BUCKET_PATH}&lt;/span&gt;&lt;span class="s2"&gt;/hisat2_index/chr22_ERCC92&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;build_hisat_index&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2-build -p &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{input.genome_fa}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;--ss &lt;/span&gt;&lt;span class="si"&gt;{input.splice_sites}&lt;/span&gt;&lt;span class="s2"&gt; --exon &lt;/span&gt;&lt;span class="si"&gt;{input.exons}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{FULL_HISAT2_INDEX_PREFIX}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;2&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{log}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="n"&gt;align_hisat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;hisat2 -p &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; --dta -x &lt;/span&gt;&lt;span class="si"&gt;{FULL_HISAT2_INDEX_PREFIX}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;-1 &lt;/span&gt;&lt;span class="si"&gt;{input.fastq1}&lt;/span&gt;&lt;span class="s2"&gt; -2 &lt;/span&gt;&lt;span class="si"&gt;{input.fastq2}&lt;/span&gt;&lt;span class="s2"&gt; 2&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{log}&lt;/span&gt;&lt;span class="s2"&gt; | &amp;quot;&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;samtools sort -@ &lt;/span&gt;&lt;span class="si"&gt;{threads}&lt;/span&gt;&lt;span class="s2"&gt; -o &lt;/span&gt;&lt;span class="si"&gt;{output}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The full &lt;code&gt;Snakefile&lt;/code&gt; can be found &lt;a href="https://gist.github.com/ccwang002/2686840e90574a67a673ec4b48e9f036"&gt;here&lt;/a&gt;. Now run the Snakemake with the following options:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;snakemake --timestamp -p --verbose --keep-remote -j &lt;span class="m"&gt;8&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-provider GS &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-prefix &lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt; &amp;gt; &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To understand how the whole remote files work, here is the the folder structure after the exection:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;~/snakemake_example
â”œâ”€â”€ lbwang-playground/
â”‚Â Â  â””â”€â”€ snakemake_rnaseq/
â”‚Â Â      â””â”€â”€ griffithlab_brain_vs_uhr/
â”‚Â Â          â”œâ”€â”€ GRCh38_Ens87_chr22_ERCC/
â”‚Â Â          â””â”€â”€ HBR_UHR_ERCC_ds_10pc/
â”œâ”€â”€ {WRITABLE_BUCKET_PATH}/
â”‚Â Â  â”œâ”€â”€ align_hisat2/
â”‚Â Â  â”œâ”€â”€ hisat2_index/
â”‚Â Â  â””â”€â”€ stringtie/
â””â”€â”€ Snakefile
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So Snakemake simply downloads/generates the files with the full path on remote storage.&lt;/p&gt;
&lt;h2 id="dockerize-the-environment"&gt;Dockerize the environment&lt;/h2&gt;
&lt;p&gt;Although bioconda has made the package installation very easy, it would be easier to just isolate the whole environment at the operating system level. One common approach is to use &lt;a href="https://www.docker.com/"&gt;Docker&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A minimal working Dockerfile would be:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;continuumio/miniconda3&lt;/span&gt;
&lt;span class="k"&gt;RUN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;conda install -y &lt;span class="nv"&gt;python&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.6 nomkl &lt;span class="se"&gt;\&lt;/span&gt;
        stringtie samtools hisat2 snakemake google-cloud-storage &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; conda clean -y --all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;However there are some details required extra care at the time of writing, so I&amp;rsquo;ve created a Docker image for this pipeline on Docker Hub, &lt;a href="https://hub.docker.com/r/lbwang/snakemake-conda-rnaseq/"&gt;&lt;code&gt;lbwang/snakemake-conda-rnaseq&lt;/code&gt;&lt;/a&gt;. One could be able to run the snakemake by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~/snakemake_example
docker run -t                       &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;:/analysis             &lt;span class="se"&gt;\&lt;/span&gt;
    lbwang/snakemake-conda-rnaseq   &lt;span class="se"&gt;\&lt;/span&gt;
    snakemake -j &lt;span class="m"&gt;2&lt;/span&gt; --timestamp      &lt;span class="se"&gt;\&lt;/span&gt;
        -s /analysis/Snakefile --directory /analysis &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="use-google-cloud-storage-in-docker-image"&gt;Use Google Cloud Storage in Docker image&lt;/h3&gt;
&lt;p&gt;To use Google&amp;rsquo;s Cloud products in a Docker image, one needs to install &lt;a href="https://cloud.google.com/sdk/downloads"&gt;Google Cloud SDK&lt;/a&gt; inside the Docker image. Refer to &lt;a href="https://github.com/GoogleCloudPlatform/cloud-sdk-docker/blob/master/debian_slim/Dockerfile"&gt;Google&amp;rsquo;s Dockerfile with Cloud SDK&lt;/a&gt; for detail. &lt;a href="https://hub.docker.com/r/lbwang/snakemake-conda-rnaseq/"&gt;&lt;code&gt;lbwang/snakemake-conda-rnaseq&lt;/code&gt;&lt;/a&gt; has installed the Cloud SDK.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo docker run -t -i                           &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;:/analysis                         &lt;span class="se"&gt;\&lt;/span&gt;
    -v ~/.config/gcloud:/root/.config/gcloud    &lt;span class="se"&gt;\&lt;/span&gt;
    lbwang/snakemake-conda-rnaseq               &lt;span class="se"&gt;\&lt;/span&gt;
    snakemake -j &lt;span class="m"&gt;4&lt;/span&gt; --timestamp --verbose -p --keep-remote   &lt;span class="se"&gt;\&lt;/span&gt;
        -s /analysis/Snakefile --directory /analysis        &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-provider GS --default-remote-prefix &lt;span class="s2"&gt;&amp;quot;{WRITABLE_BUCKET_PATH}&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To run Docker on a GCE VM instance, it requires the host machine (the VM instance) to have Docker installed. One may refer to Docker&amp;rsquo;s &lt;a href="https://docs.docker.com/engine/installation/linux/docker-ce/debian/#install-using-the-repository"&gt;official installation guide&lt;/a&gt; to install it. VM instance by default inherit the user&amp;rsquo;s permission (via the automatically created service account), thus the command above should apply to the GCE instance as well.&lt;/p&gt;
&lt;h2 id="google-container-engine-gke"&gt;Google Container Engine (GKE)&lt;/h2&gt;
&lt;p&gt;To scale up the pipeline execution across multiple machines, Snakemake could use &lt;a href="https://cloud.google.com/container-engine/"&gt;Google Container Engine&lt;/a&gt; (GKE, implemented on top of Kubernetes). This method is built on Docker which each node will pull down the given Docker image to load the environment. After &lt;a href="https://bitbucket.org/snakemake/snakemake/issues/602"&gt;some discussions&lt;/a&gt; about how to specify user input image &lt;sup id="fnref:kubernetes-docker"&gt;&lt;a class="footnote-ref" href="#fn:kubernetes-docker"&gt;1&lt;/a&gt;&lt;/sup&gt;, on Snakemake 4.1+ one is able to specify the Docker image Kubernete&amp;rsquo;s node uses by &lt;code&gt;--container-image &amp;lt;image&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To install the master branch of Snakemake, run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip install git+https://bitbucket.org/snakemake/snakemake.git@master
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Following Snakemake&amp;rsquo;s &lt;a href="https://snakemake.readthedocs.io/en/stable/executable.html#executing-a-snakemake-workflow-via-kubernetes"&gt;GKE guide&lt;/a&gt;, extra packages need to be installed to talk to GKE (Kubernetes) cluster:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip install kubernetes
gcloud components install kubectl
&lt;span class="c1"&gt;# or Debian on GCE:&lt;/span&gt;
&lt;span class="c1"&gt;# sudo apt-get install kubectl&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;First we create the GKE cluster by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CLUSTER_NAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;snakemake-cluster&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;ZONE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;us-central1-a&amp;quot;&lt;/span&gt;
gcloud container clusters create &lt;span class="nv"&gt;$CLUSTER_NAME&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --zone&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$ZONE&lt;/span&gt; --num-nodes&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --machine-type&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;n1-standard-4&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --scopes storage-rw
gcloud container clusters get-credentials --zone&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$ZONE&lt;/span&gt; &lt;span class="nv"&gt;$CLUSTER_NAME&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This will launch 3 GCE VM instances using &lt;code&gt;n1-standard-4&lt;/code&gt; machine type (4 CPUs). Therefore in the cluster there are total 12 CPUs available for computation. Modify the variables to fit one&amp;rsquo;s setting.&lt;/p&gt;
&lt;p&gt;Note that some rule may specify a number of CPUs that no node in the clusters has, say the rule &lt;code&gt;build_hisat_index&lt;/code&gt; specifies 8 threads. In this case, the cluster cannot find a node with enough free CPUs to forward the job to a &lt;a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/"&gt;pod&lt;/a&gt; and the cluster will halt. Therefore, make sure to lower the &lt;code&gt;threads&lt;/code&gt; to a reasonable number (or use &lt;a href="https://snakemake.readthedocs.io/en/stable/snakefiles/configuration.html"&gt;configfile&lt;/a&gt; to apply to mulitple samples). We will continue to use the same Docker image &lt;a href="https://hub.docker.com/r/lbwang/snakemake-conda-rnaseq/"&gt;&lt;code&gt;lbwang/snakemake-conda-rnaseq&lt;/code&gt;&lt;/a&gt; as the Kubernetes&amp;rsquo; container image.&lt;/p&gt;
&lt;p&gt;By default, Snakemake will always check if the output files are outdated, that is, older than the rule that generated them. To ensure it re-runs the pipeline, one might need to remove the generated output before calling Snakemake again:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gsutil -m rm -r gs://&lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt;/&lt;span class="o"&gt;{&lt;/span&gt;align_hisat2,hisat2_index,stringtie&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we are able to run the pipeline again.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;snakemake                                            &lt;span class="se"&gt;\&lt;/span&gt;
    --timestamp -p --verbose --keep-remote           &lt;span class="se"&gt;\&lt;/span&gt;
    -j &lt;span class="m"&gt;12&lt;/span&gt; --kubernetes                               &lt;span class="se"&gt;\&lt;/span&gt;
    --container-image lbwang/snakemake-conda-rnaseq &lt;span class="se"&gt;\&lt;/span&gt;
    --default-remote-provider GS                     &lt;span class="se"&gt;\&lt;/span&gt;
    --default-remote-prefix &lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt;   &lt;span class="se"&gt;\&lt;/span&gt;
    quant_all_samples
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that since we change the container image, we have to make sure the version of Snakemake in the Docker image and the machine starting the pipeline matches. An easy way to ensure that the versions are matched is to start the workflow inside the same Docker image.&lt;/p&gt;
&lt;p&gt;To connect the Kubernete cluster inside Docker, we need to pass kubectl&amp;rsquo;s config file as well, which is at &lt;code&gt;~/.kube/config&lt;/code&gt;. So the full command becomes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo docker run -t -i                           &lt;span class="se"&gt;\&lt;/span&gt;
    -v &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;:/analysis                         &lt;span class="se"&gt;\&lt;/span&gt;
    -v ~/.config/gcloud:/root/.config/gcloud    &lt;span class="se"&gt;\&lt;/span&gt;
    -v ~/.kube/config:/root/.kube/config        &lt;span class="se"&gt;\&lt;/span&gt;
    lbwang/snakemake-conda-rnaseq               &lt;span class="se"&gt;\&lt;/span&gt;
    snakemake                                           &lt;span class="se"&gt;\&lt;/span&gt;
        -s /analysis/Snakefile --directory /analysis    &lt;span class="se"&gt;\&lt;/span&gt;
        --timestamp -p --verbose --keep-remote          &lt;span class="se"&gt;\&lt;/span&gt;
        -j &lt;span class="m"&gt;12&lt;/span&gt; --kubernetes                              &lt;span class="se"&gt;\&lt;/span&gt;
        --container-image lbwang/snakemake-conda-rnaseq &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-provider GS                    &lt;span class="se"&gt;\&lt;/span&gt;
        --default-remote-prefix &lt;span class="o"&gt;{&lt;/span&gt;WRITABLE_BUCKET_PATH&lt;span class="o"&gt;}&lt;/span&gt;  &lt;span class="se"&gt;\&lt;/span&gt;
        quant_all_samples
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;After running our pipeline, make sure to delete the GKE cluster by:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gcloud container clusters delete --zone&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$ZONE&lt;/span&gt; &lt;span class="nv"&gt;$CLUSTER_NAME&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="potential-issues-of-using-gke-with-snakemake"&gt;Potential issues of using GKE with Snakemake&lt;/h3&gt;
&lt;p&gt;I still encountered the following issues while running the whole pipeline on the Kubernetes. It is likely that they are not Snakemake&amp;rsquo;s fault but I couldn&amp;rsquo;t find enough time to dig into the details at the time of writing:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HISAT2 cannot build its index on Kubenetes. So the step &lt;code&gt;build_hisat_index&lt;/code&gt; failed for unknown reason. The error message from HISAT2 looks like this:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;...
Wrote 8912688 bytes to secondary GFM file: {WRITABLE_BUCKET_PATH}/snakemake_demo/hisat2_index/chr22_ERCC92.6.ht2
Index is corrupt: File size for {WRITABLE_BUCKET_PATH}/snakemake_demo/hisat2_index/chr22_ERCC92.6.ht2 should have been 8912688 but is actually 0.
Please check if there is a problem with the disk or if disk is full.
Total time for call to driver() for forward index: 00:01:18
Error: Encountered internal HISAT2 exception (#1)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;Snakemake is a flexible pipeline management tool that can be run locally and on the cloud. Although it is able to run on Kubernetes such as Google Container Engine, it is a relatively new feature and will take some time to stablize. Currently if one wants to run everything (both the computing and the data) on the cloud, using Google Compute Engine and Google Cloud Storage will be the way to go.&lt;/p&gt;
&lt;p&gt;Using a 4-core (n1-standard-4) GCE instance, the total time to finish the pipeline locally and via Google Cloud Storage were 3.2 mins and 5.8 mins resepctively. So there are some overhead to transfer files from/to the storage.&lt;/p&gt;
&lt;p&gt;Docker and bioconda have made the deployment a lot easier. Bioconda truly saves a lot of duplicated efforts to figure out the tool compilation. Docker provides an OS-level isolation and an ecosystem of deployment. With more tools such as &lt;a href="http://singularity.lbl.gov/"&gt;Singularity&lt;/a&gt; continuing to come out, virtualization seems to be a inevitable trend.&lt;/p&gt;
&lt;p&gt;Other than Google cloud products, Snakemake also supports AWS, S3, LSF, SLURM and many other cluster settings. It seems to me that the day when one &lt;code&gt;Snakefile&lt;/code&gt; works for all platforms might be around the corner.&lt;/p&gt;
&lt;p&gt;EDIT 2017-08-15: Add a section about using Google Cloud in Docker. Update summary with some time measurements. Add links to the full Snakefiles.&lt;br&gt;
EDIT 2017-09-07: Snakemake has added the support of custom Kubernetes container image. Thus update the GKE section to use the official parameter to pass image.&lt;br&gt;
EDIT 2017-11-17: Add instructions to run the Snakemake on Kubernete inside Docker. And also list out the issues of using GKE.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:kubernetes-docker"&gt;
&lt;p&gt;In the discussion, Snakemake&amp;rsquo;s author, Johannes, mentioned the possiblity of using &lt;a href="http://singularity.lbl.gov/"&gt;Singularity&lt;/a&gt; so each rule can run in a different virutal environment. Singularity support comes at Snakemake 4.2+.&amp;#160;&lt;a class="footnote-backref" href="#fnref:kubernetes-docker" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="bio"></category><category term="python"></category><category term="snakemake"></category><category term="cloud"></category></entry><entry><title>Variantsã€eQTLã€MPRA</title><link href="https://blog.liang2.tw/posts/2017/06/variants-eqtl-mpra/" rel="alternate"></link><published>2017-06-20T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2017-06-20:/posts/2017/06/variants-eqtl-mpra/</id><summary type="html">&lt;p&gt;æœ¬æ–‡å…§å®¹ä¸»è¦ä¾†è‡ª Barak Cohen æ•™æŽˆçµ¦çš„æ•¸å ‚èª²çš„ç­†è¨˜ï¼Œä»¥ Systems Biology çš„è§’åº¦ä¾†çœ‹ coding/noncoding variant modeling å’Œç›¸é—œå¯¦é©— MPRAã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;Computational Biology å’Œ Bioinformatics åœ¨ç¾åœ¨å¯èƒ½å€åˆ†ä¸å¤§ï¼Œæœ¬æ–‡ä¹Ÿä¸æ‰“ç®—æ·±ç©¶å…©å®šç¾©ï¼Œä½†ä»–å€‘å¤§è‡´èƒ½ä»£è¡¨å…©å¤§é¡žå°‡é›»è…¦ç§‘å­¸ã€ç¨‹å¼é‹ç”¨åœ¨ç”Ÿç‰©ä¸Šçš„ç ”ç©¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¢©ç­ï¼Œæˆ‘çš„å¯¦é©—å®¤ä¸€ç›´é¼“å‹µæˆ‘å€‘åŽ»æƒ³æ–°çš„æ¼”ç®—æ³•ï¼ŒæŠŠæŸç¨®é æ¸¬åšå¾—æ›´å¥½æˆ–è€…å¿«ï¼Œæˆ–è€…é‹ç”¨æ›´å¤šä¾†æºçš„æ•¸æ“šï¼›åšæ–°çš„å·¥å…·ï¼›æ•´åˆå‡ºæ–°çš„è³‡æ–™åº«ã€‚é€™äº›æ‡‰ç”¨éƒ½æœ‰ä»–å€‘çš„ç ”ç©¶åƒ¹å€¼ï¼Œä¹Ÿéœ€è¦å¤§é‡çš„æŠ€è¡“æŠ•å…¥ï¼Œå³ä¾¿åœ¨ç™¼è¡¨ä¸Šä¸¦ä¸æœƒæ”¾å…¥é€™äº›ç´°ç¯€ã€‚é€™é¡žç ”ç©¶æ¯”è¼ƒåå‘ Bioinformaticsã€‚&lt;/p&gt;
&lt;p&gt;ä¾† WashU å‰ï¼Œæˆ‘æœŸè¨±è‡ªå·±ç¹¼çºŒå¾€ Bioinformatics æ·±å…¥ã€‚ç„¶è€Œï¼Œåœ¨éŽåŽ»çš„æ•¸æœˆè£¡ï¼Œå³ä¾¿æˆ‘ä»æŠ•å…¥åœ¨é€™äº›æ•¸æ“šåˆ†æžèˆ‡å·¥å…·é–‹ç™¼ä¸Šï¼Œå¦ä¸€å¤§éƒ¨ä»½çš„æ™‚é–“ï¼Œæˆ‘ç¶“æ­·äº†è¨±å¤šé—œæ–¼æ¨¡åž‹ï¼Œæˆ–è€…ï¼Œé—œæ–¼ã€Œå¦‚ä½•å›žç­”é‡è¦çš„ç”Ÿç‰©å•é¡Œã€ä¸Šçš„è¨Žè«–ï¼Œæœ‰äº†è¼ƒç¢©ç­è¨“ç·´ä¸åŒçš„å•Ÿç™¼ã€‚é€™å¦ä¸€é¡žç ”ç©¶æ¯”è¼ƒåå‘ Computational Biologyã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æƒ³ç”¨å¦ä¸€å€‹è§’åº¦ä¾†çœ‹æ‰€è¬‚çš„ã€Œmodelingã€ã€‚å…§å®¹ä¸»è¦ä¾†è‡ª &lt;a href="http://genetics.wustl.edu/bclab/"&gt;Barak Cohen&lt;/a&gt; æ•™æŽˆçµ¦çš„æ•¸å ‚èª²çš„ç­†è¨˜ï¼Œä¸»é¡Œç‚º &lt;em&gt;Coding and Noncoding Variant&lt;/em&gt;ã€‚æˆ‘ç”Ÿç‰©èƒŒæ™¯ä¸è¶³ï¼Œå¦‚æžœç­†è¨˜æœ‰ä»»ä½•éŒ¯èª¤ï¼Œç…©è«‹å‘ŠçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Conflict of Interest&lt;/strong&gt;: Cohen Lab é–‹ç™¼äº† &lt;a href="http://www.pnas.org/content/109/47/19498.short"&gt;CRE-seq&lt;/a&gt; (&lt;em&gt;cis&lt;/em&gt;-regulatory element by sequencing)ï¼Œå…¶ä¸­ä¸€ç¨® MPRA (Massively Parallel Reporter Assay) æŠ€è¡“ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#coding-vs-noncoding-variants"&gt;Coding vs noncoding variants&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#noncoding-elements"&gt;Noncoding elements&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#noncoding-variants"&gt;Noncoding variants&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#endophenotypes"&gt;Endophenotypes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#eqtl"&gt;eQTL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mpra"&gt;MPRA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="coding-vs-noncoding-variants"&gt;Coding vs noncoding variants&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆä¾†è«‡è«‡ coding å’Œ noncoding variantã€‚èª²å ‚ä¸Šè€å¸«è®“æˆ‘å€‘è‡ªç”±è¾¯è«–ç ”ç©¶å…©è€…çš„ã€Œå„ªç¼ºé»žã€ï¼Œäº¦æˆ–ï¼Œå¦‚æžœä½ æ˜¯ PI æ¯”è¼ƒæƒ³ç ”ç©¶å“ªå€‹ï¼Œé¢è‡¨çš„å„ªå‹¢èˆ‡å›°å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;Coding variant å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨æŸå€‹ gene coding region ç”¢ç”Ÿçš„åºåˆ—æ”¹è®Šï¼Œä¸€èˆ¬æœƒå…ˆçœ‹æ‰€è¬‚çš„ nonsynonymousï¼Œå³é€™å€‹ variant é€ æˆ amino acid æ”¹è®Šï¼Œå½±éŸ¿åˆ°è›‹ç™½è³ªçš„çµæ§‹ï¼Œé€²è€Œå½±éŸ¿åˆ°å…¶åŠŸèƒ½ã€‚synonymous variant é›–ç„¶ä¸æœƒæ”¹è®Š amino acidï¼Œä½†åœ¨æ¨¡å¼ç‰©ç¨®ä¸­ï¼Œå¯èƒ½æœƒè¨Žè«–ä¸åŒ amino acid å°æ–¼ä¸åŒ tRNA çš„åå¥½ï¼Œä¹Ÿè¨±æœƒå½±éŸ¿åˆ° gene expressionã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒä¹Ÿå¯èƒ½æœƒå½±éŸ¿ transcription factor (TF) bindingï¼ŒæŸäº› TF åœ¨ biding æœ‰åå¥½çš„ DNA sequenceï¼ˆmotifï¼‰ï¼Œå³ä½¿è›‹ç™½è³ªåºåˆ—ä¸è®Šï¼ŒTF binding è®ŠåŒ–ä¹Ÿæœƒå½±éŸ¿åˆ°å…¶ä»–åŸºå› çš„èª¿æŽ§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽä¸€èˆ¬è€Œè¨€ï¼Œcoding variant ä¸»è¦éƒ½æ˜¯è€ƒæ…® nonsynonymous changeï¼Œé€™é€ æˆçš„è®ŠåŒ–ååˆ†å…·å¤§ï¼Œç„¡æ³•è§£é‡‹åƒ complex traitsã€gene expression é«˜ä½Žé€™ç¨®ç´°å¾®çš„è®ŠåŒ–ã€‚&lt;/p&gt;
&lt;h3 id="noncoding-elements"&gt;Noncoding elements&lt;/h3&gt;
&lt;p&gt;Noncoding vairant ç›¸å°è€Œè¨€è¤‡é›œçš„å¤šã€‚åœ¨è¨Žè«–å®ƒä¹‹å‰ï¼Œä¸å¦‚ä¾†èªªèªªçœ‹æˆ‘å€‘çŸ¥é“å“ªäº› noncoding elementsï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Introns&lt;/li&gt;
&lt;li&gt;Promoters&lt;/li&gt;
&lt;li&gt;Regulatory elements (REs)&lt;ul&gt;
&lt;li&gt;&lt;em&gt;cis&lt;/em&gt;-regulatory elements (CREs): promoters, enhancers&lt;/li&gt;
&lt;li&gt;&lt;em&gt;trans&lt;/em&gt;-regulatory elements&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;miRNAs&lt;/li&gt;
&lt;li&gt;Retrovirus, satellites, centromeres, telemeres&lt;/li&gt;
&lt;li&gt;Structual elements &lt;ul&gt;
&lt;li&gt;Matrix Attachment Regions (MARs)&lt;/li&gt;
&lt;li&gt;Lamina Associated Domains (LADs)&lt;/li&gt;
&lt;li&gt;CTCF/Cohesin&lt;/li&gt;
&lt;li&gt;Topologically associating domains (TADs)&lt;/li&gt;
&lt;li&gt;3D genome&lt;sup id="fnref:3D genome"&gt;&lt;a class="footnote-ref" href="#fn:3D genome"&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Methylation&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å’¦ï¼Œå¿˜è¨˜æåˆ° histone modification å—Žï¼Ÿé—œæ–¼é€™äº› epigenetics markersï¼ŒBarak å°æ–¼ä»–å€‘æœ‰æ·±åˆ»çš„æ‡·ç–‘ï¼Œä»–èªç‚ºé€™äº›åªæ˜¯ markers è€Œéžæœ€çµ‚ regulatory elementï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;Something you can measure does not mean it is interesting.&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç„¶å¾Œå»ºè­°æˆ‘å€‘åŽ»è®€ä¸€ç¯‡æ‰¹è©• ENCODE çš„è«–æ–‡&lt;sup id="fnref:ENCODE paper"&gt;&lt;a class="footnote-ref" href="#fn:ENCODE paper"&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œè¢«ä»–è©•ä¹‹ç‚ºè¿‘åå¹´æœ€è¾›è¾£ï¼Œæ¨™é¡Œä¹Ÿéžå¸¸æœ‰è¶£ã€‚&lt;/p&gt;
&lt;h3 id="noncoding-variants"&gt;Noncoding variants&lt;/h3&gt;
&lt;p&gt;å¾ž non-coding elements æˆ‘å€‘èƒ½çŸ¥é“æŽ§åˆ¶ gene expression å¯ä»¥å¾žå¾ˆå¤šé¢å‘åˆ‡å…¥ï¼Œæ–¼æ˜¯è¨Žè«– non-coding variant æ™‚å°±æœƒæœ‰å¾ˆå¤šä¸åŒçš„æ©Ÿåˆ¶å½±éŸ¿ gene expressionã€‚åº•ä¸‹é‡å°æ‰€è¬‚çš„ enhancers (RE) å’Œ promoters ä¾†ç•«å€‹ç°¡å–®çš„ç¤ºæ„åœ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;     TF1  TF2  TF3         TF4  [RNA PolII]
----[  enhancer  ]-------[promoter]--[gene body]-------------------------
  &amp;lt;-- Topologically Associating Domain, TAD -----&amp;gt;   &amp;lt;-- Another TAD --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;RNA Polymerase II (RNA PolII) è² è²¬ gene transcriptionï¼Œè€Œ promoter æ˜¯ä¸€æ®µåœ¨ gene body å‰ä¸ç‰¹å®šçš„åºåˆ—å¯ä»¥å¸å¼• RNA PolII ä¾†æé«˜ gene transcription rateï¼Œå¾ˆæœ‰å¯èƒ½å°±æœƒæé«˜ gene expressionã€‚TF å¯èƒ½æœƒè¾¨åˆ¥ promoter ä¸Šç‰¹å®šçš„åºåˆ—ï¼Œå®ƒå° PolII æœ‰æ›´å¼·çš„å¸å¼•åŠ›ã€‚é™¤äº† promoter ä¹‹å¤–ï¼Œenhancer ç›¸è¼ƒæ–¼ gene body çš„è·é›¢å°±æ›´ä¸ç¢ºå®šï¼Œå¯èƒ½æ˜¯ 10kb æˆ– 100kb ä¹‹å¤–ï¼Œä½†å®ƒåœ¨ç«‹é«”çš„è·é›¢å¯èƒ½éžå¸¸è¿‘ï¼Œæœ¬èº«ä¹Ÿå¯ä»¥ recruit TF ç„¶å¾Œå¢žåŠ  Pol affinityã€‚é€™ä¸€åˆ‡å¯ä»¥ç”¨æŠ‘åˆ¶ã€ç«¶çˆ­çš„è§’åº¦ä¾†æƒ³ç”¢ç”Ÿè² å‘çš„èª¿æŽ§ã€‚&lt;/p&gt;
&lt;p&gt;Enhancer çš„å½±éŸ¿åŠ›æ²’æœ‰æ–¹å‘æ€§ï¼Œå³ä¸Šä¸‹æ¸¸çš„ gene éƒ½æœƒå—åŒå€‹ enhancer èª¿æŽ§ã€‚æ–¼æ˜¯æœ‰æ‰€è¬‚ TAD çš„æ¦‚å¿µï¼Œå®ƒæœƒè®“ chromosome å½¢æˆä¸€å€‹ loop ä¾·é™é€™æ¨£ç«‹é«”ç©ºé–“ä¸Šä¸‹æ¸¸çš„äº’å‹•ï¼Œä½¿å¾—åªåœ¨åŒå€‹ TAD çš„ REs å’Œ gene èƒ½äº’ç›¸ä½œç”¨ã€‚
é€™æ¨£çš„è§€å¿µå¯ä»¥é€²ä¸€æ­¥æŽ¨å»£åˆ° 3D genome ä¸Šï¼Œè€ƒæ…®ä¸åŒ chromosome é–“çš„äº’å‹•ã€‚TAD çš„é‚Šç•Œç”±æŸäº› motifï¼ˆä¾‹å¦‚ CTCFï¼‰æ±ºå®šï¼Œä½†ç©¶ç«Ÿ TAD æ˜¯å¦‚æžœå»ºç«‹èˆ‡èª¿æŽ§ï¼Œæ©Ÿåˆ¶å°šæœªæ˜Žæœ—ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ non-coding è¤‡é›œçš„äº¤äº’ä½œç”¨çš„å¦ä¸€é¢ï¼Œä»£è¡¨äº†æ¯å€‹äº¤äº’ä½œç”¨å¾ˆå¯èƒ½åƒ…æ”¹è®Šäº†åŸºå› è¡¨é”çš„ç¨‹åº¦ï¼Œè€Œä¸æ˜¯å¤§å¹…åº¦çš„é–‹é—œã€‚ä½†é€™ä¹Ÿä»£è¡¨ä»–å€‘å°ç”Ÿç‰©é«”ä¸ä¸€å®šæœ‰å¾ˆå¼·çš„å½±éŸ¿ï¼Œæ‰€ä»¥æœ‰è®ŠåŒ–ä¸¦ä¸€å®šä»£è¡¨å®ƒæœ‰åŠŸèƒ½ã€‚ä¸éŽï¼Œä¸åŒçš„ cell type å€’å¯ä»¥ç”¨é€éŽ TF æœ‰ç„¡ä¾†èª¿æŽ§ä¸€ç³»åˆ—çš„ geneï¼Œè€Œä¸æ˜¯ä¸€å‘³å¢žåŠ  gene æ•¸é‡ã€‚å› æ­¤ï¼Œåœ¨å¾ˆå¤šæƒ…æ³ä¸‹ï¼Œäº†è§£ non-coding variants é€ æˆçš„å½±éŸ¿æ˜¯å¾ˆæœ‰è¶£çš„ã€‚&lt;/p&gt;
&lt;h3 id="endophenotypes"&gt;Endophenotypes&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘è¦å¦‚ä½•çœ‹ non-coding variants å‘¢ï¼Ÿé¦–å…ˆè¦äº†è§£å¾ž genotype åˆ° phenotype å…¶å¯¦ä¸­é–“åŒ…å«äº†å¾ˆå¤šå±¤ç´šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;DNA (genotype) â†’  RNA â†’  Proteins â†’  Metabolites â†’  Phenotype
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸­é–“çš„æ¯å€‹æ­¥é©Ÿéƒ½å¯èƒ½å½±éŸ¿ï¼Œæˆ–ä¸æœƒå‚³éžå½±éŸ¿è‡³ä¸‹å€‹éšŽæ®µã€‚ä½†æˆ‘å€‘åœ¨ DNA å’Œ RNA level æœ‰éžå¸¸å¥½çš„å·¥å…·â”€å®šåºâ”€å¯ä»¥åŒæ™‚çœ‹ genome wide éžå¸¸å¤šåŸºå› æˆ–å€åŸŸã€‚æ–¼æ˜¯åœ¨å¤§å¤šæ•¸çš„æƒ…æ³æˆ‘å€‘éƒ½åªæœ‰çœ‹åˆ° endophenotypesï¼Œè¦å‹™å¿…åƒ…è¨˜åœ¨å¿ƒé€™å’ŒçœŸæ­£çš„ phenotype æ˜¯æœ‰æ‰€å·®ç•°çš„ã€‚&lt;/p&gt;
&lt;h2 id="eqtl"&gt;eQTL&lt;/h2&gt;
&lt;p&gt;eQTL å³æ˜¯ä¸€ç¨® endophenotypeã€‚QTL (quantitative trait loci) æ„å³æŸå€‹ chromosome region å¯ä»¥é—œé€£è‡³ä¸€äº›é‡åŒ–æ•¸å€¼çš„è®Šå‹•ï¼ˆå³ locations that map to some quantitative measuresï¼‰ï¼Œè€Œ eQTL å³ç‚º expresion QTLï¼Œé—œå¿ƒæŸæ®µå€åŸŸçš„ variants å½±éŸ¿ gene expressionã€‚&lt;/p&gt;
&lt;p&gt;éŽå¾€å¸¸è¦‹çš„ eQTL study æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linkage study&lt;/li&gt;
&lt;li&gt;Family tree&lt;/li&gt;
&lt;li&gt;GWAS on two groups&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™éƒ½æ˜¯ä½¿ç”¨æ•¸å€‹ä¸åŒäººä¸åŒ sample ä¾†çœ‹ eQTLã€‚ä½†é€™äº›å°æ–¼ non-coding variant ä¾†èªªè®Šå› å¤ªå¤šï¼Œç‚ºä½•ä¸å¾žå€‹äººã€å–®ä¸€ sample è‘—æ‰‹ï¼Œå³ allele imballanceï¼Ÿç„¶è€Œå–®ä¸€ sample å°±æœƒç‰½æ‰¯åˆ° eQTL æœ¬èº«çš„å•é¡Œï¼Œå³å®ƒå¾ˆé›£é€²ä¸€æ­¥å¾žæŸå€‹å€åŸŸç¸®å°åˆ°æ˜¯å“ªå€‹ variant æˆ–å“ªå¹¾å€‹ variants ç‚ºæ±ºå®šæ€§å› å­ (causal vairants)ã€‚&lt;/p&gt;
&lt;h2 id="mpra"&gt;MPRA&lt;/h2&gt;
&lt;p&gt;æ–¼æ˜¯æˆ‘å€‘å¯ä»¥æƒ³è¾¦æ³•è¨­è¨ˆå¯¦é©—ä¾†é€²ä¸€æ­¥è§£é‡‹ eQTLã€‚å¯¦é©—å¯ä»¥å¾žå…©å€‹æ–¹å‘ä¾†è¨­è¨ˆï¼šnecessary å’Œ sufficientã€‚Necessity å¯ä»¥é€éŽ CRISPR è¨­è¨ˆä¸€ç³»åˆ—çš„ tiled gRNAs æŠŠæŸå€‹ eQTL é€æ­¥åˆªæŽ‰ã€‚å¹³è¡ŒåŒ–é€™å€‹å¯¦é©—ï¼Œå¯ä»¥é€éŽ growth selection å’Œ single cell sequencing è®€å‡ºæ˜¯å“ªäº› gRNAs æœ€æœ‰å½±éŸ¿åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ sufficiency æ–¹é¢ï¼Œæˆ‘å€‘å¯ä»¥è¨­è¨ˆ reporter assay ä¾†å›žç­”é€™å•é¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----------------------------[weak promoter]--[GFP]--
---[cis RE, CRE]-------------[weak promoter]--[GFP]--
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;reporter assay å¯ä»¥ç”¨å€‹ plasmid æ”¾åˆ° target cellï¼Œä½†è¦æ€Žéº¼å¹³è¡ŒåŒ–ï¼ŒåŒæ™‚çœ‹å¾ˆå¤š genes å‘¢ï¼Ÿé€™æ™‚å€™å°±æ˜¯ MPRA (Massively Parallel Reporter Assay) è¡¨ç¾çš„æ™‚å€™äº†ã€‚æˆ‘å€‘å¯ä»¥ç”¨ DNA synthesis æŠŠè©² &lt;em&gt;cis&lt;/em&gt;-regulatory element (CRE) å’Œ barcode åšå‡ºä¾†ï¼Œå¯ä»¥å»ºç«‹ä¸€å€‹ CRE libraryï¼Œç”¨ RNA-seq å°±å¯ä»¥åŒæ™‚çœ‹åˆ°ä¸åŒ CRE æ‰€é€ æˆçš„ gene expression changeã€‚ç•¶ç„¶ç´°ç¯€æœ‰åƒ normalization DNA amount å’Œ barcode efficiencyï¼Œä½†æˆ‘å€‘å¯ä»¥ç”¨ MPRA ä¾†åˆ†æž CREã€‚&lt;/p&gt;
&lt;p&gt;é€™è£¡æåˆ°çš„ CRE-seq æœ‰ä»€éº¼ç¼ºé™·å‘¢ï¼Ÿå®ƒæ˜¯ Plasmid basedï¼Œæ²’æœ‰ histone modificationï¼Œæœ‰ copy number å•é¡Œï¼›å†ä¾†ä»–çš„ genome context ä¹Ÿåªæœ‰å€åŸŸæ€§ï¼ˆåƒ TAD å°±æ²’æœ‰è€ƒæ…®ï¼‰ã€‚æ–¼æ˜¯æŽ¥ä¸‹ä¾†å¦‚ä½•æ”¹å–„ä»–ï¼Œå°±æ˜¯ç›®å‰ Barak Lab ç ”ç©¶æœ€æ–°å‹•æ…‹ã€‚&lt;/p&gt;
&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;æˆ‘è¦ºå¾—å¾žé€™å€‹è§’åº¦ï¼ŒæŠŠå¾ˆå¤šè§€å¿µç”¨ç³»çµ±çš„è§’åº¦æ•´åˆï¼Œä¸¦ä¸”æå‡ºæ–°çš„å¯¦é©—èˆ‡æ¨¡åž‹ï¼Œéžå¸¸æœ‰è¶£ã€‚åƒè¦æ€Žéº¼ model enhancer å’Œ TFs çš„äº¤äº’ä½œç”¨ï¼Œéƒ½æ˜¯å¾ˆæœ‰è¶£çš„é¡Œç›®ã€‚ä»–çš„èª²éžå¸¸æœ‰å•Ÿç™¼æ€§ï¼Œå¾ˆæœ‰æ„æ€ã€‚&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:3D genome"&gt;
&lt;p&gt;é—œæ–¼ 3D genome å°±è¦æä¸€ä¸‹é€™ç¯‡è«–æ–‡ï¼š&lt;br&gt;
Adrian and Suhas &lt;em&gt;el al.&lt;/em&gt;, &lt;a href="http://www.pnas.org/content/112/47/E6456.abstract"&gt;&lt;em&gt;Chromatin extrusion explains key features of loop and domain formation in wild-type and engineered genomes&lt;/em&gt;&lt;/a&gt;, PNAS, 2015.&lt;br&gt;
è£¡é¢ç”¨ç¢Žå½¢ (fractal globule) åŽ»è§£é‡‹ CTCF å½¢æˆ TADs é€ æˆæ€Žéº¼æ¨£çš„æŸ“è‰²é«”æ‘ºç–Šï¼Œä¸¦å¦‚ä½•é€éŽé€™æ¨£çš„æ‘ºç–Šç”¢ç”Ÿ long distance interactionï¼Œå› ç‚ºå¯èƒ½åœ¨ç«‹é«”ç©ºé–“ä»–å€‘æ˜¯æŽ¥è¿‘çš„ã€‚æ¨¡åž‹ç”¨ä¾†è§£é‡‹ Hi-C æ•¸æ“šã€‚é€™ç¯‡è«–æ–‡ä½¿ç”¨æ•¸å­¸ä¹‹æŠ½è±¡å’Œè¤‡é›œï¼Œç”šè‡³è«‹ä¸˜æˆæ¡ä¾†ç•¶ reviewerã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:3D genome" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:ENCODE paper"&gt;
&lt;p&gt;é‡å° ENCODE æ‰€è¬‚ 80% genome are functional éžå¸¸æœ‰åçš„æˆ°æ–‡ï¼š&lt;br&gt;Dan &lt;em&gt;et al.&lt;/em&gt;, &lt;a href="https://academic.oup.com/gbe/article-lookup/doi/10.1093/gbe/evt028"&gt;&lt;em&gt;On the Immortality of Television Sets: â€œFunctionâ€ in the Human Genome According to the Evolution-Free Gospel of ENCODE&lt;/em&gt;&lt;/a&gt;, Genome Biol Evol, 2013.&amp;#160;&lt;a class="footnote-backref" href="#fnref:ENCODE paper" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="zh"></category><category term="bio"></category></entry><entry><title>Changing login shell without chsh</title><link href="https://blog.liang2.tw/posts/2017/01/without-chsh/" rel="alternate"></link><published>2017-01-23T00:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2017-01-23:/posts/2017/01/without-chsh/</id><summary type="html">&lt;p&gt;For my daily terminal life, I use &lt;a href="https://fishshell.com/"&gt;fish shell&lt;/a&gt;. Fish shell can be largely described by the headline on its official website:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Finally, a command line shell for the 90s&lt;/strong&gt;&lt;br&gt;
fish is a smart and user-friendly command line
shell for macOS, Linux, and the rest of the family.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Among all â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;For my daily terminal life, I use &lt;a href="https://fishshell.com/"&gt;fish shell&lt;/a&gt;. Fish shell can be largely described by the headline on its official website:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Finally, a command line shell for the 90s&lt;/strong&gt;&lt;br&gt;
fish is a smart and user-friendly command line
shell for macOS, Linux, and the rest of the family.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Among all of its features, I particularly enjoy how the autocompletions are widely available and easy to use for generally all common commands and operations. I think I&amp;rsquo;ve got spoiled by the autocompletion so much that sometimes I get lazy at typing the full commands. Undoubtedly, fish is my login shell, replacing the ubiquitous Bash shell.&lt;/p&gt;
&lt;p&gt;Most of the time, one can change the login shell by the command &lt;code&gt;chsh&lt;/code&gt;. In order to let &lt;code&gt;chsh&lt;/code&gt; accept the new fish shell, it must be added into the list of all accepted shells which requires root permission. However, in many occasions including working on a large shared server, one may not has the permission to add new shell and thus the options for the login shell are often limited.  &lt;/p&gt;
&lt;h4 id="replacing-login-shell-by-exec"&gt;Replacing login shell by &lt;code&gt;exec&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Alternative solution will be calling the new shell upon the execution of current shell.  A POSIX-compliant shell&lt;sup id="fnref:posix"&gt;&lt;a class="footnote-ref" href="#fn:posix"&gt;1&lt;/a&gt;&lt;/sup&gt; should always read the &lt;code&gt;.profile&lt;/code&gt; configuration file upon login, the following command execute fish and sweep the process with the current running shell (usually, bash). &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;exec&lt;/span&gt; -l &lt;span class="nv"&gt;$SHELL&lt;/span&gt; -l
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;-l&lt;/code&gt; tells shell to act like a login shell. For more explanation about login and non-login (as well as (non-)interactive) shells can be found at &lt;a href="http://unix.stackexchange.com/a/46856"&gt;this StackOverflow answer&lt;/a&gt;. By pointing &lt;code&gt;$SHELL&lt;/code&gt; to the desired shell binary, one can achieve the similar behavior to &lt;code&gt;chsh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;However putting &lt;code&gt;exec&lt;/code&gt; in the login profile comes with a risk that if the new shell executable crashes (e.g. failed symlink, erroneous compilation and failed dynamic library linking), one cannot establish proper shell connections. I&amp;rsquo;ve experienced these catastrophic failures for a couple of times. Since the new shell crashes when the original shell is replacing its process, one cannot set up the proper terminal session, or simply put, one will fail to login. It was not fun at all to recover.&lt;/p&gt;
&lt;h4 id="fail-safe-shell-changing"&gt;Fail-safe shell changing&lt;/h4&gt;
&lt;p&gt;To provide a fail-safe mechanism, I use the following code in my &lt;code&gt;~/.profile&lt;/code&gt; to change the shell. Only login shells will read this file so it won&amp;rsquo;t be executed when one runs a bash script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;FISH_BIN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/.linuxbrew/bin/fish&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# The replacement is only done in non-fish login interactive shell in&lt;/span&gt;
&lt;span class="c1"&gt;# SSH connection and fish executable exists.&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;                                                            &lt;span class="se"&gt;\&lt;/span&gt;
     &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$SHELL&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FISH_BIN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -a -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$SSH_TTY&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -a -x &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FISH_BIN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="c1"&gt;# we first check whether fish can be executed, otherwise the&lt;/span&gt;
    &lt;span class="c1"&gt;# replacement will cause immediate crash at login (not fun)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FISH_BIN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -c &lt;span class="s1"&gt;&amp;#39;echo &amp;quot;Test fish running&amp;quot; &amp;gt;/dev/null&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;SHELL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FISH_BIN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;One can launch the fish shell by &amp;#39;exec -l \$SHELL -l&amp;#39;&amp;quot;&lt;/span&gt;
        &lt;span class="c1"&gt;# exec -l $SHELL -l   # launch the fish login shell&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Failed to launch fish shell. Go check its installation!&amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Fall back to default shell &lt;/span&gt;&lt;span class="nv"&gt;$SHELL&lt;/span&gt;&lt;span class="s2"&gt; ...&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Basically we ensure whether fish executable work by running &lt;code&gt;echo '...'&lt;/code&gt; before we change the shell. By uncommenting the &lt;code&gt;exec ..&lt;/code&gt; line one will get automatically directed to fish shell. But the safest option is to run the shell change oneself. This kind of &amp;ldquo;shell swapping&amp;rdquo; will only happen when we log in the server by ssh&lt;/p&gt;
&lt;p&gt;The actual setting is quite straight-forward. While the backstory here is that I messed up a few times and I was lucky enough to keep another session alive. At first I only checked &lt;code&gt;fish --version&lt;/code&gt; but it was not sufficient, since it didn&amp;rsquo;t actually execute fish&amp;rsquo;s main code instructions. I got a illegal instruction after changing to fish even though printing its version was fine.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:posix"&gt;
&lt;p&gt;Interestingly, fish is not a POSIX-compliant shell so it won&amp;rsquo;t read &lt;code&gt;~/.profile&lt;/code&gt; configuration file.&amp;#160;&lt;a class="footnote-backref" href="#fnref:posix" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="en"></category><category term="fish"></category><category term="shell"></category></entry><entry><title>GPG Key Transition</title><link href="https://blog.liang2.tw/posts/2016/12/gpg-key-transition-2016/" rel="alternate"></link><published>2016-12-06T00:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-12-06:/posts/2016/12/gpg-key-transition-2016/</id><summary type="html">&lt;p&gt;I started using GPG key as one of my small experiments in March, 2015. Throughout the setup, I made some mistakes, which I revoked later, and explored several usage scenarios. Although like what was said in the post &lt;a href="https://blog.filippo.io/giving-up-on-long-term-pgp/"&gt;&lt;em&gt;I&amp;rsquo;m giving up on PGP&lt;/em&gt;&lt;/a&gt;, I don&amp;rsquo;t really use the â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;I started using GPG key as one of my small experiments in March, 2015. Throughout the setup, I made some mistakes, which I revoked later, and explored several usage scenarios. Although like what was said in the post &lt;a href="https://blog.filippo.io/giving-up-on-long-term-pgp/"&gt;&lt;em&gt;I&amp;rsquo;m giving up on PGP&lt;/em&gt;&lt;/a&gt;, I don&amp;rsquo;t really use the encryption in daily email communication, it is still good to have an online identity.&lt;/p&gt;
&lt;p&gt;A year later, which is 3 months before my &lt;em&gt;experimental&lt;/em&gt; key expires, I think now is a good time to roll out a new one. I followed Alex&amp;rsquo;s post &lt;a href="https://alexcabal.com/creating-the-perfect-gpg-keypair/"&gt;&lt;em&gt;Creating the Perfect GPG Keypair&lt;/em&gt;&lt;/a&gt; to create a signing subkey for daily usage and keep my master key sperately in a safe place. The following is my transition statement.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

I am transitioning GPG keys from an old 4192-bit RSA key to a new
4096-bit RSA key.  The old key will continue to be valid for some
time, but I prefer all new correspondance to be encrypted in the new
key, and will be making all signatures going forward with the new key.

This transition document is signed with both keys to validate the
transition.

If you have signed my old key, I would appreciate signatures on my new
key as well, provided that your signing policy permits that without
reauthenticating me.

The old key, which I am transitioning away from, is:

  pub   4096R/30A45011B233544E 2015-03-21 [expires: 2017-03-22]
      Key fingerprint = 6ECD C5B8 235C D44D 2471  866E 30A4 5011 B233 544E

The new key, to which I am transitioning to, is:

  pub   4096R/44D10E44730992C4 2016-12-04 [expires: 2018-12-04]
      Key fingerprint = 85DF A3EB 72CD DE7D 3F2A  127C 44D1 0E44 7309 92C4

To fetch the full new key from a public key server using GnuPG, run:

  gpg --keyserver hkps://hkps.pool.sks-keyservers.net --recv-key 44D10E44730992C4

If you have already validated my old key, you can then validate that
the new key is signed by my old key:

  gpg --check-sigs 44D10E44730992C4

If you then want to sign my new key, a simple and safe way to do that
is by using caff (shipped in Debian as part of the &amp;quot;signing-party&amp;quot;
package) as follows:

  caff 44D10E44730992C4

Please contact me via e-mail at &amp;lt;me@liang2.tw&amp;gt; if you have any
questions about this document or this transition.

                                            Liang-Bo Wang
                                            (liang2, ccwang002)
                                            me@liang2.tw
                                            Dec 06, 2016

-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJYR5q3AAoJEPhHjvdXantXlzEP/iEgSd2NcfcBThmrY84U+MXR
UOLED3Ax6YvDUv/nInkMAH74SyqujeF7E7+ZuZmDEWRCVS6pQtpuLTvKBviDPyWx
W/hS03AU5nV9llSYZ4I/FzQdVtdY5PBBNCHxK34LoqJQVr3LPdAQOO2m9g8M11z0
+7FjmyNOjvZIxqhU+PK7VNEcZQ9X30ndjgkwCZQFE/8Wz9FnPt5QdwZoxNRBfx7Q
tMtHpMxKNTHV1t3lCcOubf5zQLFQ07SZv2f2rmfDPlsrvzp4bzq8QWEEo/XvClRc
hyFpbM55FqlJE+5lg/Dj/XC5AN0LS8HNd9x7UBWZnNQhg00elc+CXxgNc+wMVj+N
uPXYP2n1oZ4T4Fr45eFg9nJagBpIUsu+M5hoNGXtCdLcYPzJeERPebt/VZJQybse
T60hO8K15A5WCkZYnw1mXu/JangNGY8Bxq3xm7VzXHLJktf33gIIMUQC2ZCn/I0N
MQIjkMrARFpsGfb1DEglyWk/QdK4A8Cy3eKsNaKvz4A+PMr4Eskn8zhO05yJQlux
3IkXt1lnn2YTF5fjInYQPo22bNCuub4qoJhthOoySy2Zv04NHnOtmYPBZMv14aZe
MPcv4Kvn8szNeBRDT/zKqCWoHmxIbxIs7ZvSIfvj/NpugtkSkJVtvr7gpXmqObcc
L7kJSEXjkLiqvFrq6MkxiQIcBAEBCgAGBQJYR5q3AAoJEDCkUBGyM1ROlzEQAJ3i
gpH6z/rHrAVCNxru7ATLmVZYGF0uxLvth0hUnOvmhWb7a60v4KwRgTBFJ9vdUB24
MW0T0BdxN8zJPrN6hGj9RxML5UpzH///oeL1gINM8IEhZWaG1/th7bx5f/ip8xN+
dbkA8Hp3LW/LAB09uJOITLbLaPa+N2Umcsu6stPXL+Z/06JSUYIliDRDkzzpb/qw
/OZD6sj1oI25A7KYEUPiNn+FxtBmNiFetDqwhCJSglEF3SBl8ZlrbgMDxIudZX/5
+ihTn2Za5q59c7u2ESMmInP1n8/lFxYxi/DWE2n8vrw84PwQ5lG5zdiiYQf78QeB
j77giQzYibzvRHZlslJEM0lSeNLQ72svT5SIFB+45wqtfVIAfZCxTppv35MkpyDw
gtYW/zL6U+Qx+chPgVpBLkpC7LbBvrJozIU0oHw8V837IByaeqBPu9rm+F3M++Mo
taLmkzNvhX6wozw9Tj0gnW6e8ytH7Xi8K8IYO7xSSOGih/oKF2PrWPd8gufMiIML
lOtcuwZOCQqAB2yAQ2BHliwrm78XELARZXM1sbWJTpXBJPAZ+ZbvnNFK6fUwnclK
H35TsvRJK7hH+4d10EdURleyRj7d0EcXlHqki4urKlwSzRebLzq365vADzXEjFYp
DmfC2ISS64uLqHgJ3HHxhSmTLdc8KSJqzFi90ZUu
=JS7v
-----END PGP SIGNATURE-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Coding"></category><category term="en"></category><category term="gpg"></category></entry><entry><title>St. Louis PhD ç”Ÿæ´»</title><link href="https://blog.liang2.tw/posts/2016/10/phd-life-in-st-louis/" rel="alternate"></link><published>2016-10-02T00:00:00-05:00</published><updated>2022-05-13T13:06:48-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-10-02:/posts/2016/10/phd-life-in-st-louis/</id><summary type="html">&lt;p&gt;ä¸çŸ¥ä¸è¦ºï¼Œè·é›¢ä¸Šç¯‡æ–‡ç« å·²ç¶“ 4 å€‹æœˆã€‚é€™ 4 å€‹æœˆè£¡ï¼Œæ“”ä»» &lt;a href="https://tw.pycon.org/2016/"&gt;PyCon TW 2016&lt;/a&gt; å·¥ä½œäººå“¡ã€å¯«å®Œ&lt;a href="https://github.com/ccwang002/master-thesis"&gt;ç¢©å£«è«–æ–‡&lt;/a&gt;ã€å¾žä¸€å€‹è®€äº† 7 å¹´çš„å­¸æ ¡&lt;a href="https://www.facebook.com/photo.php?fbid=1388036924547016&amp;amp;set=a.181592455191475.49590.100000221666201&amp;amp;type=3&amp;amp;theater"&gt;ç•¢æ¥­&lt;/a&gt;ã€ç„¶å¾Œå‰ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸çŸ¥ä¸è¦ºï¼Œè·é›¢ä¸Šç¯‡æ–‡ç« å·²ç¶“ 4 å€‹æœˆã€‚é€™ 4 å€‹æœˆè£¡ï¼Œæ“”ä»» &lt;a href="https://tw.pycon.org/2016/"&gt;PyCon TW 2016&lt;/a&gt; å·¥ä½œäººå“¡ã€å¯«å®Œ&lt;a href="https://github.com/ccwang002/master-thesis"&gt;ç¢©å£«è«–æ–‡&lt;/a&gt;ã€å¾žä¸€å€‹è®€äº† 7 å¹´çš„å­¸æ ¡&lt;a href="https://www.facebook.com/photo.php?fbid=1388036924547016&amp;amp;set=a.181592455191475.49590.100000221666201&amp;amp;type=3&amp;amp;theater"&gt;ç•¢æ¥­&lt;/a&gt;ã€ç„¶å¾Œå‰å¾€ç¾Žåœ‹çš„ &lt;a href="https://wustl.edu/"&gt;Washington University in St. Louis&lt;/a&gt;  å°±è®€ &lt;a href="http://dbbs.wustl.edu/divprograms/compbio/Pages/default.aspx"&gt;Bioinformatics&lt;/a&gt; PhDã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä»Šé™¤äº†ç¹¼çºŒèªè­˜æ–°ç’°å¢ƒèˆ‡æ–°æœ‹å‹ä¹‹å¤–ï¼Œç”Ÿæ´»å¤§æŠµå®‰å®šã€‚å› ç‚ºé–‹å­¸æœ‰å„ç¨®å­¸æ ¡æˆ–ç§ä¸‹å­¸ç”Ÿé–“çš„æ´»å‹•ï¼Œä»¥åŠé©æ‡‰æ–°çš„èª²ç¨‹èˆ‡å¯¦é©—å®¤ï¼Œå…¶å¯¦æ‰‹ä¸Šçš„å°ˆæ¡ˆæ²’ä»€éº¼é€²åº¦ã€‚ä¸éŽé‚„æ˜¯ç°¡å–®çš„æ›´æ–°ä¸€ä¸‹è¿‘æ³ã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;é—œæ–¼æˆ‘çš„å­¸æ ¡èˆ‡åŸŽå¸‚&lt;/h2&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/10/phd-life-in-st-louis/pics/STL_map.png"/&gt;
  &lt;figcaption&gt;St. Louis åŸŽå¸‚ä½ç½®ã€‚&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æˆ‘æƒ³å¤§å¤šæ•¸çš„äººä¸¦ä¸èªè­˜ &lt;a href="https://en.wikipedia.org/wiki/St._Louis"&gt;St. Louis&lt;/a&gt; (STL) é€™åŸŽå¸‚èˆ‡ Washington University in St. Louis (WashU or WUSTL) é€™å­¸æ ¡ã€‚é¦–å…ˆé—œæ–¼ St. Louisï¼Œå®ƒæ˜¯ä¸€å€‹ç¾Žåœ‹ä¸­è¥¿éƒ¨çš„ä¸­åž‹åŸŽå¸‚ã€‚èˆ‡æ±è¥¿å²¸çš„åŸŽå¸‚ç›¸æ¯”ä¾†å¾—é„‰ä¸‹ï¼Œä½†å­¸æ ¡é™„è¿‘ä¹Ÿä¸æœƒæ˜¯ä¸€æœ›ç„¡éš›çš„ç”°é‡Žã€‚æ›¾ç¶“æ–¼ 19 ä¸–ç´€ç¾Žåœ‹è¥¿éƒ¨æ‹“è’æ™‚ï¼Œä½œç‚ºè¥¿é€²çš„é‡è¦é™¸æ²³äº¤é€šåŸ å£ï¼ŒåŸŽå¸‚çš„åœ°æ¨™æ˜¯ä¸€å€‹å¾ˆé«˜çš„æ‹±é–€ã€‚STL èˆ‰è¾¦éŽ 1904 å¹´å¤å­£å¥§é‹èˆ‡ä¸–ç•Œåšè¦½æœƒï¼Œå› æ­¤åŸŽå¸‚å¾ˆå¤šå»ºè¨­éƒ½æ˜¯åœ¨é‚£æ™‚å®Œæˆæˆ–æ›´æ–°ï¼ŒåŒ…å«æˆ‘å€‘å­¸æ ¡ä¸å°‘å»ºç¯‰ç‰©èˆ‡è¨­æ–½ã€‚&lt;/p&gt;
&lt;figure class="full-img"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/10/phd-life-in-st-louis/pics/stl_cardinals.jpg"/&gt;
  &lt;figcaption&gt;MLB ç´…é›€ (Cardinals) æ£’çƒéšŠä¸»å ´å ´åœ° Busch Stadiumã€‚èƒŒå¾Œçš„æ‹±é–€å³ç‚º St. Louis åœ°æ¨™ã€‚&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æ°£å€™å››å­£åˆ†æ˜Žã€‚å¤å¤©å¯ä»¥åˆ° 37Â°C (100Â°F)ã€‚ç›®å‰å‰›å…¥ç§‹å­£ï¼Œæ—©æ™šæº«å·®å¤§ (15 â€” 25Â°C)ï¼Œç·ŠæŽ¥è‘—çš„å†¬å­£æœƒæ›´åŠ å¯’å†·ï¼ˆ-5 â€” 10Â°C)ï¼Œä¸‹é›ªæ•¸å¤©ï¼Œä½†é€™å¯èƒ½ç­‰æˆ‘ç¶“æ­·éŽå†¬å¤©ä¹‹å¾Œæ‰èƒ½æ­£ç¢ºçš„æè¿°ã€‚ç”Ÿæ´»æ–¹é¢ï¼ŒåŸºæœ¬ä¸Šæ²’æœ‰ä»€éº¼ä¸ä¾¿ï¼Œä½†è·Ÿå¤§åŸŽå¸‚å¯èƒ½ä¸€äº›å¨›æ¨‚ä¼‘é–’æ´»å‹•æœƒå°‘ä¸€é»žï¼Œåœ¨åœ°çš„è¯äººç¤¾å€ä¹Ÿæ¯”è¼ƒå°ã€‚ä¸éŽåéŽä¾†èªªï¼Œç‰©åƒ¹è¼ƒä½Žï¼Œæˆ¿åƒ¹è¦ªæ°‘ã€‚ä¾†ä¹‹å‰æ›¾ç¶“æ“”å¿ƒç¶²è·¯é€Ÿåº¦ä¸å¤ å¿«ï¼Œå› ç‚ºå¤šæ•¸åœ°æ–¹ä¸¦æ²’æœ‰çµ¦ä½æ°‘ä½¿ç”¨çš„å…‰çº–ç¶²è·¯ï¼Œä¸éŽç›®å‰å¯¬é »æœ‰ 100MBps è€Œä¸”å¯¦éš›å‚³è¼¸èƒ½ç¶­æŒé€™å€‹é€Ÿåº¦ï¼Œå¶çˆ¾èƒ½æ›´å¿«ï¼Œå› æ­¤æš«æ™‚é‚„å¯ä»¥æŽ¥å—ã€‚å°ä¸€å€‹é˜¿å®…ä¾†èªªï¼Œç¶²è·¯å¤ å¿«å°±è¡¨ç¤ºèƒ½é€£æŽ¥åˆ°ä»–çš„å…¨ä¸–ç•Œäº†ã€‚&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/10/phd-life-in-st-louis/pics/stl_symphony_outdoor_concert.jpg"/&gt;
  &lt;figcaption&gt;STL äº¤éŸ¿æ¨‚åœ˜æ–¼ Forest Park èˆ‰è¾¦çš„æˆ¶å¤–éŸ³æ¨‚æœƒï¼Œåœ¨é€™é‚Šæ˜¯å€‹é—”å®¶å‡ºéŠçš„è¡Œç¨‹ã€‚ååœ¨è‰åœ°ä¸Šé‡Žé¤èˆ‡è½è¡¨æ¼”ã€‚&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æŽ¥ä¸‹ä¾†è«‡è«‡æˆ‘çš„å­¸æ ¡ï¼Œ&lt;a href="https://en.wikipedia.org/wiki/Washington_University_in_St._Louis"&gt;Washington University in St. Louis&lt;/a&gt;ï¼Œç°¡ç¨± WashU æˆ– WUSTLã€‚å› ç‚ºå¤ªå¤šå­¸æ ¡éƒ½ä»¥ Washington ç‚ºåï¼Œä¾‹å¦‚ Seattle æœ‰å€‹å…¬ç«‹å­¸æ ¡ UW (University of Washington)ï¼Œä½†å½¼æ­¤é–“ä¸¦æ²’æœ‰ä»»ä½•é—œä¿‚ã€‚è¬› WashU å¸¸å¸¸æœƒèª¤æœƒï¼Œå› æ­¤å¸¸æœƒå¯« WUSTL ä¾†å€åˆ†ï¼Œé€™ä¹Ÿæ˜¯å­¸æ ¡çš„ domain nameã€‚åº•ä¸‹å°±æ˜¯æˆ‘å€‘å­¸æ ¡çš„åœ°ç†ä½ç½®ï¼š&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/10/phd-life-in-st-louis/pics/WUSTL_map.png"/&gt;
  &lt;p class="caption"&gt;WUSTL æ ¡å€ä½ç½®ã€‚
    Ref: &lt;a href="http://www.openstreetmap.org/#map=15/38.6373/-90.2829&amp;layers=T"&gt;OpenStreetMap&lt;/a&gt;
  &lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;å­¸æ ¡è¢«ä¸­é–“ä¸€å€‹å¤§å…¬åœ’åˆ‡å‰²æˆå…©å¤§æ ¡å€ã€‚è¥¿é‚Šçš„æ˜¯ä¸»æ ¡å€ï¼Œå¤§å¤šæ•¸çš„å­¸é™¢éƒ½åœ¨æ­¤ã€‚æ±é‚Šå‰‡æ˜¯é†«å­¸é™¢æ ¡å€ï¼ŒåŒ…å«è«¸å¤šé†«é™¢ï¼Œèˆ‡ç”Ÿé†«ç ”ç©¶ç›¸é—œçš„ç§‘ç³»ã€‚æˆ‘å°±è®€çš„ç§‘ç³»å³åœ¨æ±é‚Šçš„é†«å­¸é™¢æ ¡å€ã€‚æˆ‘çš„æ„Ÿè¦ºå°å¤§å…¬é¤¨æ ¡å€èˆ‡å­¸æ ¡å·®ä¸å¤šå¤§ã€‚ä¸­é–“çš„å¤§å…¬åœ’ Forest Park é•·å¯¬ 2.5 x 1.6 kmï¼Œå³æ˜¯ä¸–åšæœƒçš„ä¸»å ´åœ°ï¼Œç›®å‰è£¡é¢æœ‰åšç‰©é¤¨ã€æ¤ç‰©åœ’ã€å‹•ç‰©åœ’ç­‰ç­‰ï¼Œè¨±å¤šæˆ¶å¤–æ´»å‹•èˆ‰è¾¦æ–¼æ­¤ï¼ŒåŒæ™‚ä¹Ÿæ˜¯å¥èº«åŽ»è™•ã€‚&lt;/p&gt;
&lt;p&gt;è¥¿é‚Šçš„ä¸»æ ¡å€å»ºç¯‰ç‰©ç‚ºå­¸é™¢æ­Œå¾·å¼ (Collegiate Gothic)ï¼Œéžå¸¸æ¼‚äº®ï¼Œå¦‚åŒæ¦‚å¿µä¸­å¤è€çš„å¤§å­¸æœ‰çš„æ¨¡æ¨£ï¼Œå¯¦éš›ä¸Šå­¸æ ¡ä¹Ÿå·²å‰µç«‹ 160 å¤šå¹´ã€‚é›–ç„¶èªªå­¸æ ¡åœ¨å°ç£æ²’ä»€éº¼çŸ¥ååº¦ï¼Œä½†é‚„ç®—æ˜¯å€‹ä»¥ç ”ç©¶ç‚ºå°Žå‘çš„ç§ç«‹ã€Œä¸–ç•Œç™¾å¤§ã€å­¸æ ¡ï¼Œæœ‰ 25 ä½è«¾è²çˆ¾çŽå¾—ä¸»ã€‚é›–ç„¶çœ‹èµ·ä¾†èˆŠï¼Œä½†å­¸æ ¡ä¸€ç›´éƒ½åœ¨æ•´ä¿®æˆ–å»ºæ–°çš„å¤§æ¨“ï¼Œä»–å€‘æœƒç¶­æŒç¾æœ‰å»ºç‰©çš„é¢¨æ ¼ã€‚&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/10/phd-life-in-st-louis/pics/wustl_campus.jpg"/&gt;
  &lt;figcaption&gt;è¥¿é‚Šä¸»æ ¡å€ (Danforth Campus) æ ¡é–€å…¥å£å»ºç¯‰ Brookings Hallã€‚&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;é†«å­¸é™¢ç›¸è¼ƒè€Œè¨€å°±æ˜¯æ¯”è¼ƒç¾ä»£çš„æ ¡å€ï¼Œä¾‹å¦‚ä¸‹åœ–å°±æ˜¯æˆ‘å¯¦é©—å®¤çš„æ‰€åœ¨å»ºç¯‰ã€‚&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/10/phd-life-in-st-louis/pics/mckinley_building.jpg"/&gt;
  &lt;figcaption&gt;McKinley Research Buildingï¼Œæ–¼ 2015 å¹´è½æˆã€‚&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;é—œæ–¼ç ”ç©¶çš„è©±ï¼Œå°±ä¸åˆ—åœ¨é€™é‚Šäº†ï¼Œä¹Ÿç­‰ä¹‹å¾Œæ›´ç†Ÿæ‚‰ç’°å¢ƒå†ä¾†åˆ†äº«ã€‚å¦‚æžœä½ å°ç”³è«‹ PhD çš„éŽç¨‹æœ‰èˆˆè¶£çš„è©±ï¼Œæˆ‘æœ‰å¯«äº†ä¸€ç¯‡ &lt;a href="https://www.ptt.cc/bbs/studyabroad/M.1462818195.A.882.html"&gt;PhD ç”³è«‹æº–å‚™åœ¨ ptt&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="whats-next"&gt;Whatâ€™s Next?&lt;/h2&gt;
&lt;p&gt;èŠ±äº†ä¸€é»žæ™‚é–“å®‰é “ï¼Œç¾åœ¨é€™é‚Šçš„ç”Ÿæ´»å…¶å¯¦æœ‰ç›¸ç•¶å¤šçš„å€‹äººæ™‚é–“ï¼Œé™¤äº†ä¸€å¹´ç´šæœ‰èª²è·Ÿä½œæ¥­è¦æº–å‚™å¤–ï¼Œé‚„æ˜¯æœ‰ä¸€äº›è‡ªå·±çš„æ™‚é–“ã€‚ç›®å‰æˆ‘å·²ç¶“ç´¯ç©äº† 6 ç¯‡è‰ç¨¿ï¼Œå¤§éƒ¨ä»½æ˜¯é—œæ–¼ Djangoï¼Œä½†ç¢©ç­ç•¢æ¥­ä¹‹å¾Œï¼Œå°±ä¸å¤ªæœ‰æ©Ÿæœƒå†å¯«ç¶²ç«™ï¼Œç›´åˆ°æœ€è¿‘å¹«å¯¦é©—å®¤åšäº†å€‹ proposal review system æ‰åˆç¢°äº†ä¸€ä¸‹ã€‚æœ‰æ©Ÿæœƒæœƒæ•´ç†å®ƒå€‘ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å°ç£é‚„æœ‰ Python æ–‡ä»¶ç¿»è­¯é€™å€‹å°ˆæ¡ˆï¼Œå¾ˆå¯æƒœæ²’è¾¦æ³•åœ¨é›¢é–‹å‰å®Œæˆï¼Œä½†é€™å€‹æ˜¯æˆ‘ä»Šå¹´çš„ç›®æ¨™ã€‚ç›®å‰æ˜¯å€‹æ“ºè‘—è®“å®ƒè‡ªç”±ç™¼å±•çš„ç‹€æ…‹ï¼Œä½†æˆ‘æƒ³åœ¨å¹´åº• &lt;a href="https://www.python.org/dev/peps/pep-0494/"&gt;Python 3.6 æ–°ç‰ˆæœ¬é‡‹å‡º&lt;/a&gt;ä¹‹å‰æŠŠ tutorial éƒ¨ä»½å‘Šä¸€æ®µè½ã€‚é™¤äº†é€™å°ˆæ¡ˆä¹‹å¤–ï¼Œé‡æ–°å­¸ç¿’ Cï¼Œä»¥åŠçœ‹äº†äº› Rust çš„æ±è¥¿ï¼Œå¤šç·´ç¿’åŸºæœ¬åŠŸã€‚é‚„æ²’æœ‰åŠ å…¥ç•¶åœ°å¯¦é«”çš„é–‹æºç¤¾ç¾¤ï¼ŒåŠ ä¸Šæ™šä¸Šæ´»å‹•ä¹Ÿæ¯”åœ¨å°ç£å±éšªä¸€é»žã€‚ä¸éŽåœ¨ç¾Žåœ‹æ™‚å€ï¼Œä¸è«– IRC æˆ– mail list éƒ½èƒ½è¼•é¬†è·Ÿåˆ°è¨Žè«–ï¼Œå€’ä¹Ÿä¸æœƒè¦ºå¾—æ²’è¾¦æ³•æŽ¥å—æ–°çŸ¥ã€‚ç›®æ¨™åƒåŠ æ˜Žå¹´çš„ PyCon USã€‚&lt;/p&gt;
&lt;p&gt;é †å¸¶ä¸€æï¼Œéƒ¨è½æ ¼ä¹Ÿæ›äº†æ–°çš„ä¸»é¡Œï¼Œé¢¨æ ¼æ¯”è¼ƒåƒ Mediumï¼Œæ‡‰è©²æ¯”è¼ƒå¥½é–±è®€ã€‚ä¸éŽæˆ‘é‚„æ²’ç©ºæŠŠç´°ç¯€èª¿æ•´å¥½ï¼Œç›®å‰ç¶­æŒè‘—åªè¦é‚„ä¸æœƒå¾ˆä¸é †çœ¼ï¼Œå°±ç¶­æŒç¾ç‹€çš„åšæ³•ã€‚å¸Œæœ›ä¸ä¹…å¾Œåˆèƒ½æ¢å¾©å®šæœŸç™¼æ–‡ã€‚&lt;/p&gt;</content><category term="misc"></category><category term="zh"></category></entry><entry><title>ä½¿ç”¨ conda env éƒ¨ç½² Django</title><link href="https://blog.liang2.tw/posts/2016/05/django-deploy-conda/" rel="alternate"></link><published>2016-05-24T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-05-24:/posts/2016/05/django-deploy-conda/</id><summary type="html">&lt;p&gt;æ²’å¹¾å¤©å‰å‰›éƒ¨ç½²ä¸€æ¬¡ Djangoï¼Œè¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/"&gt;ã€Šä½¿ç”¨ uWSGIã€nginxã€systemd éƒ¨ç½² Djangoã€‹&lt;/a&gt;ã€‚ä»Šå¤©åˆéƒ¨ç½²äº†å¦ä¸€å€‹å°ˆæ¡ˆã€‚éƒ¨ç½²çš„è¨­å®šè·Ÿä¸Šæ¬¡ä¸€æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nginx -- unix socket -- uWSGI -- Django
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸€æ¨£å¯« â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æ²’å¹¾å¤©å‰å‰›éƒ¨ç½²ä¸€æ¬¡ Djangoï¼Œè¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/"&gt;ã€Šä½¿ç”¨ uWSGIã€nginxã€systemd éƒ¨ç½² Djangoã€‹&lt;/a&gt;ã€‚ä»Šå¤©åˆéƒ¨ç½²äº†å¦ä¸€å€‹å°ˆæ¡ˆã€‚éƒ¨ç½²çš„è¨­å®šè·Ÿä¸Šæ¬¡ä¸€æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nginx -- unix socket -- uWSGI -- Django
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸€æ¨£å¯«ä¸€å€‹ &lt;code&gt;PROJ.service&lt;/code&gt; çš„ systemd unit ä¾†ç®¡ç†ç¶²ç«™çš„å•Ÿå‹• (uWSGI)ã€‚ä¹‹å¾Œæåˆ° &lt;code&gt;PROJ&lt;/code&gt; æ™‚å°±æ›æˆè‡ªå·±çš„å°ˆæ¡ˆåç¨±ï¼›&lt;code&gt;USER&lt;/code&gt; å°±æ›æˆåŸ·è¡Œç¶²ç«™çš„å¸³è™Ÿã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#conda"&gt;conda&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#uwsgi-path"&gt;uWSGI å’Œ $PATH&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sysmted-unit"&gt;åœ¨ sysmted unit ä½¿ç”¨ç’°å¢ƒè®Šæ•¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;çµè«–&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="conda"&gt;conda&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://conda.pydata.org/"&gt;conda&lt;/a&gt; æ˜¯ä¸€å€‹ Python å¥—ä»¶çš„ç®¡ç†ç³»çµ±ï¼Œä»–çš„å¥½è™•æ˜¯ï¼Œé‡åˆ°è¦ä½¿ç”¨å¤–éƒ¨ library æ™‚ï¼Œæœƒé€™äº›å¥—ä»¶ç›¸ä¾çš„ library éƒ½ä¸€ä½µå®‰è£ç®¡ç†ï¼Œä¹Ÿå¯ä»¥ç®¡ç†ä¸åŒ Python ç‰ˆæœ¬ã€‚å¯ä»¥æƒ³åƒæ˜¯åŠ å¼·ç‰ˆçš„ pip + venvã€‚conda è·Ÿ pip æ˜¯ç›¸å®¹çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹ Django å°ˆæ¡ˆå°±ç”¨åˆ°å¾ˆå¤šåƒ numpyã€pandas çš„å¥—ä»¶ã€‚ç‚ºäº†ç¶­è­·æ–¹ä¾¿ï¼Œæˆ‘è€ƒæ…®ç”¨ conda ä¾†å®‰è£ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ &lt;a href="http://conda.pydata.org/miniconda.html"&gt;miniconda3&lt;/a&gt;ï¼Œé è¨­æœƒå®‰è£åœ¨ &lt;code&gt;~/miniconda3&lt;/code&gt; åº•ä¸‹ï¼Œè™›æ“¬ç’°å¢ƒæœƒå‡ºç¾åœ¨ &lt;code&gt;~/miniconda3/envs/&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ conda create -n VENV &lt;span class="nv"&gt;python&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.5 numpy pandas django
$ &lt;span class="nb"&gt;source&lt;/span&gt; activate VENV
&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ pip install uwsgi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;uWSGI æ²’æœ‰åœ¨ conda è£¡é¢ï¼Œæ‰€ä»¥å°±ç”¨ pip è£ã€‚å¾ž&lt;a href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/"&gt;ä¸Šæ¬¡çš„æ–‡ç« &lt;/a&gt;çŸ¥é“ç³»çµ±ä¸¦ä¸ç”¨å®‰è£ã€‚&lt;/p&gt;
&lt;h3 id="uwsgi-path"&gt;uWSGI å’Œ $PATH&lt;/h3&gt;
&lt;p&gt;ç†è«–ä¸Šï¼Œä¹‹å¾Œå°±ç…§è‘—ä¸Šæ¬¡æ“ä½œå°±å¥½ï¼Œä½†åœ¨ uWSGI å°±ç¢°åˆ°å•é¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;$ sudo /home/USER/miniconda3/envs/VENV/bin/uwsgi --ini PROJ.ini&lt;/span&gt;
&lt;span class="go"&gt;[uWSGI] getting INI configuration from PROJ.ini&lt;/span&gt;
&lt;span class="go"&gt;*** Starting uWSGI 2.0.13.1 (64bit) on [Wed May 25 08:04:23 2016] ***&lt;/span&gt;
&lt;span class="go"&gt;compiled with version: 5.3.1 20160413 on 25 May 2016 01:35:28&lt;/span&gt;
&lt;span class="go"&gt;os: Linux-4.4.0-22-generic #40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016&lt;/span&gt;
&lt;span class="go"&gt;nodename: s66&lt;/span&gt;
&lt;span class="go"&gt;machine: x86_64&lt;/span&gt;
&lt;span class="go"&gt;clock source: unix&lt;/span&gt;
&lt;span class="go"&gt;detected number of CPU cores: 24&lt;/span&gt;
&lt;span class="go"&gt;current working directory: /etc/uwsgi/vassals&lt;/span&gt;
&lt;span class="go"&gt;detected binary path: /home/USER/miniconda3/envs/VENV/bin/uwsgi&lt;/span&gt;
&lt;span class="go"&gt;â€¦â€¦&lt;/span&gt;
&lt;span class="go"&gt;chdir() to /path/to/PROJ/&lt;/span&gt;
&lt;span class="go"&gt;your processes number limit is 514650&lt;/span&gt;
&lt;span class="go"&gt;your memory page size is 4096 bytes&lt;/span&gt;
&lt;span class="go"&gt;detected max file descriptor number: 1024&lt;/span&gt;
&lt;span class="go"&gt;lock engine: pthread robust mutexes&lt;/span&gt;
&lt;span class="go"&gt;thunder lock: disabled (you can enable it with --thunder-lock)&lt;/span&gt;
&lt;span class="go"&gt;uwsgi socket 0 bound to UNIX address /run/PROJ/django.sock fd 3&lt;/span&gt;
&lt;span class="go"&gt;Python version: 3.5.1 |Continuum Analytics, Inc.| (default, Dec  7 2015, 11:16:01)  [GCC 4.4.7 20120313 (Red Hat 4.4.7-1)]&lt;/span&gt;
&lt;span class="go"&gt;Set PythonHome to /home/USER/miniconda3/envs/VENV&lt;/span&gt;
&lt;span class="go"&gt;Failed to import the site module&lt;/span&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/usr/lib/python3.5/site.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;580&lt;/span&gt;, in &lt;span class="n"&gt;&amp;lt;module&amp;gt;&lt;/span&gt;
    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gr"&gt;  â€¦â€¦ &lt;/span&gt;
&lt;span class="gr"&gt;  File &amp;quot;/usr/lib/python3.5/_sysconfigdata.py&amp;quot;, line 6, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="gr"&gt;    from _sysconfigdata_m import *&lt;/span&gt;
&lt;span class="gr"&gt;ImportError&lt;/span&gt;: &lt;span class="n"&gt;No module named &amp;#39;_sysconfigdata_m&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½†å› ç‚ºæ­¥é©Ÿå¯¦åœ¨å¤ªç°¡å–®ï¼Œæƒ³ä¸å‡ºä¾†å“ªè£¡æœ‰éŒ¯ï¼ŒæŸ¥ç¶²è·¯ä¹Ÿæ²’ä»€éº¼ç›¸é—œçš„çµæžœã€‚åœ¨é€™é‚Šå¡äº†å¾ˆä¹…ã€‚&lt;/p&gt;
&lt;p&gt;çµæžœå¾Œä¾†æ‰ç™¼ç¾ï¼ŒTraceback é‚£é‚Š uWSGi è·‘åŽ»è®€åˆ° &lt;code&gt;/usr/lib/python3.5/site.py&lt;/code&gt;ï¼Œé€™è¡¨ç¤ºä¸€å®šæœ‰ç’°å¢ƒè¨­éŒ¯æ‰è®“å®ƒæ‰¾åˆ°é€™å€‹ä¸æ˜¯æˆ‘å€‘è¦çš„ python ç’°å¢ƒï¼Œç†è«–ä¸Šæ‡‰è©²æ˜¯æ‰¾åˆ° &lt;code&gt;/home/USER/miniconda3/envs/VENV/lib/python3.5/site.py&lt;/code&gt; æ‰å°ã€‚&lt;/p&gt;
&lt;p&gt;ç¶“éŽä¸€é™£å˜—è©¦ï¼Œç™¼ç¾åªè¦ä¿®æ”¹ &lt;code&gt;$PATH&lt;/code&gt; ç’°å¢ƒè®Šæ•¸å°±èƒ½é‹ä½œäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -i
&lt;span class="gp"&gt;# &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$PATH&lt;/span&gt;
&lt;span class="go"&gt;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&lt;/span&gt;
&lt;span class="gp"&gt;# &lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/USER/miniconda3/envs/VENV/bin:&lt;span class="nv"&gt;$PATH&lt;/span&gt;
&lt;span class="gp"&gt;# &lt;/span&gt;/home/USER/miniconda3/envs/VENV/bin/uwsgi --ini PROJ.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="sysmted-unit"&gt;åœ¨ sysmted unit ä½¿ç”¨ç’°å¢ƒè®Šæ•¸&lt;/h3&gt;
&lt;p&gt;æ ¹æ“š &lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#%24PATH"&gt;systemd.exec(5)&lt;/a&gt; é—œæ–¼ &lt;code&gt;$PATH&lt;/code&gt; ç’°å¢ƒè®Šæ•¸çš„ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Colon-separated list of directories to use when launching executables. Systemd uses a fixed value of /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é è¨­åªæœ‰ä»¥ä¸Šæåˆ°çš„è·¯å¾‘ï¼Œå¦‚æžœè¦ä¿®æ”¹ç’°å¢ƒè®Šæ•¸çš„è©±ï¼Œå°±é€éŽ &lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Environment="&gt;&lt;code&gt;Environment=&lt;/code&gt;&lt;/a&gt;ï¼Œå› æ­¤å¤šåŠ äº†ä¸€è¡Œåœ¨ systemd unit è£¡ã€‚å…¶é¤˜çš„è¨­å®šéƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Unit]
Description=PROJ Django server by uWSGI
After=syslog.target

[Service]
Environment=&amp;quot;PATH=/home/USER/miniconda3/envs/VENV/bin:$PATH&amp;quot;
ExecStart=/home/USER/miniconda3/envs/VENV/bin/uwsgi --ini /etc/uwsgi/vassals/PROJ.ini
Restart=always
KillSignal=SIGQUIT
Type=notify
StandardError=syslog
NotifyAccess=all

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="_1"&gt;çµè«–&lt;/h3&gt;
&lt;p&gt;å¦‚æžœè¦æ”¹ç”¨ conda ç®¡ç†å¥—ä»¶çš„è©±ï¼Œåªè¦åœ¨ systemd unit é‚£é‚Šå¤šåŠ ä¸€è¡Œä¿®æ”¹ $PATHï¼ŒåŠ å…¥è™›æ“¬ç’°å¢ƒæ”¾åŸ·è¡Œæª”çš„è·¯å¾‘ï¼Œå…¶é¤˜çš„è¨­å®šéƒ½èˆ‡ä¸€èˆ¬ Python è™›æ“¬ç’°å¢ƒç›¸åŒã€‚é€™æ¨£å°±æžå®šäº†ã€‚ä½†é€™å€‹å•é¡ŒèŠ±äº†æˆ‘ 1 å€‹å¤šå°æ™‚â€¦â€¦&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="python"></category><category term="django"></category><category term="postgresql"></category><category term="deploy"></category><category term="debian"></category><category term="systemd"></category><category term="nginx"></category><category term="uwsgi"></category><category term="conda"></category></entry><entry><title>Ensembl Genomic Reference in Bioconductor</title><link href="https://blog.liang2.tw/posts/2016/05/biocondutor-ensembl-reference/" rel="alternate"></link><published>2016-05-21T18:00:00-05:00</published><updated>2022-05-13T12:53:46-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-05-21:/posts/2016/05/biocondutor-ensembl-reference/</id><summary type="html">&lt;p&gt;Using fundamental R/Biocondcutor packages (e.g. AnnotationHub, ensembldb and biomaRt) to query Ensembl genomic references or annotations.&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; I gave a talk &lt;a href="https://blog.liang2.tw/2016Talk-Genomics-in-R/"&gt;Genomics in R&lt;/a&gt; about querying genomic annotations and references in R/Bioconductor. In this post, we re-visit all the operations in my talk using Ensembl references instead of UCSC/NCBI ones.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This post is part of the &amp;ldquo;&lt;a href="https://blog.liang2.tw/posts/2015/12/biocondutor-genomic-data/"&gt;Genomic Data Processing in Bioconductor&lt;/a&gt;&amp;rdquo; series. In that post, I mentioned several topics critical for genomic data analysis in Bioconductor:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Annotation and genome reference (OrgDb, TxDb, OrganismDb, BSgenome)&lt;/li&gt;
&lt;li&gt;Experiment data storage (ExpressionSets)&lt;/li&gt;
&lt;li&gt;Operations on genome (GenomicRanges)&lt;/li&gt;
&lt;li&gt;Genomic data visualization (Gviz, ggbio)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Few days ago in a local R community meetup, I gave a talk &lt;a href="https://blog.liang2.tw/2016Talk-Genomics-in-R/"&gt;&lt;em&gt;Genomics in R&lt;/em&gt;&lt;/a&gt; covering the &amp;ldquo;Annotation and genome reference&amp;rdquo; part and a quick glance through &amp;ldquo;Operations on genome&amp;rdquo;, which should be sufficient for daily usage such as searching annotations in the subset of some genomic ranges. You can find the &lt;a href="https://blog.liang2.tw/2016Talk-Genomics-in-R/"&gt;slides&lt;/a&gt;, the &lt;a href="https://www.youtube.com/watch?v=ZR4GYQ487j8"&gt;meetup screencast&lt;/a&gt; (in Chinese) and the &lt;a href="https://github.com/ccwang002/2016Talk-Genomics-in-R"&gt;accompanied source code&lt;/a&gt; online. I don&amp;rsquo;t think a write-up is needed for the talk. But if anyone is interested, feel free to drop your reply below. :)&lt;/p&gt;
&lt;h3 id="fundamental-bioconductor-packages"&gt;Fundamental Bioconductor packages&lt;/h3&gt;
&lt;p&gt;Some Bioconductor packages are the building blocks for genomic data analysis. I put a table here containing all the classes covered in rest of the post. If you are not familiar with these classes and their methods, go through the &lt;a href="https://blog.liang2.tw/2016Talk-Genomics-in-R/"&gt;talk slides&lt;/a&gt; first, or at least follow the &lt;a href="https://bioconductor.org/help/workflows/annotation/annotation/"&gt;annotation workflow&lt;/a&gt; on Bioconductor.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;R Class&lt;/th&gt;
&lt;th style="text-align: left;"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;code&gt;OrgDb&lt;/code&gt;&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Gene-based information for Homo sapiens; useful for mapping between gene IDs, Names, Symbols, GO and KEGG identifiers, etc.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;code&gt;TxDb&lt;/code&gt;&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Transcriptome ranges for the known gene track of Homo sapiens, e.g., introns, exons, UTR regions.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;code&gt;OrganismDb&lt;/code&gt;&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Collection of multiple annotations for a common organism and genome build.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;code&gt;BSgenome&lt;/code&gt;&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Full genome sequence for Homo sapiens.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;code&gt;AnnotationHub&lt;/code&gt;&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Provides a convenient interface to annotations from many different sources; objects are returned as fully parsed Bioconductor data objects or as the name of a file on disk.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="ensembl-genome-browser-and-its-ecosystem"&gt;Ensembl genome browser and its ecosystem&lt;/h3&gt;
&lt;p&gt;In Bioconductor, most annotations are built against NCBI and UCSC naming systems, which are also used in my talk. However, there is another naming system maintained by &lt;a href="http://www.ensembl.org/index.html"&gt;Ensembl&lt;/a&gt;, whose IDs are very recognizable with suffix &amp;ldquo;ENSG&amp;rdquo; and &amp;ldquo;ENST&amp;rdquo; for gene and transcript respectively.&lt;/p&gt;
&lt;p&gt;I particularly enjoy the Ensembl genome browser. The information is well organized and structured. For example, take a look at the description page of &lt;a href="http://www.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g=ENSG00000100030"&gt;gene MAPK1&lt;/a&gt;,&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/05/biocondutor-ensembl-reference/pics/gene_MAPK1_ensembl_browser.png"&gt;
  &lt;p class="caption center"&gt;Gene information page of MAP1 on Ensembl Genome Browser release 84 (&lt;a href="http://www.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g=ENSG00000100030"&gt;link&lt;/a&gt;)&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;The &lt;a href="http://www.ensembl.org/Homo_sapiens/Gene/Compara_Tree?db=core;g=ENSG00000100030"&gt;gene tree&lt;/a&gt; tab shows its homologs and paralogs. The &lt;a href="http://www.ensembl.org/Homo_sapiens/Gene/Variation_Gene/Table?db=core;g=ENSG00000100030"&gt;variant table&lt;/a&gt; tab shows various kinds of SNPs within MAPK1&amp;rsquo;s transcript region. SNPs are annotated with their sources, different levels of supporting evidence, and SIFT/PolyPhen prediction on protein function change. Finally, there is a &lt;a href="http://www.ensembl.org/Homo_sapiens/Gene/Matches?db=core;g=ENSG00000100030"&gt;external references&lt;/a&gt; tab which links the Ensembl IDs with &lt;a href="https://www.ncbi.nlm.nih.gov/CCDS/CcdsBrowse.cgi"&gt;NCBI CCDS&lt;/a&gt; and &lt;a href="http://www.ncbi.nlm.nih.gov/refseq/"&gt;NCBI RefSeq&lt;/a&gt; IDs. There are many ways to explore different aspects of this gene, and it seems everything at multiple biological levels is simply connected.&lt;/p&gt;
&lt;p&gt;I always think of the Ensembl ecosystem as a decent learning portal, so it is a pity if one cannot easily use its information in R/Bioconductor. After a quick research, I found using Ensembl annotations are quite straightforward even though the required files does not ship with Bioconductor. Also, there were some topics I failed to mention in the talk, such as AnnotationHub and genomic coordinate system conversion (e.g., from hg19 to hg38). I am going to cover these topics in the talk.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#fundamental-bioconductor-packages"&gt;Fundamental Bioconductor packages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#ensembl-genome-browser-and-its-ecosystem"&gt;Ensembl genome browser and its ecosystem&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#orgdb"&gt;OrgDb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#txdb"&gt;TxDb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bsgenome-and-annotationhub"&gt;BSgenome and AnnotationHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#biomart"&gt;biomaRt&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#compatibility-with-annotationdbs-interface"&gt;Compatibility with AnnotationDb&amp;rsquo;s interface&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#biomarts-original-interface"&gt;biomaRt&amp;rsquo;s original interface&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conversion-between-genomic-coordinate-systems"&gt;Conversion between genomic coordinate systems&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="orgdb"&gt;OrgDb&lt;/h2&gt;
&lt;p&gt;The same OrgDb object for human (&lt;code&gt;org.Hs.eg.db&lt;/code&gt;) can be used. It relates different gene IDs, including Entrez and Ensembl gene ID. From its metadata, human&amp;rsquo;s OrgDb gets updated frequently. Most of its data source were fetched during this March. So one should be able to use it for both hg19 and hg38 human reference.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;org.Hs.eg.db&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;human&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;org.Hs.eg.db&lt;/span&gt;

&lt;span class="n"&gt;mapk_gene_family_info&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;human&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;MAPK1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MAPK3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MAPK6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;keytype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SYMBOL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ENTREZID&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ENSEMBL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GENENAME&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mapk_gene_family_info&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;SYMBOL&lt;/th&gt;
&lt;th style="text-align: left;"&gt;ENTREZID&lt;/th&gt;
&lt;th style="text-align: left;"&gt;ENSEMBL&lt;/th&gt;
&lt;th style="text-align: left;"&gt;GENENAME&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;MAPK1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;5594&lt;/td&gt;
&lt;td style="text-align: left;"&gt;ENSG00000100030&lt;/td&gt;
&lt;td style="text-align: left;"&gt;mitogen-activated protein kinase 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;MAPK3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;5595&lt;/td&gt;
&lt;td style="text-align: left;"&gt;ENSG00000102882&lt;/td&gt;
&lt;td style="text-align: left;"&gt;mitogen-activated protein kinase 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;MAPK6&lt;/td&gt;
&lt;td style="text-align: left;"&gt;5597&lt;/td&gt;
&lt;td style="text-align: left;"&gt;ENSG00000069956&lt;/td&gt;
&lt;td style="text-align: left;"&gt;mitogen-activated protein kinase 6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Here comes a small pitfall for Ensembl annotation. We cannot sufficiently map Ensembl&amp;rsquo;s gene ID to its transcript ID,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;human&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mapk_gene_family_info&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;ENSEMBL&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;
    &lt;span class="n"&gt;keytype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ENSEMBL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ENSEMBLTRANS&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# &amp;#39;select()&amp;#39; returned 1:1 mapping between keys and columns&lt;/span&gt;
&lt;span class="c1"&gt;#           ENSEMBL ENSEMBLTRANS&lt;/span&gt;
&lt;span class="c1"&gt;# 1 ENSG00000100030         &amp;lt;NA&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We got &lt;em&gt;no&lt;/em&gt; Ensembl transcript ID for MAPK1, which is impossible. Therefore, to find the real Ensembl transcript IDs, we need to find other references.&lt;/p&gt;
&lt;h2 id="txdb"&gt;TxDb&lt;/h2&gt;
&lt;p&gt;There is no pre-built Ensembl TxDb object available on Bioconductor. But with the help of &lt;a href="http://bioconductor.org/packages/release/bioc/html/ensembldb.html"&gt;ensembldb&lt;/a&gt;, we can easily build the TxDb ourselves.&lt;/p&gt;
&lt;p&gt;Following the instructions in ensembldb&amp;rsquo;s &lt;a href="http://bioconductor.org/packages/release/bioc/vignettes/ensembldb/inst/doc/ensembldb.html"&gt;vignette file&lt;/a&gt;, we can build the TxDb object from the Ensembl latest release, which is release 84 (Mar, 2016) at the time of writing. Ensembl releases all human transcript records as GTF file, which can be found here &lt;a href="ftp://ftp.ensembl.org/pub/release-84/gtf/homo_sapiens/Homo_sapiens.GRCh38.84.gtf.gz"&gt;ftp://ftp.ensembl.org/pub/release-84/gtf/homo_sapiens/Homo_sapiens.GRCh38.84.gtf.gz&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;After processing GTF file via &lt;code&gt;ensDbFromGtf()&lt;/code&gt;, the generated data for creating the TxDb object will be stored in a SQLite3 database file &lt;code&gt;Homo_sapiens.GRCh38.84.sqlite&lt;/code&gt; at the R working directory. Building TxDB is just one command away, &lt;code&gt;EnsDb()&lt;/code&gt;. Putting two commands together, the script for building Ensembl TxDb is listed below. To prevent from rebuilding the TxDb every time the script is executed, we first check if the sqlite file exists,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# xxx_DB in the vignette is just a string to the SQLite db file path&lt;/span&gt;
&lt;span class="n"&gt;ens84_txdb_pth&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;./Homo_sapiens.GRCh38.84.sqlite&amp;#39;&lt;/span&gt;
&lt;span class="nf"&gt;if &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nf"&gt;file.exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ens84_human_txdb_pth&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;ens84_txdb_pth&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;ensDbFromGtf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gtf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Homo_sapiens.GRCh38.84.gtf.gz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;txdb_ens84&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;EnsDb&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ens84txdb_pth&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;txdb_ens84&lt;/span&gt;  &lt;span class="c1"&gt;# Preview the metadata&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The filtering syntax for finding desired genes or transcripts is different to the built-in TxDb object,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;transcripts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;txdb_ens84&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nf"&gt;GeneidFilter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mapk_gene_family_info&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;ENSEMBL&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]])&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# GRanges object with 4 ranges and 5 metadata columns:&lt;/span&gt;
&lt;span class="c1"&gt;#                   seqnames               ranges strand |           tx_id           tx_biotype&lt;/span&gt;
&lt;span class="c1"&gt;#                      &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt; |     &amp;lt;character&amp;gt;          &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000215832       22 [21754500, 21867629]      - | ENST00000215832       protein_coding&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000491588       22 [21763984, 21769428]      - | ENST00000491588 processed_transcript&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000398822       22 [21769040, 21867680]      - | ENST00000398822       protein_coding&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000544786       22 [21769204, 21867440]      - | ENST00000544786       protein_coding&lt;/span&gt;
&lt;span class="c1"&gt;#                   tx_cds_seq_start tx_cds_seq_end         gene_id&lt;/span&gt;
&lt;span class="c1"&gt;#                          &amp;lt;numeric&amp;gt;      &amp;lt;numeric&amp;gt;     &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000215832         21769204       21867440 ENSG00000100030&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000491588             &amp;lt;NA&amp;gt;           &amp;lt;NA&amp;gt; ENSG00000100030&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000398822         21769204       21867440 ENSG00000100030&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000544786         21769204       21867440 ENSG00000100030&lt;/span&gt;
&lt;span class="c1"&gt;#   -------&lt;/span&gt;
&lt;span class="c1"&gt;#   seqinfo: 1 sequence from GRCh38 genome&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So filtering is done by passing special filter functions to &lt;code&gt;filter=&lt;/code&gt;. Likewise, there are &lt;code&gt;TxidFilter&lt;/code&gt;, &lt;code&gt;TxbiotypeFilter&lt;/code&gt;, and &lt;code&gt;GRangesFilter&lt;/code&gt; for filtering on the respective columns.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;tx_gr&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;transcripts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;txdb_ens84&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nf"&gt;TxidFilter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ENST00000215832&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tr_gr&lt;/span&gt;
&lt;span class="c1"&gt;# GRanges object with 1 range and 5 metadata columns:&lt;/span&gt;
&lt;span class="c1"&gt;#                   seqnames               ranges strand |           tx_id     tx_biotype tx_cds_seq_start tx_cds_seq_end         gene_id&lt;/span&gt;
&lt;span class="c1"&gt;#                      &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt; |     &amp;lt;character&amp;gt;    &amp;lt;character&amp;gt;        &amp;lt;numeric&amp;gt;      &amp;lt;numeric&amp;gt;     &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#   ENST00000215832       22 [21754500, 21867629]      - | ENST00000215832 protein_coding         21769204       21867440 ENSG00000100030&lt;/span&gt;
&lt;span class="c1"&gt;#   -------&lt;/span&gt;
&lt;span class="c1"&gt;#   seqinfo: 1 sequence from GRCh38 genome&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Check the result with the online Ensembl genome browser. Note that Ensembl release 84 use hg38.&lt;/p&gt;
&lt;h2 id="bsgenome-and-annotationhub"&gt;BSgenome and AnnotationHub&lt;/h2&gt;
&lt;p&gt;We can load the sequence from &lt;code&gt;BSgenome.Hsapiens.UCSC.hg38&lt;/code&gt;, however, we can obtain the genome (chromosome) sequence of Ensembl using &lt;a href="https://bioconductor.org/packages/release/bioc/html/AnnotationHub.html"&gt;AnnotationHub&lt;/a&gt;. References of non-model organisms can be found on AnnotationHub, many of which are extracted from Ensembl. But they can be downloaded as Bioconductor objects directly so it should be easier to use.&lt;/p&gt;
&lt;p&gt;First we create a AnnotationHub instance, it cached the metadata all available annotations locally for us to query.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ah&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;AnnotationHub&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="nf"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ah&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Homo sapiens&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;release-84&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;# AnnotationHub with 5 records&lt;/span&gt;
&lt;span class="c1"&gt;# # snapshotDate(): 2016-05-12&lt;/span&gt;
&lt;span class="c1"&gt;# # $dataprovider: Ensembl&lt;/span&gt;
&lt;span class="c1"&gt;# # $species: Homo sapiens&lt;/span&gt;
&lt;span class="c1"&gt;# # $rdataclass: TwoBitFile&lt;/span&gt;
&lt;span class="c1"&gt;# # additional mcols(): taxonomyid, genome, description, tags, sourceurl, sourcetype&lt;/span&gt;
&lt;span class="c1"&gt;# # retrieve records with, e.g., &amp;#39;object[[&amp;quot;AH50558&amp;quot;]]&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;#             title&lt;/span&gt;
&lt;span class="c1"&gt;#   AH50558 | Homo_sapiens.GRCh38.cdna.all.2bit&lt;/span&gt;
&lt;span class="c1"&gt;#   AH50559 | Homo_sapiens.GRCh38.dna.primary_assembly.2bit&lt;/span&gt;
&lt;span class="c1"&gt;#   AH50560 | Homo_sapiens.GRCh38.dna_rm.primary_assembly.2bit&lt;/span&gt;
&lt;span class="c1"&gt;#   AH50561 | Homo_sapiens.GRCh38.dna_sm.primary_assembly.2bit&lt;/span&gt;
&lt;span class="c1"&gt;#   AH50562 | Homo_sapiens.GRCh38.ncrna.2bit&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;From the search results, human hg38 genome sequences are available as &lt;a href="https://genome.ucsc.edu/goldenpath/help/twoBit.html"&gt;TwoBit&lt;/a&gt; format. But having multiple results is confusing at first. After checking the Ensembl&amp;rsquo;s &lt;a href="ftp://ftp.ensembl.org/pub/release-84/fasta/homo_sapiens/dna/README"&gt;gnome DNA assembly readme&lt;/a&gt;, what we should use here is the full DNA assembly without any masking (or you can decide it based on your application).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# There are a plenty of query hits. Description of different file suffix:&lt;/span&gt;
&lt;span class="c1"&gt;# GRCh38.dna.*.2bit     genome sequence&lt;/span&gt;
&lt;span class="c1"&gt;# GRCh38.dna_rm.*.2bit  hard-masked genome sequence (masked regions are replaced with N&amp;#39;s)&lt;/span&gt;
&lt;span class="c1"&gt;# GRCh38.dna_sm.*.2bit  soft-masked genome sequence (.............. are lower cased)&lt;/span&gt;
&lt;span class="n"&gt;ens84_human_dna&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;ah&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;AH50559&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we can use it to obtain the DNA sequence of desired genomic range (in &lt;code&gt;GRagnes&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;getSeq&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ens84_human_dna&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tx_gr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;#   A DNAStringSet instance of length 1&lt;/span&gt;
&lt;span class="c1"&gt;#      width seq                              names&lt;/span&gt;
&lt;span class="c1"&gt;# [1] 113130 TTTATAGAGAAAA...CTCGGACCGATTGCCT ENST00000215832&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="biomart"&gt;biomaRt&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://www.ensembl.org/biomart/martview"&gt;BioMart&lt;/a&gt; are a collections of database that can be accessed by the same API, including Ensembl, Uniprot and HapMap. &lt;a href="https://bioconductor.org/packages/release/bioc/html/biomaRt.html"&gt;biomaRt&lt;/a&gt; provides an R interface to these database resources. We will use BioMart for ID conversion between Ensembl and RefSeq. Its &lt;a href="https://bioconductor.org/packages/release/bioc/vignettes/biomaRt/inst/doc/biomaRt.pdf"&gt;vignette&lt;/a&gt; contains solutions to common scenarios so should be a good starting point to get familiar with it.&lt;/p&gt;
&lt;p&gt;You could first explore which Marts are currently available by &lt;code&gt;listMarts()&lt;/code&gt;,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;biomaRt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;listMarts&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="c1"&gt;#                biomart               version&lt;/span&gt;
&lt;span class="c1"&gt;# 1 ENSEMBL_MART_ENSEMBL      Ensembl Genes 84&lt;/span&gt;
&lt;span class="c1"&gt;# 2     ENSEMBL_MART_SNP  Ensembl Variation 84&lt;/span&gt;
&lt;span class="c1"&gt;# 3 ENSEMBL_MART_FUNCGEN Ensembl Regulation 84&lt;/span&gt;
&lt;span class="c1"&gt;# 4    ENSEMBL_MART_VEGA               Vega 64&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here we will use Ensembl&amp;rsquo;s biomart. Each mart contains multiple datasets, usually separated by different organisms. In our case, human&amp;rsquo;s dataset is &lt;code&gt;hsapiens_gene_ensembl&lt;/code&gt;. For other organisms, you can find their dataset by &lt;code&gt;listDatasets(ensembl)&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ensembl&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;useMart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ensembl&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ensembl&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;useDataset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hsapiens_gene_ensembl&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# or equivalently&lt;/span&gt;
&lt;span class="n"&gt;ensembl&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;useMart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ensembl&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dataset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hsapiens_gene_ensembl&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="compatibility-with-annotationdbs-interface"&gt;Compatibility with AnnotationDb&amp;rsquo;s interface&lt;/h3&gt;
&lt;p&gt;The way to query the &lt;code&gt;ensembl&lt;/code&gt; Mart object is slightly different to how we query a AnnotationDb object. The major difference is the terminology. Luckily, Mart object provides a compatibility layer so we can still call functions such as &lt;code&gt;select(db, ...)&lt;/code&gt;, &lt;code&gt;keytypes(db)&lt;/code&gt;, &lt;code&gt;keys(db)&lt;/code&gt; and &lt;code&gt;columns(db)&lt;/code&gt;, which we frequently do&lt;sup id="fnref:select-compat"&gt;&lt;a class="footnote-ref" href="#fn:select-compat"&gt;1&lt;/a&gt;&lt;/sup&gt; when using NCBI/UCSC references.&lt;/p&gt;
&lt;p&gt;A Mart can have hundreds of keys and columns. So we select a part of them out by &lt;code&gt;grep()&lt;/code&gt;,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;grep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;^refseq&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nf"&gt;keytypes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# [1] &amp;quot;refseq_mrna&amp;quot; &amp;quot;refseq_mrna_predicted&amp;quot; ...&lt;/span&gt;
&lt;span class="nf"&gt;grep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;^ensembl&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nf"&gt;keytypes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# [1] &amp;quot;ensembl_exon_id&amp;quot; &amp;quot;ensembl_gene_id&amp;quot; ...&lt;/span&gt;
&lt;span class="nf"&gt;grep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hsapiens_paralog_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nf"&gt;columns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# [1] &amp;quot;hsapiens_paralog_associated_gene_name&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# [2] &amp;quot;hsapiens_paralog_canonical_transcript_protein&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# [3] &amp;quot;hsapiens_paralog_chrom_end&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We start by finding the MAPK1&amp;rsquo;s RefSeq transcript IDs and their corresponding Ensembl transcript IDs, which is something we cannot do by our locally built Ensembl TxDb nor the human OrgDb.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;MAPK1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;keytype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;hgnc_symbol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;refseq_mrna&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ensembl_transcript_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;hgnc_symbol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;entrezgene&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;chromosome_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;transcript_start&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;transcript_end&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;strand&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#   refseq_mrna ensembl_transcript_id hgnc_symbol entrezgene&lt;/span&gt;
&lt;span class="c1"&gt;# 1   NM_002745       ENST00000215832       MAPK1       5594&lt;/span&gt;
&lt;span class="c1"&gt;# 2                   ENST00000491588       MAPK1       5594&lt;/span&gt;
&lt;span class="c1"&gt;# 3   NM_138957       ENST00000398822       MAPK1       5594&lt;/span&gt;
&lt;span class="c1"&gt;# 4                   ENST00000544786       MAPK1       5594&lt;/span&gt;
&lt;span class="c1"&gt;#   chromosome_name transcript_start transcript_end strand&lt;/span&gt;
&lt;span class="c1"&gt;# 1              22         21754500       21867629     -1&lt;/span&gt;
&lt;span class="c1"&gt;# 2              22         21763984       21769428     -1&lt;/span&gt;
&lt;span class="c1"&gt;# 3              22         21769040       21867680     -1&lt;/span&gt;
&lt;span class="c1"&gt;# 4              22         21769204       21867440     -1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So some of the MAPK1 Ensembl transcripts does not have RefSeq identifiers. This is common to see since RefSeq is more conservative about including new transcripts. Anyway, we can now translate our analysis result between a wider range of naming systems.&lt;/p&gt;
&lt;p&gt;Moreover, what&amp;rsquo;s awesome about BioMart is that almost all the information on the Ensembl genome browser can be retreived by BioMart. For example, getting the paralog and the mouse homolog of MAPK1,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Get paralog of MAPK1&lt;/span&gt;
&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ENSG00000100030&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;keytype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ensembl_gene_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;hsapiens_paralog_associated_gene_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;hsapiens_paralog_orthology_type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;hsapiens_paralog_ensembl_peptide&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#   hsapiens_paralog_associated_gene_name hsapiens_paralog_orthology_type hsapiens_paralog_ensembl_peptide&lt;/span&gt;
&lt;span class="c1"&gt;# 1                                 MAPK3          within_species_paralog                  ENSP00000263025&lt;/span&gt;
&lt;span class="c1"&gt;# 2                                 MAPK6          within_species_paralog                  ENSP00000261845&lt;/span&gt;
&lt;span class="c1"&gt;# 3                                 MAPK4          within_species_paralog                  ENSP00000383234&lt;/span&gt;
&lt;span class="c1"&gt;# 4                                   NLK          within_species_paralog                  ENSP00000384625&lt;/span&gt;
&lt;span class="c1"&gt;# 5                                 MAPK7          within_species_paralog                  ENSP00000311005&lt;/span&gt;

&lt;span class="c1"&gt;# Get homolog of MAPK1 in mouse&lt;/span&gt;
&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ENSG00000100030&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;keytype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ensembl_gene_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;mmusculus_homolog_associated_gene_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;mmusculus_homolog_orthology_type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;mmusculus_homolog_ensembl_peptide&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#   mmusculus_homolog_associated_gene_name mmusculus_homolog_orthology_type mmusculus_homolog_ensembl_peptide&lt;/span&gt;
&lt;span class="c1"&gt;# 1                                  Mapk1                 ortholog_one2one                ENSMUSP00000065983&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="biomarts-original-interface"&gt;biomaRt&amp;rsquo;s original interface&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;select()&lt;/code&gt; function we use is not the original biomaRt&amp;rsquo;s interface. In fact, keys and columns are interpreted as BioMart&amp;rsquo;s &lt;strong&gt;filters&lt;/strong&gt; and &lt;strong&gt;attributes&lt;/strong&gt; respectively. To find all available filters and attributes,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;filters&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;listFilters&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;attributes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;listAttributes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ensembl&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;each of the command return a data.frame that contains each filter&amp;rsquo;s or attribute&amp;rsquo;s name and description.&lt;/p&gt;
&lt;p&gt;Behind the scene, arguments of &lt;code&gt;select(db, ...)&lt;/code&gt; is converted to &lt;code&gt;getBM(mart, ...)&lt;/code&gt;. For the same example of finding RefSeq and Ensembl transcript IDs, it can be re-written as&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;getBM&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;attributes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;refseq_mrna&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ensembl_transcript_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;chromosome_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;transcript_start&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;transcript_end&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;strand&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s"&gt;&amp;quot;hgnc_symbol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;entrezgene&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ensembl_gene_id&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;filters&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;hgnc_symbol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;values&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;MAPK1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;mart&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ensembl&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="conversion-between-genomic-coordinate-systems"&gt;Conversion between genomic coordinate systems&lt;/h2&gt;
&lt;p&gt;Somethings we need to convert between different verions of the reference. For example, today we&amp;rsquo;d like to convert a batch of genomic locations of reference hg38 to that of hg19, so we can compare our new research with previous studies. It is a non-trivial task that can be currently handled by the following tools:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://crossmap.sourceforge.net/"&gt;CrossMap&lt;/a&gt; (used by Ensembl)&lt;/li&gt;
&lt;li&gt;&lt;a href="https://genome.ucsc.edu/cgi-bin/hgLiftOver"&gt;liftOver&lt;/a&gt; (used by UCSC)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Frankly I don&amp;rsquo;t have experience for such conversion in real study (the converted result still gives the sense of unease), but anyway here I follow &lt;a href="http://genomicsclass.github.io/book/pages/bioc1_liftOver.html"&gt;the guide on PH525x series&lt;/a&gt;. In Bioconductor, we can use UCSC&amp;rsquo;s Chain file to apply the &lt;code&gt;liftOver()&lt;/code&gt; method provided by package &lt;code&gt;rtracklayer&lt;/code&gt;. To convert regions from hg38 to hg19, we need the &lt;code&gt;hg38ToHg19.over.chain&lt;/code&gt; file, which can be found at &lt;a href="ftp://hgdownload.cse.ucsc.edu/goldenPath/hg38/liftOver/"&gt;ftp://hgdownload.cse.ucsc.edu/goldenPath/hg38/liftOver/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We still use MAPK1 as an example of conversion. First extract MAPK1&amp;rsquo;s genomic ranges in hg38 and hg19 respectively,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TxDb.Hsapiens.UCSC.hg38.knownGene&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TxDb.Hsapiens.UCSC.hg19.knownGene&lt;/span&gt;
&lt;span class="n"&gt;tx38&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;TxDb.Hsapiens.UCSC.hg38.knownGene&lt;/span&gt;
&lt;span class="n"&gt;tx19&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;TxDb.Hsapiens.UCSC.hg19.knownGene&lt;/span&gt;
&lt;span class="n"&gt;MAPK1_hg38&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;genes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx38&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;5594&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;MAPK1_hg19&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;genes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx19&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gene_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;5594&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we convert &lt;code&gt;MAPK1_hg38&lt;/code&gt; to use the hg19 coordinate system.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rtracklayer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;import.chain&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;./hg38ToHg19.over.chain&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;MAPK1_hg19_lifted&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;liftOver&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MAPK1_hg38&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;MAPK1_hg19&lt;/span&gt;
&lt;span class="c1"&gt;# GRanges object with 1 range and 1 metadata column:&lt;/span&gt;
&lt;span class="c1"&gt;#        seqnames               ranges strand |     gene_id&lt;/span&gt;
&lt;span class="c1"&gt;#           &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt; | &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#   5594    chr22 [22113947, 22221970]      - |        5594&lt;/span&gt;
&lt;span class="c1"&gt;#   -------&lt;/span&gt;
&lt;span class="c1"&gt;#   seqinfo: 93 sequences (1 circular) from hg19 genome&lt;/span&gt;

&lt;span class="n"&gt;MAPK1_hg19_lifted&lt;/span&gt;
&lt;span class="c1"&gt;# GRangesList object of length 1:&lt;/span&gt;
&lt;span class="c1"&gt;# $5594&lt;/span&gt;
&lt;span class="c1"&gt;# GRanges object with 2 ranges and 1 metadata column:&lt;/span&gt;
&lt;span class="c1"&gt;#       seqnames               ranges strand |     gene_id&lt;/span&gt;
&lt;span class="c1"&gt;#          &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt; | &amp;lt;character&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#   [1]    chr22 [22113947, 22216652]      - |        5594&lt;/span&gt;
&lt;span class="c1"&gt;#   [2]    chr22 [22216654, 22221970]      - |        5594&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# -------&lt;/span&gt;
&lt;span class="c1"&gt;# seqinfo: 1 sequence from an unspecified genome; no seqlengths&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So the conversion worked as expected, though it created a gap in the range (missing a base at 22216653). I haven&amp;rsquo;t looked into the results. To ensure the correctness of the conversion, maybe a comparison with CrossMap is needed.&lt;/p&gt;
&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;We skimmed through OrgDb and TxDb again using the Ensembl references, including how to build the TxDb for Ensembl locally and obtain external annotations from AnnotationHub.&lt;/p&gt;
&lt;p&gt;BioMart is an abundant resource to query across various types of databases and references, which can be used in conversion between different naming systems.&lt;/p&gt;
&lt;p&gt;Finally, we know how to convert between different version of the reference. Though the correctness of the conversion requires further examination (not meaning it is wrong), at least the conversion by liftOver works as expected.&lt;/p&gt;
&lt;p&gt;Starting here, you should have no trouble dealing with annotations in R anymore. For the next post, I plan to further explore the way to read sequencing analysis results in R.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:select-compat"&gt;
&lt;p&gt;Note that the &lt;code&gt;select(mart, ...)&lt;/code&gt; compatibility does not apply to all existed filters (keys) and attributes (columns) of the given Mart.&amp;#160;&lt;a class="footnote-backref" href="#fnref:select-compat" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="r"></category><category term="bioconductor"></category></entry><entry><title>ä½¿ç”¨ uWSGIã€nginxã€systemd éƒ¨ç½² Django</title><link href="https://blog.liang2.tw/posts/2016/05/django-deploy-uwsgi-nginx-systemd/" rel="alternate"></link><published>2016-05-19T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-05-19:/posts/2016/05/django-deploy-uwsgi-nginx-systemd/</id><summary type="html">&lt;p&gt;ä¸Šä¸€æ¬¡å¾ˆèªçœŸçš„ Django éƒ¨ç½²è¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;ã€Šè¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Serverã€‹&lt;/a&gt;ä¸€æ–‡ã€‚å¾ˆå·§åœ°è‡ªå·±ç•¢æ¥­çš„é¡Œç›®ä¹Ÿè¦æž¶å€‹ Django ç¶²ç«™ï¼Œæ‰€ä»¥å°± â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸Šä¸€æ¬¡å¾ˆèªçœŸçš„ Django éƒ¨ç½²è¨˜éŒ„åœ¨&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;ã€Šè¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Serverã€‹&lt;/a&gt;ä¸€æ–‡ã€‚å¾ˆå·§åœ°è‡ªå·±ç•¢æ¥­çš„é¡Œç›®ä¹Ÿè¦æž¶å€‹ Django ç¶²ç«™ï¼Œæ‰€ä»¥å°±å†è·‘äº†ä¸€æ¬¡éƒ¨ç½²è¨­å®šã€‚èˆŠæ–‡é‚„æäº†æœ‰çš„æ²’çš„ï¼Œé€™ç¯‡åƒ…é‡å° Django çš„éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šçš„éƒ¨ç½²è¨­å®šéƒ½å„˜é‡ä¸ä½¿ç”¨ root æ¬Šé™ï¼Œæ•´å€‹é€£ç·šçš„æµç¨‹åœ–å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nginx -- unix socket -- uWSGI -- Django
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯«ä¸€å€‹åç‚º &lt;code&gt;PROJ.service&lt;/code&gt; çš„ systemd unit ä¾†ç®¡ç†é€™ç¶²ç«™çš„å•Ÿå‹•èˆ‡å¦ã€‚ä¹‹å¾Œ &lt;code&gt;PROJ&lt;/code&gt; å°±æ›æˆè‡ªå·±çš„å°ˆæ¡ˆåç¨±ï¼›&lt;code&gt;USER&lt;/code&gt; å°±æ›æˆåŸ·è¡Œç¶²ç«™çš„å¸³è™Ÿã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ä½œæ¥­ç³»çµ±&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-proj"&gt;Django PROJ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#tmpfilesd"&gt;tmpfiles.d&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#nginx"&gt;nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#uwsgi"&gt;uWSGI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#systemd"&gt;systemd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç¢ºèªã€ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="_1"&gt;ä½œæ¥­ç³»çµ±&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ Ubuntu 16.04 LTSã€‚æˆ‘å° Ubuntu å…¶å¯¦æ²’æ„›ï¼Œä½†å› ç‚ºå¾ˆå¤šäººç”¨ï¼Œç•¢æ¥­ä¹‹å¾Œæ‡‰è©²é‚„æ‰¾å¾—åˆ°äººç¶­è­·ã€‚ä»–è·Ÿ Debian å·®ä¸å¤šï¼Œæ‰€ä»¥è·ŸèˆŠæ–‡æ²’ä»€éº¼å·®åˆ¥ã€‚Ubuntu 16 å…§å»ºå°±æœ‰ Python 3.5ï¼Œä¸ç”¨å†è£ï¼›PostgreSQL ä¹Ÿä¾†åˆ° 9.5 ç‰ˆã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href="https://wiki.debian.org/UnattendedUpgrades"&gt;unattended-upgrades&lt;/a&gt; å®šæœŸæ›´æ–°èˆ‡ security ç›¸é—œçš„å¥—ä»¶ï¼Œå®ƒé è¨­ä¸€å¤©æª¢æŸ¥ä¸€æ¬¡ï¼Œæ›´æ–°çš„è¨˜éŒ„æœƒåœ¨ &lt;code&gt;/var/log/unattended-upgrades&lt;/code&gt; ç›®éŒ„ä¸­ã€‚&lt;/p&gt;
&lt;h3 id="postgresql"&gt;PostgreSQL&lt;/h3&gt;
&lt;p&gt;åƒè€ƒ&lt;a href="https://blog.liang2.tw/posts/2016/01/postgresql-install/"&gt;ã€Šå®‰è£ PostgreSQL 9 æ–¼ Debian Jessie / OSXã€‹&lt;/a&gt;ä¸€æ–‡è¨­å®šã€‚å»ºç«‹è·Ÿ OS user åŒåçš„ PostgreSQL å¸³è™Ÿï¼Œçµ¦äº†å»ºç«‹ database çš„æ¬Šé™ï¼Œé€™æ¨£é–‹ç™¼æ¯”è¼ƒæ–¹ä¾¿ã€‚ä¸ç”¨è¨­å®šå¯†ç¢¼ã€‚&lt;/p&gt;
&lt;h3 id="django-proj"&gt;Django PROJ&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨å…§å»º &lt;a href="https://docs.python.org/3/library/venv.html"&gt;venv&lt;/a&gt; åœ¨è‡ªå·±å®¶ç›®éŒ„ä¸‹æŸè™•ï¼Œå»ºç«‹åç‚º &lt;code&gt;VENV&lt;/code&gt; çš„è™›æ“¬ç’°å¢ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3.5 -m venv VENV
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ‰é—œéƒ¨ç½²çš„è¨­å®šï¼ˆå³ &lt;code&gt;settings.py&lt;/code&gt;ï¼‰ï¼Œåˆ©ç”¨ &lt;a href="https://github.com/joke2k/django-environ"&gt;django-environ&lt;/a&gt; æŠŠ secret keyã€database é€£ç·šè³‡è¨Šã€å¯„ä¿¡ SMTP server ç­‰è¨­å®šå¯«åœ¨ç¨ç«‹çš„æª”æ¡ˆï¼Œå°±å¯ä»¥è®“ local å’Œ production ç’°å¢ƒè®€åˆ°å„è‡ªçš„è¨­å®šã€‚å…·é«”çš„åšæ³•å¯ä»¥åƒè€ƒ &lt;a href="https://github.com/pycontw/pycontw2016/blob/master/src/pycontw2016/settings/production.py"&gt;PyCon Taiwan 2016 ç¶²ç«™ç®¡ç†è¨­å®š&lt;/a&gt; çš„å¯«æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é€£ PostgreSQL æ™‚ä½¿ç”¨ local connection (Unix-domain socket)ï¼Œå³ä½¿ç”¨è€…åŒåçš„èº«ä»½ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="na"&gt;DATABASE_URL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;postgres:///TABLE_NAME&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="tmpfilesd"&gt;tmpfiles.d&lt;/h3&gt;
&lt;p&gt;æŠŠ nginx èˆ‡ uwsgi æºé€šç”¨çš„ socket æ”¾åœ¨ &lt;code&gt;/run/PROJ&lt;/code&gt; åº•ä¸‹ï¼Œä½†é€™ä¹Ÿè¡¨ç¤ºé‡é–‹æ©Ÿä¹‹å¾Œï¼Œ&lt;code&gt;/run/PROJ&lt;/code&gt; è³‡æ–™å¤¾å°±æœƒæ¶ˆå¤±ä¸è¦‹ï¼Œæ‰€ä»¥ä½¿ç”¨ &lt;a href="https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html"&gt;tmpfiles.d&lt;/a&gt;&lt;sup id="fnref:systemd-runtimedir"&gt;&lt;a class="footnote-ref" href="#fn:systemd-runtimedir"&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚é™¤äº†è³‡æ–™å¤¾çš„å‘½åæ”¹æˆç”¨å°ˆæ¡ˆåç¨±ï¼Œè¨­å®šéƒ½è·Ÿ&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;èˆŠæ–‡&lt;/a&gt;ä¸€æ¨£ã€‚&lt;/p&gt;
&lt;h3 id="nginx"&gt;nginx&lt;/h3&gt;
&lt;p&gt;nginx è¨­å®šè·Ÿ&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;èˆŠæ–‡&lt;/a&gt;ä¸€æ¨£ã€‚æ”¾åœ¨ &lt;code&gt;/etc/nginx/sites-available/PROJ.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Upstream Django setting; the socket nginx connects to&lt;/span&gt;
&lt;span class="k"&gt;upstream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;django&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;unix:///run/PROJ/django.sock&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;listen&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;listen&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;443&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;ssl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;server_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;123&lt;/span&gt;&lt;span class="s"&gt;.123.123.123&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;charset&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="s"&gt;utf-8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;client_max_body_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;10M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# max upload size&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;keepalive_timeout&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;alias&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/path/to/PROJ/assets&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;# Finally, send all non-media requests to the Django server.&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;uwsgi_pass&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s"&gt;django&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;include&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="s"&gt;/etc/nginx/uwsgi_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;/path/to/PROJ/assets&lt;/code&gt; æ˜¯ Django &lt;a href="https://docs.djangoproject.com/en/1.9/ref/settings/#std:setting-STATIC_ROOT"&gt;STATIC_ROOT&lt;/a&gt; çš„è·¯å¾‘ã€‚åªè¦åŸ·è¡Œ &lt;code&gt;python manage.py collectstatic&lt;/code&gt; å¾Œï¼Œå³ä½¿ uWSGI é‚„æ²’è¨­å®šå°±å¯ä»¥æ¸¬è©¦ /static/&amp;hellip;/ æœ‰æ²’æœ‰è¢« nginx æŠ“åˆ°ã€‚ &lt;/p&gt;
&lt;p&gt;å•Ÿå‹•æ™‚ï¼Œå…ˆæŠŠæª”æ¡ˆé€£çµåˆ° &lt;code&gt;/etc/nginx/site-enabled/&lt;/code&gt;ï¼Œé‡è¼‰ nginx è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /etc/nginx/sites-enabled/
sudo ln -s ../sites-available/PROJ.conf .
sudo systemctl reload nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="uwsgi"&gt;uWSGI&lt;/h3&gt;
&lt;p&gt;è·ŸèˆŠæ–‡æœ€å¤§çš„å·®åˆ¥ï¼Œåªè¦è£åœ¨ VENV è£¡é¢å°±å¥½äº†ï¼›ç„¶å¾Œä¹Ÿä¸ä½¿ç”¨ emperor modeã€‚å¯«ä¸€å€‹ &lt;code&gt;/etc/uwsgi/vassals/PROJ.ini&lt;/code&gt; æ”¾è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;[uwsgi]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;chdir&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/path/to/PROJ&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# Django&amp;#39;s wsgi file&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;module&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;PROJ.wsgi:application&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;env&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;DJANGO_SETTINGS_MODULE=PROJ.settings.production&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# the virtualenv (full path)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;home&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/path/to/VENV&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="c1"&gt;# process-related settings&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# master&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;master&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;true&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# maximum number of worker processes&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;processes&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;4&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# the socket (use the full path to be safe&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;socket&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/run/PROJ/django.sock&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# ... with appropriate permissions - may be needed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;chmod-socket&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;664&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;uid&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;USER&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;gid&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;www-data&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# clear environment on exit&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;vacuum&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;true&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¨­å®šå¥½å¾ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œå°±æ‡‰è©²èƒ½çœ‹åˆ°ç¶²ç«™èƒ½å‹•äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo /path/to/VENV/bin/uwsgi --ini /etc/uwsgi/vassals/PROJ.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="systemd"&gt;systemd&lt;/h3&gt;
&lt;p&gt;é€™é‚Šé™¤äº†åŸ·è¡Œ uWSGI çš„æŒ‡ä»¤ä¸åŒå¤–ï¼Œéƒ½è·Ÿ&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;èˆŠæ–‡&lt;/a&gt;ç›¸åŒã€‚Debian ç³» systemd system unit è¨­å®šæª”æ”¾åœ¨ &lt;code&gt;/etc/systemd/system/PROJ.service&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Unit]
Description=PROJ&amp;#39;s Django server by uWSGI
After=syslog.target

[Service]
ExecStart=/path/to/VENV/bin/uwsgi --ini /etc/uwsgi/vassals/PROJ.ini
Restart=always
KillSignal=SIGQUIT
Type=notify
StandardError=syslog
NotifyAccess=all

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™é‚Šè¨­å®šå®ƒæœƒï¼ˆæœ‰éŒ¯èª¤æ™‚ï¼‰è‡ªå‹•é‡æ–°èµ·å‹•ï¼Œä¸¦æŠŠ stderr å°Žåˆ° syslogã€‚æŽ¥è‘—ï¼Œå°±è¦å•Ÿå‹•é€™å€‹ &lt;code&gt;PROJ.service&lt;/code&gt; æœå‹™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo systemctl &lt;span class="nb"&gt;enable&lt;/span&gt; PROJ
sudo systemctl status PROJ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥é€éŽ &lt;code&gt;sudo journalctl -xe -u PROJ&lt;/code&gt; ä¾†æŸ¥çœ‹ uWSGI åŸ·è¡Œã€é€£ç·š logã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;ç¢ºèªã€ç¸½çµ&lt;/h3&gt;
&lt;p&gt;é‡å•Ÿç³»çµ±ä¸€æ¬¡ï¼Œå¦‚æžœç¶²ç«™é‚„æ´»è‘—ï¼Œå°±è¡¨ç¤ºä¸€åˆ‡è¨­å®šéƒ½æ²’å•é¡Œã€‚æ•´é«”ä¸Šä¸å¤ªè¤‡é›œï¼Œä½†æ¬Šé™ä¸ç¬¦çš„éŒ¯èª¤å¯èƒ½æœƒè®“ä½ é¬¼æ‰“ç‰†ï¼Œè¦æœ‰è€å¿ƒã€‚&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:systemd-runtimedir"&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ç”¨ &lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html"&gt;systemd.exec(5)&lt;/a&gt; æåˆ°çš„ &lt;code&gt;RuntimeDirectory=PROJ&lt;/code&gt; ä¾†å»ºç«‹åŸ·è¡Œç”¨ç›®éŒ„ã€‚ä½†å› ç‚º &lt;code&gt;PROJ.service&lt;/code&gt; çš„ USER å¿…é ˆæ˜¯ rootï¼Œé€™ç¨®æƒ…æ³ man page å°±å»ºè­°æ”¹ç”¨ tmpfiles.dã€‚æˆ‘è¦ºå¾—æ‡‰è©²èƒ½è§£æ±ºä½¿ç”¨ root æ¬Šé™çš„å•é¡Œï¼Œä½†å¤ªæ‡¶äº†å°±å…ˆé€™æ¨£â€¦â€¦&amp;#160;&lt;a class="footnote-backref" href="#fnref:systemd-runtimedir" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="python"></category><category term="django"></category><category term="postgresql"></category><category term="deploy"></category><category term="debian"></category><category term="systemd"></category><category term="nginx"></category><category term="uwsgi"></category></entry><entry><title>Jupyter Notebook Progress Bar</title><link href="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/" rel="alternate"></link><published>2016-03-23T02:00:00-05:00</published><updated>2022-05-13T12:58:45-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-03-23:/posts/2016/03/notebook-progress-bar/</id><summary type="html">&lt;p&gt;ç›¸ä¿¡å¾ˆå¤šäººéƒ½å·²ç¶“åœ¨ä½¿ç”¨ &lt;a href="https://jupyter.org/"&gt;Jupyter (IPython) Notebook&lt;/a&gt; è·‘åˆ†æžã€‚éš¨è‘—åˆ†æžçš„è³‡æ–™è¶Šè·‘è¶Šå¤šï¼Œæœ‰æ™‚å€™åˆ·ä¸‹åŽ»å°±æ˜¯å¹¾ååˆ†é˜ç”šè‡³æ•¸å°æ™‚ã€‚æ­¤æ™‚æ²’æœ‰å€‹ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç›¸ä¿¡å¾ˆå¤šäººéƒ½å·²ç¶“åœ¨ä½¿ç”¨ &lt;a href="https://jupyter.org/"&gt;Jupyter (IPython) Notebook&lt;/a&gt; è·‘åˆ†æžã€‚éš¨è‘—åˆ†æžçš„è³‡æ–™è¶Šè·‘è¶Šå¤šï¼Œæœ‰æ™‚å€™åˆ·ä¸‹åŽ»å°±æ˜¯å¹¾ååˆ†é˜ç”šè‡³æ•¸å°æ™‚ã€‚æ­¤æ™‚æ²’æœ‰å€‹é€²åº¦æ¢é‚„è »ç„¡èŠçš„ï¼Œè€Œä¸”èƒ½è®“è‡ªå·±æ„Ÿè¦º&lt;strong&gt;å¾ˆæœ‰é€²åº¦&lt;/strong&gt;ï¼Œä½•æ¨‚ä¸ç‚ºå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚æˆ‘&lt;a href="https://blog.liang2.tw/play_aiohttp/?full#asyncio-progressbar-cover"&gt;åŽ»å¹´ä»‹ç´¹ aiohttp&lt;/a&gt; æ™‚å°±æœ‰ç”¨åˆ° notebook å’Œ console åº•ä¸‹çš„é€²åº¦æ¢ (progress bar)ã€‚ä¸éŽï¼Œé€™å¹¾å€‹æœˆ Jupyter Notebook 4+ æž¶æ§‹ä¸Šçš„èª¿æ•´ï¼Œå¯èƒ½ code éƒ½ä¸èƒ½ç”¨äº†ã€‚å‰›å¥½æ˜¨å¤©çš„ Taipei.py æœ‰äººæåˆ°é€™äº‹ï¼Œå°±ä¾†æ•´ç†ä¸€ä¸‹å§ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#ipywidgets"&gt;IPywidgets ä»‹ç´¹&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;å®‰è£&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ä½¿ç”¨é€²åº¦æ¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#progress-bar-example-in-action"&gt;Progress bar example in action&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#misc"&gt;Misc. èž¢å¹•æˆªåœ–&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#ffmpeg"&gt;FFmpeg è½‰æª”&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="ipywidgets"&gt;IPywidgets ä»‹ç´¹&lt;/h3&gt;
&lt;p&gt;Notebook é€²åº¦æ¢ä½¿ç”¨ &lt;a href="https://github.com/ipython/ipywidgets"&gt;ipywidgets&lt;/a&gt; ä¸­çš„å…ƒä»¶å¯¦ä½œã€‚é€™ä»¶å…ƒä»¶è¦ç¯„äº† notebook client &amp;lt;-&amp;gt; server é–“é›™å‘çš„æºé€šï¼Œä¸¦ä¸”èƒ½æŠŠç›¸é—œçš„ CSS / JS åŒ…è£åœ¨ä¸€èµ·ã€‚åœ¨ ipywidgets ç¯„ä¾‹çš„ &lt;a href="http://nbviewer.jupyter.org/github/ipython/ipywidgets/blob/master/examples/Widget%20Basics.ipynb"&gt;&lt;em&gt;Widgets Basics&lt;/em&gt;&lt;/a&gt; ä¸­å°±æœ‰æåˆ°å¯èƒ½çš„ç”¨é€”ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You can use widgets to &lt;strong&gt;build interactive GUIs&lt;/strong&gt; for your notebooks. &lt;br&gt;
You can also use widgets to &lt;strong&gt;synchronize stateful and stateless information&lt;/strong&gt; between Python and JavaScript.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥é™¤äº†åƒé€²åº¦æ¢é€™æ¨£å–®å‘çš„å¾ž python code å‚³è¨Šæ¯åˆ° notebook (HTML) front-end ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥åšä¸€äº›ä»‹é¢æŠŠ front-end çš„å€¼å‚³å›ž python codeã€‚&lt;/p&gt;
&lt;p&gt;â€¦â€¦åªæ˜¯è¦ç”¨å€‹é€²åº¦æ¢è€Œå·²ï¼Œå“ªä¾†é€™éº¼å¤šèƒŒæ™¯çŸ¥è­˜ã€‚æ›´å¤šä»‹ç´¹å¯ä»¥åƒè€ƒ &lt;a href="http://nbviewer.jupyter.org/github/ipython/ipywidgets/blob/master/examples/Index.ipynb"&gt;ipywidgets å®˜æ–¹ç¯„ä¾‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id="_1"&gt;å®‰è£&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ Python 3.5 ç¤ºç¯„ã€‚å®‰è£é™¤äº† notebook æœ¬èº«å¤–ï¼Œé‚„è¦é¡å¤–è£ä¸Š ipywidgets é€™å¥—ä»¶ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip install notebook ipywidgets
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†ç”¨ &lt;code&gt;jupyter notebook&lt;/code&gt; å³å¯å•Ÿç”¨ notebookã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;ä½¿ç”¨é€²åº¦æ¢&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ipywidgets&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;IntProgress&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;IPython.display&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;display&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;IntProgress&lt;/code&gt; å°±æ˜¯é€²åº¦æ¢ï¼Œ&lt;code&gt;display&lt;/code&gt; å‰‡æ˜¯ IPython é¡¯ç¤ºå„ç¨® Python ç‰©ä»¶çš„å‡½æ•¸ï¼Œåœ¨é€™é‚Šç”¨å®ƒæ‰èƒ½æŠŠ widget ä»¥ HTML é¡¯ç¤ºä¸¦èˆ‡ python code è¯å‹•ã€‚&lt;/p&gt;
&lt;p&gt;å»ºç«‹ä¸€å€‹é€²åº¦æ¢çš„æ–¹å¼å¾ˆç°¡å–®ã€‚å»ºç«‹ &lt;code&gt;IntProgress&lt;/code&gt; widget objectï¼Œç„¶å¾Œé¡¯ç¤ºå®ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;IntProgress&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/pics/progressbar_default.png"&gt;
&lt;/figure&gt;

&lt;p&gt;é è¨­æ˜¯é€²åº¦æ¢æœ‰ 100 å€‹å–®ä½ï¼Œåˆå§‹å€¼ç‚º 0ã€‚é€²åº¦æ¢çš„å€¼èˆ‡æœ€å¤§å€¼çš„ç‹€æ…‹åˆ†åˆ¥å­˜åœ¨ &lt;code&gt;.value&lt;/code&gt;ã€&lt;code&gt;.max&lt;/code&gt; å±¬æ€§è£¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;
&lt;span class="go"&gt;(0, 100)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åªè¦ä¿®æ”¹ &lt;code&gt;p.value&lt;/code&gt; å‰é¢çš„é€²åº¦æ¢çš„ç‹€æ…‹å°±æœƒè‡ªå‹•æ›´æ–°ï¼ˆä¸ç”¨é‡è·‘ &lt;code&gt;display(p)&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/pics/progressbar_50.png"&gt;
&lt;/figure&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/pics/progressbar_100.png"&gt;
&lt;/figure&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œæœ€å¤§å€¼èª¿æ•´ä¹Ÿæœƒå³æ™‚æ›´æ–°ã€‚æ­¤å¤–ï¼Œé‚„å¯ä»¥é€éŽ &lt;code&gt;.description&lt;/code&gt; çµ¦é€²åº¦æ¢ä¸€å€‹ labelã€‚é‡æ–°åšä¸€å€‹å®Œæ•´çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;p2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;IntProgress&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;p2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="n"&gt;p2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;description&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Running&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/pics/progressbar_full.png"&gt;
&lt;/figure&gt;

&lt;p&gt;å®Œæ•´çš„ code å°±é€™æ¨£ï¼Œç”¨èµ·ä¾†éžå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;h3 id="progress-bar-example-in-action"&gt;Progress bar example in action&lt;/h3&gt;
&lt;p&gt;æ¨¡æ“¬ä¸€ä¸‹çœŸå¯¦æƒ…æ³ï¼Œæˆ‘å€‘é€šå¸¸æœ‰ä¸€å †å¾…åšçš„ taskï¼Œåœ¨é€™é‚Šå« &lt;code&gt;todo_tasks&lt;/code&gt; å¥½äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="n"&gt;todo_tasks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;task &lt;/span&gt;&lt;span class="si"&gt;%02d&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åªæ˜¯å€‹å­—ä¸²ï¼Œä½†ç”¨ &lt;code&gt;time.sleep(sec)&lt;/code&gt; ä¾†æ¨¡æ“¬æœ‰åœ¨åšäº‹ã€‚&lt;/p&gt;
&lt;p&gt;æ­é…é€²åº¦æ¢çš„æ™‚å€™ï¼ŒæŠŠå¯¦éš›å‹•æ…‹åšæˆåº•ä¸‹çš„å‹•ç•«ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Initialize a progess bar&lt;/span&gt;
&lt;span class="n"&gt;progress&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;IntProgress&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;progress&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;todo_tasks&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;progress&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;description&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;(Init)&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;progress&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.25&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Simulating task execution&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;task&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;todo_tasks&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;progress&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.05&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;progress&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;description&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;task&lt;/span&gt;
&lt;span class="n"&gt;progress&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;description&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;(Done)&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;video loop auto autoplay&gt;
    &lt;source src="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/pics/progressbar_demo.webm" type="video/webm"&gt;
    &lt;source src="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/pics/progressbar_demo.mp4" type="video/mp4"&gt;
    Your browser doesn't support HTML5 video in WebM with VP8 or MP4 with H.264. You can still download the &lt;a href="https://blog.liang2.tw/posts/2016/03/notebook-progress-bar/pics/progressbar_demo.mp4"&gt;screencast&lt;/a&gt; and view it locally.
  &lt;/video&gt;
  &lt;p class="caption center"&gt;Progressbar in action&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;éžå¸¸æ–¹ä¾¿å§ï¼&lt;/p&gt;
&lt;h3 id="misc"&gt;Misc. èž¢å¹•æˆªåœ–&lt;/h3&gt;
&lt;p&gt;å¯«é€™ç¯‡æ–‡ç« èŠ±æœ€å¤šçš„æ™‚é–“æ˜¯åœ¨æˆªåœ–è·Ÿåšå‹•ç•« XD&lt;/p&gt;
&lt;p&gt;ç€è¦½å™¨çš„æˆªåœ–ï¼Œç¾åœ¨ Firefox (45) å·²ç¶“å¯ä»¥åªé¸æ“‡æˆªæŸå€‹ DOMï¼Œååˆ†æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ€å¾Œå‹•æ…‹çš„éŒ„è£½èŠ±äº†ä¸å°‘æ™‚é–“ã€‚ä¸€é–‹å§‹æƒ³èªªæ˜¯ä¸æ˜¯è¦ç”¨ GIFï¼Œä½†&lt;a href="http://blog.imgur.com/2014/10/09/introducing-gifv/"&gt;éƒ½ 2016 å¹´äº†é‚„ç”¨ä»€éº¼ GIF å•Šï¼&lt;/a&gt;ï¼Œé›–ç„¶èž¢å¹•å¯ä»¥è©¦è‘—æ”¹ GIF palette è®“ç•«é¢ä¸æœƒå¾ˆé†œé«”ç©åˆå°ï¼Œä½†è¦ºå¾—ç”¨å€‹ H.264 / VP9 ç°¡å–®å¤šäº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ QuickTime Screen Captureï¼Œé–‹å§‹éŒ„çš„æ™‚å€™èƒ½åªé¸æ“‡èž¢å¹•ä¸€éƒ¨ä»½å€åŸŸã€‚ä»¥æˆ‘ 13&amp;rdquo; retina èž¢å¹•ç‚ºä¾‹ï¼Œæœƒå¾—åˆ° 1636x736 H.264 .mov æª”ã€‚ä½†æˆ‘è¦ºå¾—è§£æžåº¦ä¸ç”¨é€™éº¼é«˜ï¼Œæ‰€ä»¥æœ€å¾Œè¼¸å‡ºæˆ 480p (1148x480)  å°±å¥½ï¼Œé †ä¾¿è£äº†ä¸€é»žç™½é‚Šã€‚&lt;/p&gt;
&lt;p&gt;é€éŽ HTML5 &lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video"&gt;&lt;code&gt;&amp;lt;video&amp;gt;&lt;/code&gt;&lt;/a&gt; èƒ½æŠŠ MP4 / WebM ç•¶æˆå‹•ç•«ä¾†ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;video&lt;/span&gt; &lt;span class="na"&gt;loop&lt;/span&gt; &lt;span class="na"&gt;autoplay&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;source&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;vid.webm&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;video/webm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;source&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;vid.mp4&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;video/mp4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    Your browser doesn&amp;#39;t support HTML5 video in WebM with VP8
    or MP4 with H.264. You can still download the
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;vid.mp4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;screencast&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; and view it locally.
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;video&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å„å®¶ web browser çš„æ”¯æ´åº¦å¯åƒè€ƒ caniuse.comï¼š&lt;a href="http://caniuse.com/#feat=webm"&gt;WebM&lt;/a&gt;ã€&lt;a href="http://caniuse.com/#feat=mpeg4"&gt;MP4&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="ffmpeg"&gt;FFmpeg è½‰æª”&lt;/h4&gt;
&lt;p&gt;ç­†è¨˜è€Œå·²ï¼Œæ²’æœ‰èªçœŸèª¿åƒæ•¸è®“è¼¸å‡ºæª”æ¡ˆæœ€å°ã€‚VP9 çš„éƒ¨ä»½åƒè€ƒ &lt;a href="https://trac.ffmpeg.org/wiki/Encode/VP9"&gt;FFmepg&lt;/a&gt;&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# H.264 MP4&lt;/span&gt;
ffmpeg -i Untitled.mov &lt;span class="se"&gt;\&lt;/span&gt;
    -vcodec h264 &lt;span class="se"&gt;\&lt;/span&gt;
    -strict -2 -crf &lt;span class="m"&gt;22&lt;/span&gt; -preset slow -r &lt;span class="m"&gt;24&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    -vf &lt;span class="s2"&gt;&amp;quot;crop=iw:ih-52:0:10, scale=-1:480&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    out.mp4

&lt;span class="c1"&gt;# VP9 WebM&lt;/span&gt;
ffmpeg -i Untitled.mov &lt;span class="se"&gt;\&lt;/span&gt;
    -vcodec libvpx-vp9 &lt;span class="se"&gt;\&lt;/span&gt;
    -b:v 150K -r &lt;span class="m"&gt;24&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    -vf &lt;span class="s2"&gt;&amp;quot;crop=iw:ih-52:0:10, scale=-1:480&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    out.webm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;4s çš„æª”æ¡ˆæœ€å¾Œå¤§ç´„ 60KBï¼Œç›¸ç•¶ä¸éŒ¯ã€‚æˆ‘å¾ˆå¤š PNG æˆªåœ–éƒ½å¤§å¤šäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;du -sh ./* &lt;span class="p"&gt;|&lt;/span&gt; gsort -rh
&lt;span class="go"&gt;744K    ./Untitled.mov&lt;/span&gt;
&lt;span class="go"&gt; 60K    ./out.mp4&lt;/span&gt;
&lt;span class="go"&gt; 52K    ./out.webm&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;éœ€è¦é¡å¤–å®‰è£ libvpxï¼Œä¾‹å¦‚ï¼š&lt;code&gt;brew install ffmepg --with-libvpx&lt;/code&gt;&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="jupyter"></category><category term="notebook"></category></entry><entry><title>Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ– Server HTTPS ä½¿ç”¨ Let's Encrypt</title><link href="https://blog.liang2.tw/posts/2016/02/pydoctw-https/" rel="alternate"></link><published>2016-02-21T14:00:00-06:00</published><updated>2022-05-13T12:58:39-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-02-21:/posts/2016/02/pydoctw-https/</id><summary type="html">&lt;p&gt;æ•´ç†äº† server å¾ž HTTP åˆ° HTTPS ç›¸é—œè¨­å®šçš„èª¿æ•´ã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç¾åœ¨å¯ä»¥é€éŽ &lt;a href="https://docs.python.org.tw"&gt;https://docs.python.org.tw&lt;/a&gt; è¨ªå• Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–ç¶²ç«™ã€‚&lt;/p&gt;
&lt;p&gt;Server æœ¬èº«çš„è¨­å®šå¯ä»¥åƒè€ƒ&lt;a href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/"&gt;ä¹‹å‰çš„æ–‡ç« &lt;/a&gt;ã€‚åŠ å…¥ HTTPS å°±è¦è¨­å®šç›¸é—œçš„æ†‘è¨¼ï¼Œæˆ‘é¸æ“‡ &lt;a href="https://letsencrypt.org/"&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; åšç‚ºæ†‘è¨¼çš„ç°½ç½²è€…ã€‚&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s Encrypt (LE) ä½¿ç”¨ AMCE (Automated Certificate Management Environment) protocol åŽ»é©—è¨¼ä½ æ˜¯å¦æ“æœ‰ä½ æ¬²ç°½è¨¼çš„ domainã€‚å®˜ç¶²ä¸Šæœ‰&lt;a href="https://letsencrypt.org/howitworks/technology/"&gt;åœ–æ–‡èªªæ˜Ž&lt;/a&gt;ï¼Œç°¡å–®ä¾†èªªï¼ŒLE æœƒè¦æ±‚ä½ çš„ server åœ¨ç‰¹å®šçš„ path åŠ å…¥ç‰¹å®šçš„æª”æ¡ˆï¼Œå¦‚æžœä½ åšå¾—åˆ°ï¼Œå°±ä»£è¡¨ä½ æ“æœ‰é€™å€‹ domainã€‚é€™æ¨£çš„ç°½è¨¼ç¬¬ä¸€æ¬¡è¦åœ¨ LE server ä¸Šè¨»å†Šï¼Œä¹‹å¾Œæœ€é•·æ¯ 90 å¤©èªè¨¼ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;åƒè€ƒè³‡æ–™&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#lets-encrypt-certificate"&gt;Let&amp;rsquo;s Encrypt Certificate&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#systemd-timer-certificate"&gt;è¨­å®š systemd timer å®šæ™‚æ›´æ–° certificate&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#systemd-service"&gt;Systemd service&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#systemd-timer"&gt;Systemd Timer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#nginx-http-redirect-to-https"&gt;nginx HTTP redirect to HTTPS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#https"&gt;æ¸¬è©¦ HTTPS è¨­å®š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;å¿ƒå¾—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#misc"&gt;Misc.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="_1"&gt;åƒè€ƒè³‡æ–™&lt;/h3&gt;
&lt;p&gt;æˆ‘ä¸æ˜¯ç¶²è·¯å®‰å…¨ç›¸é—œçš„å°ˆå®¶ï¼Œè¨­å®šéƒ½æ˜¯åƒè€ƒç¶²è·¯ä¸Šçš„èªªæ˜Žæ•´ç†è€Œæˆã€‚LE certificate çš„è¨­å®šåƒè€ƒ &lt;a href="https://robmclarty.com/blog/how-to-secure-your-web-app-using-https-with-letsencrypt"&gt;&lt;em&gt;How to Secure Your Web App Using HTTPS With Letsencrypt&lt;/em&gt;&lt;/a&gt; by Rob McLarty é€™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;
&lt;h3 id="lets-encrypt-certificate"&gt;Let&amp;rsquo;s Encrypt Certificate&lt;/h3&gt;
&lt;p&gt;æ²’æœ‰ä½¿ç”¨ LE å®˜æ–¹çš„ clientï¼Œè€Œæ˜¯ç”¨ &lt;a href="https://daylightpirates.org/"&gt;Daniel Roesler&lt;/a&gt; æ‰€å¯«çš„ &lt;a href="https://github.com/diafygi/acme-tiny/"&gt;acme-tiny&lt;/a&gt;ã€‚é€™æ˜¯ä¸€å€‹ä¸åˆ° 200 è¡Œçš„ Python scriptï¼Œå¯ä»¥è‡ªè¡Œæª¢æŸ¥å®ƒæœ‰æ²’æœ‰åšä»»ä½•å¥‡æ€ªçš„äº‹ã€‚&lt;a href="https://github.com/diafygi/acme-tiny/"&gt;acme-tiny&lt;/a&gt; çš„ README ä¹Ÿæœ‰å€‹è¨­å®šæ•™å­¸ï¼Œæ‡‰è©²æ˜¯å¤§åŒå°ç•°ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šéƒ½æ˜¯ç…§è‘— &lt;a href="https://robmclarty.com/blog/how-to-secure-your-web-app-using-https-with-letsencrypt"&gt;&lt;em&gt;How to Secure Your Web App Using HTTPS With Letsencrypt&lt;/em&gt;&lt;/a&gt; è©²ç¯‡æ–‡ç« åšï¼Œä¸éŽæœ‰èª¿æ•´äº†ä»¥ä¸‹çš„æ±è¥¿ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å»ºç«‹ letsencrypt å¸³è™Ÿæ™‚ï¼Œç¦æ­¢ä½¿ç”¨ password loginã€‚&lt;br&gt;
   å³ï¼š &lt;code&gt;adduser --disabled-password ...&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ git ç®¡ç† &lt;a href="https://github.com/diafygi/acme-tiny/"&gt;acme-tiny&lt;/a&gt; scriptã€‚&lt;/li&gt;
&lt;li&gt;æ”¹ç”¨ systemd æŽ§åˆ¶ nginxï¼Œè€Œä¸æ˜¯é€éŽ serviceã€‚&lt;br&gt;
   å³ï¼š &lt;code&gt;systemctl reload nginx&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ²’æœ‰ç”¨ crontab è€Œæ˜¯ä½¿ç”¨ &lt;a href="https://wiki.archlinux.org/index.php/Systemd/Timers"&gt;systemd Timers&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é‡æ–°å°Žå¼• http é€£ç·šè‡³ httpsã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ 4ã€5 é»žè¨­å®šæ¯”è¼ƒå¤šï¼Œæ•´ç†åˆ°å¾Œé¢ã€‚&lt;/p&gt;
&lt;h3 id="systemd-timer-certificate"&gt;è¨­å®š systemd timer å®šæ™‚æ›´æ–° certificate&lt;/h3&gt;
&lt;p&gt;é€™é‚Šåƒè€ƒ &lt;a href="http://www.certdepot.net/rhel7-use-systemd-timers/"&gt;&lt;em&gt;RHEL7: How to use Systemd timers.&lt;/em&gt;&lt;/a&gt; ä¸€æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;Systemd Timer æ¦‚å¿µå¦‚åŒ crontabï¼Œä½†å·®åˆ¥æ˜¯ä½¿ç”¨ timer å³èˆ‡ systemd æ•´åˆã€‚&lt;code&gt;&amp;lt;unit&amp;gt;.timer&lt;/code&gt; å¯ä»¥å®šæœŸåŸ·è¡Œ &lt;code&gt;&amp;lt;unit&amp;gt;.service&lt;/code&gt;ï¼Œæ‰€ä»¥ &lt;unit&gt; åŸ·è¡Œçš„çµæžœèˆ‡ç‹€æ…‹éƒ½èƒ½é¡¯ç¤ºåœ¨ systemd ä¸­ï¼Œä¹Ÿå¸¶å…¥äº† journald æœ‰çš„ logging åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ›´æ–° certificate çš„æŒ‡ä»¤å¯«åœ¨ &lt;code&gt;/etc/letsencrypt/renew_cert.sh&lt;/code&gt;ã€‚Shell script çš„å…§å®¹èˆ‡åƒè€ƒæ–‡ç« ä¸€æ¨£ã€‚&lt;/p&gt;
&lt;h4 id="systemd-service"&gt;Systemd service&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆå»ºç«‹ä¸€å€‹ renew_certï¼Œä»¥ Debian ç‚ºä¾‹æ”¾åœ¨ &lt;code&gt;/etc/systemd/system/renew_cert.service&lt;/code&gt;ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Renew Let&amp;#39;s Encrypt cert&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog.target&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;User&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;letsencrypt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;Group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;letsencrypt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/etc/letsencrypt/renew_cert.sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;simple&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;StandardError&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;syslog&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¦æ‰‹å‹•æ›´æ–° certificate çš„æ™‚å€™åŸ·è¡Œé€™å€‹ service å³å¯ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;systemctl start renew_cert
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘ä¸éœ€è¦ enable å®ƒï¼Œä¸ç„¶æ¯æ¬¡é–‹æ©Ÿéƒ½æœƒåŸ·è¡Œä¸€æ¬¡ã€‚çœ‹çµæžœæˆ–è¨˜éŒ„ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;systemctl status renew_cert
journalctl -e -u renew_cert
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="systemd-timer"&gt;Systemd Timer&lt;/h4&gt;
&lt;p&gt;å»ºç«‹ä¸€å€‹ &lt;code&gt;/etc/systemd/system/renew_cert.timer&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Update Let&amp;#39;s Encrypt certificate every two months&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;[Timer]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;OnCalendar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;*-1/2-1 16:00:00&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;Unit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;renew_cert.service&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡é»žåªæœ‰ &lt;code&gt;[Timer]&lt;/code&gt; é€™ directiveã€‚&lt;code&gt;Unit=&lt;/code&gt; è¡¨ç¤ºè¦å•Ÿå‹•çš„ serviceã€‚&lt;code&gt;OnCalendar=&lt;/code&gt;&lt;sup id="fnref:calendar"&gt;&lt;a class="footnote-ref" href="#fn:calendar"&gt;1&lt;/a&gt;&lt;/sup&gt; å‰‡æ˜¯è¨­å®šé€™ timer æ ¹æ“šæŒ‡å®šçš„æ™‚é–“é»ž (UTC æ™‚é–“&lt;sup id="fnref:utc"&gt;&lt;a class="footnote-ref" href="#fn:utc"&gt;2&lt;/a&gt;&lt;/sup&gt;) å•Ÿå‹•ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥é€™é‚Šå¯«çš„æ™‚é–“ &lt;code&gt;*-1/2-1 16:00:00&lt;/code&gt; ç‚ºä¾‹ï¼Œä»£è¡¨æ¯å¹´çš„ 1+2n æœˆ 1 æ—¥ 16:00 UTC æ›´æ–° certificateï¼Œå³è‡ºç£æ™‚é–“ 1ã€3ã€5ã€â€¦â€¦æœˆ 2 æ—¥å‡Œæ™¨æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;å•Ÿç”¨ timerï¼Œå®ƒéœ€è¦è¢« enable ç¢ºä¿é‡é–‹æ©Ÿæ™‚è¢«åŸ·è¡Œã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;systemctl enable renew_cert.timer
systemctl start renew_cert.timer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥ç”¨ &lt;code&gt;systemctl list-timers&lt;/code&gt; æª¢æŸ¥å®ƒä¸‹æ¬¡åŸ·è¡Œçš„æ™‚é–“ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo systemctl list-timers renew_cert.timer
&lt;span class="go"&gt;NEXT                         LEFT                LAST PASSED UNIT             ACTIVATES&lt;/span&gt;
&lt;span class="go"&gt;Tue 2016-03-01 16:00:00 UTC  1 weeks 2 days left n/a  n/a    renew_cert.timer renew_cert.service&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="nginx-http-redirect-to-https"&gt;nginx HTTP redirect to HTTPS&lt;/h3&gt;
&lt;p&gt;ï¼ˆé€™é‚Šè¨­å®šæˆ‘æ²’ä¿¡å¿ƒï¼Œæœ‰æ›´å¥½çš„è¨­å®šæ–¹æ³•æ­¡è¿Žå‘Šè¨´æˆ‘ &amp;gt; &amp;lt;ï¼‰&lt;/p&gt;
&lt;p&gt;è¦è§£æ±ºçš„å•é¡Œç‚ºï¼ŒACME challenge æ˜¯é€éŽ HTTPï¼Œå…¶é¤˜çš„é€£ç·šéƒ½è½‰åˆ° HTTPSã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ nginx ä¸­æŠŠä¸»è¦çš„è¨­å®šæª”ä¸­æ‹¿æŽ‰ &lt;code&gt;listen 80;&lt;/code&gt; èˆ‡ ACM challenge çš„éƒ¨ä»½ã€‚æŠŠå®ƒå€‘ç§»æˆæ–°çš„ server blockï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;listen&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;server_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;docs.python.org.tw&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;# For Let&amp;#39;s Encrypt ACME challenge files&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/.well-known/acme-challenge/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;alias&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/var/www/challenges/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;try_files&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$uri&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;404&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;301&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;https://&lt;/span&gt;&lt;span class="nv"&gt;$host$request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="https"&gt;æ¸¬è©¦ HTTPS è¨­å®š&lt;/h3&gt;
&lt;p&gt;ç”¨äº† &lt;a href="https://securityheaders.io/"&gt;securityheaders.io&lt;/a&gt; å’Œ &lt;a href="https://www.ssllabs.com/index.html"&gt;SSL Labs&lt;/a&gt; æ¸¬è©¦äº†ä¸€ä¸‹ï¼Œæ‡‰è©²é‚„å¯ä»¥ï¼š&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/02/pydoctw-https/pics/pydoctw_securityheaders_report.png"/&gt;
  &lt;p class="caption center"&gt;Report from securityheaders.io (&lt;a href="https://securityheaders.io/?q=https%3A%2F%2Fdocs.python.org.tw%2F3%2F"&gt;Live Report&lt;/a&gt;)&lt;/p&gt;
&lt;/figure&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/02/pydoctw-https/pics/pydoctw_ssllabs_report.png"/&gt;
  &lt;p class="caption center"&gt;Report from SSL Labs (&lt;a href="https://www.ssllabs.com/ssltest/analyze.html?d=docs.python.org.tw"&gt;Live Report&lt;/a&gt;)&lt;/p&gt;
&lt;/figure&gt;

&lt;h3 id="_2"&gt;å¿ƒå¾—&lt;/h3&gt;
&lt;p&gt;ç¸½çµä¾†èªªï¼Œä½¿ç”¨ &lt;a href="https://letsencrypt.org/"&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; ä¸é›£ï¼Œä½†ä¹Ÿæ²’åˆ°éžå¸¸ç°¡å–®ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœä½ é¡˜æ„æŠŠ root å’Œ private key æ¬Šé™çµ¦å®ƒçš„è©±ï¼Œç”¨å®˜æ–¹ client æä¾›çš„ &lt;code&gt;letsencrypt-auto&lt;/code&gt; æ­¥é©Ÿèƒ½æ›´å°‘ï¼Œç”¨ Apache å®ƒè²ç¨±èƒ½å…¨è‡ªå‹•è¨­å®šã€‚è¦ºå¾— &lt;a href="https://github.com/diafygi/acme-tiny/"&gt;acme-tiny&lt;/a&gt; æŒ‡ä»¤å¤ªè¤‡é›œçš„è©±ï¼ŒåŽŸä½œè€…ä¹Ÿå¯«äº†ä¸€å€‹ &lt;a href="https://gethttpsforfree.com/"&gt;Get HTTPS for free!&lt;/a&gt; æœå‹™ï¼Œç”¨ç¶²é çš„æ–¹å¼å”åŠ©æ•´å€‹è¨»å†Šæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;è¦æ³¨æ„ç›®å‰ public beta éšŽæ®µï¼Œç›¸åŒ domain åœ¨ 7 å¤©åªèƒ½è¢«ç°½ç½² 5 æ¬¡ï¼Œæ¸¬è©¦çš„æ™‚å€™ä¸è¦å¤ªè¡å‹•ä¸ç„¶å°±è¦ç­‰ä¸€é€±äº†ã€‚&lt;/p&gt;
&lt;h3 id="misc"&gt;Misc.&lt;/h3&gt;
&lt;p&gt;å»ºç«‹ CSR (Certificate Signing Request) æª”æ™‚ï¼Œå¯ä»¥åŠ å…¥è‡ªå·±çš„ email åœ°å€ï¼Œä¸ç„¶é è¨­æ˜¯ &lt;code&gt;webmaster@&amp;lt;domain&amp;gt;&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl req -new -sha256 &lt;span class="se"&gt;\&lt;/span&gt;
    -key /etc/letsencrypt/private/domain.key &lt;span class="se"&gt;\&lt;/span&gt;
    -subj &lt;span class="s2"&gt;&amp;quot;/CN=docs.python.org.tw/emailAddress=me+pydoctw@liang2.tw&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &amp;gt; /etc/letsencrypt/private/domain.csr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:calendar"&gt;
&lt;p&gt;é™¤äº† &lt;code&gt;OnCalendar&lt;/code&gt; é‚„æœ‰å¾ˆå¤šè¨­å®š timer çš„æ–¹å¼ï¼Œå¦‚ &lt;code&gt;OnUnitActiveSec&lt;/code&gt;ã€‚ä¸éŽå…¶ä»–çš„æ™‚é–“ç®—æ³•ï¼Œéƒ½æœƒå—æœ‰æ²’æœ‰é–‹æ©Ÿï¼Œå½±éŸ¿æ™‚é–“çš„è¨ˆç®—ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:calendar" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:utc"&gt;
&lt;p&gt;Debian Jessie çš„ &lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.time.html#Calendar%20Events"&gt;systemd.time (7)&lt;/a&gt; Calendar Events è£¡ä¸¦æ²’æœ‰æŒ‡å®šæ™‚å€çš„æ–¹å¼ï¼Œæ‰€ä»¥åŠ ä¸Šæ™‚å€æœƒæœ‰ parse errorã€‚ä½†æ–°ç‰ˆçš„ systemd ä¼¼ä¹Žæ”¯æ´æ™‚å€ã€‚ç¸½ä¹‹æ‡‰è©²ç”¨ &lt;code&gt;systemctl list-timers&lt;/code&gt; ç¢ºå®šåŸ·è¡Œçš„æ™‚é–“ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:utc" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="pydoctw"></category><category term="https"></category><category term="letsencrypt"></category></entry><entry><title>Add code block language name into CSS classes in Pelican Markdown</title><link href="https://blog.liang2.tw/posts/2016/02/markdown-codehilite-lang/" rel="alternate"></link><published>2016-02-19T15:00:00-06:00</published><updated>2022-05-13T13:10:32-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-02-19:/posts/2016/02/markdown-codehilite-lang/</id><summary type="html">&lt;p&gt;I used &lt;a href="http://docs.getpelican.com/"&gt;Pelican&lt;/a&gt; and its &lt;a href="https://pythonhosted.org/Markdown/"&gt;Markdown&lt;/a&gt; plugin to render blog post.&lt;/p&gt;
&lt;p&gt;Recently I was playing with the &lt;a href="https://docs.python.org/"&gt;Python Official Documentation&lt;/a&gt;, which has a decent code syntax highlighter powered by &lt;a href="http://pygments.org/"&gt;Pygments&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;What&amp;rsquo;s more, the output of code examples can be toggled. That is, a code example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Hello World&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Hello â€¦&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;I used &lt;a href="http://docs.getpelican.com/"&gt;Pelican&lt;/a&gt; and its &lt;a href="https://pythonhosted.org/Markdown/"&gt;Markdown&lt;/a&gt; plugin to render blog post.&lt;/p&gt;
&lt;p&gt;Recently I was playing with the &lt;a href="https://docs.python.org/"&gt;Python Official Documentation&lt;/a&gt;, which has a decent code syntax highlighter powered by &lt;a href="http://pygments.org/"&gt;Pygments&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;What&amp;rsquo;s more, the output of code examples can be toggled. That is, a code example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Hello World&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Hello&lt;/span&gt; &lt;span class="n"&gt;World&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;
&lt;span class="mi"&gt;42&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;can be toggled to:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Hello World&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;which is very convenient for code copy-pasting.&lt;/p&gt;
&lt;p&gt;&lt;del&gt;However, the functionality is currently failed on the official Python doc (given by &lt;a href="https://docs.python.org/3/_static/copybutton.js"&gt;&lt;code&gt;copybutton.js&lt;/code&gt;&lt;/a&gt;) because the jQuery updates break previous API behavior. I&amp;rsquo;ve filed &lt;a href="http://bugs.python.org/issue26246"&gt;issue 26246&lt;/a&gt; on the Python issue tracker for this problem.&lt;/del&gt; (EDIT 2016-02-27: the patch has been merged.)&lt;/p&gt;
&lt;h3 id="code-output-toggle-in-pelican"&gt;Code output toggle in Pelican&lt;/h3&gt;
&lt;p&gt;After I fixed the copybutton.js, I wished to add this functionality to my blog.&lt;/p&gt;
&lt;p&gt;Code highlighting in Pelican markdown files is handled by its &lt;a href="https://pythonhosted.org/Markdown/extensions/code_hilite.html"&gt;CodeHilite&lt;/a&gt; extension. To my surprise, I found CodeHilite does not express the language name specified for each code block.&lt;/p&gt;
&lt;p&gt;What I expected was&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;highlight-python3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;highlight&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;pre&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
            &lt;span class="cm"&gt;&amp;lt;!-- ... --&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;pre&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;but the actual output was&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;highlight&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;pre&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="cm"&gt;&amp;lt;!-- ... --&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;pre&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So no way to find the language name the code block used, nor the lexer aliases Pygments guessed when no language name was specified.&lt;/p&gt;
&lt;p&gt;A quick dig into the &lt;a href="https://github.com/waylan/Python-Markdown/blob/master/markdown/extensions/codehilite.py#L106-L123"&gt;source code&lt;/a&gt; showed that it is relatively easy to fix. Here is the diff:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gh"&gt;diff --git a/extensions/codehilite.py b/extensions/codehilite_updated.py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gh"&gt;index 0657c37..4fad7c5 100644&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gd"&gt;--- a/extensions/codehilite.py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+++ b/extensions/codehilite_updated.py&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gu"&gt;@@ -75,7 +75,8 @@ class CodeHilite(object):&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt; &lt;/span&gt;    def __init__(self, src=None, linenums=None, guess_lang=True,&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                 css_class=&amp;quot;codehilite&amp;quot;, lang=None, style=&amp;#39;default&amp;#39;,&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gd"&gt;-                 noclasses=False, tab_length=4, hl_lines=None, use_pygments=True):&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                 noclasses=False, tab_length=4, hl_lines=None, use_pygments=True,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                 wrap_by_lang=True):&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        self.src = src&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        self.lang = lang&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        self.linenums = linenums&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gu"&gt;@@ -86,6 +87,7 @@ class CodeHilite(object):&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        self.tab_length = tab_length&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        self.hl_lines = hl_lines or []&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        self.use_pygments = use_pygments&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+        self.wrap_by_lang = wrap_by_lang&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt; &lt;/span&gt;    def hilite(self):&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gu"&gt;@@ -114,13 +116,22 @@ class CodeHilite(object):&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                        lexer = get_lexer_by_name(&amp;#39;text&amp;#39;)&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                except ValueError:&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                    lexer = get_lexer_by_name(&amp;#39;text&amp;#39;)&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+            lang = lexer.aliases[0]&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;            formatter = get_formatter_by_name(&amp;#39;html&amp;#39;,&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                                              linenos=self.linenums,&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                                              cssclass=self.css_class,&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                                              style=self.style,&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                                              noclasses=self.noclasses,&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;                                              hl_lines=self.hl_lines)&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gd"&gt;-            return highlight(self.src, lexer, formatter)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+            hilited_html = highlight(self.src, lexer, formatter)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+            if self.wrap_by_lang and self.lang:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                return &amp;#39;&amp;lt;div class=&amp;quot;%(class)s-%(lang)s&amp;quot;&amp;gt;%(html)s&amp;lt;/div&amp;gt;\n&amp;#39; % {&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                    &amp;#39;class&amp;#39;: self.css_class,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                    &amp;#39;lang&amp;#39;: lang.replace(&amp;#39;+&amp;#39;, &amp;#39;-&amp;#39;),&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                    &amp;#39;html&amp;#39;: hilited_html,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                }&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+            else:&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gi"&gt;+                return hilited_html&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;        else:&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;            # just escape and build markup usable by JS highlighting libs&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;            txt = self.src.replace(&amp;#39;&amp;amp;&amp;#39;, &amp;#39;&amp;amp;amp;&amp;#39;)&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I&amp;rsquo;m happy with the patched codehilite output. I am now able to give code toggle function to specific code languages.&lt;/p&gt;
&lt;p&gt;However it&amp;rsquo;s quite busy these days, so it may take a while to submit a proper pull request (e.g. fix any broken unit tests, write new tests, and tune the API as well as the new behavior). Moerover, &lt;strong&gt;currently my site does not use jQuery&lt;/strong&gt; so I am missing a huge dependency. Rewriting it using vanilla JS seems to require considerable work, and the very thing I don&amp;rsquo;t have at hand is time :(&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve decided to leave this improvement in future development. But if your site use Pelican Markdown and imports jQuery, the diff will add the code language back.&lt;/p&gt;</content><category term="Coding"></category><category term="en"></category><category term="blog"></category><category term="pelican"></category><category term="codehilite"></category><category term="pygment"></category></entry><entry><title>è¨­å®š Python å®˜æ–¹æ–‡ä»¶ä¸­æ–‡åŒ–è‡ªå‹•æ›´æ–° Server</title><link href="https://blog.liang2.tw/posts/2016/02/pydoctw-server/" rel="alternate"></link><published>2016-02-14T21:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-02-14:/posts/2016/02/pydoctw-server/</id><summary type="html">&lt;p&gt;è¨­å®šä¸€å€‹è‡ªå‹•æ›´æ–° Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯ä¸¦ä¸” host ä¸­æ–‡åŒ–ç¶²é ç‰ˆæ–‡ä»¶çš„ serverã€‚ä½¿ç”¨ Django ä½œ web serverã€Django-Q åšç‚º task queueï¼Œdeploy stack ç”¨ nginxã€uWSGIï¼Œhost æ–¼ Amazon EC2 (Debian Jessie)ï¼Œè³‡æ–™åº«ç”¨ PostgreSQLï¼Œä¸¦ç”¨ systemd ç®¡ç†ç›¸é—œçš„ processã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;TL;DR&lt;/em&gt; å¯è‡³ &lt;a href="http://docs.python.org.tw"&gt;http://docs.python.org.tw&lt;/a&gt; çœ‹ç·šä¸Šè‡ªå‹•æ›´æ–°çš„&lt;a href="http://docs.python.org.tw/3/"&gt;ä¸­æ–‡åŒ–çš„æ–‡ä»¶&lt;/a&gt;å’Œ &lt;a href="http://docs.python.org.tw/_build/"&gt;build server&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;EDIT 2016-02-16: åŠ ä¸Š language codeã€git sshconfigã€swap çš„è¨­å®šï¼›æ–‡å¥æ½¤é£¾ã€‚&lt;br&gt;
EDIT 2016-02-20: åŠ ä¸Š tmpfiles.d çš„è¨­å®šã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#python"&gt;Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sphinx"&gt;Sphinx æ–‡ä»¶å¤šåœ‹èªžè¨€æž¶æ§‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#transifex-po"&gt;Transifex ç·šä¸Šæœå‹™è®“å¤šäººå…±åŒç¿»è­¯ po æª”&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç¿»è­¯é«”é©—æ”¹å–„&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#pydoc-autobuild-server"&gt;PyDoc Autobuild Server&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_2"&gt;å¯¦ä½œ&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sphinx_1"&gt;Sphinx æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#autobuild-django-server"&gt;Autobuild Django server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#autobuild-server"&gt;Autobuild server éƒ¨ç½²&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_3"&gt;ä½œæ¥­ç³»çµ±&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python-35-and-apt-pinning"&gt;Python 3.5 and APT-pinning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;è³‡æ–™åº« PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#swap"&gt;Swap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git-repo-ssh-config"&gt;Git repo ssh config&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#tmpfilesd"&gt;tmpfiles.d&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-stack-nginx-uwsgi"&gt;Django Stack &amp;ndash; nginx + uWSGI&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#nginx"&gt;nginx è¨­å®š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#uwsgi"&gt;uWSGI è¨­å®š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#systemd-services"&gt;Systemd services&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="python"&gt;Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘ä¸€æ®µæ™‚é–“éƒ½åœ¨æº–å‚™ &lt;a href="https://github.com/python-doc-tw/python-doc-tw"&gt;Python èªªæ˜Žæ–‡ä»¶ä¸­æ–‡ç¿»è­¯è¨ˆç•«&lt;/a&gt;ã€‚ç¿»è­¯æœ¬èº«é›–ç„¶é‚„æ²’å¾ˆç©æ¥µåœ°é€²è¡Œï¼Œä½†ç¶“éŽ&lt;a href="http://www.meetup.com/Taipei-py/events/226558484/"&gt;å‰&lt;/a&gt;&lt;a href="http://www.meetup.com/Taipei-py/events/227001232/"&gt;å¹¾æ¬¡&lt;/a&gt; Taipei.py Projects On çš„ sprint æ´»å‹•ï¼Œå·²ç¶“æœ‰è »å¤šäººåŠ å…¥ç¿»è­¯çš„è¡Œåˆ—ã€‚å¤§å®¶éƒ½æœ‰å„è‡ªç¿»è­¯çš„ä¸»é¡Œï¼Œåƒæˆ‘è‡ªå·±æ˜¯å¾ž &lt;a href="http://docs.python.org.tw/3/tutorial/index.html"&gt;Tutorial&lt;/a&gt; çš„éƒ¨ä»½é–‹å§‹ç¿»è­¯ã€‚&lt;/p&gt;
&lt;h3 id="sphinx"&gt;Sphinx æ–‡ä»¶å¤šåœ‹èªžè¨€æž¶æ§‹&lt;/h3&gt;
&lt;p&gt;å…ˆç°¡ä»‹ä¸€ä¸‹ &lt;a href="https://docs.python.org/3/"&gt;CPython Documentation&lt;/a&gt;ï¼ˆä¸‹ç¨± pydocï¼‰çš„æž¶æ§‹å’Œç¿»è­¯æ–¹å¼ã€‚pydoc æ˜¯æ¨™æº–çš„ &lt;a href="http://www.sphinx-doc.org/en/stable/"&gt;Sphinx&lt;/a&gt; æ–‡ä»¶ï¼Œå› æ­¤ç¿»è­¯ä½¿ç”¨ Sphinx è‡ªå¸¶çš„ &lt;a href="http://www.sphinx-doc.org/en/stable/intl.html"&gt;internationalization&lt;/a&gt; (i18n or intl) åŠŸèƒ½æŠŠæ–‡ä»¶çš„å…§å®¹è½‰æ›åˆ°åˆ¥çš„èªžè¨€ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¦‚åŒ Django ç­‰å°ˆæ¡ˆï¼Œi18n éƒ½æ˜¯é€éŽ gettextï¼ŒSphinx æœƒæŒ‰ç…§ rst æª”æ¡ˆè¼¸å‡ºåŒæª”åçš„ po æª”ã€‚rst æª”æ¡ˆä¸­çš„æ¯å€‹æ–‡å­—æ®µè½æœƒå°æ‡‰åˆ° po æª”ä¸€å€‹ entryï¼Œä¸ç›¸å¹²çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ç­‰æ®µè½æœƒè¢«è·³éŽã€‚è¼¸å‡ºçš„ po æª”æ”¾åœ¨å°æ‡‰çš„è·¯å¾‘ä¾‹å¦‚ &lt;code&gt;locale/&amp;lt;lang&amp;gt;/LC_MESSAGES/xxx.po&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Gettext"&gt;po æª”çš„æ ¼å¼&lt;/a&gt;å¾ˆç°¡å–®ï¼Œè·³éŽæœ‰çš„æ²’çš„ headerï¼Œå¯¦è³ªå…§å®¹é•·é€™æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kd"&gt;#: ../../tutorial/appetite.rst:50&lt;/span&gt;
&lt;span class="nv"&gt;msgid&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Python enables programs to be written compactly and readably.  Programs &amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;written in Python are typically much shorter than equivalent C,  C++, or &amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Java programs, for several reasons:&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;msgstr&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Python è®“ç¨‹å¼å¯«å¾—ç²¾ç°¡ä¸¦æ˜“è®€ã€‚ç”¨ Python å¯¦ä½œçš„ç¨‹å¼é•·åº¦å¾€å¾€é æ¯”ç”¨ &amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Cã€C++ã€Java å¯¦ä½œçš„çŸ­ã€‚é€™æœ‰ä»¥ä¸‹å¹¾å€‹åŽŸå› ï¼š&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯¦éš›ä¸Š Sphinx æœƒå…ˆè¼¸å‡ºä¸€ä»½ä¹¾æ·¨çš„ po æª”ç¯„æœ¬ï¼ˆç¨±ç‚º pot æª”ï¼‰åˆ° &lt;code&gt;locale/pot/&lt;/code&gt;ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åªæœ‰åŽŸæ–‡çš„ po æª”ã€‚æ¯å¢žåŠ ä¸€å€‹æ–°èªžè¨€å°±æœƒå¾ž pot æª”è£½ä½œä¸€ä»½ po æª”åˆ°å„è‡ªçš„ &lt;code&gt;locale/&amp;lt;lang&amp;gt;/&lt;/code&gt; ç›®éŒ„ä¸‹ï¼Œç¿»è­¯æ™‚å°±ä¿®æ”¹é‚£ä»½ po æª”å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;p&gt;ç¿»è­¯å®Œæˆå¾Œï¼Œé¦–å…ˆ Sphinx æœƒå…ˆå‘¼å« gettext æŠŠ po æª”ç·¨è­¯æˆ mo æª”åŠ é€Ÿæœå°‹ç¿»è­¯å­—ä¸²é€Ÿåº¦ã€‚è¼¸å‡ºç¿»è­¯å¾Œçš„æ–‡ä»¶åªè¦è¨­å®šä¸åŒèªžè¨€ï¼ŒSphinx å°±æœƒåŽ»æ‰¾è©²èªžè¨€çš„ mo æª”ï¼Œä¸¦æŠŠåŽŸæ–‡å­—ä¸²æ›æˆ mo æª”è£¡çš„å…§å®¹ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸­æ–‡çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id="transifex-po"&gt;Transifex ç·šä¸Šæœå‹™è®“å¤šäººå…±åŒç¿»è­¯ po æª”&lt;/h3&gt;
&lt;p&gt;æ•´å€‹ Sphinx æ–‡ä»¶ç¿»è­¯æµç¨‹å°±é€™æ¨£ï¼Œæ‰€ä»¥ç¿»è­¯åªè¦ç·¨è¼¯ä¸­æ–‡ (lang code: zh-Hant&lt;sup id="fnref:zh-Hant"&gt;&lt;a class="footnote-ref" href="#fn:zh-Hant"&gt;1&lt;/a&gt;&lt;/sup&gt;) çš„ po æª”å°±å¥½äº†ã€‚ä¸éŽè¦ç›´æŽ¥å¯« po æª”æ ¼å¼é–€æª»é‚„æ˜¯å¤ªé«˜ï¼Œæ–¼æ˜¯å°±æœ‰åƒ &lt;a href="https://www.transifex.com/"&gt;Transifex&lt;/a&gt; é€™æ¨£çš„ç¶²ç«™ã€‚ä¸Šå‚³ po/pot æª”å°±èƒ½ç·šä¸Šä¿®æ”¹ç¿»è­¯ï¼Œç„¶å¾Œå†æŠŠç¿»å®Œçš„çµæžœç”¨ po æª”æ ¼å¼ä¸‹è¼‰ä¸‹ä¾†ã€‚æˆ‘èªç‚ºé€™æ˜¯ç¾åœ¨åƒåŠ ä»¥ gettext-based PO æª”ç¿»è­¯é–€æª»æœ€ä½Žçš„æ–¹å¼ï¼Œè‡³å°‘æ—¥æœ¬ä¹Ÿæ˜¯é€™éº¼åšã€‚æ–¼æ˜¯æƒ³è¦åƒè€ƒ pydoc ç¿»è­¯çš„äººï¼Œåªè¦ç™»å…¥ Transifex å°±å¯ä»¥é–‹å§‹ç·¨è¼¯ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ Transifex é‚„æœ‰é¡å¤–çš„å¥½è™•ã€‚ä¾‹å¦‚ä»–æœ‰ POS tagging å¯ä»¥æ¨™æ³¨å°ˆæœ‰åè©žï¼Œå®šç¾©çµ±ä¸€çš„è­¯åï¼Œé€™äº›è­¯åæœƒæ•´ç†åœ¨ glossary terms è£¡ï¼Œç¿»è­¯æ™‚å‡ºç¾é€™äº›è©žå°±æœƒè‡ªå‹•æç¤ºã€‚é¡žä¼¼çš„åŽŸæ–‡æ–‡å¥ä¹Ÿæœƒæ”¾åœ¨ suggestion è£¡ï¼Œè®“ç¿»è­¯å®Œçš„ç”¨èªžæ–‡æ³•ä¹Ÿèƒ½ä¸€è‡´ã€‚æ­¤å¤–ä¹Ÿæœ‰ä¿®æ”¹æ­·å²ã€é˜²å‘†æç¤ºï¼ˆå¦‚è©²æœ‰çš„æ ¼å¼æ²’åœ¨è­¯æ–‡å‡ºç¾ï¼‰ã€åŠ è¨»è§£ (comment)ã€è©•è«– (issue) ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;ç¿»è­¯é«”é©—æ”¹å–„&lt;/h3&gt;
&lt;p&gt;é€™æ®µæ™‚é–“ç¿»è­¯çš„ç”¨è©žã€æµç¨‹ç­‰è¦ç¯„éƒ½æœ‰å€‹é››åž‹äº†ï¼Œç›¸é—œçš„å…§å®¹éƒ½å¯ä»¥åœ¨&lt;a href="https://github.com/python-doc-tw/python-doc-tw/wiki"&gt;å°ˆæ¡ˆçš„ wiki&lt;/a&gt; è£¡æ‰¾åˆ°ã€‚æ‰€ä»¥é–‹å§‹æƒ³è¦æ€Žéº¼è®“å¤§å®¶æ›´å¥½åƒèˆ‡ç¿»è­¯å’Œçœ‹åˆ°ç¿»è­¯çš„çµæžœã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç™¼ç¾åƒåŠ ç¿»è­¯æœ¬èº«å·²ç¶“ä¸å›°é›£ï¼Œå¤§å®¶æ²’ä»€éº¼ç–‘å•ã€‚ç¶­è­·æ•´é«”çš„ç”¨è©žã€ç¿»è­¯è¨Žè«–ç”¨ Transifex issue å’Œ comment æ•ˆæžœä¸éŒ¯ã€‚æ•´é«”ä¸Šèƒ½ä¿æŒæ¥µåº¦åˆ†æ•£å¼çš„å·¥ä½œå½¢å¼ã€‚&lt;/p&gt;
&lt;p&gt;å¹³å¸¸é‡åˆ°æœ€å¤šå•é¡Œæ˜¯å‡ºç¾ rst æ ¼å¼éŒ¯èª¤ã€ç¼ºå°‘å¿…è¦çš„ç©ºç™½ã€å‰å¾Œæ–‡åŠ ä¸Šç¨‹å¼ç¢¼ç¯„ä¾‹ä¹‹å¾Œä¸é€šé †ã€è­¯æ–‡æ›²è§£æˆ–èª¤æœƒåŽŸæ–‡çš„æ„æ€ã€‚é€™äº›å•é¡Œï¼Œæˆ‘è¦ºå¾—åªè¦è‡ªå·±è®€éŽç¿»å®Œçš„ pydoc è©²é ã€çœ‹ä¸€ä¸‹è¼¸å‡ºçš„ log å°±èƒ½æ˜Žç™½ï¼Œä¹Ÿä¸éœ€è¦æˆ‘å¤šä½œè§£é‡‹ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†ï¼Œçœ‹ä¸åˆ°è‡ªå·±ç¿»è­¯çš„æˆæžœ&lt;strong&gt;å¾ˆæ²’æœ‰æˆå°±æ„Ÿ&lt;/strong&gt;ï¼ŒéŽä¸€æ®µæ™‚é–“æˆ‘æ€•æœƒå¤±åŽ»å‹•åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯è®Šæˆéœ€è¦ä¸€ä»½ä¿æŒæ›´æ–°çš„ç¿»è­¯æˆæžœã€‚ç•¶ç„¶è‡ªå·±è¼¸å‡º doc çš„æ–¹æ³•éƒ½æœ‰å¯«åœ¨ &lt;a href="https://github.com/python-doc-tw/python-doc-tw/wiki/How-to-build-the-doc-locally"&gt;wiki&lt;/a&gt; è£¡ï¼Œä½†æ­¥é©Ÿå¾ˆå¤šï¼Œèªªç°¡å–®ä¹Ÿæ²’å¤šç°¡å–®ï¼Œè€Œä¸”æœ‰éŒ¯æˆ–æœ‰å•é¡Œå¯èƒ½éƒ½è¦ä¾†æ‰¾æˆ‘ï¼Œå°±å¤±åŽ»åˆ†æ•£å¼åˆ†å·¥çš„ç‰¹æ€§äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸å¦‚åšå€‹ autobuild serverã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯æœ‰äº†é€™æƒ³æ³•ã€‚ä½†å¯¦åœ¨æ˜¯å€‹å¤§å‘ï¼Œä¸€ç›´åªèƒ½ç”¨æƒ³çš„ã€‚åœ¨éŽå¹´çš„æ™‚å€™ç¸½ç®—æ‰¾åˆ°æ™‚é–“æŠŠ prototype åšå‡ºä¾†äº†ï¼Œå…¶å¯¦è »æœ‰æˆå°±æ„Ÿçš„ã€‚&lt;/p&gt;
&lt;h2 id="pydoc-autobuild-server"&gt;PyDoc Autobuild Server&lt;/h2&gt;
&lt;p&gt;ç°¡å–®æ•´ç†å¹¾å€‹éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PyDoc çµæžœç¶²å€å°æ‡‰æœ¬å®¶ &lt;a href="https://docs.python.org/"&gt;https://docs.python.org/&lt;/a&gt;ã€‚ä¾‹å¦‚ /3/ å°±æ˜¯ Python 3.x ç‰ˆæœ€æ–°çš„ï¼Œè€Œç¾åœ¨ /3.5/ å°±æœƒè‡ªå‹•è½‰å€åˆ° /3/&lt;sup id="fnref:pydoc-url"&gt;&lt;a class="footnote-ref" href="#fn:pydoc-url"&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸€é éƒ½æœ‰å€‹æ›´æ–°ç¿»è­¯é€£çµï¼Œé»žä¸€ä¸‹å°±æœƒå¾ž Transifex ä¸ŠæŠ“æ–°çš„ç¿»è­¯ï¼Œä¸¦æ›´æ–°è¼¸å‡ºã€‚&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ¯é ç¿»è­¯çš„æŒ‡ä»¤è¼¸å‡ºéƒ½è¦ä¿ç•™ï¼Œæ–¹ä¾¿æª¢æŸ¥ rst èªžæ³•ç­‰éŒ¯èª¤ã€‚&lt;/li&gt;
&lt;li&gt;æ›´æ–°ç¿»è­¯è¦æœ‰å€‹ queueï¼Œæ‰å¯ä»¥å¤šäººåˆä½œæ™‚ä¸ç‚¸æŽ‰ autobuild serverã€‚&lt;/li&gt;
&lt;li&gt;æ¯æ—¥æ›´æ–°å…¨éƒ¨çš„æ–‡ä»¶ï¼Œä¸¦ä¸”æŠŠæ›´æ–°åŠ åˆ° CPython-tw çš„ git repo ä¸­ã€‚æ›´æ–°çš„éŽç¨‹ä¸€æ¨£è¦æœ‰è¨˜éŒ„ã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šè¿°çš„æ‰€æœ‰åŠŸèƒ½éƒ½èƒ½åœ¨æœ¬æ©Ÿè¼•é¬†åœ°è¨­å®šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_2"&gt;å¯¦ä½œ&lt;/h3&gt;
&lt;p&gt;ç›®æ¨™å°±æ˜¯å®Œæˆä¸Šè¿°çš„éœ€æ±‚ã€‚pydoc åŸºæœ¬ä¸Šå°±æ˜¯å€‹ static siteï¼Œäº¤çµ¦ nginx è¨­å¥½è·¯å¾‘ host static files å°±å¯ä»¥ã€‚Pydoc Sphinx ç”¨ &lt;a href="http://jinja.pocoo.org/docs/dev/"&gt;Jinja2&lt;/a&gt; ä½œ HTML templateï¼Œæ‰€ä»¥åªè¦å¤šåŠ ä¸€äº›è®Šæ•¸å°±èƒ½æŽ§åˆ¶é é¢çš„è¼¸å‡ºï¼Œåœ¨ autobuild server ä¸Šæ™‚å°±å¯ä»¥åŠ ä¸Šé¡å¤–çš„é€£çµã€‚è€Œ Autobuild server æœ¬èº«æ˜¯å€‹ task queueï¼Œå…¶å¯¦åŠŸèƒ½å¾ˆç°¡å–®ï¼Œä½†ç‚ºäº†ç¶­è­·æ–¹ä¾¿ï¼Œä¸¦è€ƒæ…®åˆ° localã€production ç’°å¢ƒéƒ½è¦èƒ½å‹•çš„è©±ï¼Œé¸æ“‡ &lt;a href="https://www.djangoproject.com/"&gt;Django&lt;/a&gt; ç‚ºåŸºç¤Žã€‚çœŸçš„çµ¦ Django ç®¡ç†çš„å°±é¡¯ç¤º task queueã€task resultã€æŽ¥å— rebuild doc request é€™å¹¾å€‹ viewã€‚&lt;/p&gt;
&lt;h4 id="sphinx_1"&gt;Sphinx æ–‡ä»¶&lt;/h4&gt;
&lt;p&gt;åœ¨ Sphinx æ–‡ä»¶éƒ¨ä»½ä¸æƒ³æžå¤ªè¤‡é›œï¼Œå°±åœ¨æ¯ä¸€é åŠ ä¸Šä¸€å€‹è‡ªå·±çš„å°ˆå±¬é€£çµï¼Œæ‰“é€™å€‹ç¶²å€å°±æœƒåŠ å…¥ä¸€å€‹æ›´æ–°è©²é é¢çš„ task åˆ° autobuild server&lt;sup id="fnref:build-link"&gt;&lt;a class="footnote-ref" href="#fn:build-link"&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ autobuild æ™‚åŠ å…¥å°ˆå±¬é€£çµåªè¦ä¿®æ”¹ Sphinx doc template å³å¯ã€‚Sphinx åœ¨ build doc æ™‚å¯ä»¥é€éŽ &lt;a href="http://www.sphinx-doc.org/en/stable/man/sphinx-build.html#options"&gt;&lt;code&gt;-A &amp;lt;name=value&amp;gt;&lt;/code&gt;&lt;/a&gt; å¢žåŠ  Jinja2 template çš„è®Šæ•¸ï¼Œå°±å¯æŽ§åˆ¶ template render è¡Œç‚ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# &amp;lt;cpython-src&amp;gt;/Doc/tools/templates/layout.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt;- &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;autobuildi18n&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/_build/update/?source_path=&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;pagename&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Update Translation&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt;- &lt;span class="k"&gt;endif&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sphinx-build -A autobuildi18n=1&lt;/code&gt; æ™‚å°±æœƒåŒ…å«é€™å€‹ Jinja2 blockï¼Œå¤šé€™å€‹ Update Translation é€£çµã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.sphinx-doc.org/en/stable/templating.html#pagename"&gt;&lt;code&gt;{{ pagename }}&lt;/code&gt;&lt;/a&gt; æ˜¯æ¯é æ–‡ä»¶çš„ rst è·¯å¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="autobuild-django-server"&gt;Autobuild Django server&lt;/h4&gt;
&lt;p&gt;Django server ç›®æ¨™å°±æ˜¯æŽ¥å— task request å’Œé¡¯ç¤º task resultã€‚ä¸€å€‹æ¨™æº–çš„ task queue å°±æœ‰é€™äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Django ä¸Šçš„ task queue é¸æ“‡å¾ˆå¤šï¼Œå¾ž &lt;a href="https://www.djangopackages.com/"&gt;Django Packages&lt;/a&gt; ä¸Šçš„ &lt;a href="https://www.djangopackages.com/grids/g/workers-queues-tasks/"&gt;Workers, Queues, and Tasks&lt;/a&gt; ç›¸é—œçš„å¥—ä»¶å¯ä»¥çœ‹åˆ°æœ‰å¹¾å€‹æœ‰åœ¨æ›´æ–°è€Œä¸” up æ•¸å¤šçš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://celery.github.io/django-celery/"&gt;django-celery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://huey.readthedocs.org/en/latest/"&gt;huey&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/ui/django-rq"&gt;django-RQ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://policystat.github.io/jobtastic/"&gt;jobtastic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://django-q.readthedocs.org/"&gt;django-Q&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰£æŽ‰ä¸æ”¯æ´ Python 3 çš„å¥—ä»¶&lt;sup id="fnref:python3"&gt;&lt;a class="footnote-ref" href="#fn:python3"&gt;4&lt;/a&gt;&lt;/sup&gt;å¾Œï¼Œå°±å‰© django-celeryã€django-RQã€django-Q å¯ä»¥é¸ã€‚é€™è£¡é¢æœ€ç´…ä¹Ÿæœ€è€ç‰Œçš„æ˜¯ django-celery ï¼Œå®ƒèˆ‡ &lt;a href="http://www.celeryproject.org/"&gt;Celery&lt;/a&gt; æ•´åˆï¼ŒåŠŸèƒ½å®Œæ•´ä¸”ç©©å®šï¼Œæˆ‘ç”¨éŽä¹Ÿè¦ºå¾—ååˆ†ä¸éŒ¯ï¼Œç¼ºé»žæ˜¯åŠŸèƒ½å¤ªå¤šæœ‰é»žè¤‡é›œï¼ŒåŠ ä¸Šä¸åŒ message queue æ™‚æœƒæœ‰å¾ˆå¤šè¨­å®šè¦èª¿æ•´ï¼Œéœ€è¦ä¸€æ®µæ™‚é–“ä¸Šæ‰‹ã€‚ä¸€èˆ¬ Celery å¸¸è¦‹çš„æ­é…ä½¿ç”¨ &lt;a href="https://www.rabbitmq.com/"&gt;Rabbit-MQ&lt;/a&gt; å’Œ &lt;a href="http://redis.io/"&gt;Redis&lt;/a&gt;ï¼Œçš„ç¢ºåœ¨ task å¾ˆå¤šæ™‚æœ‰å¿…è¦ï¼Œä½†æˆ‘å€‘é€™å€‹ build doc ä¸€å¤©å¯èƒ½æ‰åå¹¾æ¬¡ï¼Œåœ¨ä¸éš”é›¢ build doc ç’°å¢ƒçš„æƒ…æ³åŒæ™‚é–“çš„ worker åªèƒ½æœ‰ä¸€å€‹ï¼Œä¸æœƒæœ‰æ•ˆèƒ½ä¸Šçš„å•é¡Œã€‚å› æ­¤æˆ‘å‚¾å‘åªè¦ä½¿ç”¨èˆ‡ Django åŒä¸€å€‹ database å°±å¥½ï¼Œä¸è¦å†æœ‰é¡å¤–éž Python çš„ dependencyï¼Œè®“ local é–‹ç™¼ç°¡å–®ä¸€é»žã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œé¸æ“‡ &lt;a href="https://django-q.readthedocs.org/"&gt;django-Q&lt;/a&gt;ã€‚é›–ç„¶å¾ˆæ–°ä½†ä½œè€…ç¶­è­·å¾—å¾ˆå‹¤ï¼Œworker å¯ä»¥åªç”¨ Python å…§å»ºçš„ multiprocessing å®Œæˆã€‚åŠŸèƒ½ç°¡å–®å»å®Œæ•´ï¼ŒåŒ…å« monitorï¼Œè·Ÿ django-admin æ•´åˆï¼Œé‚„å¯ä»¥æŽ’ç¨‹ã€‚æ‰€ä»¥è¦å•Ÿå‹• django-Q çš„ clusterï¼Œåªè¦å¤šä¸€å€‹ &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python manage.py qcluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å³å¯ï¼Œååˆ†æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;æ€Žéº¼ä½¿ç”¨ django-Q å°±ä¸åœ¨é€™ç¯‡ blog è¨Žè«–ç¯„åœå…§äº†ã€‚æˆ‘æƒ³æˆ‘æ‡‰è©²æœƒæŠ•ç¨¿ PyCon TW æˆ– Taipei.pyï¼Œåˆ°æ™‚å€™å†æ•´ç†æˆå¦ä¸€ç¯‡ã€‚Django-Q çš„èªªæ˜Žæ–‡ä»¶å¯«å¾—å¾ˆæ¸…æ¥šï¼Œè®€ä¸€è®€æ‡‰è©²å°±æœƒäº†ã€‚&lt;/p&gt;
&lt;h2 id="autobuild-server"&gt;Autobuild server éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;ï¼ˆé€™ç¯‡æ–‡çš„é‡é»žå…¶å¯¦æ˜¯éƒ¨ç½²ï¼Œèª°æ›‰å¾—èƒŒæ™¯ä»‹ç´¹å¯ä»¥é€™éº¼é•·ï¼‰&lt;/p&gt;
&lt;p&gt;éƒ¨ç½² (deploy) æ–¹æ³•ç™¾ç™¾ç¨®ï¼Œæœ‰å¥½æœ‰å£žã€‚ä½†è‡³å°‘è¦æœƒä¸€ç¨®å˜›ï¼Œæ‰€ä»¥é€™é‚Šå°±ç”¨å…¶ä¸­ä¸€ç¨®ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;nginx &amp;lt;-&amp;gt; uwsgi &amp;lt;-&amp;gt; Django&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿç®—å¾ˆæµè¡Œçš„çµ„åˆã€‚æ›´å®Œæ•´åœ°ä¾†èªªï¼Œæ•´å€‹è™•ç† request çš„æµç¨‹ç¶“éŽï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;web client &amp;lt;-&amp;gt; nginx web server &amp;lt;-&amp;gt; socket &amp;lt;-&amp;gt; uwsgi &amp;lt;-&amp;gt; Django server&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åŸºæœ¬çš„è¨­å®šèˆ‡æ•™å­¸ä¾†è‡ª &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/index.html"&gt;uWSGI&lt;/a&gt; å®˜ç¶²çš„ &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html"&gt;&lt;em&gt;Setting up Django and your web server with uWSGI and nginx&lt;/em&gt;&lt;/a&gt; ä¸€æ–‡ï¼Œæ­é… &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/Systemd.html"&gt;&lt;em&gt;uWGSI and Systemd&lt;/em&gt;&lt;/a&gt; èˆ‡ &lt;a href="https://www.freedesktop.org/wiki/Software/systemd/"&gt;systemd&lt;/a&gt; æ•´åˆã€‚&lt;/p&gt;
&lt;p&gt;é€™ä¹Ÿæ˜¯ç›®å‰ Pydoc production çš„è¨­å®šï¼Œè¨˜éŒ„ä¸€ä¸‹æ–¹ä¾¿æœªä¾†çš„ç¶­è­·ã€‚&lt;/p&gt;
&lt;h3 id="_3"&gt;ä½œæ¥­ç³»çµ±&lt;/h3&gt;
&lt;p&gt;ä½œæ¥­ç³»çµ±ç”¨ Debian Jessieï¼Œæž¶è¨­æ–¼ Amazon EC2 ä¸Šï¼Œä½¿ç”¨ t2.nano&lt;sup id="fnref:ec2-nano"&gt;&lt;a class="footnote-ref" href="#fn:ec2-nano"&gt;5&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Python web deploy éƒ½æœƒæŠŠå¥—ä»¶è£åœ¨è™›æ“¬ç’°å¢ƒä¸­ï¼Œé¿å…ä¸åŒå°ˆæ¡ˆé–“äº’è¡æˆ–èˆ‡ç³»çµ±è¡çªã€‚åœ¨ Debian ä¸Šå¯ä»¥ç”¨ &lt;code&gt;apt buid-dep python3-&amp;lt;pkg&amp;gt;&lt;/code&gt; æŠŠ Python &lt;pkg&gt; å¥—ä»¶æ‰€éœ€çš„ header æˆ– library å®‰è£å¥½ï¼Œååˆ†ç°¡å–®ã€‚&lt;/p&gt;
&lt;h4 id="python-35-and-apt-pinning"&gt;Python 3.5 and APT-pinning&lt;/h4&gt;
&lt;p&gt;æˆ‘çš„ code è£¡ç”¨åˆ°äº† &lt;a href="https://docs.python.org/3/library/subprocess.html#subprocess.run"&gt;&lt;code&gt;subprocess.run&lt;/code&gt;&lt;/a&gt;ï¼Œé€™æ˜¯ Python 3.5+ æ‰æœ‰çš„ APIã€‚ä½† Jessie åªæœ‰ Python 3.4ï¼Œä½†æˆ‘è¦ºå¾—å¾ˆå¥½ç”¨ä¸€é»žéƒ½ä¸æƒ³æ”¹å¯«æˆç›¸å®¹èˆŠç‰ˆçš„ codeã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤éœ€è¦å®‰è£ Debian testing channel ä¸Šæœ€æ–°çš„ Python 3.5ã€‚é€™æ¨£å…¶å¯¦æœ‰å®‰å…¨ä¸Šçš„ç–‘æ…®ï¼Œå› ç‚ºåªæœ‰ stable channel æ‰æœ‰ security supportï¼Œä½†è‡ªå·±ç·¨è­¯çš„å•é¡Œæ›´å¤§ï¼Œæ‰€ä»¥åƒ &lt;a href="https://github.com/yyuu/pyenv"&gt;pyenv&lt;/a&gt; é€™ç¨®å¤š Python ç‰ˆæœ¬çš„å·¥å…·ä¸åœ¨è€ƒæ…®å…§ã€‚&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯ç”¨ &lt;a href="https://wiki.debian.org/AptPreferences"&gt;Apt-Pinning&lt;/a&gt; åªè®“ Python 3.5 ç›¸é—œçš„å¥—ä»¶å®‰è£ testing çš„ç‰ˆæœ¬ã€‚é¦–å…ˆæŠŠ testing channel åŠ åˆ° &lt;code&gt;/etc/apt/source.list&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;deb http://cloudfront.debian.net/debian testing main
deb-src http://cloudfront.debian.net/debian testing main
deb http://security.debian.org/ testing/updates main
deb-src http://security.debian.org/ testing/updates main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç„¶å¾Œä¿®æ”¹ &lt;code&gt;/etc/apt/preferences&lt;/code&gt; ç¢ºå®šæˆ‘å€‘ä¸æœƒä¸å°å¿ƒè£åˆ° testing ç›¸é—œçš„å¥—ä»¶ï¼Œä¸¦æŠŠ Python 3.5 ç›¸é—œçš„å¥—ä»¶è¨­å®šæ¬Šé™ &amp;gt;= 990 è®“å®ƒå€‘èƒ½è¢«è‡ªå‹•å®‰è£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Specify * rules first so later package-specfic rules can override them
Package: *
Pin: release a=testing
Pin-Priority: -10

Package: python3.5* libpython3.5*
Pin: release a=testing
Pin-Priority: 990
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥ç”¨ &lt;code&gt;sudo apt-cache policy &amp;lt;pkg-name&amp;gt;&lt;/code&gt; æª¢æŸ¥ç›®å‰çš„è¦å‰‡æœƒè£åˆ°å“ªå€‹ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo apt-get update 
$ sudo apt-get install python3.5 python3.5-venv python3.5-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£åªæœ‰ Python 3.5 ç›¸é—œçš„å¥—ä»¶æ‰æœƒè£åˆ° testingã€‚&lt;/p&gt;
&lt;h4 id="postgresql"&gt;è³‡æ–™åº« PostgreSQL&lt;/h4&gt;
&lt;p&gt;è³‡æ–™åº«ç”¨ PostgreSQL 9.4ã€‚åƒç…§ä¹‹å‰ blog&lt;a href="https://blog.liang2.tw/posts/2016/01/postgresql-install/"&gt;ã€Šå®‰è£ PostgreSQL 9 æ–¼ Debian Jessie / OSXã€‹&lt;/a&gt;ä¸€æ–‡è¨­å®šã€‚&lt;/p&gt;
&lt;h4 id="swap"&gt;Swap&lt;/h4&gt;
&lt;p&gt;å…¶å¯¦æ˜¯ä¸Šç·šä¸ä¹…æ‰æ³¨æ„åˆ° EC2 é è¨­æ²’æœ‰ swap ç©ºé–“ã€‚æˆ‘å¾ˆçª®æ‰€ä»¥ production server çš„ RAM åªæœ‰ 512 MBï¼Œè§€å¯Ÿä¸€ä¸‹æœ‰æ™‚å€™ build doc RAM å°±å…¨æ»¿äº†ï¼Œæ‰€ä»¥é‚„æ˜¯åŠ å€‹ swap å®‰å¿ƒä¸€é»žã€‚&lt;/p&gt;
&lt;p&gt;å› ç‚º Amazon EBS SSD I/O æ•¸ä¸æœƒå¦å¤–æ”¶éŒ¢ï¼ˆæ‡‰è©²å§ï¼Ÿï¼‰ï¼Œå°±å»º swap file åœ¨ä¸»ç¡¬ç¢Ÿè£¡ã€‚&lt;/p&gt;
&lt;p&gt;Swap è¨­å®šçš„æ•™å­¸å¾ˆå¤šï¼Œé€™é‚Šå°±åƒè€ƒ &lt;a href="https://wiki.archlinux.org/index.php/swap"&gt;Arch Wiki&lt;/a&gt; ä¸Šçš„åšæ³•ï¼Œæˆ‘é¸æ“‡æ”¾åœ¨ &lt;code&gt;/var/swap.1&lt;/code&gt;ã€‚å¤§å°è¨­å®šç‚º RAM çš„ 2 å€ï¼Œå³ 1GBã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæŠŠé€™å€‹æª”æ¡ˆå»ºå‡ºä¾†ï¼Œæ¬Šé™æ”¹ç‚º 600ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo /bin/dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/zero &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/swap.1 &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1M &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1024&lt;/span&gt;
&lt;span class="c1"&gt;# or faster with fallocate&lt;/span&gt;
sudo fallocate -l 1G /var/swap.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo chmod &lt;span class="m"&gt;600&lt;/span&gt; /var/swap.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†ä¾†æŠŠé€™å€‹æª”æ¡ˆæ”¹æˆ swap æ ¼å¼ä¸¦å•Ÿç”¨å®ƒï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo /sbin/mkswap /var/swap.1
sudo /sbin/swapon /var/swap.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¿®æ”¹ fstab è®“æ¯æ¬¡é–‹æ©Ÿéƒ½æœ‰é€™å€‹ swap è¨­å®šï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# /etc/fstab
/var/swap.1 none swap defaults 0 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨ &lt;code&gt;free -h&lt;/code&gt;ã€&lt;code&gt;cat /proc/meminfo&lt;/code&gt; æª¢æŸ¥æ­¤æ™‚æ‡‰è©²æœ‰å€‹ 1GB swap äº†ã€‚&lt;/p&gt;
&lt;h4 id="git-repo-ssh-config"&gt;Git repo ssh config&lt;/h4&gt;
&lt;p&gt;å†ä¾†æ˜¯ code çš„åŒæ­¥èˆ‡æ›´æ–°ã€‚autobuild server åªè¦æ›´æ–° source codeï¼Œä½† cpython-tw source éœ€è¦å®šæ™‚ commit æ–°çš„ç¿»è­¯ï¼Œå› æ­¤ deploy server æœƒæœ‰ä¿®æ”¹ git repo çš„æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸æ‡‰è©²ä½¿ç”¨è‡ªå·±çš„ SSH keyï¼Œdeploy server ä¸Šæ‡‰è©²æœ‰å°ˆå±¬çš„ deploy keyï¼Œå…¶ä¸­ cpython-tw çš„ deploy key æœ‰å¯«å…¥æ¬Šé™ï¼ˆå³å¯ä»¥ commitï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥äº†ä¸€ä¸‹ï¼Œè¦è®“ä¸åŒ git repo ä½¿ç”¨ä¸åŒçš„ SSH key ä¹Ÿä¸è¤‡é›œã€‚ä»¥é€™é‚Šçš„ä¾‹å­ï¼Œå…ˆä¿®æ”¹ &lt;code&gt;~/.ssh/config&lt;/code&gt; åŠ å…¥å…©å€‹æ–°çš„ hostï¼Œä½¿ç”¨ä¸åŒçš„ SSH keyï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Host github-pydoc_autobuild
  HostName github.com
  User git
  IdentityFile /home/pydoc/.ssh/id_rsa.pydoc_autobuild

Host github-cpython_tw
  HostName github.com
  User git
  IdentityFile /home/pydoc/.ssh/id_rsa.cpython_tw
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å»ºç«‹å°æ‡‰çš„ SSH keypairï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh-keygen -t rsa -f ~/.ssh/id_rsa.pydoc_autobuild
ssh-keygen -t rsa -f ~/.ssh/id_rsa.cpython_tw
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŠŠå…©å€‹ repo çš„ URL host æ›æŽ‰ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git remote set-url origin git@github-pydoc_autobuild:python-doc-tw/pydoc_autobuild.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£å…©å€‹ repo æœƒé€éŽçµ¦å®šçš„ ssh key é€£ç·šã€‚GitHub æœƒé¡¯ç¤ºæ¯å€‹ key æœ€è¿‘ä½¿ç”¨çš„æ™‚é–“ï¼Œæª¢æŸ¥æ™‚é–“å°±èƒ½ç¢ºèªè¨­å®šæ­£ç¢ºèˆ‡å¦ï¼ˆè€Œä¸”æ”¹ host æ²’è¨­å®šå°æ‡‰è©²ç›´æŽ¥é€£ä¸ä¸Šï¼‰ã€‚&lt;/p&gt;
&lt;h4 id="tmpfilesd"&gt;tmpfiles.d&lt;/h4&gt;
&lt;p&gt;ä¹‹å¾Œ nginx å’Œ uwsgi æºé€šç”¨çš„ socket æ‰“ç®—æ”¾åœ¨ &lt;code&gt;/run/django/xxxx.sock&lt;/code&gt; &lt;sup id="fnref:/run"&gt;&lt;a class="footnote-ref" href="#fn:/run"&gt;6&lt;/a&gt;&lt;/sup&gt;ã€‚å› ç‚ºåªéœ€è¦éž root çš„æ¬Šé™ï¼Œä¿®æ”¹ &lt;a href="https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html"&gt;tmpfiles.d&lt;/a&gt; çš„è¨­å®šï¼Œè®“é€™å€‹è³‡æ–™å¤¾èƒ½åœ¨é–‹æ©Ÿæ™‚è‡ªå‹•å»ºç«‹ã€‚å¢žåŠ è¨­å®šæª” &lt;code&gt;/etc/tmpfiles.d/pydoc_autobuild.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;d /run/django 0755 pydoc www-data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="django-stack-nginx-uwsgi"&gt;Django Stack &amp;ndash; nginx + uWSGI&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬åœ°é–‹ç™¼éƒ½ç”¨ &lt;code&gt;python manage.py runserver&lt;/code&gt; å•Ÿå‹• Djangoã€‚ä½†ä¸Šç·šæ™‚å…§å»ºçš„ runserver å°±ç„¡æ³•åŒæ™‚é–“æœå‹™å¤ªå¤šäººã€‚å› æ­¤éœ€è¦åƒ nginxã€uWSGI ç­‰å·¥å…·ä¾†å”åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;åƒç…§ uWSGI &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/tutorials/Django_and_nginx.html"&gt;&lt;em&gt;Setting up Django and your web server with uWSGI and nginx&lt;/em&gt;&lt;/a&gt; ä¸€æ–‡ä»¥åŠ TP å¯«çš„ ã€Šç‚ºç¨‹å¼äººå¯«çš„ Django Tutorialã€‹ç³»åˆ—æ–‡ä¸­ &lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers/blob/master/25-deploy-to-ubuntu-server.md"&gt;&lt;em&gt;Day 27 - Deploy to Ubuntu server&lt;/em&gt;&lt;/a&gt; é—œæ–¼éƒ¨ç½²çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;Autobuild server æœ‰ç‰¹åˆ¥ç‚º production å¯«ä¸€ä»½è¨­å®šæª”ï¼Œåˆ‡æ›æ™‚åªè¦è¨­å®šæˆ &lt;code&gt;settings.production&lt;/code&gt; å³å¯ã€‚åœ¨ Django è¨­å®šéƒ¨ä»½ï¼Œå»ºè­°æŠŠæ‰€æœ‰è·¯å¾‘éƒ½è¨­æˆçµ•å°è·¯å¾‘ï¼ˆåŒ…å«åŸ·è¡Œæª”ï¼‰ã€‚ä¸ç„¶å¾ŒçºŒåœ¨è¨­å®š systemd è¦èª¿æ•´å¾ˆå¤šç’°å¢ƒè®Šæ•¸ï¼Œsystemd ä¹Ÿä¸æœƒå¸¶å…¥ä½¿ç”¨è€…çš„ PATH è®Šæ•¸ï¼Œä¸ç”¨çµ•å°è·¯å¾‘å…¶å¯¦è »éº»ç…©çš„ä¹Ÿå®¹æ˜“éŒ¯ã€‚&lt;/p&gt;
&lt;h4 id="nginx"&gt;nginx è¨­å®š&lt;/h4&gt;
&lt;p&gt;nginx æœƒæŽ¥å— incoming HTTP requestï¼Œéœ€è¦è·Ÿ Django server è¯çµ¡æ™‚ï¼Œå°±æœƒæœƒé€£åˆ° uWSGI é–‹çš„ UNIX socketã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å…ˆå‡è¨­ uWSGI é€™æ®µæ²’å•é¡Œï¼Œé¦–å…ˆè¨­å®š nginx æœ¬èº«ã€‚ç”±æ–¼ static files åœ¨ nginx å°±ç›´æŽ¥å°Žåˆ°å°æ‡‰çš„æª”æ¡ˆï¼Œä¸æœƒç¶“éŽ uWSGI ï¼Œæ‰€ä»¥è¨­å®šå¥½ nginx ä¹‹å¾Œ pydoc æ–‡ä»¶æœ¬èº«å°±ä¸Šç·šäº†ã€‚ç”¨é€™å€‹ä¾†æ¸¬è©¦è¨­å®šçš„æ­£ç¢ºæ€§ã€‚&lt;/p&gt;
&lt;p&gt;å°æœ¬ç¶²ç«™è€Œè¨€ï¼Œ/static å°Žåˆ° Django staticfilesï¼›/3/ã€/3.5/ å°Žåˆ° pydoc build HTML çš„è·¯å¾‘ï¼›å…¶é¤˜è·¯å¾‘å†äº¤çµ¦ Django è™•ç†ã€‚å…¶ä¸­ï¼Œ/3.5/* çš„é€£çµå°‡é‡æ–°å°Žå‘åˆ° /3/* ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ•´ç†ä¸Šè¿°çš„éœ€æ±‚ï¼Œå¯«å€‹ nginx è¨­å®šæª”åœ¨ &lt;code&gt;/etc/nginx/sites-available/pydoc_autobuild.conf&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Upstream Django setting; the socket nginx connects to&lt;/span&gt;
&lt;span class="k"&gt;upstream&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;django&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;unix:///run/django/pydoc_autobuild.sock&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;listen&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;listen&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="mi"&gt;443&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;ssl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;server_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;docs.python.org.tw&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="s"&gt;.69.170.26&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;charset&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="s"&gt;utf-8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;client_max_body_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;10M&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# max upload size&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;keepalive_timeout&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;alias&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/path/to/code/pydoc_autobuild/assets&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;alias&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/path/to/code/cpython-tw/Doc/build/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sr"&gt;/3\.5/(.*)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;302&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/3/&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;# Finally, send all non-media requests to the Django server.&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kn"&gt;location&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;uwsgi_pass&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s"&gt;django&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kn"&gt;include&lt;/span&gt;&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="s"&gt;/etc/nginx/uwsgi_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†æŠŠæª”æ¡ˆ soft link åˆ° &lt;code&gt;/etc/nginx/sites-enabled/&lt;/code&gt;ï¼Œæ›´æ–° nginx è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /etc/nginx/sites-available/
sudo ln -s pydoc_autobuild.conf ../sites-enabled/
sudo systemctl reload nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¢ºå®š pydoc ä¸Šç·šå°±å¯ä»¥å°ˆå¿ƒè™•ç† uWSGI äº†ã€‚&lt;/p&gt;
&lt;h4 id="uwsgi"&gt;uWSGI è¨­å®š&lt;/h4&gt;
&lt;p&gt;uWSGI åœ¨ VENV å¤–ä¹Ÿè¦è£ï¼Œæˆ‘è¦ºå¾—é‚„æ˜¯ç”¨ pip æ¯”è¼ƒç°¡å–®ï¼Œé›–ç„¶é€™æ¨£å°±è¦è‡ªå·±æ³¨æ„ uWSGI çš„ç‰ˆæœ¬æ›´æ–°äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo python3.5 -m pip install uwsgi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŠŠ uWSGI è¨­å®šå­˜æˆ &lt;code&gt;pydoc_autobuild_uwsgi.ini&lt;/code&gt; ä¸¦ä¸”åœ¨æ¸¬è©¦æ™‚ï¼Œéƒ½ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo uwsgi --ini pydoc_autobuild_uwsgi.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¨¡æ“¬å¯¦éš›ä¸Šçš„åŸ·è¡Œæ–¹å¼ï¼Œé€™æ¨£ä¹‹å¾Œæ”¹ç”¨ systemd åŸ·è¡Œæ‰ä¸æœƒåˆä¸Ÿä¸€å †æ¬Šé™çš„å•é¡Œã€‚è¨­å®šæª”çš„å…§å®¹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[uwsgi]
chdir        = /path/to/code/pydoc_autobuild
# Django&amp;#39;s wsgi file
module       = pydoc_autobuild.wsgi:application
env          = DJANGO_SETTINGS_MODULE=pydoc_autobuild.settings.production
# the virtualenv (full path)
home         = /path/to/VENV

# process-related settings
# master
master       = true
# maximum number of worker processes
processes    = 4
# the socket (use the full path to be safe
socket       = /run/django/pydoc_autobuild.sock
# ... with appropriate permissions - may be needed
chmod-socket = 664
uid          = pydoc
gid          = www-data
# clear environment on exit
vacuum       = true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¬Šé™ä¸Šçš„è¨­å®šå¯èƒ½è¦èŠ±é»žæ™‚é–“è™•ç†ä¸€ä¸‹ï¼Œnginx ä½¿ç”¨ www-data/www-data çš„èº«ä»½åŸ·è¡Œï¼Œsocket è¦ç¢ºå®š nginx èƒ½è®€å¯«ï¼Œä½†æˆ‘çš„ code æ”¾åœ¨ pydoc ä½¿ç”¨è€…è·¯å¾‘ä¸‹ï¼Œç”¨ www-data å¯èƒ½æœƒæœ‰æ¬Šé™çš„å•é¡Œã€‚å»ºè­°æŠŠ uidã€gid éƒ½è¨­å®šå¥½ã€‚&lt;/p&gt;
&lt;p&gt;éŽç¨‹ä¸­ï¼Œæ­é… nginx çš„éŒ¯èª¤è¨Šæ¯æ¯”è¼ƒå¥½ debugï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo less +F /var/log/nginx/error.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆåŠŸå¾Œï¼Œå†ç”¨ uWSGI çš„ Emperor modeï¼ŒæŠŠè¨­å®šæª”ä¸Ÿåˆ°ä¸€å€‹è·¯å¾‘åº•ä¸‹ï¼ˆè©²è·¯å¾‘ç¨±ç‚º vassalsï¼‰ã€‚uWSGI åœ¨ Emperor mode æ™‚æœƒè‡ªå‹•æŠŠ vassals è·¯å¾‘å…§æ‰€æœ‰è¨­å®šæª”éƒ½è®€é€²ä¾†ä¸¦åŸ·è¡Œã€‚&lt;/p&gt;
&lt;p&gt;é€™è£¡ vassals è·¯å¾‘ä½¿ç”¨ &lt;code&gt;/etc/uwsgi/vassals/&lt;/code&gt;ã€‚å› ç‚ºæœ‰è¨­ uidã€gidï¼Œè·‘çš„æ™‚å€™å°±ä¸ç”¨å†è¨­äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo uwsgi --emperor /etc/uwsgi/vassals
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£æ‡‰è©² Django ç›¸é—œçš„ view éƒ½æ²’å•é¡Œäº†ã€‚æŽ¥ä¸‹ä¾†ï¼Œè¦æŠŠå•Ÿå‹• uWSGI çš„æ­¥é©Ÿäº¤çµ¦ç³»çµ±ä¾†ç®¡ç†ã€‚&lt;/p&gt;
&lt;h3 id="systemd-services"&gt;Systemd services&lt;/h3&gt;
&lt;p&gt;Autobuild server åŒ…å«å…©å€‹éƒ¨ä»½ï¼šDjango Server èˆ‡ Django-Q clusterã€‚æ‰€ä»¥å¯«æˆ systemd service æ™‚æœƒæœ‰å…©å€‹æœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;Debian system service æ”¾åœ¨ &lt;code&gt;/etc/systemd/system/&lt;/code&gt; åº•ä¸‹ï¼Œå› æ­¤å»ºç«‹ &lt;code&gt;uwsgi.service&lt;/code&gt; å’Œ &lt;code&gt;qcluster.service&lt;/code&gt; åˆ†åˆ¥ç®¡ç† uWSGI Emperor mode å’Œ Django-Q clusterã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;uwsgi.service&lt;/code&gt; åƒè€ƒ uWSGI å®˜ç¶² &lt;a href="http://uwsgi-docs.readthedocs.org/en/latest/Systemd.html"&gt;&lt;em&gt;Django and Systemd&lt;/em&gt;&lt;/a&gt; ä¸€æ–‡çš„è¨­å®šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Unit]
Description=uWSGI Emperor
After=syslog.target

[Service]
ExecStart=/usr/local/bin/uwsgi --emperor /etc/uwsgi/vassals
RuntimeDirectory=uwsgi
Restart=always
KillSignal=SIGQUIT
Type=notify
StandardError=syslog
NotifyAccess=all

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;qcluster.service&lt;/code&gt; ç®—æ˜¯è‡ªå·±ç¡¬å¯«æ¨¡æ“¬ &lt;code&gt;python manage.py qcluster&lt;/code&gt; è¡Œç‚ºã€‚å› æ­¤ç’°å¢ƒè®Šæ•¸éƒ½è¦è¨­å®šå¥½ï¼ˆç•¶ç„¶ç”¨çµ•å°è·¯å¾‘å°±æ²’å•é¡Œäº†ï¼Œæˆ‘åªæ˜¯è¦ºå¾—é€™æ¨£ build log å…§çš„åŸ·è¡Œæª”è·¯å¾‘éƒ½å¾ˆé•·æœƒå¾ˆé†œ xdï¼‰&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Unit]
Description=Django-Q Cluster for site pydoc_autobuild
After=syslog.target
Wants=uwsgi.service

[Service]
User=pydoc
Group=www-data
Environment=VIRTUAL_ENV=/path/to/VENV
Environment=PATH=/path/to/VENV/bin:$PATH
Environment=DJANGO_SETTINGS_MODULE=pydoc_autobuild.settings.production
WorkingDirectory=/path/to/code/pydoc_autobuild
ExecStart=/path/to/VENV/bin/python manage.py qcluster
Restart=always
KillSignal=SIGQUIT
Type=simple
NotifyAccess=none
StandardError=syslog

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£çš„è¨­å®šæª”æ‡‰è©²ä¸æ˜¯ systemd çš„æ…£ä¾‹ï¼Œæˆ‘é‚„åœ¨æƒ³æ˜¯ä¸æ˜¯æ‡‰è©²è¦æ”¹å¯«åˆ° user service åŽ»ï¼ˆä½†æˆ‘ä¸æœƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åŠ å…¥åˆ° systemd ä¹‹å¾Œç®¡ç†å°±å¾ˆç°¡å–®ï¼Œå•Ÿå‹•é€™å…©å€‹ serviceï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo systemctl enable uwsgi
sudo systemctl enable qcluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŸ¥çœ‹ä»–å€‘çš„ç‹€æ…‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo systemctl status uwsgi
sudo systemctl status qcluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŸ¥çœ‹å®ƒå€‘çš„ log ä¹Ÿè®Šå¾—å¾ˆç°¡å–®ï¼Œå› ç‚ºæœ‰æŠŠå®ƒå€‘çš„ stderr æŠ“èµ·ä¾†ã€‚systemd å¥½è™•æ˜¯ rotation ç­‰ç­‰éƒ½æœƒå¹«ä½ æ³¨æ„ï¼Œçœ‹ log çš„åŠŸèƒ½ä¹Ÿå¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚è¦æŸ¥æœ€è¿‘ä¸€å°æ™‚ uWSGI çš„é€£ç·šè¨˜éŒ„ï¼Œä¸¦åœ¨æœ‰æ–°é€£ç·šæ™‚æŒçºŒæ›´æ–° logï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo journalctl -xef -u uwsgi --since &amp;#39;1 hour ago&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="_4"&gt;ç¸½çµ&lt;/h2&gt;
&lt;p&gt;ä»‹ç´¹äº† &lt;a href="https://github.com/python-doc-tw/python-doc-tw"&gt;Python èªªæ˜Žæ–‡ä»¶ç¿»è­¯è¨ˆç•«&lt;/a&gt;ï¼Œç·šä¸Šæ–‡ä»¶autobuild server åŸºæ–¼ Django èˆ‡ Django-Q çš„æž¶æ§‹ï¼Œä»¥åŠåœ¨ Debian ä¸Šçµåˆ nginxã€uWSGIã€systemd çš„éƒ¨ç½²è¨­å®šã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥è³‡æ–™æ™‚è¦ºå¾—æ–‡ç« é‚„ä¸å¤šï¼Œåªæœ‰å¹¾ç¯‡åƒ &lt;a href="https://luxagraf.net/src/how-set-django-uwsgi-systemd-debian-8"&gt;&lt;em&gt;How to Set Up Django with Nginx, uWSGI &amp;amp; systemd on Debian/Ubuntu&lt;/em&gt;&lt;/a&gt; çš„æ–‡ç« ï¼Œå‰©ä¸‹è¦è‡ªå·±çµ„è£é‚„æ˜¯è¦èŠ±ä¸€é»žæ™‚é–“ã€‚åŒæ™‚ä¹ŸæŠŠéƒ¨ç½² pydoc server çš„è¨­å®šéƒ½è¨˜åœ¨é€™ï¼Œå°‡ä¾†è¦é‡å»ºä¹Ÿæ¯”è¼ƒç°¡å–®ã€‚&lt;/p&gt;
&lt;p&gt;é—œæ–¼èªªæ˜Žæ–‡ä»¶ç¿»è­¯ï¼Œæ‡‰è©²æœƒå†èŠ±ç¯‡æ–‡ç« å¥½å¥½å¯«æ•´å€‹è¨ˆç•«æœ¬èº«ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆæ˜¯èªªå¦‚æžœæœ‰äººèƒ½å¾žé ­çœ‹åˆ°å°¾çš„è©±ï¼Œçµ¦å€‹å›žé¥‹å§ &amp;gt; &amp;lt;ï¼‰&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:zh-Hant"&gt;
&lt;p&gt;å…«å¦æ˜¯ï¼Œè‡ºç£ç¹é«”ä¸­æ–‡çš„ language code (or locale identifier) ç©¶ç«Ÿæ˜¯ zh_TWã€zh-Hantã€zh-Hant-TWã€zh-Hant_TWã€zh_Hant é‚„æ˜¯ zh_Hant_TWï¼Ÿé€™å•é¡Œæœ¬èº«å°±å¯ä»¥å¯«ä¸€ç¯‡äº†ã€‚&lt;br&gt;&lt;br&gt;æŸ¥åœ‹éš›è¦ç¯„ &lt;a href="http://www.ietf.org/rfc/bcp/bcp47.txt"&gt;BCP 47&lt;/a&gt; çš„è©±ï¼Œåªæœ‰ &lt;a href="http://www.iana.org/assignments/lang-tags/zh-Hant"&gt;zh-Hant&lt;/a&gt; å’Œ &lt;a href="http://www.iana.org/assignments/lang-tags/zh-Hant-TW"&gt;zh-Hant-TW&lt;/a&gt;ï¼Œæ›´å¤šé—œæ–¼æ¨™æº–çš„èªªæ˜Žèˆ‡å®šç¾©å¯ä»¥åƒè€ƒ &lt;a href="https://www.w3.org/International/articles/bcp47/"&gt;&lt;em&gt;Understanding the New Language Tags&lt;/em&gt;, W3C&lt;/a&gt; ä¸€æ–‡ã€‚&lt;br&gt;&lt;br&gt;ä¸éŽç¾ç‹€æ˜¯å¾ˆå¥‡å¦™çš„ã€‚åƒè€ƒ OSX å®šç¾© &lt;a href="https://developer.apple.com/library/ios/documentation/MacOSX/Conceptual/BPInternational/LanguageandLocaleIDs/LanguageandLocaleIDs.html"&gt;&lt;em&gt;Language and Locale IDs&lt;/em&gt;&lt;/a&gt; çš„è©±æ‡‰è©²æ˜¯ zh_TWã€zh-Hant æˆ– zh-Hant_TWã€‚è€Œåœ¨ Debain ä¸­ï¼Œæ‰€æœ‰æ”¯æ´çš„ locale å¯«åœ¨ &lt;code&gt;/usr/share/i18n/SUPPORTED&lt;/code&gt;ï¼Œè£¡é¢åªæœ‰ zh_TWï¼Œä¸éŽ Debian åªç”¨ &lt;code&gt;language[_country][.charset]&lt;/code&gt; æ‰€ä»¥ä¸æœƒæœ‰å®šç¾©ä¸­ç‚º script çš„ Hantï¼Œé›–ç„¶åœ¨ locale ä¸­ä½¿ç”¨åº•ç·šèˆ‡ &lt;a href="http://www.ietf.org/rfc/bcp/bcp47.txt"&gt;BCP 47&lt;/a&gt; çš„å®šç¾©ä¸åŒã€‚Sphinx é€éŽ &lt;a href="http://babel.pocoo.org/"&gt;Babel&lt;/a&gt; è™•ç† localeï¼Œä½†å®ƒä¸å…è¨± locale ä¸­æœ‰ &lt;code&gt;-&lt;/code&gt;ï¼Œå› æ­¤åªèƒ½è€ƒæ…® zh_Hant æˆ– zh_Hant_TWã€‚æ›´æœ‰è¶£çš„æ˜¯ï¼Œlocale æ‡‰è©²æ˜¯ case-insensitive æ‰€ä»¥å¤§å°å¯«æ˜¯ä¸é‡è¦çš„ XD&amp;#160;&lt;a class="footnote-backref" href="#fnref:zh-Hant" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:pydoc-url"&gt;
&lt;p&gt;å…¶å¯¦åœ¨ &lt;a href="https://docs.python.org/"&gt;https://docs.python.org/&lt;/a&gt; ä¸Šé¢ &lt;a href="https://docs.python.org/3/"&gt;/3/&lt;/a&gt; å’Œ &lt;a href="https://docs.python.org/3.5/"&gt;/3.5/&lt;/a&gt; æ˜¯ä¸åŒä»½æ–‡ä»¶ï¼Œå³ä½¿æ˜¯åŒå€‹ç‰ˆæœ¬è™Ÿå®ƒå€‘æ›´æ–°çš„æ™‚é–“ä¸ç›¸åŒã€‚è »æ„å¤–æœƒæ˜¯é€™æ¨£çš„æƒ…æ³ã€‚ä¸éŽæˆ‘å€‘ä¸ç”¨æžé€™éº¼è¤‡é›œï¼Œåªè¦è½‰å€å°±å¥½ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:pydoc-url" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:build-link"&gt;
&lt;p&gt;é–‹ç™¼æ™‚ä¸€ç›´éƒ½æ˜¯ç”¨ GETï¼Œå³å¦‚æ–‡ä¸­æ‰€èªªï¼Œæœ‰å€‹å°ˆå±¬çš„ linkã€‚ä½†ç™¼ç¾æœƒæœ‰ robot / crawler æ‰“é€™äº›è·¯å¾‘ï¼Œå› æ­¤æœ€å¾Œæ”¹æˆ POSTï¼ŒæŠŠ &lt;code&gt;{{ pagename }}&lt;/code&gt; ç”¨ data-* å³ &lt;code&gt;&amp;lt;a href="#" data-pagename="{{ pagename }}"&amp;gt;...&amp;lt;/a&amp;gt;&lt;/code&gt; çš„æ–¹å¼å­˜èµ·ä¾†ï¼Œåœ¨ç”¨ jQuery ç¶å®š click listenerã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:build-link" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:python3"&gt;
&lt;p&gt;çœ‹ &lt;a href="https://github.com/coleifer/huey"&gt;huey&lt;/a&gt; å’Œ &lt;a href="https://github.com/PolicyStat/jobtastic"&gt;jobtastic&lt;/a&gt; master branch ä¸Šæœ‰ py3k çš„ commit ä½†æ„Ÿè¦ºæ˜¯æœ€è¿‘çš„äº‹ï¼Œæœ‰å¾…è§€å¯Ÿã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:python3" title="Jump back to footnote 4 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:ec2-nano"&gt;
&lt;p&gt;åå˜ˆä¸€ä¸‹ï¼Œt2.nano vCPU çœŸçš„æ™‚å¿«æ™‚æ…¢ï¼Œæœ‰æ™‚ build doc å¹¾åˆ†é˜å°±æžå®šäº†ï¼Œæœ‰æ™‚è¦å¹¾ååˆ†é˜ï¼Œæœ‰ä¸€å¤©è¶…æ…¢ï¼Œç„¶å¾Œåˆè¢« web crawler æŠ“åˆ°ï¼Œè®“ task queue timeout é™·å…¥äº† timeoutã€restartã€timeout çš„ç„¡é™åœ°ç„â€¦â€¦&amp;#160;&lt;a class="footnote-backref" href="#fnref:ec2-nano" title="Jump back to footnote 5 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:/run"&gt;
&lt;p&gt;/var/run = /runï¼Œé€™å€‹è·¯å¾‘æ˜¯å€‹ tmpfs æ‰€ä»¥æ¯æ¬¡é‡é–‹æ©Ÿå°±æœƒæ¸…ç©ºï¼Œç›®éŒ„è¦è¨˜å¾—é‡å»ºã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:/run" title="Jump back to footnote 6 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="pydoctw"></category><category term="python"></category><category term="django"></category><category term="postgresql"></category><category term="deploy"></category><category term="debian"></category><category term="systemd"></category><category term="nginx"></category><category term="uwsgi"></category></entry><entry><title>å®‰è£ PostgreSQL 9 æ–¼ Debian Jessie / OSX</title><link href="https://blog.liang2.tw/posts/2016/01/postgresql-install/" rel="alternate"></link><published>2016-01-25T17:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-25:/posts/2016/01/postgresql-install/</id><summary type="html">&lt;p&gt;å¹³å¸¸ç”¨æœ€å¤šçš„æ˜¯ &lt;a href="https://www.sqlite.org/"&gt;SQLite&lt;/a&gt;ï¼Œä½† &lt;a href="http://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt; æœ‰å¾ˆå¤šå¥½ç”¨çš„åŠŸèƒ½ï¼Œæ¯æ¬¡è¦ç”¨æƒ³ä¸èµ·ä¾†æ€Žéº¼è£ã€‚ç¸½ä¹‹æŠŠç›¸é—œè¨­å®šçš„ç­†è¨˜å­˜åœ¨é€™ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ &lt;a href="https://www.debian.org/releases/stable/"&gt;Debian Jessie&lt;/a&gt; (Debian 8.3) èˆ‡ OSX â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å¹³å¸¸ç”¨æœ€å¤šçš„æ˜¯ &lt;a href="https://www.sqlite.org/"&gt;SQLite&lt;/a&gt;ï¼Œä½† &lt;a href="http://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt; æœ‰å¾ˆå¤šå¥½ç”¨çš„åŠŸèƒ½ï¼Œæ¯æ¬¡è¦ç”¨æƒ³ä¸èµ·ä¾†æ€Žéº¼è£ã€‚ç¸½ä¹‹æŠŠç›¸é—œè¨­å®šçš„ç­†è¨˜å­˜åœ¨é€™ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ &lt;a href="https://www.debian.org/releases/stable/"&gt;Debian Jessie&lt;/a&gt; (Debian 8.3) èˆ‡ OSX &lt;a href="http://brew.sh/"&gt;Homebrew&lt;/a&gt; èˆ‰ä¾‹ã€‚ä¸éŽ OSX å¤§æ¦‚ä¹Ÿä¸æœƒæ²’äº‹æŠŠ PostgreSQL é–‹è‘—ï¼Œä¸»è¦æ˜¯è‘—é‡åœ¨ Debian çš„ç’°å¢ƒè¨­å®šä¸Šã€‚ç›®å‰ PostgreSQL å‡ºåˆ° 9.5 ä½† Debian stable æ˜¯ 9.4ã€‚åŸºæœ¬è¨­å®šæ‡‰è©²å®Œå…¨æ²’å·®åˆ¥ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#postgresql"&gt;å®‰è£ PostgreSQL&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#osx"&gt;å®‰è£åœ¨ OSX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#debian-jessie"&gt;å®‰è£åœ¨ Debian Jessie&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#database"&gt;åˆå§‹å€‹äººçš„ Database&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#postgresql_1"&gt;å»ºç«‹åŒä½¿ç”¨è€…åç¨±çš„ PostgreSQL å¸³è™Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database_1"&gt;å»ºç«‹èˆ‡å¸³è™ŸåŒåç¨±çš„ database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#psql"&gt;ç”¨ä½¿ç”¨è€…å¸³è™Ÿé€£æŽ¥ psql&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#psql_1"&gt;psql æŒ‡ä»¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database_2"&gt;åˆªé™¤ä½¿ç”¨è€…ã€Database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;é€²éšŽä¸»é¡Œ&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#psql_2"&gt;é€éŽ psql å‰µå»ºä½¿ç”¨è€…å¸³è™Ÿã€è³‡æ–™åº«&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#postgresql-logging"&gt;PostgreSQL Logging&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#logging-postgresql"&gt;Logging è®“ PostgreSQL è‡ªå·±ç®¡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#logging-systemd"&gt;Logging é€éŽ Systemd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#reference"&gt;Reference&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="postgresql"&gt;å®‰è£ PostgreSQL&lt;/h2&gt;
&lt;h3 id="osx"&gt;å®‰è£åœ¨ OSX&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;brew install postgresql&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¦ç”¨çš„æ™‚å€™æ‰‹å‹•æŠŠ PostgreSQL server æ‰“é–‹ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;postgres -D /usr/local/var/postgres&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;PostgreSQL çš„è¨­å®šåƒè€ƒ Debian çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h3 id="debian-jessie"&gt;å®‰è£åœ¨ Debian Jessie&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo apt-get install postgresql-9.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¾åœ¨ç³»çµ±æœå‹™éƒ½ç”± &lt;a href="http://freedesktop.org/wiki/Software/systemd/"&gt;Systemd&lt;/a&gt; ç®¡ç†äº†ï¼Œæª¢æŸ¥ PostgreSQL æœ‰æ²’æœ‰è·‘èµ·ä¾†é€éŽ &lt;code&gt;systemctl&lt;/code&gt; é€™æŒ‡ä»¤å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;systemctl status postgresql.service
&lt;span class="go"&gt;â— postgresql.service - PostgreSQL RDBMS&lt;/span&gt;
&lt;span class="go"&gt;   Loaded: loaded (/lib/systemd/system/postgresql.service; enabled)&lt;/span&gt;
&lt;span class="go"&gt;   Active: inactive (dead) since Mon 2016-01-25 17:26:08 CST; 4s ago&lt;/span&gt;
&lt;span class="go"&gt;  Process: 913 ExecStart=/bin/true (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt; Main PID: 913 (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸éŽé€™ service çœ‹ä¸å¤ªåˆ°ä»€éº¼é‹è¡Œçš„è³‡è¨Šï¼Œå…¶å¯¦æ˜¯å€‹ dummy serviceï¼Œå®ƒæœƒ trigger å¯èƒ½å¾ˆå¤šå€‹ PostgreSQL database cluster ä»€éº¼çš„ã€‚é è¨­åªæœ‰ä¸€å€‹ &lt;code&gt;main&lt;/code&gt; çš„ clusterã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;systemctl status postgresql@9.4-main.service
&lt;span class="go"&gt;â— postgresql@9.4-main.service - PostgreSQL Cluster 9.4-main&lt;/span&gt;
&lt;span class="go"&gt;   Loaded: loaded (/lib/systemd/system/postgresql@.service; disabled)&lt;/span&gt;
&lt;span class="go"&gt;   Active: active (running) since Mon 2016-01-25 17:26:30 CST; 4min 7s ago&lt;/span&gt;
&lt;span class="go"&gt;  Process: 9641 ExecStop=/usr/bin/pg_ctlcluster -m fast %i stop (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt;  Process: 9717 ExecStart=postgresql@%i %i start (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt; Main PID: 9723 (postgres)&lt;/span&gt;
&lt;span class="go"&gt;   CGroup: /system.slice/system-postgresql.slice/postgresql@9.4-main.service&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€9723 /usr/lib/postgresql/9.4/bin/postgres -D /var/lib/postgresql/9.4/main -c config_file=/etc/postgr...&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€9725 postgres: checkpointer process&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€9726 postgres: writer process&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€9727 postgres: wal writer process&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€9728 postgres: autovacuum launcher process&lt;/span&gt;
&lt;span class="go"&gt;           â””â”€9729 postgres: stats collector process&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="database"&gt;åˆå§‹å€‹äººçš„ Database&lt;/h2&gt;
&lt;p&gt;åœ¨ OSX ä¸Šç”¨ homebrew å®‰è£ PostgreSQL çš„ä½¿ç”¨è€…æœƒæœ‰ superuser çš„æ¬Šé™ï¼Œåæ­£æ˜¯æœ¬åœ°é–‹ç™¼ä¹Ÿæ²’å·®ï¼Œå»º database ç­‰è¨­å®šéƒ½æ¯”è¼ƒç°¡å–®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Debian ä¸Šçš„è©±ï¼Œæœ‰é€™ superuser æ¬Šé™çš„ä½¿ç”¨è€…ç‚º &lt;code&gt;postgres&lt;/code&gt;ã€‚æ‰€ä»¥é è¨­ä½¿ç”¨è€…ï¼ˆé€™é‚Šä»¥ &lt;code&gt;vm&lt;/code&gt; ç‚ºä¾‹ï¼‰æœƒç„¡æ³•é€£ç·šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;psql
&lt;span class="go"&gt;psql: FATAL:  role &amp;quot;vm&amp;quot; does not exist&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åˆ‡åˆ° root å†åˆ‡åˆ° postgres èº«ä»½å°±èƒ½ç”¨ &lt;code&gt;psql&lt;/code&gt; ï¼ˆPostgreSQL çš„ REPL shellï¼‰é€£åˆ° databaseã€‚ç”¨ &lt;code&gt;\q&lt;/code&gt; å°±å¯ä»¥é€€å‡º psqlã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres psql
&lt;span class="go"&gt;[sudo] password for vm:&lt;/span&gt;
&lt;span class="go"&gt;psql (9.4.5)&lt;/span&gt;
&lt;span class="go"&gt;Type &amp;quot;help&amp;quot; for help.&lt;/span&gt;

&lt;span class="go"&gt;postgres=# \q&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½†ç”¨ postgres é€™ superuser åŽ»é€£è³‡æ–™åº«ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œä¸€é–‹å§‹é¤Šæˆå¥½ç¿’æ…£æ‡‰è©²ç”¨å€‹äººå¸³è™Ÿã€‚æ‰€ä»¥æŽ¥ä¸‹ä¾†è¦å®Œæˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å»ºç«‹åŒä½¿ç”¨è€…åç¨±çš„ PostgreSQL å¸³è™Ÿ&lt;/li&gt;
&lt;li&gt;å»ºç«‹èˆ‡å¸³è™ŸåŒåç¨±çš„ database&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="postgresql_1"&gt;å»ºç«‹åŒä½¿ç”¨è€…åç¨±çš„ PostgreSQL å¸³è™Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨ Debian ä¸Šå¯ä»¥ç”¨ &lt;code&gt;$USER&lt;/code&gt; ä¾†æŠ“åˆ°ç¾åœ¨ç™»å…¥è€…çš„å¸³è™Ÿï¼Œå³ä½¿ç”¨ sudo åˆ‡æ›èº«ä»½é€™ç’°å¢ƒè®Šæ•¸çš„å€¼ä¸æœƒè®Šã€‚ï¼ˆè®€ &lt;a href="https://help.ubuntu.com/community/PostgreSQL"&gt;Ubuntu wiki&lt;/a&gt; çœ‹åˆ°çš„æŠ€å·§ï¼‰&lt;/p&gt;
&lt;p&gt;æ“”å¿ƒçš„è©±å°±ç›´æŽ¥åœ¨æœ‰ &lt;code&gt;$USER&lt;/code&gt; çš„åœ°æ–¹æ‰“å‡ºå¸³è™Ÿå³å¯ã€‚å…ˆç¢ºèªä¸€ä¸‹ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;vm@vm-debian:~$ echo $&lt;/span&gt;USER
&lt;span class="go"&gt;vm&lt;/span&gt;
&lt;span class="gp"&gt;vm@vm-debian:~$ &lt;/span&gt;sudo -u postgres &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$USER&lt;/span&gt;
&lt;span class="go"&gt;vm&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å»ºç«‹ä½¿ç”¨è€…æ˜¯é€éŽ &lt;code&gt;createuser&lt;/code&gt; é€™æŒ‡ä»¤ã€‚é€™æ˜¯ä½¿ç”¨è€…å¸³è™Ÿå°±ä¸çµ¦å¤ªå¤šæ¬Šé™ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres createuser --interactive &lt;span class="nv"&gt;$USER&lt;/span&gt;
&lt;span class="go"&gt;Shall the new role be a superuser? (y/n) n&lt;/span&gt;
&lt;span class="go"&gt;Shall the new role be allowed to create databases? (y/n) n&lt;/span&gt;
&lt;span class="go"&gt;Shall the new role be allowed to create more new roles? (y/n) n&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ™‚å€™é€éŽ &lt;code&gt;psql&lt;/code&gt; çœ‹å°±æœƒå¤šä¸€å€‹ä½¿ç”¨è€…ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;-- Run with command `sudo -u postgres psql`&lt;/span&gt;
&lt;span class="gp"&gt;postgres=#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kp"&gt;\du&lt;/span&gt;
&lt;span class="w"&gt;                             &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;roles&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Role&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="n"&gt;Attributes&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;-----------+------------------------------------------------+-----------&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;postgres&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Superuser&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Create&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;role&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;Create&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DB&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Replication&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt;                                                &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="database_1"&gt;å»ºç«‹èˆ‡å¸³è™ŸåŒåç¨±çš„ database&lt;/h3&gt;
&lt;p&gt;é€éŽ &lt;code&gt;createdb&lt;/code&gt; é€™æŒ‡ä»¤ã€‚æŠŠèˆ‡å¸³è™ŸåŒå database çš„ owner è¨­å®šæˆè©²å¸³è™Ÿã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres createdb --owner&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt; &lt;span class="nv"&gt;$USER&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¦å¤šå»ºåˆ¥çš„ database çµ¦é€™å¸³è™Ÿä¹Ÿæ²’å•é¡Œï¼Œä¾‹å¦‚åç‚º &lt;code&gt;vm_database&lt;/code&gt; çš„ databaseï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo -u postgres createdb --owner&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt; vm_database
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="psql"&gt;ç”¨ä½¿ç”¨è€…å¸³è™Ÿé€£æŽ¥ psql&lt;/h3&gt;
&lt;p&gt;é€™æ™‚å€™æ‰“ &lt;code&gt;psql&lt;/code&gt; å°±æ²’å•é¡Œäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;psql
&lt;span class="go"&gt;psql (9.4.5)&lt;/span&gt;
&lt;span class="go"&gt;Type &amp;quot;help&amp;quot; for help.&lt;/span&gt;

&lt;span class="go"&gt;vm=&amp;gt; \conninfo&lt;/span&gt;
&lt;span class="go"&gt;You are connected to database &amp;quot;vm&amp;quot; as user &amp;quot;vm&amp;quot; via socket in &amp;quot;/var/run/postgresql&amp;quot; at port &amp;quot;5432&amp;quot;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Prompt å¾ž &lt;code&gt;#=&lt;/code&gt; è®Šæˆ &lt;code&gt;=&amp;gt;&lt;/code&gt; è¡¨ç¤ºç¾åœ¨é€£ç·šçš„ä½¿ç”¨è€…ä¸æ˜¯ superuserã€‚é€éŽ psql çš„æŒ‡ä»¤ &lt;code&gt;\l&lt;/code&gt; æˆ– &lt;code&gt;\l+&lt;/code&gt; å¯ä»¥çœ‹ç¾åœ¨æ‰€æœ‰çš„ databaseï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;vm=&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kp"&gt;\l&lt;/span&gt;
&lt;span class="go"&gt;                                   List of databases&lt;/span&gt;
&lt;span class="go"&gt;    Name     |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges&lt;/span&gt;
&lt;span class="go"&gt;-------------+----------+----------+-------------+-------------+-----------------------&lt;/span&gt;
&lt;span class="go"&gt; postgres    | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |&lt;/span&gt;
&lt;span class="go"&gt; template0   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +&lt;/span&gt;
&lt;span class="go"&gt;             |          |          |             |             | postgres=CTc/postgres&lt;/span&gt;
&lt;span class="go"&gt; template1   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +&lt;/span&gt;
&lt;span class="go"&gt;             |          |          |             |             | postgres=CTc/postgres&lt;/span&gt;
&lt;span class="go"&gt; vm          | vm       | UTF8     | en_US.UTF-8 | en_US.UTF-8 |&lt;/span&gt;
&lt;span class="go"&gt; vm_database | vm       | UTF8     | en_US.UTF-8 | en_US.UTF-8 |&lt;/span&gt;
&lt;span class="go"&gt;(5 rows)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€£å¦ä¸€å€‹ database &lt;code&gt;vm_database&lt;/code&gt; ä¹Ÿå¾ˆç°¡å–®ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;psql -d vm_database
&lt;span class="go"&gt;psql (9.4.5)&lt;/span&gt;
&lt;span class="go"&gt;Type &amp;quot;help&amp;quot; for help.&lt;/span&gt;

&lt;span class="go"&gt;vm_database=&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="psql_1"&gt;psql æŒ‡ä»¤&lt;/h2&gt;
&lt;p&gt;psql çš„æŒ‡ä»¤å¾ˆå¤šï¼Œç”¨ &lt;code&gt;\?&lt;/code&gt; å¯ä»¥çœ‹åˆ°åˆ—è¡¨ã€‚å®Œæ•´çš„ç‰ˆæœ¬å¯ä»¥è¦‹&lt;a href="http://www.postgresql.org/docs/9.4/static/app-psql.html#APP-PSQL-META-COMMANDS"&gt;å®˜ç¶² psql meta-commands&lt;/a&gt; çš„ä»‹ç´¹ã€‚åº•ä¸‹åˆ—å¹¾å€‹å¸¸ç”¨çš„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;\l          # list all database
\d          # list tables in current database
\du         # list roles
\conninfo   # show current SQL connection
\q          # quit
help        # print a hub message for all kinds of help
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="database_2"&gt;åˆªé™¤ä½¿ç”¨è€…ã€Database&lt;/h2&gt;
&lt;p&gt;å„æœ‰ä¸€å€‹æŒ‡ä»¤å°æ‡‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;dropuser &amp;lt;usr&amp;gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;dropdb &amp;lt;db&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="_1"&gt;é€²éšŽä¸»é¡Œ&lt;/h2&gt;
&lt;h3 id="psql_2"&gt;é€éŽ psql å‰µå»ºä½¿ç”¨è€…å¸³è™Ÿã€è³‡æ–™åº«&lt;/h3&gt;
&lt;p&gt;Ref: &lt;a href="http://www.cyberciti.biz/faq/howto-add-postgresql-user-account/"&gt;http://www.cyberciti.biz/faq/howto-add-postgresql-user-account/&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;-- Run with command `sudo -u postgres psql -d template1`&lt;/span&gt;
&lt;span class="gp"&gt;template1=#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PASSWORD&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;lt;pwd&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;template1=#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DATABASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;template1=#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;GRANT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ALL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIVILEGES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DATABASE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="postgresql-logging"&gt;PostgreSQL Logging&lt;/h3&gt;
&lt;p&gt;è¨­å®šåœ¨ &lt;code&gt;/etc/postgresql/9.4/main/postgresql.conf&lt;/code&gt; è£¡ã€‚ä¸åŒç®¡ç† log çš„æ–¹å¼å°±è¦é¸æ“‡ä¸åŒçš„ &lt;code&gt;log_destination&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;PostgreSQL è‡ªå·±ç®¡ï¼š&lt;code&gt;stderr&lt;/code&gt;, &amp;hellip;&lt;/li&gt;
&lt;li&gt;é€éŽ &lt;a href="http://freedesktop.org/wiki/Software/systemd/"&gt;Systemd&lt;/a&gt;ï¼š&lt;code&gt;syslog&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸éŽæˆ‘æ²’æ·±å…¥ç ”ç©¶å°±æ˜¯ï¼Œçœ‹é‚£å€‹ conf è£¡å¾ˆå¤šè¨­å®šå¯ä»¥èª¿æ•´ã€‚è¨­å®šä¿®æ”¹å¾Œè¦ restart PostgreSQL clusterï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo systemctl restart postgresql.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="logging-postgresql"&gt;Logging è®“ PostgreSQL è‡ªå·±ç®¡&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# At /etc/postgresql/9.4/main/postgresql.conf&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;log_destination&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;stderr&amp;#39; &lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;logging_collector&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;on                              &lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Log files é è¨­å¯«åœ¨ &lt;code&gt;/var/lib/postgresql/9.4/main/pg_log/&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id="logging-systemd"&gt;Logging é€éŽ Systemd&lt;/h4&gt;
&lt;p&gt;æˆ‘è¦ºå¾— systemd çš„å„ªé»žä¹‹ä¸€å°±æ˜¯èƒ½æŠŠ log éƒ½é›†ä¸­ç®¡ç†ï¼Œåªè¦ç…§å®ƒçš„è¦å‰‡ï¼Œå°±èƒ½ç”¨ä¸€æ¨£çš„æ–¹æ³•ç®¡ç† logging æ˜¯è »æ–¹ä¾¿çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# At /etc/postgresql/9.4/main/postgresql.conf&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;log_destination&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;syslog&amp;#39;  &lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="na"&gt;logging_collector&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;off   # on ä¹Ÿåªæœƒèªªè¢«å°Žå‘åˆ° syslog äº†                             &lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ™‚å€™é‡å•Ÿæœå‹™ï¼Œå†çœ‹ &lt;code&gt;systemctl status&lt;/code&gt; å°±èƒ½çœ‹åˆ°æœ€è¿‘çš„ log äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;systemctl status postgresql@9.4-main
&lt;span class="go"&gt;â— postgresql@9.4-main.service - PostgreSQL Cluster 9.4-main&lt;/span&gt;
&lt;span class="go"&gt;   Loaded: loaded (/lib/systemd/system/postgresql@.service; disabled)&lt;/span&gt;
&lt;span class="go"&gt;   Active: active (running) since Mon 2016-01-25 17:52:02 CST; 1min 13s ago&lt;/span&gt;
&lt;span class="go"&gt;  Process: 14632 ExecStop=/usr/bin/pg_ctlcluster -m fast %i stop (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt;  Process: 14641 ExecStart=postgresql@%i %i start (code=exited, status=0/SUCCESS)&lt;/span&gt;
&lt;span class="go"&gt; Main PID: 14648 (postgres)&lt;/span&gt;
&lt;span class="go"&gt;   CGroup: /system.slice/system-postgresql.slice/postgresql@9.4-main.service&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€14648 /usr/lib/postgresql/9.4/bin/postgres -D /var/lib/postgresql/9.4/main -c config_file=/etc/postg...&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€14650 postgres: checkpointer process&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€14651 postgres: writer process&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€14652 postgres: wal writer process&lt;/span&gt;
&lt;span class="go"&gt;           â”œâ”€14653 postgres: autovacuum launcher process&lt;/span&gt;
&lt;span class="go"&gt;           â””â”€14654 postgres: stats collector process&lt;/span&gt;

&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14648]: [1-1] 2016-01-25 17:52:00 CST [14648-1] LOG:  ending log output to stderr&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14648]: [1-2] 2016-01-25 17:52:00 CST [14648-2] HINT:  Future log output ...log&amp;quot;.&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14649]: [2-1] 2016-01-25 17:52:00 CST [14649-1] LOG:  database system was...9 CST&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14649]: [3-1] 2016-01-25 17:52:00 CST [14649-2] LOG:  MultiXact member wr...abled&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14648]: [2-1] 2016-01-25 17:52:00 CST [14648-3] LOG:  database system is ...tions&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14653]: [2-1] 2016-01-25 17:52:00 CST [14653-1] LOG:  autovacuum launcher started&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:00 vm-debian postgres[14658]: [3-1] 2016-01-25 17:52:00 CST [14658-1] [unknown]@[unknown] LOG: ...acket&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:52:38 vm-debian postgres[14793]: [3-1] 2016-01-25 17:52:38 CST [14793-1] root@root FATAL:  role &amp;quot;r...exist&lt;/span&gt;
&lt;span class="go"&gt;Hint: Some lines were ellipsized, use -l to show in full.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ–ç”¨ systemd æ¨™æº–çœ‹ log çš„æ–¹å¼ &lt;code&gt;journalctl&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;# &lt;/span&gt;journalctl -u postgresql@9.4-main 
&lt;span class="go"&gt;-- Logs begin at Mon 2016-01-25 16:46:25 CST, end at Mon 2016-01-25 19:22:07 CST. --&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [1-1] 2016-01-25 17:47:06 CST [13699-1] LOG:  redirecting log output to logging collector process&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [1-2] 2016-01-25 17:47:06 CST [13699-2] HINT:  Future log output will appear in directory &amp;quot;pg_log&amp;quot;.&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [2-1] 2016-01-25 17:47:06 CST [13699-3] LOG:  ending log output to stderr&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [2-2] 2016-01-25 17:47:06 CST [13699-4] HINT:  Future log output will go to log destination &amp;quot;syslog&amp;quot;.&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13701]: [3-1] 2016-01-25 17:47:06 CST [13701-1] LOG:  database system was shut down at 2016-01-25 17:47:05 CST&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13701]: [4-1] 2016-01-25 17:47:06 CST [13701-2] LOG:  MultiXact member wraparound protections are now enabled&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13699]: [3-1] 2016-01-25 17:47:06 CST [13699-5] LOG:  database system is ready to accept connections&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:06 vm-debian postgres[13705]: [3-1] 2016-01-25 17:47:06 CST [13705-1] LOG:  autovacuum launcher started&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:47:07 vm-debian postgres[13710]: [4-1] 2016-01-25 17:47:07 CST [13710-1] [unknown]@[unknown] LOG:  incomplete startup packet&lt;/span&gt;
&lt;span class="go"&gt;Jan 25 17:49:30 vm-debian postgres[14170]: [4-1] 2016-01-25 17:49:30 CST [14170-1] root@root FATAL:  role &amp;quot;root&amp;quot; does not exist&lt;/span&gt;
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="reference"&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-9-4-on-debian-8"&gt;How to Install and Use PostgreSQL 9.4 on Debian 8&lt;/a&gt; by Digital Ocean&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/PostgreSQL"&gt;PostgreSQL&lt;/a&gt; on Arch Wiki&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/PostgreSql"&gt;PostgreSQL&lt;/a&gt; on Debian wiki&lt;/li&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/PostgreSQL"&gt;PostgreSQL&lt;/a&gt; on Ubuntu wiki&lt;/li&gt;
&lt;/ul&gt;</content><category term="Coding"></category><category term="zh"></category><category term="postgresql"></category><category term="debian"></category><category term="osx"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—é™„éŒ„ - Bioinfo Practices using Python</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/" rel="alternate"></link><published>2016-01-21T23:30:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-appendix-bioinfo-python/</id><summary type="html">&lt;p&gt;A walk through of practices created by Rosalind Team.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jan, 2016 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;We are going to walk through a series of practice created by &lt;a href="http://rosalind.info/problems/"&gt;Rosalind Team&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once you register an account at Rosalind, you can use their judging system to work through all problems. However, in this case you cannot arbitrarily skip easy levels and it sucks. So I&amp;rsquo;m not going to force you using the system. Luckily, in each problem one set of example data and expected output is given, which can be used for checking our answer.&lt;/p&gt;
&lt;p&gt;Note: Their code assumes Python 2 but everything I mention here is Python 3.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#python-basics"&gt;Python Basics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bininfo-first-try"&gt;Bininfo First Try&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#q-dna-counting-dna-nucleotides"&gt;Q DNA: Counting DNA Nucleotides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#q-revc-the-secondary-and-tertiary-structures-of-dna"&gt;Q REVC: The Secondary and Tertiary Structures of DNA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#q-gc-computing-gc-content"&gt;Q: GC: Computing GC Content&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#workthrough"&gt;Workthrough&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#q-next"&gt;Q: (next?)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="python-basics"&gt;Python Basics&lt;/h2&gt;
&lt;p&gt;Do their &lt;a href="http://rosalind.info/problems/list-view/?location=python-village"&gt;Python Village&lt;/a&gt; problem sets. If any topic you don&amp;rsquo;t know, go read your Python reference.&lt;/p&gt;
&lt;p&gt;Should be very trivial.&lt;/p&gt;
&lt;h2 id="bininfo-first-try"&gt;Bininfo First Try&lt;/h2&gt;
&lt;h3 id="q-dna-counting-dna-nucleotides"&gt;Q DNA: Counting DNA Nucleotides&lt;/h3&gt;
&lt;p&gt;Link: &lt;a href="http://rosalind.info/problems/dna/"&gt;http://rosalind.info/problems/dna/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: use &lt;a href="https://docs.python.org/3/library/collections.html#collections.Counter"&gt;collections.Counter&lt;/a&gt; provided by Python&amp;rsquo;s stdlib&lt;/li&gt;
&lt;li&gt;More Hint: use &lt;code&gt;' '.join&lt;/code&gt; and list comprehension to output the answer&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="q-revc-the-secondary-and-tertiary-structures-of-dna"&gt;Q REVC: The Secondary and Tertiary Structures of DNA&lt;/h3&gt;
&lt;p&gt;Link: &lt;a href="http://rosalind.info/problems/revc/"&gt;http://rosalind.info/problems/revc/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: &lt;a href="https://docs.python.org/3/library/functions.html#reversed"&gt;reversed&lt;/a&gt; for any sequence object and a dict for nucleotide code mapping&lt;/li&gt;
&lt;li&gt;More Hint: done in a list comprehension&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="q-gc-computing-gc-content"&gt;Q: GC: Computing GC Content&lt;/h3&gt;
&lt;p&gt;Link: &lt;a href="http://rosalind.info/problems/gc/"&gt;http://rosalind.info/problems/gc/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This is the first complicated problem that some abstraction should help you come up the solution. Try write some re-usable code blocks, for example, function calls and class definitions.&lt;/p&gt;
&lt;p&gt;Don&amp;rsquo;t worry about the computation complexity&lt;/p&gt;
&lt;h4 id="workthrough"&gt;Workthrough&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;You should implement by yourself before looking my solution. Also I didn&amp;rsquo;t see their official solution so my solution can differ a lot from theirs.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Intuitively, we need to implement a FASTA file parser. FASTA contains a series of sequence reads with unique ID. From a object-oriented viewpoint, we create classes &lt;code&gt;Read&lt;/code&gt; for reads and &lt;code&gt;Fasta&lt;/code&gt; for fasta files.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Read&lt;/code&gt; is easy to design and understand,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seq&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;seq&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Since we need to compute their GC content, add a method for &lt;code&gt;Read&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# ... skipped&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;gc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Compute the GC content (in %) of the read.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="c1"&gt;# put the logic here (think of problem Q DNA)&lt;/span&gt;
        &lt;span class="n"&gt;gc_percent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seq&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;gc_percent&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we have to implement the FASTA parser, which reads all read entries and converts them through &lt;code&gt;Read&lt;/code&gt;. In real world we are dealing with &lt;code&gt;myfasta.fa&lt;/code&gt;-like files, but here the input is string.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Fasta&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;raw_str&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Parse a FASTA formated string.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;raw_str&lt;/span&gt;
        &lt;span class="c1"&gt;# convert string into structured reads.&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reads&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Parse the string and yield read in Read class.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="c1"&gt;# though we have no idea right now, the code structure&lt;/span&gt;
        &lt;span class="c1"&gt;# should be something like the following.&lt;/span&gt;
        &lt;span class="n"&gt;raw_lines&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;raw_lines&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here I use &lt;code&gt;yield Read(...)&lt;/code&gt;, which may be unfamiliar for Python beginners. It turns &lt;code&gt;parse(self)&lt;/code&gt; function as a generator. Generator makes you focus on the incoming data. Once data is parsed and converted, the result is immediated thrown out by &lt;code&gt;yield&lt;/code&gt;. We don&amp;rsquo;t care about how to collect all the results. In our case, we catch all the results into a list by &lt;code&gt;list(...)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So how should we read FASTA file? A simple rule in this case is that every read consists by two continuous row. Also, the first row will always be the first read id.&lt;/p&gt;
&lt;p&gt;All we need is read two lines at the same time. Here &lt;a href="https://docs.python.org/3/library/functions.html#zip"&gt;a Pythonic idiom&lt;/a&gt; is introduced. The following code read two non-overlapping lines,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;first_line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;second_line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;iter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;raw_lines&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;Read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;first_line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;second_line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;By &lt;code&gt;zip(*[iter(s)]*n)&lt;/code&gt; magic, we are very close to implement a full parser. You could find a lot of &lt;a href="http://stackoverflow.com/a/2233247"&gt;explanations&lt;/a&gt; for this magic.&lt;/p&gt;
&lt;p&gt;Read id line percedes with a &lt;code&gt;&amp;gt;&lt;/code&gt; sign, so we could use something like &lt;code&gt;first_line[1:]&lt;/code&gt; or &lt;code&gt;first_line[len('&amp;gt;'):]&lt;/code&gt; for explicity.&lt;/p&gt;
&lt;p&gt;Then sorting the GC% of reads in a FASTA file is easy.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;fasta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Fasta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;...&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sorted_reads&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fasta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reads&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gc&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;  &lt;span class="c1"&gt;# note 1&lt;/span&gt;
&lt;span class="n"&gt;top_gc_read&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sorted_reads&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# note 2&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0:s}&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;{1:.6f}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# note 3, 4&lt;/span&gt;
    &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;top_gc_read&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;top_gc_read&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gc&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The code above completes the following steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;sorted(list, key=key_func)&lt;/code&gt; sorts the list based on the return value of key_func applied to each element.&lt;/li&gt;
&lt;li&gt;or &lt;code&gt;top_gc_read = sorted(..., reversed=True)[0]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;two string with no operands in between will be joint automatically. In this case it is exactly &lt;code&gt;&amp;gt;{0:s}\n{1:.6f}&lt;/code&gt;. This is useful to tidy a super long string.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;'...'.format()&lt;/code&gt; fills the string with given values. See &lt;a href="https://docs.python.org/3/library/string.html#formatspec"&gt;doc&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In real case FASTA can span across multiple lines, also likely the file we parse is broken. How could we modify this parser to handle these situations?&lt;/p&gt;
&lt;h3 id="q-next"&gt;Q: (next?)&lt;/h3&gt;
&lt;p&gt;I&amp;rsquo;m super tired now so I&amp;rsquo;ll leave the rest for you. Try those problems within yellow correct ratio range.&lt;/p&gt;</content><category term="Coding"></category><category term="en"></category><category term="labcoding"></category><category term="python"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—é™„éŒ„ - OSX é–‹ç™¼ç’°å¢ƒ</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/" rel="alternate"></link><published>2016-01-21T23:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-appendix-osx-env/</id><summary type="html">&lt;p&gt;æˆ‘è‡ªå·±åœ¨ OSX ä¸Šçš„ä¸»è§€é–‹ç™¼ç’°å¢ƒè¨­å®š&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jan, 2016 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹çš„è¨­å®šéƒ½è »ä¸»è§€çš„ï¼Œè¦‹äººè¦‹æ™ºã€‚ç¸½ä¹‹æˆ‘æŠŠæˆ‘çš„ç’°å¢ƒåˆ†äº«å‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#terminal"&gt;Terminal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#homebrew-git-and-python"&gt;Homebrew, Git and Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#text-editors"&gt;Text Editors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#terminal-multiplexers"&gt;Terminal Multiplexers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git-gui"&gt;Git GUI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#documentation-searcher"&gt;Documentation Searcher&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#misc"&gt;Misc.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="terminal"&gt;Terminal&lt;/h2&gt;
&lt;p&gt;OSX ç³»çµ±æœ‰å…§å»ºä¸€å€‹ &lt;code&gt;Terminals.app&lt;/code&gt; èƒ½åƒåœ¨ Linux ä¸Šä¸€æ¨£ä½¿ç”¨ã€‚ä»–å…¶å¯¦ä½¿ç”¨ä¸Šæ²’ä»€éº¼å•é¡Œï¼Œä¸éŽæƒ³è¦èª¿é¡è‰²ï¼Œæœ‰æ›´å¤šè‡ªå®šåŠŸèƒ½çš„è©±ï¼Œè¨±å¤šäººæœƒå®‰è£ &lt;a href="http://iterm2.com/"&gt;iTerm2&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="homebrew-git-and-python"&gt;Homebrew, Git and Python&lt;/h2&gt;
&lt;p&gt;OSX ä¸Šå®˜æ–¹æ²’æœ‰ä¸€å€‹ç®¡ç†å¥—ä»¶çš„å·¥å…·ï¼Œæ‰€ä»¥ç¤¾ç¾¤è‡ªè¡Œé–‹ç™¼äº†ä¸€å€‹å«åš Homebrewã€‚ä½ å¯ä»¥æŒ‰ç…§&lt;a href="http://djangogirlstaipei.herokuapp.com/tutorials/installation/"&gt;é€™ç¯‡æ•™å­¸&lt;/a&gt;å®‰è£ Homebrewã€‚&lt;/p&gt;
&lt;p&gt;è£å¥½äº†ä¹‹å¾Œä½ å¯ä»¥ä»¥ä¸‹æŒ‡ä»¤åŽ»çœ‹å®ƒè©²æ€Žéº¼æ“ä½œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ brew --help
$ man brew    &lt;span class="c1"&gt;# for full documentation&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;OSX é›–ç„¶å…§å»ºæœ‰ git èˆ‡ pythonï¼Œä½†æˆ‘å€‘å¯ä»¥ç”¨ homebrew å®‰è£æ¯”è¼ƒæ¨™æº–ï¼ˆæ–°ï¼‰çš„ç‰ˆæœ¬ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ brew install git python3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æžœ homebrew æœ‰å•é¡Œå¯ä»¥ç”¨ &lt;code&gt;brew doctor&lt;/code&gt; ä¾†æª¢æ¸¬ã€‚æŠŠéŒ¯èª¤è¨Šæ¯å• google é€šå¸¸å°±èƒ½æ‰¾åˆ°è§£æ±ºæ–¹å¼ã€‚&lt;/p&gt;
&lt;h2 id="text-editors"&gt;Text Editors&lt;/h2&gt;
&lt;p&gt;æˆ‘æœ€å¸¸ç”¨çš„æ˜¯ Vimã€‚OSX æœ‰å…§å»ºï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ homebrew å®‰è£ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† console based çš„ Vimï¼ŒOSX ä¸Šä¹Ÿæœ‰åƒ gVim çš„ MacVimã€‚ä¸€æ¨£èƒ½ç”¨ homebrew å®‰è£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ brew info macvim  &lt;span class="c1"&gt;# çœ‹ MacVim åœ¨å®‰è£æœ‰ä»€éº¼é¸é …å¯ä»¥èª¿æ•´&lt;/span&gt;
$ brew install macvim --override-system-vim --custom-icons
$ brew linkapps macvim
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨ Macvim çš„æ™‚å€™é™¤äº† vim ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å‘¼å« &lt;code&gt;mvim&lt;/code&gt; æ‰“é–‹ MacVimã€‚&lt;/p&gt;
&lt;h2 id="terminal-multiplexers"&gt;Terminal Multiplexers&lt;/h2&gt;
&lt;p&gt;ä½ æœ‰å¯èƒ½æœ‰è½éŽ screen æˆ–è€… tmuxã€‚å‰è€…åœ¨ osx ä¸Šæœ‰å…§å»ºä½†ç‰ˆæœ¬å¾ˆèˆŠï¼Œåœ¨é¡¯ç¤ºé¡è‰²ä¸Šæœƒæœ‰å•é¡Œï¼Œå› æ­¤å¯ä»¥é€éŽ homebrew å†å®‰è£æ–°çš„ã€‚ä½†å› ç‚º screen è·Ÿç³»çµ±æä¾›çš„é‡è¦†åˆ°äº†ï¼Œæ‰€ä»¥é è¨­ä¸åœ¨ homebrew çš„ repo ä¸­ï¼Œè¦å…ˆæ–°å¢ž repo æ¸…å–®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;brew tap homebrew/dupes
brew install screen tmux
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="git-gui"&gt;Git GUI&lt;/h2&gt;
&lt;p&gt;åˆå­¸ Git å¯èƒ½æœƒä¸ç†Ÿé‚£äº›æŒ‡ä»¤ã€å¸¸å¸¸ä¸çŸ¥é“è‡ªå·±åœ¨ git log å“ªå€‹ä½ç½®ã€‚é€™æ™‚å€™æœ‰å€‹åœ–å½¢åŒ–çš„å·¥å…·æœƒæ›´æ–¹ä¾¿äº†è§£ã€‚Git æœ‰å…§å»ºä¸€å€‹ gitkï¼Œä½†æ¯”è¼ƒé™½æ˜¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ OSX ä¸Šå¯ä»¥è€ƒæ…®ç”¨ &lt;a href="http://www.sourcetreeapp.com/"&gt;SourceTree&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="documentation-searcher"&gt;Documentation Searcher&lt;/h2&gt;
&lt;p&gt;è¦ä¸€ç›´æŸ¥ Python å®˜ç¶²æœ‰æ™‚å€™é‚„è »éº»ç…©çš„ï¼Œæœªä¾†å­¸äº† HTML CSS ç­‰ç­‰ä¸åŒèªžè¨€æˆ–å„ç¨® Python å¥—ä»¶ï¼Œè¦æŸ¥å€‹æ±è¥¿æœƒå¾ˆè²»æ™‚ã€‚æ‰€ä»¥æœ‰äººé–‹ç™¼äº†ä¸€å€‹é›¢ç·šçš„ documentation æŸ¥è©¢å™¨å«åš &lt;a href="http://kapeli.com/dash"&gt;Dash&lt;/a&gt;ã€‚ä»–è¦éŒ¢ä½†æœ‰å…è²»ç‰ˆï¼Œä¼¼ä¹Žæ˜¯æœƒä¸€ç›´è·³æç¤ºè¨Šæ¯ã€‚&lt;/p&gt;
&lt;h2 id="misc"&gt;Misc.&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.alfredapp.com/"&gt;Alfred App&lt;/a&gt;ï¼šä¸€å€‹å»¶ä¼¸ç‰ˆçš„ Spotlightï¼ŒæŸ¥æ‡‰ç”¨ç¨‹å¼å¾ˆå¿«é€Ÿï¼ŒåŒæ™‚ä¹Ÿå¯ä»¥è·Ÿ Dash æ•´åˆè®“æŸ¥ doc æ›´æ–¹ä¾¿ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href="http://macdown.uranusjr.com/"&gt;Macdown&lt;/a&gt;ï¼šOSX ä¸Šçš„ markdown ç·¨è¼¯å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;</content><category term="Coding"></category><category term="zh"></category><category term="labcoding"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—ï¼Python</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/" rel="alternate"></link><published>2016-01-21T22:50:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-python/</id><summary type="html">&lt;p&gt;é¸æ“‡ Python ä½œç‚ºç¬¬ä¸€å€‹æ·±å…¥å­¸ç¿’çš„èªžè¨€æœ‰å¾ˆå¤šå¥½è™•ã€‚ä»–çš„èªžæ³•è·Ÿè‹±æ–‡ç›¸ä¼¼ã€ç”¨äº’å‹•å¼çš„æ–¹å¼ä¾†æ“ä½œï¼Œæ–¹ä¾¿ä»¥é‚Šè©¦é‚Šå­¸ã€å…§å»ºçš„æ¨™æº–å‡½å¼åº«åŠŸèƒ½è±å¯Œã€ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œå¹¾ä¹Žèƒ½ç”¨ Python å®Œæˆå„ç¨®äº‹æƒ…ã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jun, 2017 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Python æ˜¯ä¸€ç¨®ç‰©ä»¶å°Žå‘ã€ç›´è­¯å¼çš„é›»è…¦ç¨‹å¼èªžè¨€ï¼Œå…·æœ‰è¿‘äºŒåå¹´çš„ç™¼å±•æ­·å²ã€‚å®ƒåŒ…å«äº†ä¸€çµ„åŠŸèƒ½å®Œå‚™çš„æ¨™æº–åº«ï¼Œèƒ½å¤ è¼•é¬†å®Œæˆå¾ˆå¤šå¸¸è¦‹çš„ä»»å‹™ã€‚&lt;/p&gt;
&lt;p&gt;(From &lt;a href="https://zh.wikipedia.org/wiki/Python"&gt;Wikipedia&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¸æ“‡ Python ä½œç‚ºç¬¬ä¸€å€‹æ·±å…¥å­¸ç¿’çš„èªžè¨€æœ‰å¾ˆå¤šå¥½è™•ã€‚ä»–çš„èªžæ³•è·Ÿè‹±æ–‡ç›¸ä¼¼ï¼Œæ¯”èµ·å…¶ä»–èªžè¨€ç¶“å¸¸ç”¨åˆ° &lt;code&gt;;{}()&lt;/code&gt; ä¾†æŽ§åˆ¶èªžæ³•ä¸åŒçš„æ®µè½ï¼ŒPython ä¸»è¦ç”¨çš„æ˜¯ç©ºç™½èˆ‡ç¸®æŽ’ã€‚&lt;/p&gt;
&lt;p&gt;Python èƒ½ç”¨äº’å‹•å¼çš„æ–¹å¼ï¼ˆreadâ€“evalâ€“print loop, REPLï¼‰ä¾†æ“ä½œï¼Œä»¥é‚Šè©¦é‚Šåšçš„æ–¹æ³•ä¾†é–‹ç™¼å¾ˆé©åˆåˆå­¸è€…ã€‚&lt;/p&gt;
&lt;p&gt;å…§å»ºçš„æ¨™æº–åº«ï¼ˆstandard libraryï¼‰åŠŸèƒ½å¾ˆè±å¯Œï¼Œåœ¨ç¶²è·¯ã€æ–‡å­—è™•ç†ã€æª”æ¡ˆè™•ç†ã€ç”šè‡³ GUI ä»‹é¢éƒ½èƒ½ç”¨å®ƒå®Œæˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒçš„ç¬¬ä¸‰æ–¹å¥—ä»¶ä¹Ÿå¾ˆå¤šï¼Œåœ¨ Linux ä¸Šå¾ˆå¥½å®‰è£ï¼Œé€™æ¨£å¹¾ä¹Žèƒ½ç”¨ Python å®Œæˆå„ç¨®äº‹æƒ…ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;è½èªªç³»åˆ—&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python"&gt;è½èªª Python è·‘å¾ˆæ…¢ï¼Œæ˜¯ä¸æ˜¯ä¸èƒ½ç”¨ä¾†è¨ˆç®—/åˆ†æž/å¤§æª”æ¡ˆï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python-2-python-3"&gt;Python 2 é‚„æ˜¯ Python 3ï¼Œè½æˆ‘æœ‹å‹èªªâ€¦æ¯”è¼ƒå¥½ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç›¸é—œè³‡æº&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#introducing-python-python"&gt;Introducing Pythonï¼ˆç²¾é€š Pythonï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python_1"&gt;Python å®˜ç¶²&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python_2"&gt;Python ç¨‹å¼è¨­è¨ˆã€Œè¶…å…¥é–€ã€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#learning-python"&gt;Learning Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#python-cookbookpython"&gt;Python Cookbookï¼ˆPython çš„éŒ¦å›Šå¦™è¨ˆï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#fluent-python-python"&gt;Fluent Pythonï¼ˆæµæš¢çš„ Pythonï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#moocs"&gt;MOOCs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;å­¸ç¿’ç›®æ¨™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#file-a1_python_bioinfo-md"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="_1"&gt;è½èªªç³»åˆ—&lt;/h2&gt;
&lt;p&gt;ï¼ˆéœ€è¦æŽ¥è§¸éŽ Python ä¹‹å¾Œæ‰èƒ½ç†è§£ï¼‰&lt;/p&gt;
&lt;h3 id="python"&gt;è½èªª Python è·‘å¾ˆæ…¢ï¼Œæ˜¯ä¸æ˜¯ä¸èƒ½ç”¨ä¾†è¨ˆç®—/åˆ†æž/å¤§æª”æ¡ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Python çš„ç¢ºåŸ·è¡Œæ•ˆçŽ‡æ¯”ç·¨è­¯å¼çš„èªžè¨€å·®ï¼ˆä¾‹ï¼šC/C++ã€Javaï¼‰ï¼Œä½†é€™å¾ˆå¯èƒ½ä¸æ˜¯ä½ ç¨‹å¼è·‘å¾—æ…¢çš„ä¸»å› ï¼Œæ‰€ä»¥ä¹Ÿä¸ä»£è¡¨ Python ä¸èƒ½è™•ç†è¨ˆç®—é‡é«˜çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ç¢°åˆ°ç¨‹å¼è·‘å¾—æ¯”æƒ³åƒä¸­æ…¢çš„æ™‚å€™ï¼Œæœ‰å¹¾å€‹æ­¥é©Ÿï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ°åº•æ˜¯å“ªå¹¾è¡Œç¨‹å¼è·‘å¾—æ…¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é€™æ˜¯æœ€ä½³çš„æ¼”ç®—æ³•å—Žï¼Ÿ&lt;/li&gt;
&lt;li&gt;é€™æ˜¯æœ€æœ‰æ•ˆçŽ‡çš„ Python èªžæ³•å—Žï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æžœç”¨åˆ°äº†æœ€å¾Œä¸€æ­¥æƒ…æ³é‚„æ˜¯æ²’æœ‰æ”¹å–„çš„è©±ï¼Œå°±å¯ä»¥é–‹å§‹æŠŠé‚£äº›éƒ¨ä»½ç”¨å…¶ä»–èªžè¨€æ”¹å¯«ï¼Œä¾‹å¦‚ï¼šCã€‚Python èƒ½å¾ˆå®¹æ˜“è·Ÿ C èªžè¨€çš„çµåˆã€‚è€Œä¸”å¸¸è¦‹çš„ C èªžè¨€åŠ é€Ÿï¼Œå…¶å¯¦éƒ½æœ‰ Python å¥—ä»¶èƒ½æ”¯æ´äº†ï¼Œä¾‹å¦‚ Numpyï¼Œæ‰€ä»¥å¤§éƒ¨ä»½çš„æ™‚é–“ï¼Œéƒ½èƒ½åœ¨ä¸ä½¿ç”¨ Python ä»¥å¤–çš„èªžè¨€å®Œæˆé«˜é‡è¨ˆç®—ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘åœ¨å¯¦ç¿’æ™‚å€™ï¼Œä¹Ÿå¸¸ç¢°åˆ°éœ€è¦å„ªåŒ–çš„å•é¡Œã€‚ç”¨ Python æˆ‘èƒ½å¾ˆè¼•é¬†ï¼ˆä¸€å¤©å…§ï¼‰æŠŠå·¥ä½œåˆ†é…åˆ° 4 å°ä¸»æ©Ÿ 64 cores ä¸Šè·‘ï¼Œä¹Ÿè¨±æ–¹æ³•ä¸æœ‰æ•ˆçŽ‡ï¼Œä½†æ¯”èµ·æˆ‘èŠ±å¹¾å¤©æŠŠ Python æ”¹å¯«æˆ C/C++ï¼Œå¯¦ä½œæ›´ç²¾å¯†æœ‰æ•ˆçš„ç®—æ³•ï¼ˆé‚„è¦æ˜¯ multithreadï¼‰ï¼Œä»”ç´°è™•ç†å¯èƒ½çš„ corner caseï¼Œå¹³è¡ŒåŒ–ä¹‹å¾Œæœ¬ä¾†ä¸‰å››å¤©çš„è¨ˆç®—æ™‚é–“æˆ‘ 2 å€‹å°æ™‚å°±èƒ½æ”¶å·¥ã€‚&lt;/p&gt;
&lt;p&gt;æ›´é‡è¦çš„æ˜¯ï¼Œé€™å€‹å¯¦é©—å°±åªè·‘å€‹å…©æ¬¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯”èµ·è¨ˆç®—æ™‚é–“ï¼Œé–‹ç™¼æ™‚é–“å°å·¥ç¨‹å¸«è€Œè¨€æ˜¯æ›´åŠ å¯¶è²´çš„ã€‚å°¤å…¶åœ¨å¯¦é©—å®¤ï¼Œæœ€é—œå¿ƒçš„æ˜¯é€™å€‹æ–¹æ³•è¡Œä¸è¡Œå¾—é€šï¼Œç¨‹å¼è·‘å¾—æ…¢æœ‰å¾ˆå¤šè§£æ±ºçš„æ–¹å¼ï¼Œä¾‹å¦‚å¹³è¡ŒåŒ–ã€‚é‡é»žåœ¨è§£æ±ºå•é¡Œï¼Œéœ€è¦ç”¨å¤šä¸€é»žçš„è³‡æºå…¶å¯¦ä¸æ˜¯å¾ˆé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœå•æˆ‘ Python é‚„æ˜¯ Matlab æ¯”è¼ƒå¿«ï¼Ÿé€™é‚Šæœ‰æ­£ç¶“çš„ &lt;a href="http://www.pyzo.org/python_vs_matlab.html"&gt;Python vs Matlab&lt;/a&gt;ã€‚ä¸€é–‹å§‹é¸ Python æ…¢çš„è©±æœ‰&lt;a href="http://wiki.scipy.org/PerformancePython"&gt;å¾ˆå¤šæ¢è·¯å¯ä»¥èµ°&lt;/a&gt;ï¼Œä½† Matlab å‘¢ï¼Ÿ meh&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ Python è·‘å¾—å¿«ä¸å¿«ï¼Ÿå®ƒå–®æ‰“ç¨é¬¥æœ‰æ¥µé™ï¼Œä½†å®ƒæœ‰å¾ˆå¤šå¿«æ¨‚å¤¥ä¼´ã€‚O&amp;rsquo;Reilly æœ‰æœ¬ &lt;a href="http://shop.oreilly.com/product/0636920028963.do"&gt;High Performance Python&lt;/a&gt; å€¼å¾—ä¸€çœ‹ã€‚&lt;/p&gt;
&lt;h3 id="python-2-python-3"&gt;Python 2 é‚„æ˜¯ Python 3ï¼Œè½æˆ‘æœ‹å‹èªªâ€¦æ¯”è¼ƒå¥½ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;éš¨è‘—æ™‚é–“æµé€ï¼Œæ¯éŽä¸€å¤©æˆ‘éƒ½å¯ä»¥æ›´ç¢ºä¿¡çš„èªª&lt;strong&gt;ã€Œè«‹å­¸ Python 3ã€&lt;/strong&gt;ã€‚ç¾åœ¨æœ‰åœ¨ç”¨ Python 2 å¤šåŠä¹Ÿæ˜¯ç”¨ 2.7 ç‰ˆæœ¬ï¼Œè¦æŠŠ 3.3+ çš„ç¨‹å¼ç¢¼æ”¹å›ž 2.7 ä¹Ÿä¸é›£ã€‚&lt;/p&gt;
&lt;p&gt;EDIT 2017-06: Python 2.7 ç¢ºå®š&lt;a href="https://pythonclock.org/"&gt;åœ¨ 2020 å¹´æœƒåœæ­¢å®˜æ–¹æ”¯æ´&lt;/a&gt;ï¼Œé€™ä¸ä»£è¡¨èªªåœ¨é‚£å¹´ Python 2.7 å°±æœƒçž¬é–“æ¶ˆå¤±ï¼Œç›®å‰ä¸–ç•Œä¸Šæœ‰éžå¸¸å¤šå…¬å¸æœƒç¹¼çºŒç¶­è­·ä»–å€‘å…§éƒ¨çš„ Python 2.x ç¨‹å¼ç¢¼ï¼Œä½†æ–°çš„å°ˆæ¡ˆéƒ½é è¨­ä½¿ç”¨ 3.5+ ç‰ˆæœ¬é–‹ç™¼ã€‚è€Œå¸‚é¢ä¸Šçš„æ›¸ç±ä¹Ÿå·²ç¶“éƒ½æ˜¯é‡å° Python 3.x æ’°å¯«ï¼ŒéŽå¾€ä½¿ç”¨ä¸­æ–‡å­¸ç¿’çš„éšœç¤™å·²ç¶“æ¶ˆå¤±ã€‚&lt;/p&gt;
&lt;h2 id="_2"&gt;ç›¸é—œè³‡æº&lt;/h2&gt;
&lt;p&gt;é€£åŒå‰å¹¾ç« ï¼Œå¦‚æžœä½ è¦åœ¨è‡ªå·±é›»è…¦ä¸Šè¨­å®š Python é–‹ç™¼ç’°å¢ƒï¼Œå¯ä»¥åƒè€ƒ &lt;a href="http://djangogirlstaipei.herokuapp.com/tutorials/"&gt;Djang Girls Taipei Tutorial&lt;/a&gt;ã€‚å¦å¤–ï¼Œ&lt;a href="http://wiki.python.org.tw/Python/%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%94%A8%E5%B0%B1%E4%B8%8A%E6%89%8B"&gt;Python Taiwan Wiki&lt;/a&gt; æœ‰æ›´å®Œæ•´çš„ Python å­¸ç¿’è³‡æºåˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;O&amp;rsquo;Reillyï¼ˆæ­èŠç¦®ï¼‰çš„æ›¸ï¼Œ&lt;a href="https://shop.oreilly.com/"&gt;å®˜æ–¹ç·šä¸Šå•†åº—&lt;/a&gt;å¸¸æœ‰ 50% æŠ˜æ‰£ï¼ŒPDF/ePub/Mobi æ ¼å¼éƒ½æœ‰, è²·ä¸€æ¬¡å°±èƒ½è¼•é¬†åœ¨é›»è…¦ã€Kindleã€eReader ä¸Šé–±è®€ï¼Œèƒ½æŽ¥å—è‹±æ–‡çš„è©±ï¼Œååˆ†æŽ¨è–¦è·Ÿå®˜æ–¹è³¼è²·ã€‚ä¸­æ–‡ç‰ˆå°±ä»¥&lt;a href="https://www.tenlong.com.tw/"&gt;å¤©ç“æ›¸å±€&lt;/a&gt;ç‚ºä¸»ã€‚å®ƒä¹Ÿæœ‰è³£è‹±æ–‡ç´™æœ¬ï¼Œé€›å¯¦é«”åº—å¾ˆèˆ’æœã€‚&lt;/p&gt;
&lt;p&gt;EDIT 2017-06: è‡ªæœ¬æ–‡æ’°å¯«å…©å¹´ä»¥ä¾†ï¼Œå¸‚é¢ä¸Š Python 3.x ä¸­æ–‡æ›¸å·²ç¶“éžå¸¸å……è¶³ï¼Œåœ¨å¤©ç“å¯¦é«”åº—ç”šè‡³æœ‰ä¸€æ•´å€‹å°ˆæ«ƒæä¾›ä¸åŒé›£æ˜“åº¦ã€å„ç¨®æ‡‰ç”¨çš„å°ˆæ›¸ã€‚åº•ä¸‹åˆ—å‡ºçš„æ›¸åªæ˜¯æˆ‘å€‹äººçš„æŽ¨è–¦èˆ‡åå¥½ï¼Œå»ºè­°æœ‰ç©ºåˆ°æ›¸åº—è¦ªè‡ªç¿»ä¸€ç¿»æ›´èƒ½æ‰¾åˆ°è‡ªå·±å–œæ­¡çš„å­¸ç¿’æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†æ›¸ç±ä¹‹å¤–ï¼Œç¾åœ¨è¶Šä¾†è¶Šå¤šä»¥å½±ç‰‡ã€äº’å‹•å½¢å¼çš„æ•™å­¸ï¼Œåƒ Jessica McKellar éŒ„è£½çš„ &lt;a href="http://shop.oreilly.com/product/110000448.do"&gt;Introduction to Python&lt;/a&gt; æ•™å­¸å½±ç‰‡å³éžå¸¸å—æ­¡è¿Žã€‚å› ç‚ºæˆ‘ä¸¦æ²’æœ‰è¦ªè‡ªçŽ©éŽé€™äº›æ–°èª²ç¨‹ï¼Œå®ƒå€‘ä¸¦æ²’æœ‰åˆ—æ–¼æ­¤ï¼Œä½†éƒ½æ­¡è¿Žè®€è€…å˜—è©¦ã€‚&lt;/p&gt;
&lt;h3 id="introducing-python-python"&gt;Introducing Pythonï¼ˆç²¾é€š Pythonï¼‰&lt;/h3&gt;
&lt;p&gt;O&amp;rsquo;Reilly Python ç³»åˆ—çš„æ›¸éƒ½å¯«å¾—å¾ˆå¥½ã€‚é€™æœ¬æ˜¯æ¯”è¼ƒæ–°å‡ºçš„ï¼Œå¥½è™•æ˜¯å®ƒé‡å°åˆå­¸è€…ï¼Œæ¯”è¼ƒè–„ï¼Œèƒ½åœ¨çŸ­æ™‚é–“çœ‹å®Œï¼Œæ–‡å­—å¾ˆæµæš¢ã€‚æƒ³è¦å¿«é€ŸæŽŒæ¡åŸºç¤Žçš„èªžæ³•çš„è©±ï¼Œå»ºè­°é–±è®€ Chp1 åˆ° Chp7ï¼Œä»¥åŠ Chp8 File I/O éƒ¨ä»½ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Introducing Python&amp;rdquo;, Bill Lubanovic. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2014.11&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920028659.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tenlong.com.tw/items/9863477311?item_id=1007464"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="python_1"&gt;Python å®˜ç¶²&lt;/h3&gt;
&lt;p&gt;Python çš„å®˜ç¶²é™¤äº†æŸ¥èªžè¨€ç‰¹æ€§ä¹‹å¤–ï¼Œé‚„èƒ½ç”¨ä¾†å­¸ç¿’æ€Žéº¼ä½¿ç”¨ stdlibã€‚Python æ¨™æº–å‡½å¼åº«åŠŸèƒ½åŒ…å±±åŒ…æµ·ï¼Œåœ¨ä½ æƒ³è¦åšä»€éº¼ä¹‹å‰ï¼Œéƒ½æ‡‰è©²åˆ°å®˜ç¶²æŸ¥çœ‹çœ‹æ˜¯ä¸æ˜¯å…§å»º module å°±å·²ç¶“æä¾›åŠŸèƒ½äº†ã€‚é™¤å¤–ï¼Œé‚„æœ‰ä¸€å€‹ç°¡æ½”çš„ tutorialï¼Œä¾›åˆå­¸è€…åƒè€ƒï¼Œé©åˆæœ‰å­¸éŽå…¶ä»–èªžè¨€çš„äººã€‚æˆ‘èªç‚ºé€™ä»½å¯«å¾—éžå¸¸å¥½ï¼Œè‹¦æ–¼æ²’æœ‰ä¸­æ–‡ï¼Œæ“šä»¥å‰ç¶“é©—ä¸å¤ªå®¹æ˜“æŽ¨å»£ï¼Œä½†å€¼å¾—ä¸€è®€ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Python Tutorial&amp;rdquo;, Official Python Documentation, Python Devs.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.python.org/3/"&gt;é€£çµ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.pythondoc.com/pythontutorial3/index.html"&gt;ç°¡ä¸­ç¿»è­¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.python.org.tw/3/tutorial/index.html"&gt;ç¹ä¸­ç¿»è­¯&lt;/a&gt;ï¼ˆé€²è¡Œä¸­ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="python_2"&gt;Python ç¨‹å¼è¨­è¨ˆã€Œè¶…å…¥é–€ã€&lt;/h3&gt;
&lt;p&gt;å¦‚æžœä½ å®Œå…¨æ²’æœ‰ä»»ä½•ç¨‹å¼è¨­è¨ˆçš„åŸºç¤Žï¼Œä¾‹å¦‚ä¸æ‡‚ä»€éº¼æ˜¯è®Šæ•¸ã€å¦‚æžœå¯«ç¨‹å¼æŽ§åˆ¶é›»è…¦è¡Œç‚ºã€ä»€éº¼æ˜¯å‘½ä»¤åˆ—æ¨¡å¼ï¼Œé‚£éº¼é€™æœ¬å…¥é–€æ›¸æ‡‰è©²å¾ˆé©åˆä½ ã€‚å®ƒç”¨åœ–è§£çš„æ–¹å¼åŽ»è§£é‡‹ä½•è¬‚è¿´åœˆã€if-else æ¢ä»¶åˆ¤æ–·ã€ç‰©ä»¶å°Žå‘æ¦‚å¿µã€‚é€™é‚Šæ‰€åˆ—çš„å…¶ä»–ã€Œå…¥é–€æ›¸ã€ï¼Œéƒ½æœƒå‡è¨­ä½ å¤§æ¦‚çŸ¥é“ä¸Šè¿°é€™äº›æ¦‚å¿µã€‚åˆ°äº†æœ€å¾Œå…©ç« å¯èƒ½æœƒçªç„¶è®Šå¾—è¤‡é›œï¼Œé€™æ™‚å€™å¯ä»¥å†å›žé ­çœ‹çœ‹å…¶ä»–å…¥é–€æ›¸ï¼Œæ‡‰è©²å°±æœƒæœ‰è¾¦æ³•é–±è®€ã€‚&lt;/p&gt;
&lt;p&gt;ã€ŠPython ç¨‹å¼è¨­è¨ˆã€Œè¶…å…¥é–€ã€ã€‹ï¼ŒéŽŒç”°æ­£æµ©ã€€è‘—ã€é™³ç¦¹è±ªã€æž—å­æ”¿ è­¯ã€‚æ——æ¨™ 2016.11&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://amzn.asia/dQgghO8"&gt;æ—¥æ–‡æ›¸&lt;/a&gt; (source: Amazon)&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.tenlong.com.tw/products/9789863123798"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="learning-python"&gt;Learning Python&lt;/h3&gt;
&lt;p&gt;é›–ç„¶åç¨±çœ‹èµ·ä¾†å¾ˆåƒæ˜¯ Python çš„å…¥é–€æ›¸ï¼Œä½†å®ƒçš„ç¯‡å¹…å·²ç¶“ä¾†åˆ° 1600 é ï¼Œå¯¦åœ¨ç„¡æ³•æŽ¨è–¦çµ¦åˆå­¸è€…ã€‚å®ƒåœ¨ä¸€æœ¬æ›¸å…§æŠŠ Python å¹¾ä¹Žæ‰€æœ‰èªžè¨€ç‰¹æ€§éƒ½èªªæ¸…æ¥šï¼ŒåŒæ™‚è€ƒæ…®åˆ° Python 2 å’Œ 3 ç‰ˆæœ¬ã€‚ç•¶ä½ æƒ³è¦äº†è§£ï¼Œä¾‹å¦‚ MRO çš„é †åºã€ä½•è¬‚ unbounded, bound methodï¼Œé€™æœ¬æ›¸è©³ç´°çš„ç¨‹åº¦ä¸æœƒè®“ä½ å¤±æœ›ï¼Œåªæ€•ä½ æ²’ç©ºè®€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç•¶åˆçœ‹çš„æ˜¯é€™ä¸€æœ¬ 3ed ä¸­æ–‡ç‰ˆï¼ˆç¾å·²çµ•ç‰ˆï¼‰ï¼Œé‚£æ™‚é‚„æ²’æœ‰è€ƒæ…® Python 3ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Learning Python&amp;rdquo; 5ed, Mark Lutz. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2013.06&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920028154.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="python-cookbookpython"&gt;Python Cookbookï¼ˆPython çš„éŒ¦å›Šå¦™è¨ˆï¼‰&lt;/h3&gt;
&lt;p&gt;é€™æœ¬ä¸æ˜¯å…¥é–€æ›¸ä½†å¾ˆé©åˆæ·±å…¥äº†è§£ Pythonï¼Œä¸¦è®“è‡ªå·±çš„ç¨‹å¼ç¢¼å¯«å¾—æ›´ Pythonicã€‚è£¡é¢ä»‹ç´¹äº†å¾ˆå¤šå¯«æ³•æ…£ä¾‹ idiomsï¼ŒåŒæ™‚ä¹Ÿæœ‰ä¸­æ–‡ç‰ˆã€‚éžå¸¸å€¼å¾—åœ¨æœªä¾†æ¯”è¼ƒæ‡‚ Python æ™‚è²·ä¾†çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…ä¹‹ä¸€ David Beazley æ˜¯ PyCon TW 2013 çš„ Keynoteã€‚ä»–å¹³å¸¸å°±æ˜¯å°ˆé–€æ•™ Python çš„è¬›å¸«ï¼Œä»–åœ¨ PyCon è¬›éŽçš„ã€Œæ‰€æœ‰ talk èˆ‡ tutorialã€ï¼Œå¦‚ &lt;a href="http://www.dabeaz.com/coroutines/"&gt;concurrency&lt;/a&gt;, &lt;a href="http://www.dabeaz.com/modulepackage/index.html"&gt;packaging&lt;/a&gt;, &lt;a href="https://www.youtube.com/watch?v=MCs5OvhV9S4"&gt;async io&lt;/a&gt; ç­‰ç­‰éƒ½å€¼å¾—ä¸€çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Python Cookbook&amp;rdquo; 3ed, David Beazley and Brian K. Jones. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2013.05&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920027072.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tenlong.com.tw/items/9863470686"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="fluent-python-python"&gt;Fluent Pythonï¼ˆæµæš¢çš„ Pythonï¼‰&lt;/h3&gt;
&lt;p&gt;ç•¶å®ƒæ˜¯è©³ç´°ã€æ“´å……ç‰ˆçš„ &amp;ldquo;Python Cookbook&amp;rdquo;ï¼Œå¯¦éš›ä¸Šæ›¸ä¸­ä¹Ÿå¸¸å¸¸å¼•ç”¨ David çš„è©±ã€‚è¬›è¿°æ›´å¤š Python åˆä»‹ç´¹æ™‚ä¸æœƒæ·±è«‡çš„èªžè¨€ç‰¹æ€§ã€‚å¦‚ï¼šMRO, Mixin, decorator, closure, metaprogramming&lt;/p&gt;
&lt;p&gt;æ¯ç« æœ€å¾Œçš„ Future Reading èˆ‡ Soapbox æ—å¾µåšå¼•ï¼Œé™¤äº†æ›´ç´°ç¯€çš„åƒè€ƒè³‡æ–™ï¼Œé‚„æœ‰ç•¶åˆ Python ç‚ºä½•å¦‚æ­¤è¨­è¨ˆç­‰è€ƒé‡èˆ‡è¨Žè«–çš„æ­·å²ã€ç™¼å±•ã€èˆ‡å„èªžè¨€æ¯”è¼ƒã€‚éžå¸¸é©åˆåšç‚ºé‚å‘ Python core developer çš„åƒè€ƒæ›¸ã€‚&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Fluent Python&amp;rdquo;, Luciano Ramalho. &lt;em&gt;O&amp;rsquo;Reilly&lt;/em&gt;, 2015.07&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://shop.oreilly.com/product/0636920032519.do"&gt;è‹±æ–‡æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tenlong.com.tw/items/986347911X"&gt;ä¸­æ–‡å¯¦é«”æ›¸&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="moocs"&gt;MOOCs&lt;/h3&gt;
&lt;p&gt;é—œæ–¼ MOOCs æˆ‘æœ‰çœ‹éŽ Codecademy Python Track ä»¥åŠ Coursera &amp;ldquo;An Introduction to Interactive Programming in Python&amp;rdquo; é€™å…©é–€èª²ã€‚æˆ‘è¦ºå¾—æœ€å¤§çš„ç¼ºé»žå°±æ˜¯è¬› Python 2.7ï¼ŒPython 3.x çš„å¥½ç”¨åŠŸèƒ½èˆ‡å·®ç•°éƒ½æ²’æï¼›å†ä¾†è¬›èª²çš„ code ç¯„ä¾‹ä¸¦ä¸æ˜¯ä½¿ç”¨ idiomatic Python syntaxï¼Œåœ¨åˆå­¸å°±æ²’é¤Šæˆå¥½ç¿’æ…£èˆ‡æ…£ç”¨èªžæ³•æœ‰é»žå¯æƒœã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Codecademy Python Track &lt;a href="http://www.codecademy.com/en/tracks/python"&gt;http://www.codecademy.com/en/tracks/python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Coursera: An Introduction to Interactive Programming in Python &lt;a href="https://www.coursera.org/course/interactivepython"&gt;https://www.coursera.org/course/interactivepython&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="_3"&gt;å­¸ç¿’ç›®æ¨™&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ‰“é–‹è‡ªå·± Linux è£¡çš„ Python3ï¼Œè·Ÿè‘—å­¸ç¿’ç”¨çš„åƒè€ƒè³‡æ–™å‹•æ‰‹æ“ä½œã€‚ç”¨ REPL ä»¥åŠé‹è¡Œè…³æœ¬å…©ç¨®æ–¹æ³•ä¾†åŸ·è¡Œ Python ç¨‹å¼ã€‚&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­¸ç¿’ä½¿ç”¨ pip å’Œ venv (virtualenv) ä¾†ç®¡ç† Python å¥—ä»¶èˆ‡ç’°å¢ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: Python å®˜ç¶²æ˜¯ä½ çš„å¥½å¤¥ä¼´ã€‚ä½ å¯ä»¥åœ¨&lt;a href="https://docs.python.org/3/installing/"&gt;é€™è£¡ (pip)&lt;/a&gt; å’Œ&lt;a href="https://docs.python.org/3/library/venv.html?highlight=venv"&gt;é€™è£¡ (venv)&lt;/a&gt; æ‰¾åˆ°å…©è€…çš„æ•™å­¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://rg3.github.io/youtube-dl/"&gt;youtube-dl&lt;/a&gt; æ˜¯ä¸€å€‹ç”¨ä¾†ä¸‹è¼‰ Youtubeã€Crunchyroll ç­‰å„å¤§å½±éŸ³ä¸²æµç¶²ç«™å½±ç‰‡çš„å·¥å…·ã€‚é™¤äº†ç”¨ Linux çš„å¥—ä»¶ç®¡ç†å·¥å…·å®‰è£å®ƒï¼Œå®ƒå…¶å¯¦æ˜¯å€‹ç”¨ Python å¯«æˆçš„å¥—ä»¶ã€‚ç‚ºäº†é¿å…è·Ÿ Linux ç³»çµ±ç’°å¢ƒç›¸è¡ï¼Œè«‹é–‹ä¸€å€‹ Python è™›æ“¬ç’°å¢ƒï¼Œä¸¦åœ¨è£¡é¢ç”¨ pip å®‰è£å®ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Note: youtube-dl é™¤äº†å–®ç´”åšä¸‹è¼‰ä¸²æµæª”ä¹‹å¤–ï¼Œé‚„æ”¯æ´è½‰æª”ã€å°è£ã€å¾Œè£½ç­‰å½±åƒè™•ç†ï¼Œé€™éœ€è¦ libav æˆ– ffmpeg ä»»ä¸€å½±åƒè™•ç†å¥—ä»¶ã€‚åœ¨ Debian ç³»åˆ—çš„ Linux ä¸Š libav æœƒå¥½è£ä¸€é»žã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨ Python è§£æ±ºä¸€äº›å¯¦é©—å®¤æœƒç¢°åˆ°çš„ Bioinfo å•é¡Œã€‚æœ‰å€‹ç¶²ç«™ Rosalind å‡ºäº†ä¸€ç³»åˆ—çš„é¡Œç›®ï¼Œæˆ‘é¸äº†ä¸€äº›è®“å„ä½ç·´ç¿’ï¼Œè«‹åƒè€ƒ&lt;a href="#file-a1_python_bioinfo-md"&gt;é™„éŒ„ 1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;EDIT 2016-05-22: æŠŠ &lt;a href="https://www.ptt.cc/bbs/Python/M.1463750830.A.DA8.html"&gt;ptt ç™¼æ–‡&lt;/a&gt; çš„å…§å®¹æ›´æ–°ä¸Šä¾†ï¼Œå¢žåŠ ä¸€äº›æ–°æ›¸å’Œä¸­æ–‡ç¿»è­¯ï¼›èª¿æ•´æŽ¨è–¦çš„é †åºã€‚&lt;br&gt;
EDIT 2017-06-20: æ›´æ–°æ›¸ç±è³‡è¨Šèˆ‡ 2/3 æ¯”è¼ƒã€‚&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="labcoding"></category><category term="python"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—ï¼ç‰ˆæœ¬æŽ§åˆ¶</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/" rel="alternate"></link><published>2016-01-21T22:40:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-version-control/</id><summary type="html">&lt;p&gt;æ‰€è¬‚çš„ç‰ˆæœ¬æŽ§åˆ¶å°±è·ŸçŽ©éŠæˆ²ä¸€æ¨£å¯ä»¥å­˜å–ã€Œé€²åº¦é»žã€ï¼Œç ´é—œå‰éƒ½æœƒä¿å­˜é€²åº¦ï¼Œé€™æ¨£ç ´é—œå¤±æ•—çš„æ™‚å€™å¯ä»¥é‚„æˆåˆ°ä¿å­˜é€²åº¦çš„ç‹€æ…‹ï¼Œå†é‡æ–°æ‰“æ€ªã€‚ç‰ˆæœ¬æŽ§åˆ¶ç”¨åœ¨ç®¡ç†ç¨‹å¼ç¢¼æ™‚ï¼Œå°±æ–¹ä¾¿è®“è‡ªå·±åœ¨æŠŠ code æžç‚¸æŽ‰çš„æ™‚å€™ï¼Œé‚„èƒ½å›žåˆ°å…ˆå‰æœ‰ä¿å­˜çš„ç‹€æ…‹ã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jan, 2016 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;æ‰€è¬‚çš„ç‰ˆæœ¬æŽ§åˆ¶å°±è·ŸçŽ©éŠæˆ²ä¸€æ¨£å¯ä»¥å­˜å–ã€Œé€²åº¦é»žã€ï¼Œç ´é—œå‰éƒ½æœƒä¿å­˜é€²åº¦ï¼Œé€™æ¨£ç ´é—œå¤±æ•—çš„æ™‚å€™å¯ä»¥é‚„æˆåˆ°ä¿å­˜é€²åº¦çš„ç‹€æ…‹ï¼Œå†é‡æ–°æ‰“æ€ªã€‚ç‰ˆæœ¬æŽ§åˆ¶ç”¨åœ¨ç®¡ç†ç¨‹å¼ç¢¼æ™‚ï¼Œå°±æ–¹ä¾¿è®“è‡ªå·±åœ¨æŠŠ code æžç‚¸æŽ‰çš„æ™‚å€™ï¼Œé‚„èƒ½å›žåˆ°å…ˆå‰æœ‰ä¿å­˜çš„ç‹€æ…‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;h3 id="_1"&gt;ç‚ºä»€éº¼ä½¿ç”¨ç‰ˆæœ¬æŽ§åˆ¶ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨è»Ÿé«”é–‹ç™¼çš„éŽç¨‹ä¸­ï¼Œç¨‹å¼ç¢¼æ¯å¤©ä¸æ–·åœ°ç”¢å‡ºï¼ŒéŽç¨‹ä¸­æœƒç™¼ç”Ÿä»¥ä¸‹æƒ…æ³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æª”æ¡ˆè¢«åˆ¥äººæˆ–è‡ªå·±è¦†è“‹ï¼Œç”šè‡³éºå¤±&lt;/li&gt;
&lt;li&gt;æƒ³å¾©åŽŸå‰å¹¾å¤©å¯«çš„ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;æƒ³çŸ¥é“è·Ÿæ˜¨å¤©å¯«çš„å·®åœ¨å“ªè£¡ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ˜¯èª°æ”¹äº†é€™æ®µç¨‹å¼ç¢¼ï¼Œç‚ºä»€éº¼ ï¼Ÿ&lt;/li&gt;
&lt;li&gt;è»Ÿé«”ç™¼è¡Œï¼Œéœ€è¦åˆ†æˆç¶­è­·ç‰ˆè·Ÿé–‹ç™¼ç‰ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œæˆ‘å€‘å¸Œæœ›æœ‰ä¸€ç¨®æ©Ÿåˆ¶ï¼Œèƒ½å¤ å¹«åŠ©æˆ‘å€‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥éš¨æ™‚å¾©åŽŸä¿®æ”¹ï¼Œå›žåˆ°ä¹‹å‰çš„ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;å¤šäººå”ä½œæ™‚ï¼Œä¸æœƒæŠŠåˆ¥äººçš„æ±è¥¿è“‹æŽ‰&lt;/li&gt;
&lt;li&gt;ä¿ç•™ä¿®æ”¹æ­·å²è¨˜éŒ„ï¼Œä»¥ä¾›æŸ¥è©¢&lt;/li&gt;
&lt;li&gt;è»Ÿé«”ç™¼è¡Œæ™‚ï¼Œå¯ä»¥æ–¹ä¾¿ç®¡ç†ä¸åŒç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(From: &lt;a href="http://dylandy.github.io/Easy-Git-Tutorial/"&gt;Git æ•™å­¸ç ”ç©¶ç«™&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;èƒ½åšåˆ°ç‰ˆæœ¬æŽ§åˆ¶çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œä½†ç›®å‰ä¸»æµå°±æ˜¯ Gitã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç‚ºä»€éº¼ä½¿ç”¨ç‰ˆæœ¬æŽ§åˆ¶ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git-version-control"&gt;Git (Version Control)&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_2"&gt;æ“ä½œå»ºè­°&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#commit-style"&gt;Commit Style&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;å¸¸è¦‹å•é¡Œ&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#conflict"&gt;Conflict&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#push-fail"&gt;Push fail&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;ç›¸é—œè³‡æº&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#code-school-try-git"&gt;Code School - Try Git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git"&gt;Git æ•™å­¸ç ”ç©¶ç«™&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#code-school-git-real"&gt;Code School - Git Real&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#learn-git-branching"&gt;Learn Git Branching&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git-tutorial-by-atlassian"&gt;Git Tutorial by Atlassian&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_5"&gt;å­¸ç¿’ç›®æ¨™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="git-version-control"&gt;Git (Version Control)&lt;/h1&gt;
&lt;p&gt;Git æ˜¯ä¸€å€‹ç‰ˆæœ¬æŽ§åˆ¶çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;Git æœƒåœ¨ä½ çš„å°ˆæ¡ˆï¼ˆrepoï¼‰ç›®éŒ„&lt;sup id="fnref:è¨»1"&gt;&lt;a class="footnote-ref" href="#fn:è¨»1"&gt;1&lt;/a&gt;&lt;/sup&gt;åº•ä¸‹å»ºä¸€å€‹ &lt;code&gt;.git&lt;/code&gt; çš„è³‡æ–™å¤¾ä¾†ç®¡ç†é€™äº›ã€Œé€²åº¦é»žã€ï¼Œè€Œä¸æœƒåŽ»å‹•å°ˆæ¡ˆå…¶ä»–è·¯å¾‘è£¡çš„æ±è¥¿ã€‚&lt;/p&gt;
&lt;p&gt;é€™äº›é€²åº¦é»žå¯ä»¥å‚³åˆ° server ä¸Šï¼Œåˆ¥äººä¸‹è¼‰ä¸‹ä¾†çš„æ™‚å€™å°±å¯ä»¥é™¤äº†å¾—åˆ°ç¾åœ¨çš„ code ä»¥å¤–ï¼Œé‚„èƒ½çœ‹åˆ°éŽåŽ»é–‹ç™¼çš„è¨˜éŒ„ï¼›è€Œåˆ¥äººä¸Šå‚³äº†ä»–çš„æ›´æ–°é€²åº¦é»žä¹‹å¾Œï¼Œä½ æŠ“ä¸‹ä¾†å°±å¯ä»¥å¾—åˆ°ä»–æ›´æ”¹çš„é€²åº¦ã€‚é€™å€‹å°±æ˜¯ã€ŒåŒæ­¥ã€çš„æ¦‚å¿µï¼Œå¤šäººä¹‹é–“èƒ½å½¼æ­¤å…±äº«ã€æ›´æ–°å½¼æ­¤é–‹ç™¼çš„æˆæžœã€‚&lt;/p&gt;
&lt;p&gt;èƒ½å¤ è™•ç† Git åŒæ­¥æ“ä½œçš„ä¼ºæœå™¨å°±å«åš git serverã€‚&lt;a href="https://github.com/"&gt;Github&lt;/a&gt; å°±æ˜¯ä¸€é–“å…¬å¸æä¾›å…è²»çš„ git server è®“å¤§å®¶åŒæ­¥å…¬é–‹çš„ Git å°ˆæ¡ˆã€‚å¾ˆå¤š Linux çš„å·¥å…·éƒ½ä½¿ç”¨ git ä¾†è®“å¤§å®¶åˆä½œé–‹ç™¼ï¼Œä¹Ÿæœ‰ä¸å°‘å·¥å…·å·²ç¶“æŠŠ git server è½‰åˆ°äº† Github ä¸Šé¢ã€‚æ‰€ä»¥éžå¸¸å¤šäººåœ¨ç”¨ï¼Œå› æ­¤å»ºè­°å¤§å®¶ä¸å¦¨ç”³è«‹ä¸€å€‹ GitHub å¸³è™Ÿã€‚&lt;/p&gt;
&lt;p&gt;Git é›–ç„¶æœ€å¸¸ç”¨ä¾†ç®¡ç†ç¨‹å¼ç¢¼ï¼Œä½†å®ƒå…¶å¯¦å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ä»»ä½•ç´”æ–‡å­—çš„æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥æŠŠ binary  æª”æ¡ˆåŠ åˆ° repo ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆå¯èƒ½éœ€è¦æœ‰ä¸€äº› git æ“ä½œç¶“é©—æ‰èƒ½äº†è§£ä»¥ä¸‹çš„è¡“èªžï¼‰&lt;/p&gt;
&lt;h2 id="_2"&gt;æ“ä½œå»ºè­°&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;å»ºç«‹å¤šè€Œå°çš„é€²åº¦é»ž&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯å®Œæˆä¸€ç³»åˆ—çš„æ›´å‹•ï¼Œå°±è¶•å¿« add å’Œ commitã€‚ä¸€é–‹å§‹æœƒç…©ï¼Œä½†é€™æ˜¯å¥½ç¿’æ…£ã€‚&lt;/p&gt;
&lt;p&gt;æ—¥å¾Œæ›´äº†è§£ git æ“ä½œçš„æ™‚å€™ï¼Œæœƒå­¸åˆ°ä¸€äº›é€²éšŽçš„æŒ‡ä»¤ï¼ˆå¦‚ &lt;code&gt;git rebase -i&lt;/code&gt;ï¼‰å°±èƒ½æŠŠå¤šå€‹ commit åˆæˆç‚ºä¸€å€‹ã€‚ä½†è¦æ‹†é–‹ä¸€å€‹å¤§çš„ commit æœƒæ¯”è¼ƒè¤‡é›œã€‚&lt;/p&gt;
&lt;h3 id="commit-style"&gt;Commit Style&lt;/h3&gt;
&lt;p&gt;å¸¸è¦‹çš„ commit message å¤§æ¦‚æœƒæ˜¯ä¸€è¡Œæ–‡ã€‚å¦‚æžœé€™å€‹æ›´å‹•éœ€è¦èªªæ˜Žï¼Œé‚£å°±å»ºè­°æŒ‰ç…§ä¸‹é¢çš„æ ¼å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€è¡Œå°‘æ–¼ 50 å€‹å­—å…ƒ&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒè¡Œç•™ç©º&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰è¡Œä»¥å¾Œæ ¼å¼éš¨æ„ï¼Œä½†å–®è¡Œä¸è¶…éŽ 75 å€‹å­—å…ƒ&lt;/li&gt;
&lt;li&gt;å–„ç”¨æ¢åˆ—å¼èªªæ˜Ž&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ç¯„ä¾‹ï¼ˆFrom &lt;a href="http://git-scm.com/book/ch5-2.html"&gt;Git Book&lt;/a&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Short (50 chars or less) summary of changes

More detailed explanatory text, if necessary.  Wrap it to
about 72 characters or so.  In some contexts, the first
line is treated as the subject of an email and the rest of
the text as the body.  The blank line separating the
summary from the body is critical (unless you omit the body
entirely); tools like rebase can get confused if you run
the two together.

Further paragraphs come after blank lines.

  - Bullet points are okay, too

  - Typically a hyphen or asterisk is used for the bullet,
    preceded by a single space, with blank lines in
    between, but conventions vary here
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ps ä½ å¯ä»¥æ‰¾åˆ°å¾ˆå¤šæœ‰è¶£çš„ commit messageã€‚ä¾‹å¦‚ï¼š&lt;a href="http://www.commitlogsfromlastnight.com/"&gt;æŠ±æ€¨&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="_3"&gt;å¸¸è¦‹å•é¡Œ&lt;/h2&gt;
&lt;h4 id="conflict"&gt;Conflict&lt;/h4&gt;
&lt;p&gt;ç•¶å–®æ©Ÿåªæœ‰åœ¨ä¸€å€‹ branch ä¸Šé–‹ç™¼çš„æ™‚å€™ï¼Œå¾ˆé›£æœ‰ conflict çš„å•é¡Œã€‚ä½†ç¢°åˆ°å¤šäººå…±åŒé–‹ç™¼ï¼Œæˆ–æŠŠå¤šæ¢ branch merge åœ¨ä¸€èµ·æ™‚å°±æœƒæœ‰ conflictã€‚&lt;/p&gt;
&lt;p&gt;Conflict çš„ç™¼ç”Ÿï¼Œæœ€å¸¸è¦‹çš„å°±æ˜¯å…©å€‹äººå„è‡ªä¿®æ”¹äº†åŒä¸€å€‹æª”æ¡ˆç›¸è¿‘ä½ç½®çš„å…§å®¹ã€‚é€™ä½¿å¾— git åœ¨æŠŠå…©å€‹äººçš„æ›´å‹•èžåˆåœ¨ä¸€èµ·çš„æ™‚å€™ï¼Œæœƒä¸çŸ¥é“åˆ°åº•è¦ç”¨èª°çš„æ›´å‹•ï¼Œé€™æ™‚å€™å°±ç„¡æ³•è‡ªå‹•è™•ç†äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥æœå°‹ã€Œresolve git conflictã€æ‰¾åˆ°ç›¸é—œçš„è§£æ±ºè¾¦æ³•ã€‚&lt;/p&gt;
&lt;h4 id="push-fail"&gt;Push fail&lt;/h4&gt;
&lt;p&gt;é€™é€šå¸¸ç™¼åœ¨ server ä¸Šçš„é€²åº¦é»žæ¯”è‡ªå·±æœ¬æ©Ÿçš„é‚„è¦æ–°ï¼Œæ‰€ä»¥å¿…é ˆå…ˆæŠŠ server ä¸Šçš„æ›´æ–°åŒæ­¥ä¸‹ä¾†ã€‚å¦‚æžœéƒ½æ˜¯åŒä¸€å€‹ branch çš„è©±ï¼Œä½ å¯ä»¥è©¦è‘—ç”¨ &lt;code&gt;git pull --rebase&lt;/code&gt; åŽ»é¿å…é¡å¤–çš„ mergeã€‚&lt;/p&gt;
&lt;h2 id="_4"&gt;ç›¸é—œè³‡æº&lt;/h2&gt;
&lt;h3 id="code-school-try-git"&gt;Code School - Try Git&lt;/h3&gt;
&lt;p&gt;äº’å‹•å¼ç·´ç¿’ï¼Œèƒ½æ‡‚æœ€åŸºæœ¬çš„ Git æŒ‡ä»¤æ“ä½œï¼Œæ—¥å¸¸æ“ä½œä¹Ÿä¸»è¦æ˜¯é€™äº›æŒ‡ä»¤ã€‚ä¸¦ä¸”æœƒå¸¶ä½ å»ºç«‹ä¸€å€‹ GitHub å¸³è™Ÿã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://try.github.io"&gt;https://try.github.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="git"&gt;Git æ•™å­¸ç ”ç©¶ç«™&lt;/h3&gt;
&lt;p&gt;ä¸­æ–‡çš„ä»‹ç´¹ï¼Œä»–çš„äº’å‹•å¼ç·´ç¿’å°±æ˜¯ä¸Šé¢ Try Git çš„ä¸­æ–‡åŒ–ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://dylandy.github.io/Easy-Git-Tutorial/index.html"&gt;http://dylandy.github.io/Easy-Git-Tutorial/index.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="code-school-git-real"&gt;Code School - Git Real&lt;/h3&gt;
&lt;p&gt;æ›´å®Œæ•´çš„äº’å‹•å¼ç·´ç¿’ï¼Œå¦‚æžœå…¨éƒ¨çš„é—œå¡éƒ½åšå®Œçš„è©±ï¼Œå¤§éƒ¨ä»½éœ€è¦ç”¨ git çš„ç‹€æ³éƒ½ç·´ç¿’éŽäº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://gitreal.codeschool.com"&gt;http://gitreal.codeschool.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="learn-git-branching"&gt;Learn Git Branching&lt;/h3&gt;
&lt;p&gt;é¡§åæ€ç¾©ï¼Œæ˜¯å€‹ç·´ç¿’æ“ä½œ git branch çš„ç·šä¸Šå­¸ç¿’ç¶²ç«™ã€‚ä¸éŽå‰å¹¾å€‹é—œå¡åœ¨ä»‹ç´¹ commit ç›¸é—œçš„æ“ä½œï¼Œå¯ä»¥è©¦ä¸€è©¦ã€‚çœŸè¦ç·´ç¿’å¯ä»¥å…ˆå®Œæˆ Main ä»¥ä¸‹ levelsï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Introduction Sequence&lt;/li&gt;
&lt;li&gt;Ramping Up&lt;/li&gt;
&lt;li&gt;Moving Work Around&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–ç¨é›£ä¸€é»žï¼Œè¦–æƒ…æ³è·³éŽã€‚ä½†å¦‚æžœæƒ³å­¸ git æ¯”è¼ƒè¤‡é›œçš„æŒ‡ä»¤å¯ä»¥å›žä¾†çœ‹å®ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://pcottle.github.io/learnGitBranching/"&gt;http://pcottle.github.io/learnGitBranching/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="git-tutorial-by-atlassian"&gt;Git Tutorial by Atlassian&lt;/h3&gt;
&lt;p&gt;è »å®Œæ•´çš„æ•™å­¸ï¼Œä½†å¯èƒ½ç¨é›£ä¸€é»žã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.atlassian.com/git/tutorials"&gt;https://www.atlassian.com/git/tutorials&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="_5"&gt;å­¸ç¿’ç›®æ¨™&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç”¨ Git ç®¡ç†é€™äº›ç·´ç¿’çš„ç­†è¨˜ï¼ˆå‘ˆæŽ¥åœ¨ Text Editors çš„ç·´ç¿’ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥è©¦è‘—å°å®ƒåšä¸€äº› git æŒ‡ä»¤æ“ä½œï¼š&lt;ul&gt;
&lt;li&gt;&lt;code&gt;git status&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git log --oneline --graph&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹ dotfiles å’Œ dotvim ä¾†ç®¡ç†ä½ çš„ç’°å¢ƒè¨­å®šæª”ã€‚&lt;br&gt;
   dotfiles å°±æ˜¯ç”¨ä¾†å„²å­˜ &lt;code&gt;.xxx&lt;/code&gt; çš„æª”æ¡ˆå€‘ï¼Œåƒæ˜¯ &lt;code&gt;.bashrc&lt;/code&gt; ã€ &lt;code&gt;.screenrc&lt;/code&gt; ã€ &lt;code&gt;.tmux.conf&lt;/code&gt; ã€ &lt;code&gt;.gitconfig&lt;/code&gt; ç­‰ç­‰ï¼Œä¸€èˆ¬å¯èƒ½å­˜æ”¾åœ¨ &lt;code&gt;~/.xxx&lt;/code&gt; æˆ– &lt;code&gt;~/.config/xxx&lt;/code&gt; ä¹‹é¡žã€‚ç”¨ç‰ˆæœ¬æŽ§åˆ¶çš„å¥½è™•æ˜¯ï¼Œé€™æ¨£åœ¨ä¸åŒçš„ server ä¹‹é–“è¨­å®šå¯ä»¥åŒæ­¥ã€‚&lt;br&gt;
   dotvim æ˜¯å­˜æ”¾ &lt;code&gt;~/.vim&lt;/code&gt; çš„ Vim è¨­å®šæª”ã€‚é€™äº›è¨­å®šæª”å¯ä»¥é€éŽ soft link é€£çµå›žä»–å€‘åŽŸæœ¬æ‡‰è©²åœ¨çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼æ°¸é ä¸è¦æŠŠ private key æ”¾å…¥ç‰ˆæœ¬æŽ§åˆ¶ä¸­ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: æœå°‹ dotfiles å°±æœƒæœ‰å¾ˆå¤šç¯„ä¾‹ï¼ˆEx &lt;a href="https://github.com/ccwang002/dotfiles"&gt;æˆ‘çš„&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹è‡ªå·±çš„ Github å¸³è™Ÿï¼Œä¸¦æŠŠ dotfiles / dotvim repo åŒæ­¥ï¼ˆ&lt;strong&gt;push&lt;/strong&gt;ï¼‰åˆ°Githubã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: å»ºç«‹è¨­ç«‹å¥½ ssh key pair ä½¿ç”¨ ssh ä¸Šå‚³ã€‚Github æœ‰&lt;a href="https://help.github.com/articles/generating-ssh-keys/"&gt;å®Œæ•´çš„æ•™å­¸&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:è¨»1"&gt;
&lt;p&gt;æ‰€è¬‚çš„å°ˆæ¡ˆç›®éŒ„å°±æ˜¯ä¸‹ &lt;code&gt;git init&lt;/code&gt; æŒ‡ä»¤çš„ç›®éŒ„ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="labcoding"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—ï¼æ–‡å­—ç·¨è¼¯</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/" rel="alternate"></link><published>2016-01-21T22:30:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-text-editing/</id><summary type="html">&lt;p&gt;é€™å€‹ç« ç¯€æœƒå¸¶å¤§å®¶èªè­˜ä¸€å€‹å¾ˆç°¡å–®çš„ç´”æ–‡å­—æ ¼å¼ Markdownï¼Œæ–¹ä¾¿å¤§å®¶æ•´ç†ç­†è¨˜ã€‚åŒæ™‚å¸Œæœ›å¤§å®¶å­¸æœƒä¸€å€‹ terminal based çš„æ–‡å­—ç·¨è¼¯å™¨ï¼Œæ–¹ä¾¿å¾€å¾Œåœ¨ server ç’°å¢ƒåº•ä¸‹çš„æ“ä½œã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jan, 2016 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;é€™å€‹ç« ç¯€æœƒå¸¶å¤§å®¶èªè­˜ä¸€å€‹å¾ˆç°¡å–®çš„ç´”æ–‡å­—æ ¼å¼ Markdownï¼Œæ–¹ä¾¿å¤§å®¶æ•´ç†ç­†è¨˜ã€‚åŒæ™‚å¸Œæœ›å¤§å®¶å­¸æœƒä¸€å€‹ terminal based çš„æ–‡å­—ç·¨è¼¯å™¨ï¼Œæ–¹ä¾¿å¾€å¾Œåœ¨ server ç’°å¢ƒåº•ä¸‹çš„æ“ä½œã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#markdown"&gt;Markdown&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç›¸é—œè³‡æº&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#markdown_1"&gt;Markdown èªžæ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;å­¸ç¿’ç›®æ¨™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#text-editor"&gt;Text Editor&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#nano"&gt;Nano&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#emacs"&gt;Emacs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#vim"&gt;Vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#vim_1"&gt;Vim ç›¸é—œè³‡æº&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#open-vim"&gt;Open Vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#vim-ptt"&gt;å­¸ç¿’ Vim çš„å¿ƒæ³•èˆ‡æ”»ç•¥ (ptt)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#vim-adventure"&gt;Vim adventure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#vim_2"&gt;Vim æœ¬èº«çš„ä½¿ç”¨æ‰‹å†Š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;å­¸ç¿’ç›®æ¨™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#regex"&gt;æ­£è¦è¡¨ç¤ºå¼ Regex&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#regex_1"&gt;Regex èªžæ³•æ´¾åˆ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;ç›¸é—œè³‡æº&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#regex-one"&gt;Regex One&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#regex-101"&gt;Regex 101&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="markdown"&gt;Markdown&lt;/h1&gt;
&lt;p&gt;é€™æ˜¯ä¸€å€‹ç°¡ä¾¿çš„èªžæ³•ï¼Œå®ƒçš„æ¦‚å¿µæ˜¯åœ¨ç´”æ–‡å­—çš„æª”æ¡ˆä¸­ç”¨ä¸€äº›ç°¡å–®çš„æ¨™è¨˜ï¼Œå°±èƒ½åšå‡ºå¤§å°æ¨™é¡Œã€ç²—æ–œé«”ã€è¶…é€£çµã€è¡¨æ ¼ã€ç¨‹å¼ç¢¼ä¸Šè‰²ç­‰èªžæ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœå¤§å®¶äº†è§£ç¶²é çš„æ ¼å¼ &lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTML"&gt;HTML&lt;/a&gt; çš„è©±ï¼Œé‚£ markdown çš„èªžæ³•èƒ½ç›´æŽ¥å°æ‡‰åˆ° HTML çš„èªžæ³•ï¼Œæ‰€ä»¥é€™å€‹æ ¼å¼åœ¨ç¶²è·¯çš„ä¸–ç•Œååˆ†æµè¡Œã€‚å®ƒçš„å‰¯æª”åç‚º &lt;code&gt;.md&lt;/code&gt;ï¼Œè¿‘ä»£ç¨‹å¼çš„ REAME è¨±å¤šéƒ½ç”¨ markdown å¯«æˆï¼ˆä¾‹ï¼š&lt;code&gt;README.md&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;h2 id="_1"&gt;ç›¸é—œè³‡æº&lt;/h2&gt;
&lt;h3 id="markdown_1"&gt;Markdown èªžæ³•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://markdown.tw/"&gt;http://markdown.tw/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="_2"&gt;å­¸ç¿’ç›®æ¨™&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;é€™ä¸€ç³»åˆ—çš„ç­†è¨˜å°±æ˜¯ç”¨ markdown å¯«æˆï¼Œä½ å¯ä»¥åœ¨&lt;a href="https://github.com/ccwang002/ccwang002.github.io/tree/src/content/blogs/2016-01"&gt;é€™è£¡&lt;/a&gt;æ‰¾åˆ°å®ƒçš„åŽŸå§‹æª”ã€‚&lt;/li&gt;
&lt;li&gt;è©¦è‘—æŠŠ Linux å­¸ç¿’éŽçš„æŒ‡ä»¤ï¼Œæˆ–è€…è‡ªå·±å¸¸ç”¨çš„çµ„åˆæŒ‡ä»¤ç”¨ markdown è¨˜éŒ„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id="text-editor"&gt;Text Editor&lt;/h1&gt;
&lt;p&gt;åœ¨ Linux çš„ä¸–ç•Œå¾ˆå¤šéƒ½æ˜¯ç´”æ–‡å­—æª”æ¡ˆï¼Œå†åŠ ä¸Šä¸€äº›è¦å®šçš„èªžæ³•æˆç‚ºæ–°çš„æ ¼å¼ã€‚å‰é¢çš„ markdown å°±æ˜¯å€‹ä¾‹å­ã€‚ç”šè‡³è¨±å¤šå¯ä»¥åŸ·è¡Œçš„ç¨‹å¼éƒ½åªæ˜¯å€‹è…³æœ¬æª”ï¼Œèƒ½ç”¨ä¸€èˆ¬çš„ç·¨è¼¯å™¨ï¼ˆeditorï¼‰æ‰“é–‹å°±èƒ½è®€æ‡‚ã€‚ä½ å¯ä»¥è©¦è©¦&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# cd is a shell script&lt;/span&gt;
nano &lt;span class="sb"&gt;`&lt;/span&gt;which &lt;span class="nb"&gt;cd&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;       &lt;span class="c1"&gt;# thanks TP&amp;#39;s idea&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¸¸è¦‹çš„ editor æœ‰ï¼šnanoã€viã€vimã€emacsã€‚åˆ°åº•ä»€éº¼æ˜¯æœ€å¥½ç”¨çš„æ–‡å­—ç·¨è¼¯å™¨ï¼Œé€™æ˜¯ä¸€å ´æ°¸ç„¡æ­¢ç›¡çš„æˆ°çˆ­ï¼Œè¿‘å¹´ä¾†åˆæœ‰ Notepad++(GUI)ã€Sublime Text (GUI)ã€Neovim çš„åŠ å…¥ï¼Œé€™è©±é¡Œå°‡ä¸æœƒæœ‰çµè«–ã€‚å°åˆå­¸è€…è€Œè¨€ï¼Œè‡³å°‘å­¸æœƒä¸€å€‹ editor æ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é›–ç„¶ä¸€é–‹å§‹éƒ½èªªæ˜¯ä»‹ç´¹æ–‡å­—ç·¨è¼¯å™¨ï¼Œä½†å¾Œä¾†æœƒé–‹å§‹å­¸ç¨‹å¼è¨­è¨ˆï¼Œæ‰€ä»¥æœ€å¾Œå¤§å®¶åœ¨è¨Žè«–çš„éƒ½æ˜¯ã€Œç¨‹å¼ç¢¼çš„ç·¨è¼¯å™¨ã€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç•¶åœ¨ç·¨è¼¯ä¸€äº›è¨­å®šæª”ã€ç¨‹å¼ç¢¼æ™‚ï¼Œç‚ºäº†é¿å…æ‰“éŒ¯é—œéµå­—ä½†é›£ä»¥æŸ¥è¦ºï¼Œå¤šæ•¸äººæœƒæŠŠç¨‹å¼ç¢¼çš„é—œéµå­—ä¸Šè‰²ã€‚æŒ‰ç…§ç¨‹å¼ç¢¼ä¸åŒçš„å±¬æ€§ã€åŠŸèƒ½ä¸Šè‰²ä¹‹å¾Œï¼Œå¤šæ•¸äººç™¼ç¾èƒ½æ›´å¥½çš„ç†è§£ç¨‹å¼çš„çµæ§‹ï¼Œå› æ­¤ editor å¤§å¤šå¸¶æœ‰èªžæ³•ä¸Šè‰²ï¼ˆsyntax highlightingï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†èªžæ³•ä¸Šè‰²ï¼Œé€™äº› editor éƒ½æœ‰è‡ªå·±çš„è¨­å®šæª”è¦ç¯„ï¼Œå¯ä»¥è®“ä½¿ç”¨è€…è‡ªè¡Œä¿®æ”¹ editor çš„è¡Œç‚ºã€‚æŠŠè‡ªå·±å¸¸è¦‹çš„ç·¨è¼¯å™¨æ”¹å¾—åˆä¹Žè‡ªå·±ç¿’æ…£ï¼Œæ˜¯é•·æœŸç”Ÿæ´»åœ¨ terminal ä¸–ç•Œçš„ç¬¬ä¸€æ­¥ï¼Œå¤§å®¶å¯ä»¥åƒè€ƒï¼ˆæŠ„ï¼‰åˆ¥äººçš„ç¯„æœ¬é–‹å§‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è®“è‡ªå·±çš„ç·¨è¼¯å™¨æœ‰å®¶çš„æ„Ÿè¦ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é™¤äº†è¨­å®šæª”ä¹‹å¤–ï¼ŒåŠŸèƒ½å¤šçš„ç·¨è¼¯å™¨é‚„æœƒæœ‰ã€Œå¤–æŽ›ã€çš„åŠŸèƒ½ï¼Œå¯ä»¥è®“ä½¿ç”¨è€…å¢žåŠ è‡ªå·±çš„å¥—ä»¶ã€‚é€™ä¹Ÿç­‰å¤§å®¶ç†Ÿæ‚‰ç’°å¢ƒä¹‹å¾Œå†è‡ªè¡ŒçŽ©çŽ©å§ã€‚&lt;/p&gt;
&lt;h2 id="nano"&gt;Nano&lt;/h2&gt;
&lt;p&gt;é€™æ˜¯ä¸€å€‹æ“ä½œç°¡å–®å¥½æ‡‚çš„ç·¨è¼¯å™¨ï¼Œ&lt;del&gt;æ²’æœ‰èªžæ³•ä¸Šè‰²&lt;/del&gt;&lt;sup id="fnref:è¨»1"&gt;&lt;a class="footnote-ref" href="#fn:è¨»1"&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚å¤šæ•¸çš„ç³»çµ±éƒ½æœ‰å…§å»ºï¼Œæ‰€ä»¥åˆ°ä¸€å€‹æ–°çš„ç’°å¢ƒæ™‚å¹¾ä¹Žéƒ½èƒ½ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;é³¥å“¥æœ‰æ•™ã€‚å…¶å¯¦ç›´æŽ¥åŸ·è¡Œå®ƒ &lt;code&gt;nano&lt;/code&gt; å®ƒçš„æŒ‡ä»¤éƒ½æœƒé¡¯ç¤ºåœ¨ç·¨è¼¯ç•«é¢ä¸­ã€‚&lt;/p&gt;
&lt;h2 id="emacs"&gt;Emacs&lt;/h2&gt;
&lt;p&gt;æŠ±æ­‰ï¼Œæˆ‘ä¸æœƒã€‚ä½†å®ƒæ˜¯ä¸€å€‹å¾ˆå¥½çš„ç·¨è¼¯å™¨ã€‚ï¼ˆèª å¾µå¤§å¤§è£œå…¨ï¼‰&lt;/p&gt;
&lt;h2 id="vim"&gt;Vim&lt;/h2&gt;
&lt;p&gt;ä¸€å€‹è€å­—è™Ÿä½†ç¶­æŒç©©å®šé–‹ç™¼çš„ç·¨è¼¯å™¨ã€‚ä»–æœ‰å€‹ç‰¹è‰²æ˜¯ç·¨è¼¯å™¨çš„æ¨¡å¼ï¼Œæœ‰äº›æ¨¡å¼èƒ½ç·¨è¼¯æ–‡å­—ï¼Œæœ‰äº›ä¸è¡Œï¼Œä½†èƒ½åšé¸å–ã€æœå°‹ç­‰å‹•ä½œã€‚é‚„æœ‰ç‰¹æœ‰çš„æŒ‡ä»¤åˆæˆæ–¹å¼ï¼ˆåƒé€£çºŒæŠ€ã€buff é€™æ¨£ï¼‰&lt;/p&gt;
&lt;p&gt;åˆå­¸è€…é€šå¸¸æœƒé›£ä»¥ç¿’æ…£ï¼ŒåˆæœŸä¸ç†Ÿæ¨¡å¼ã€æŒ‡ä»¤è¨˜ä¸ä½çš„è©±æœƒå¾ˆé›£æ“ä½œã€‚æ‰€ä»¥å»ºè­°ä¸€é–‹å§‹å…ˆè¨˜ä½æœ€åŸºæœ¬çš„æŒ‡ä»¤ï¼Œéš¨æ™‚æŽŒæ¡è‡ªå·±åœ¨çš„æ¨¡å¼ï¼Œæ—¥å¾Œå†æ…¢æ…¢åŠ æ·±å° vim çš„äº†è§£ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœçœŸçš„å¾ˆæ²’æ¦‚å¿µï¼Œé³¥å“¥ä¹Ÿæœ‰å¯«ä»‹ç´¹ã€‚&lt;/p&gt;
&lt;h2 id="vim_1"&gt;Vim ç›¸é—œè³‡æº&lt;/h2&gt;
&lt;h3 id="open-vim"&gt;Open Vim&lt;/h3&gt;
&lt;p&gt;äº’å‹•å¼çš„ç·šä¸Šå­¸ç¿’ç¶²ç«™ï¼Œå¾ˆçŸ­ï¼Œè·Ÿè‘—æ“ä½œå®Œèƒ½æœƒ Vim åŸºæœ¬å‹•ä½œã€å­˜æª”ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.openvim.com/"&gt;http://www.openvim.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="vim-ptt"&gt;å­¸ç¿’ Vim çš„å¿ƒæ³•èˆ‡æ”»ç•¥ (ptt)&lt;/h3&gt;
&lt;p&gt;äº†è§£æœ€å¸¸ç”¨çš„ normal èˆ‡ insert æ¨¡å¼åŠæœ€åŸºæœ¬çš„æŒ‡ä»¤ã€‚é€™ç¯‡çš„å…§å®¹ç†è§£ä¹‹å¾Œï¼Œå°±èƒ½ç”¨ vim è™•ç†æ–‡å­—ç·¨è¼¯äº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.ptt.cc/bbs/Editor/M.1264056747.A.885.html"&gt;https://www.ptt.cc/bbs/Editor/M.1264056747.A.885.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="vim-adventure"&gt;Vim adventure&lt;/h3&gt;
&lt;p&gt;å¦‚æžœå¾ˆé›£å­¸ç¿’ &lt;code&gt;hjkl&lt;/code&gt;ã€&lt;code&gt;wb&lt;/code&gt; ç§»å‹•çš„è©±ï¼Œé€™æ˜¯å€‹è¦ç”¨ vim æŒ‡ä»¤æŽ§åˆ¶çš„å°éŠæˆ²ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://vim-adventures.com/"&gt;http://vim-adventures.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="vim_2"&gt;Vim æœ¬èº«çš„ä½¿ç”¨æ‰‹å†Š&lt;/h3&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ &lt;code&gt;vimtutor&lt;/code&gt; æŒ‡ä»¤ï¼Œæˆ–è€…åœ¨ vim normal æ¨¡å¼æ™‚éµå…¥ &lt;code&gt;:help&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="_3"&gt;å­¸ç¿’ç›®æ¨™&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;èƒ½åœ¨ terminal ä¸­ç·¨ä¿®ä¸€å€‹æ–‡å­—æª”åç‚º &lt;code&gt;foo.txt&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: try nano&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nano foo.txt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ­é… root æ¬Šé™ä¿®æ”¹ç³»çµ±çš„è¨­å®šæª”ï¼ˆä½ åœ¨é³¥å“¥å¯èƒ½æœ‰ç¶“é©—äº†ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: try sudo&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èƒ½åœ¨ console ä¸­ç·¨å¯«ç¨‹å¼ç¢¼ã€‚ç”¨ 1. çš„æ–¹æ¡ˆä¹Ÿå¯ï¼Œä½†å»ºè­°å†è©¦è©¦çœ‹å¦å¤–ä¸€å€‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: try vi, vim or emacs&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿®æ”¹ editor è¨­å®šè®“å®ƒæ›´ç¬¦åˆè‡ªå·±çš„ç¿’æ…£ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: for vim, try editing &lt;code&gt;~/.vimrc&lt;/code&gt;; for emacs, try editing &lt;code&gt;~/.emacs&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨ terminal editor ä½¿ç”¨ markdown æ ¼å¼è¨˜éŒ„é€™äº›ç·´ç¿’çš„ç­†è¨˜èˆ‡ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id="regex"&gt;æ­£è¦è¡¨ç¤ºå¼ Regex&lt;/h1&gt;
&lt;p&gt;Vim åœ¨ normal æ¨¡å¼ä¸‹èƒ½ç”¨ &lt;code&gt;/{pattern}&lt;/code&gt; æœå°‹æ–‡ä¸­çš„å­—ä¸²ã€‚é™¤äº†ç›´æŽ¥æŠŠæƒ³è¦æŸ¥çš„å­—ä¸²å¯«åœ¨ pattern è£¡ä»¥å¤–ï¼Œé‚„å¯ä»¥è¨­è¨ˆè¦å‰‡æ‰¾å‡ºç¬¦åˆ pattern ä½†ä¸ä¸€æ¨£çš„çµæžœã€‚é€™æ¨£çš„è¦å‰‡ç¨±ä¹‹ç‚ºæ­£è¦è¡¨ç¤ºå¼ï¼ˆRegular Expression, or regexï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æƒ³åšå¾ˆè¤‡é›œçš„å­—ä¸²æ¯”å°æ™‚ï¼Œéƒ½æ‡‰è©²è€ƒæ…®æ˜¯å¦èƒ½ä½¿ç”¨ regex&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¦åšå­—ä¸²æ¯”å°çš„åœ°æ–¹ï¼Œå·¥å…·é€šå¸¸éƒ½æœƒæä¾›ä½¿ç”¨ regexï¼Œä¾‹å¦‚ &lt;code&gt;grep&lt;/code&gt;ã€&lt;code&gt;sed&lt;/code&gt;ã€‚Vim èˆ‡ Python ä¹Ÿéƒ½æœ‰æä¾› regex çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id="regex_1"&gt;Regex èªžæ³•æ´¾åˆ¥&lt;/h3&gt;
&lt;p&gt;æ—¢ç„¶ regex æ˜¯ä¸€å¥—å­—ä¸²æ¯”å°çš„è¦å‰‡ï¼Œå°±æœ‰è¦ç¯„å®ƒçš„èªžæ³•ã€‚ä¸»è¦çš„ regex èªžæ³•æœ‰å…©å¤§é¡žï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BRE (basic regex)&lt;ul&gt;
&lt;li&gt;Ex. &lt;code&gt;[:alnum:]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ERE (extended regex)&lt;ul&gt;
&lt;li&gt;Ex. &lt;code&gt;\w&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Linux æŒ‡ä»¤ç•¶ä¸­é€šå¸¸æœƒå› ç‚ºä½¿ç”¨ regex èªžæ³•çš„ä¸åŒåˆ†æˆå¤šå€‹æŒ‡ä»¤&lt;sup id="fnref:è¨»2"&gt;&lt;a class="footnote-ref" href="#fn:è¨»2"&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚ä¾‹å¦‚ grep ä½¿ç”¨ BREï¼›egrep ä½¿ç”¨ EREã€‚&lt;/p&gt;
&lt;p&gt;èˆ‡æ–‡å­—ç·¨è¼¯ç›¸é—œçš„å·¥å…·ï¼Œåƒ Vimã€Pythonã€Perl&lt;sup id="fnref:è¨»3"&gt;&lt;a class="footnote-ref" href="#fn:è¨»3"&gt;3&lt;/a&gt;&lt;/sup&gt; ä¹Ÿæœ‰ä»–å€‘å„è‡ªå¯« regex çš„æ–¹å¼ï¼Œä½†å¤šå°‘éƒ½èˆ‡å‰å…©å¤§é¡žç›¸ä¼¼ï¼Œä½¿ç”¨æ™‚éƒ½æ‡‰è©²å…ˆæŸ¥ä¸€ä¸‹ä»–å€‘çš„èªžæ³•ã€‚Vim å¯ä»¥ç”¨ &lt;code&gt;:help regex&lt;/code&gt; æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;h2 id="_4"&gt;ç›¸é—œè³‡æº&lt;/h2&gt;
&lt;h3 id="regex-one"&gt;Regex One&lt;/h3&gt;
&lt;p&gt;ä¸»è¦æ˜¯ä»‹ç´¹ pcre çš„èªžæ³•ï¼Œæ¯ä¸€å€‹ example å¤šä»‹ç´¹ä¸€å€‹æ–°çš„èªžæ³•ã€‚æŽ¥è‘—é‚„æœ‰å€‹ practical examples ç·´ç¿’æ•´ç†ä¸åŒçš„èªžæ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://regexone.com/"&gt;http://regexone.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="regex-101"&gt;Regex 101&lt;/h3&gt;
&lt;p&gt;regex å¾ˆå®¹æ˜“å¯«åˆ°è‡ªå·±éƒ½çœ‹ä¸æ‡‚ï¼Œé€™æ˜¯ä¸€å€‹å¹«åŠ©äº†è§£è‡ªå·±æˆ–åˆ¥äººå¯«å¥½çš„ regex pattern çš„ç¶²ç«™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://regex101.com/"&gt;https://regex101.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:è¨»1"&gt;
&lt;p&gt;nano å…¶å¯¦æœ‰è¾¦æ³•åšèªžæ³•ä¸Šè‰²å–”ï¼Œè©³è¦‹ &lt;a href="https://wiki.archlinux.org/index.php/Nano"&gt;Arch wiki&lt;/a&gt; åŠ &lt;a href="https://github.com/scopatz/nanorc"&gt;nanorc&lt;/a&gt;ã€‚Thanks @concise&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:è¨»2"&gt;
&lt;p&gt;å“ªäº›æŒ‡ä»¤æœ‰ç„¡æ”¯æ´ regex ä»¥åŠæ”¯æ´çš„èªžæ³•å¯ä»¥åƒè€ƒ &lt;a href="https://www.debian.org/doc/manuals/debian-reference/ch01.en.html#_unix_text_tools"&gt;Debian Reference&lt;/a&gt;&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»2" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:è¨»3"&gt;
&lt;p&gt;Perl çš„ regex èªžæ³•åˆç¨±ç‚º &lt;strong&gt;pcre&lt;/strong&gt; styleï¼Œå¸¸è¢«å…¶ä»–å·¥å…·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šphp&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»3" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="labcoding"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—ï¼Linux</title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/" rel="alternate"></link><published>2016-01-21T21:30:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-linux/</id><summary type="html">&lt;p&gt;Last Edited: Jan, 2016 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;å­¸ç¿’ä½¿ç”¨ Linux æ˜¯ç¬¬ä¸€å€‹æ¯”è¼ƒå¤§çš„éšœç¤™ï¼Œå› ç‚ºæœƒåœ¨çŸ­æ™‚é–“æŽ¥è§¸åˆ°éž â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jan, 2016 ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;å­¸ç¿’ä½¿ç”¨ Linux æ˜¯ç¬¬ä¸€å€‹æ¯”è¼ƒå¤§çš„éšœç¤™ï¼Œå› ç‚ºæœƒåœ¨çŸ­æ™‚é–“æŽ¥è§¸åˆ°éžå¸¸å¤šæ–°çš„æ±è¥¿ã€‚å¾Œé¢çš„æ±è¥¿å¤šå°‘éƒ½èˆ‡ Linux ç›¸é—œï¼Œè€Œ Linux é›£çš„éƒ¨ä»½åœ¨é–‹å§‹ä½¿ç”¨ terminal ä¾†æ“ä½œã€Œæ•´å°é›»è…¦ã€ï¼Œå°å¾ˆç¿’æ…£ä½¿ç”¨è¦–çª—ä»‹é¢çš„äººæœƒè¦ºå¾—å¾ˆä¸ç›´è¦ºã€‚å¥½åœ¨è¿‘å¹´å¹¾å€‹ä¸»æµçš„ Linux Distribution éƒ½æœ‰å¾ˆå¥½çš„åœ–å½¢ä»‹é¢ï¼ˆæ­£ç¢ºç¨± Desktop Environmentï¼‰ï¼Œæ‰€ä»¥ä¸€é–‹å§‹èƒ½æ¼¸è¿‘åœ°é©æ‡‰ terminal æ“ä½œã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨å¯¦é©—å®¤ server ä¸Šé–‹ç™¼ï¼Œã€Œèƒ½åœ¨ terminal è£¡åšäº‹æƒ…ã€æ˜¯å¿…é ˆçš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#linuxunixbsdnix"&gt;Linuxã€Unixã€BSDã€*nix&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#distro"&gt;Distro ç°¡ä»‹&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#redhat-centos-fedora"&gt;Redhat / CentOS / Fedora&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#debian-ubuntu"&gt;Debian / Ubuntu&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#archlinux"&gt;ArchLinux&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#gnomekdexfcelxde"&gt;æ¡Œé¢ç’°å¢ƒ GNOMEã€KDEã€XFCEã€LXDE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç›¸é—œè³‡æº&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_2"&gt;é³¥å“¥çš„ç§æˆ¿èœ&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_3"&gt;å„ç« ç¯€é‡é»žæ•´ç†&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#introduction-to-linux-on-edx-course"&gt;Introduction to Linux on edX course&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#debian-user-manual"&gt;Debian User Manual&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#chapter-highlights"&gt;Chapter Highlights&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;å­¸ç¿’ç›®æ¨™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å…¶ä»– Coding åˆå­¸æŒ‡å—ç³»åˆ—æ–‡ç« ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="linuxunixbsdnix"&gt;Linuxã€Unixã€BSDã€*nix&lt;/h2&gt;
&lt;p&gt;Linux å’Œ Unix æ˜¯ä¸åŒçš„ï¼Œä½†å°åˆå­¸è€…ä¾†èªªä»–å€‘çš„åˆ†åˆ¥ä¸å®¹æ˜“æŸ¥è¦ºï¼Œå…©è€…çš„çµ‚ç«¯æŒ‡ä»¤å¾ˆç›¸ä¼¼ï¼Œä¹Ÿå› æ­¤æœ‰äº† *nix çš„é€šç¨±ã€‚Linux ä»‹ç´¹æ›¸å¤šåŠæœƒæŠŠä»–å€‘çš„æ­·å²å¥½å¥½çš„èªªä¸€é&lt;sup id="fnref:è¨»2"&gt;&lt;a class="footnote-ref" href="#fn:è¨»2"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œæœ‰èˆˆè¶£è½è»Ÿé«”ç™¼å±•æ•…äº‹çš„å°±å¤šç•™æ„é€™éƒ¨ä»½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å®Œæ•´åœ°ä¸»è¦åˆ†æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redhat, CentOS, Fedora&lt;/li&gt;
&lt;li&gt;Debian, Ubuntu, Linux Mint&lt;/li&gt;
&lt;li&gt;ArchLinux&lt;/li&gt;
&lt;li&gt;openSUSE&lt;/li&gt;
&lt;li&gt;FreeBSD, OpenBSD&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº› distributions (distros)ã€‚å…¶å¯¦ Linuxã€BSD (or Unix) çš„ç³»çµ±éžå¸¸å¤š&lt;sup id="fnref:è¨»3"&gt;&lt;a class="footnote-ref" href="#fn:è¨»3"&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œä½†å°åˆå…¥ Linux çš„ä½¿ç”¨è€…ï¼Œæ‡‰è©²è¦æ‰¾æ¯”è¼ƒç†±é–€çš„ distro ä½¿ç”¨ï¼Œæ‰å¥½æ‰¾è³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢æ¢åˆ—çš„æ–¹å¼æ˜¯æœ‰æ„ç¾©çš„ï¼Œæˆ‘æŠŠé¡žä¼¼çš„ distro æ”¾åœ¨åŒä¸€æŽ’ï¼Œåªè¦å­¸äº†å…¶ä¸­ä¸€å€‹ï¼ŒåŒæŽ’çš„å…¶ä»–éƒ½å¾ˆå¥½ä¸Šæ‰‹ã€‚å…¶ä¸­å‰å…©æŽ’æ˜¯å…©å¤§å®¶æ—åæ˜ å…©ç¨®ç”Ÿæ…‹ã€‚æˆ‘å€‘å¯¦é©—å®¤çš„å¤§ server ç”¨çš„æ˜¯ CentOSï¼›ä½†è¿‘å¹´ä¾†æˆ‘è‡ªå·±çš„é›»è…¦å·²ç¶“æ¼¸æ¼¸æ›åˆ° Debian ä¸Šã€‚&lt;/p&gt;
&lt;h2 id="distro"&gt;Distro ç°¡ä»‹&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘ä¸è² è²¬ä»»çš„ä¸»è§€ä»‹ç´¹ã€‚å¾žä»‹ç´¹ç¯‡å¹…å°±çŸ¥é“æˆ‘æ˜¯å€‹å‚¾å‘ Debian çš„äººã€‚&lt;/p&gt;
&lt;h4 id="redhat-centos-fedora"&gt;Redhat / CentOS / Fedora&lt;/h4&gt;
&lt;p&gt;Redhat æ˜¯å•†ç”¨çš„ç‰ˆæœ¬ï¼Œé–‹æºç¤¾ç¾¤ç¶­è­·çš„å°æ‡‰ç‰ˆæœ¬æ˜¯ CentOSã€‚å®ƒä»¥ä¿å®ˆç©©å®šè‘—åï¼Œä½†ç›¸å°ä¾†èªªæ–°çš„æ±è¥¿åœ¨ä¸Šé¢å°±è¦è‡ªå·±å®‰è£ï¼Œé€™å°å¯¦é©—å®¤éƒ½ç”¨è¼ƒæ–°çš„å·¥å…·ä¾†èªªæ˜¯å€‹æ¸›åˆ†çš„åœ°æ–¹ã€‚ä»–å¥—ä»¶ç”¨ &lt;code&gt;yum xxx&lt;/code&gt; ä¾†æ“ä½œã€‚Fedora ä¸Šçš„æ±è¥¿æœƒæ–°ä¸€é»žä½†æˆ‘å€‘å¯¦é©—å®¤æ²’äººç”¨ï¼Œæ‰€ä»¥ä¸å»ºè­°ã€‚&lt;/p&gt;
&lt;h4 id="debian-ubuntu"&gt;Debian / Ubuntu&lt;/h4&gt;
&lt;p&gt;Debian æ˜¯å¦ä¸€å€‹å¤§å®¶æ—çš„é ­ï¼Œé›–ç„¶æ˜¯é ­ä½†ä¸€ç›´ä¿æŒç©©å®šé–‹ç™¼ï¼Œåœ¨èªªæ˜Žæ–‡ä»¶ã€&lt;a href="https://wiki.debian.org/"&gt;wiki&lt;/a&gt; ä¸Šéƒ½æœ‰ä¸éŒ¯çš„å“è³ªã€‚æœ¬èº«æœ‰æ‰€è¬‚çš„ stableã€testingã€unstable ä¸¦åˆ†åˆ¥å°æ‡‰ä¸‰å€‹ç‰ˆæœ¬è™Ÿç¢¼èˆ‡åç¨±ã€‚ä»¥ 2016.01 ç‚ºä¾‹ï¼Œstable æ˜¯ jessie(8)ã€testing æ˜¯ stretch(9)ã€‚unstable æ°¸é å°æ‡‰åˆ° sidã€‚å¦‚å­—é¢ä¸Šçš„æ„æ€ä»£è¡¨ç•¶ä¸­å¥—ä»¶ï¼ˆè»Ÿé«”ï¼‰çš„æ–°èˆŠç¨‹åº¦ã€‚stable ä¸Šçš„å·¥å…·ä¹Ÿå› æ­¤æœƒæ¯”è¼ƒèˆŠä¸é©åˆå¯¦é©—å®¤ä½¿ç”¨ï¼Œä½† testing é‚„è »é©åˆçš„ï¼Œæˆ‘å€‹äººå¾ˆæŽ¨ã€‚å¥—ä»¶ç”¨ &lt;code&gt;apt-get xxx&lt;/code&gt; ä¾†æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;Debian å®¶æ—ä¸­çš„ Ubuntu éžå¸¸ç«ç´…ï¼Œç¶²è·¯ä¸Šæ•™å­¸éžå¸¸å¤šï¼ŒèƒŒå¾Œä¹Ÿæœ‰å…¬å¸åŠ æŒã€‚åŸºæœ¬ä¸Š Debian çš„å„ªé»žéƒ½æœƒå‚³åˆ° Ubuntu ä¸Šã€‚Ubuntu é›–ç„¶å¥—ä»¶åŒ…ç­‰ç­‰éƒ½å¾ž Debian ç§»æ¤ï¼Œä½†ä»–æœ‰è‡ªå·±çš„ç‰ˆæœ¬è™Ÿç¢¼ï¼Œæ¯åŠå¹´ç™¼ä½ˆä¸€å€‹ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h4 id="archlinux"&gt;ArchLinux&lt;/h4&gt;
&lt;p&gt;å†ä¾†çš„æœ‰èˆˆè¶£è‡ªå·±çœ‹ï¼Œä½†æˆ‘è¦é¡å¤–ä»‹ç´¹ä¸€å€‹ ArchLinuxã€‚é€™æ˜¯ä¸€å€‹å¾ˆè‡ªå¹¹çš„ç³»çµ±ï¼Œä¸€é»žéƒ½ä¸é©åˆæ–°æ‰‹èˆ‡æ‡¶äººã€‚ä½†ä»–æœ‰ä¸€å€‹å¯«å¾—å¾ˆä»”ç´°å®Œæ•´çš„ &lt;a href="https://wiki.archlinux.org/"&gt;wiki ç«™&lt;/a&gt;ã€‚æƒ³è¦å­¸æ–°çš„å¥—ä»¶ã€ä¸æœƒè¨­å®šçš„è©±ï¼ŒåŽ»å• google çš„æ™‚å€™è«‹å„ªå…ˆçœ‹ä»–å€‘çš„ wikiã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æŸ¥è³‡æ–™çš„æ™‚å€™ï¼Œé™¤äº† StackOverflow ã€Ubuntu è«–å£‡ä¹‹å¤–ï¼Œè«‹å¤šçœ‹å“è³ªå„ªè‰¯çš„ &lt;a href="https://wiki.archlinux.org/"&gt;Arch Linux&lt;/a&gt; å’Œ &lt;a href="https://wiki.debian.org/"&gt;Debian&lt;/a&gt; çš„ wikiã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯«äº†é€™éº¼å¤šï¼Œæ²’æœ‰çµ¦ä¸€å€‹æ˜Žç¢ºçš„é¸æ“‡ï¼Œå¤šæ•¸äººé‚„æ˜¯å¾ˆé›£æ±ºå®šã€‚æ‰€ä»¥å¦‚æžœä½ æ˜¯åˆå­¸è€…ï¼Œæˆ‘æœƒå»ºè­°å®‰è£ Ubuntuï¼Œåœ¨æ­¤æ™‚è«‹é¸æ“‡ &lt;a href="http://releases.ubuntu.com/15.10/"&gt;15.10&lt;/a&gt; or &lt;a href="http://releases.ubuntu.com/14.04/"&gt;14.04 LTS&lt;/a&gt; Desktop ç‰ˆæœ¬ï¼Œå› ç‚ºä»–ç¶²è·¯ä¸Šçš„è³‡æºæœ€è±å¯Œã€‚&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä¸æ˜¯å¾ˆå–œæ­¡ Ubuntuï¼Œæ‰€ä»¥ç­‰ä½ æœ‰èƒ½åŠ›è‡ªå·±æŸ¥è©¢ Linux ç›¸é—œæ“ä½œæ™‚ï¼Œå»ºè­°å†çœ‹çœ‹åˆ¥çš„ distro ï¼ˆä¾‹å¦‚æˆ‘æŽ¨è–¦çš„ &lt;a href="https://www.debian.org/releases/testing/"&gt;Debian testing channel&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;h2 id="gnomekdexfcelxde"&gt;æ¡Œé¢ç’°å¢ƒ GNOMEã€KDEã€XFCEã€LXDE&lt;/h2&gt;
&lt;p&gt;åœ–å½¢åŒ–ä»‹é¢ï¼ˆGUIï¼‰ï¼Œé™¤äº†ä½¿ç”¨è€…çš„æ‡‰ç”¨ç¨‹å¼å¤–ï¼Œé‚„éœ€è¦ç³»çµ±è¼”åŠ©ã€ç®¡ç†ç­‰æ ¸å¿ƒå¥—ä»¶ã€‚ä¸€ç³»åˆ—çš„ GUI å¥—ä»¶å°±ç¨±ä¹‹ç‚ºæ¡Œé¢ç’°å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;Windowsã€OSX åœ¨å®‰è£ç³»çµ±æ™‚éƒ½æœƒè‡ªå‹•å®‰è£ï¼Œ å³æ¡Œé¢ç’°å¢ƒåªæœ‰ä¸€ç¨®é¸æ“‡ã€‚ä½†åœ¨ Linux ä¸Šï¼ŒGUI çš„å®‰è£æ˜¯é¸æ“‡æ€§çš„ï¼Œç³»çµ±èƒ½åœ¨åªæœ‰å–®ç´”çš„ terminal ä»‹é¢ä¾¿èƒ½å®Œæ•´ä½¿ç”¨ï¼ˆä¾‹å¦‚é¸æ“‡å®‰è£ Ubuntu Server æ™‚ï¼‰ï¼Œä¸å°‘ server ç‚ºäº†æ•ˆèƒ½ã€å®‰å…¨æ€§çš„è€ƒé‡éƒ½ä¸æœƒè£æ¡Œé¢ç’°å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;å° Linux ä¾†èªªæ¡Œé¢ç’°å¢ƒæ˜¯èƒ½ä¹‹å¾Œå†é¸æ“‡å®‰è£ä¸ŠåŽ»çš„ï¼Œè€Œä¸”é‚„æœ‰ã€Œä¸åŒå£å‘³ã€å¯ä»¥é¸æ“‡ï¼Œä½¿ç”¨è€…ä¹Ÿå¯ä»¥è‡ªç”±çš„ç§»é™¤å®ƒå€‘ï¼ˆä½†å¾ˆæœ‰å¯èƒ½æœƒç‚¸æŽ‰ï¼‰ï¼Œå¸¸è¦‹å°±æœ‰ GNOMEã€KDEã€XFCEã€LXDE&lt;sup id="fnref:è¨»4"&gt;&lt;a class="footnote-ref" href="#fn:è¨»4"&gt;3&lt;/a&gt;&lt;/sup&gt; å¹¾ç¨®ç³»çµ±èƒ½ä½¿ç”¨ã€‚ä¾‹å¦‚é¸æ“‡å®‰è£ Ubuntu Server å¾Œï¼Œæƒ³è¦å†åŠ ä¸Š GNOME åˆ—åœ–å½¢åŒ–ä»‹é¢æ™‚ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt-get install ubuntu-gnome-desktop
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™é‚Šä¸æœƒåŽ»ç´°è¬›é€™äº›å¯¦ä½œæ–¹å¼çš„ä¸åŒã€‚ç°¡å–®è€Œè¨€ï¼ŒGNOME æœ€æµè¡Œã€‚XFCE ä½¿ç”¨çš„ç³»çµ±è³‡æºè¼ƒå°‘ï¼Œåœ¨å¯¦é©—å®¤ä¸Šçš„ server å¸¸æœƒè£é€™å€‹ã€‚åœ¨ Ubuntu ä¸Šï¼Œé è¨­æ˜¯ç”¨ Unityï¼Œå®ƒæ˜¯å¾ž GNOME æ²¿ä¼¸å‡ºä¾†çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡å®‰è£æ™‚ï¼Œå°±ä½¿ç”¨é è¨­çš„æ¨¡å¼å§ã€‚è£å¥½ä¹‹å¾Œè¦æ›åˆ°ä¸åŒçš„æ¡Œé¢ç’°å¢ƒæ™‚ï¼Œéœ€è¦å°å¥—ä»¶ç®¡ç†ç³»çµ±ï¼ˆä¾‹ aptã€yumï¼‰ã€èª¿æ•´ç³»çµ±è¨­å®šæœ‰è¶³å¤ äº†è§£ã€‚&lt;/p&gt;
&lt;h2 id="_1"&gt;ç›¸é—œè³‡æº&lt;/h2&gt;
&lt;p&gt;èªçœŸåœ°èªªï¼Œæˆ‘æœ‰é»žä¸çŸ¥é“ Linux å¾žå¾ˆåˆå­¸åˆ°å®Œæ•´å­¸ç¿’çš„è³‡æºåœ¨å“ªè£¡ã€‚å¦‚æžœä½ å€‘åœ¨å­¸çš„éŽç¨‹ä¸­ï¼Œæœ‰ç¢°åˆ°æ›´é©åˆçš„è«‹å†å‘Šè¨´æˆ‘ï¼ˆä¾‹å¦‚ï¼šç•™è¨€ï¼‰&lt;/p&gt;
&lt;h3 id="_2"&gt;é³¥å“¥çš„ç§æˆ¿èœ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://linux.vbird.org/linux_basic/"&gt;é³¥å“¥å®˜ç¶²ï¼ˆåŸºç¤Žå­¸ç¿’ç¯‡ï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tenlong.com.tw/items/9861818510?item_id=53725"&gt;å¯¦é«”æ›¸é€£çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å°ç£å­¸ Linux å¤§æ¦‚éƒ½æœƒå…ˆæŽ¨è–¦é³¥å“¥ï¼Œé€™æ‡‰è©²æ˜¯æœ€å¤šäººç”¨çš„å®Œæ•´ä¸­æ–‡è³‡æºäº†ã€‚å¦‚æžœé¡˜æ„å•ƒå®Œä»–ï¼Œå° Linux çµ•å°æœƒæœ‰è¶³å¤ çš„èªè­˜ã€‚æˆ‘å¤§å­¸çš„æ™‚å€™ä¹Ÿæ˜¯çœ‹é€™æœ¬å…¥é–€çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸é©åˆçš„åœ°æ–¹æ˜¯é³¥å“¥ä»‹ç´¹ Redhat ç³»çš„æ“ä½œï¼Œå¾ˆå¤šè¨­å®šåœ¨ Ubuntu ä¸Šä¸éœ€è¦æˆ–è€…æ˜¯ç”¨åˆ¥çš„æ–¹å¼åŽ»ç®¡ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨ CentOS ä¸Šå¯èƒ½éƒ½ç”¨æ–‡å­—æª”ä¾†ä¿®æ”¹è¨­å®šï¼Œä½†åœ¨ Ubuntu ä¸Šå¯ä»¥ç”¨ &lt;code&gt;dpkg-reconfigure&lt;/code&gt; æŒ‡ä»¤ä¾†æ›´å‹•ã€‚ä»–ç¤ºç¯„çš„ OS ç‚º CentOS 5.xï¼Œç¾åœ¨ CentOS å·²ç¶“ 7.x ç‰ˆäº†ï¼Œè¨±å¤šè¨­å®šä¹ŸéŽæ™‚äº†ï¼Œæ–°çš„å·¥å…·ä¸æœƒä»‹ç´¹åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ç¾åœ¨å®‰è£ Linux æ™‚ï¼Œåœ¨ç£å€åˆ†å‰²ä¸Šéƒ½æœ‰å¾ˆå¥½çš„é è¨­å€¼ï¼Œåˆå­¸è€…å¯ä»¥ä¸ç”¨å†å­¸èª¿æ•´ swap ç­‰è¨­å®šã€‚åŒæ™‚ç³»çµ±ä¹Ÿéƒ½æä¾›ä½¿ç”¨ LVM (Logical Volume Manager) &lt;sup id="fnref:è¨»5"&gt;&lt;a class="footnote-ref" href="#fn:è¨»5"&gt;4&lt;/a&gt;&lt;/sup&gt; ç®¡ç†ç£å€ï¼Œé€™äº›ç£å€ (LV) æ—¥å¾Œèƒ½å‹•æ…‹èª¿æ•´ã€‚æ›å¥è©±èªªï¼Œç¬¬äº”ç« ï¼ˆå«ï¼‰çš„å…§å®¹éƒ½èˆ‡ç¾åœ¨ä½¿ç”¨ Linux çš„æ–¹å¼ä¸åŒï¼Œå¦‚æžœåªæ˜¯é †è‘—é³¥å“¥æ›¸çš„é †åºä¸€ç« ä¸€ç« çœ‹ä¸‹ä¾†ï¼Œæœƒæ²’è¾¦æ³•å°ç…§è‡ªå·±ç³»çµ±æ“ä½œï¼Œå› ç‚ºè¿‘æœŸçš„ Linux å®‰è£åªè¦å¾ˆé †çš„ä¸‹ä¸€æ­¥å°±èƒ½å®Œæˆäº†ã€‚&lt;/p&gt;
&lt;h4 id="_3"&gt;å„ç« ç¯€é‡é»žæ•´ç†&lt;/h4&gt;
&lt;p&gt;é³¥å“¥çš„å…§å®¹é€€ä¸€åƒæ­¥ä¾†èªªéƒ½å°åˆå­¸è€…å¾ˆæœ‰å¹«åŠ©ï¼Œä½†ç‚ºäº†é¿å…å„ä½èŠ±è²»ç„¡è¬‚çš„æ™‚é–“åœ¨ã€Œå°ç…§å¤æ—©èˆ‡ç¾ä»£æ“ä½œ (google åˆ°çš„è³‡æ–™)ä¸Šã€ï¼Œæ•´ç†å€‹è¡¨æ ¼è®“å¤§å®¶çŸ¥é“æ¯å€‹ç« ç¯€ä»€éº¼åœ°æ–¹éœ€è¦çœ‹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center;"&gt;ç« ç¯€&lt;/th&gt;
&lt;th style="text-align: left;"&gt;ç« ç¯€å&lt;/th&gt;
&lt;th&gt;é‡è¦çš„å…§å®¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;0&lt;/td&gt;
&lt;td style="text-align: left;"&gt;è¨ˆç®—æ©Ÿæ¦‚è«–&lt;/td&gt;
&lt;td&gt;æ²’è½éŽ CPUã€RAMã€MB GB å–®ä½å°±å¾žé ­çœ‹ï¼› ä¸ç„¶å°±è®€è³‡æ–™è¡¨ç¤ºæ–¹å¼(3)ã€è»Ÿé«”ç¨‹å¼é‹ä½œ(4)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;5&lt;/td&gt;
&lt;td style="text-align: left;"&gt;é¦–æ¬¡ç™»å…¥èˆ‡ç·šä¸Šæ±‚åŠ© man page&lt;/td&gt;
&lt;td&gt;æ–‡å­—æ¨¡å¼ä¸‹æŒ‡ä»¤çš„ä¸‹é”(2)ã€man page èˆ‡ info page(3)ã€nano(4)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;6&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Linux çš„æª”æ¡ˆæ¬Šé™èˆ‡ç›®éŒ„é…ç½®&lt;/td&gt;
&lt;td&gt;å…¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;7&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Linux æª”æ¡ˆèˆ‡ç›®éŒ„ç®¡ç†&lt;/td&gt;
&lt;td&gt;é™¤æª”æ¡ˆéš±è—èˆ‡ç‰¹æ®Šå±¬æ€§(4)å¤–éƒ½é‡è¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;8&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Linux ç£ç¢Ÿèˆ‡æª”æ¡ˆç³»çµ±ç®¡ç†&lt;/td&gt;
&lt;td&gt;æª”æ¡ˆç³»çµ±çš„ç°¡å–®æ“ä½œ(2)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;9&lt;/td&gt;
&lt;td style="text-align: left;"&gt;æª”æ¡ˆèˆ‡æª”æ¡ˆç³»çµ±çš„å£“ç¸®èˆ‡æ‰“åŒ…&lt;/td&gt;
&lt;td&gt;å£“ç¸®æª”æ¡ˆçš„ç”¨é€”èˆ‡æŠ€è¡“(1)ã€æ‰“åŒ…æŒ‡ä»¤(3)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;10&lt;sup id="fnref:*"&gt;&lt;a class="footnote-ref" href="#fn:*"&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="text-align: left;"&gt;vim ç¨‹å¼ç·¨è¼¯å™¨&lt;/td&gt;
&lt;td&gt;èªžç³»ç·¨ç¢¼è½‰æ›(4.3)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;11&lt;/td&gt;
&lt;td style="text-align: left;"&gt;èªè­˜èˆ‡å­¸ç¿’ BASH&lt;/td&gt;
&lt;td&gt;å…¨ã€‚ä½†å¯è¦–æƒ…æ³å¿½ç•¥ 2.4-2.8ã€6.4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;12&lt;sup id="fnref:â€ "&gt;&lt;a class="footnote-ref" href="#fn:â€ "&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td style="text-align: left;"&gt;æ­£è¦è¡¨ç¤ºæ³•èˆ‡æ–‡ä»¶æ ¼å¼åŒ–è™•ç†&lt;/td&gt;
&lt;td&gt;å‰è¨€(1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;13&lt;/td&gt;
&lt;td style="text-align: left;"&gt;å­¸ç¿’ Shell Scripts&lt;/td&gt;
&lt;td&gt;å…¨ï¼ˆç­‰ç”¨åˆ°å†çœ‹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;22&lt;/td&gt;
&lt;td style="text-align: left;"&gt;è»Ÿé«”å®‰è£ï¼šåŽŸå§‹ç¢¼èˆ‡ Tarball&lt;/td&gt;
&lt;td&gt;å…¨ï¼ˆäº†è§£æµç¨‹ã€æ‡‚æœ‰é€™äº›é—œéµå­—å°±å¥½ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center;"&gt;23&lt;/td&gt;
&lt;td style="text-align: left;"&gt;è»Ÿé«”å®‰è£ï¼š RPM, SRPM èˆ‡ YUM åŠŸèƒ½&lt;/td&gt;
&lt;td&gt;Ubuntu ç”¨çš„æ˜¯ APT&lt;sup id="fnref:â€¡"&gt;&lt;a class="footnote-ref" href="#fn:â€¡"&gt;7&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="introduction-to-linux-on-edx-course"&gt;Introduction to Linux on edX course&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.edx.org/course/introduction-linux-linuxfoundationx-lfs101x-2"&gt;èª²ç¨‹é€£çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Linux Foundation æ‰€é–‹è¾¦çš„ç·šä¸Šèª²ç¨‹ï¼Œæœ‰è‹±æ–‡çš„å½±ç‰‡å’Œè¬›ç¾©ã€‚é‚„è«‹åˆ°äº† Linux Kernel çš„ä½œè€… Linus Torvalds ä¾†æ‹ä»‹ç´¹ç‰‡ã€‚é€™æ˜¯çœŸçš„å¾žéžå¸¸åŸºç¤Žé–‹å§‹è¬›ï¼Œæˆ‘æœ‰ç¨å¾®çœ‹éŽï¼Œä½†æˆ‘æ€•é›£åº¦ä¸å¤ ï¼Œéœ€è¦å†æ­é…å…¶ä»–çš„è³‡æºä¾†ä½¿ç”¨ã€‚å¥½è™•æ˜¯åˆæœŸçš„å­¸ç¿’æ¯”è®€é³¥å“¥å‰å¹¾ç« ä¾†çš„å¿«éžå¸¸å¤šï¼ˆé³¥å“¥å‰å¹¾ç« ç‚ºè¨ˆç®—æ©Ÿæ¦‚è«–ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="debian-user-manual"&gt;Debian User Manual&lt;/h3&gt;
&lt;p&gt;è‹±æ–‡çš„ Debian ç³»çµ±ä½¿ç”¨è€…æ‰‹å†Šï¼Œè£¡é¢åŒ…å«äº†å¸¸è¦‹å•é¡ŒæŽ’è§£ã€å„ç¨®ç¡¬é«”ä¸Šçš„å®‰è£æŒ‡å—ã€åƒè€ƒæ‰‹å†Šã€‚æƒ³è¦å¥½å¥½å­¸ç¿’ç¾ä»£ Debian (Linux) çš„ä½¿ç”¨æ–¹å¼çš„è©±ï¼Œå¯ä»¥åƒè€ƒé€™äº›è³‡æºï¼Œå®ƒå€‘é‚„æœ‰å†ç¶­è­·ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºé»žæ˜¯é€™æ‰‹å†Šå¤ªé•·äº†ï¼Œå¦‚æžœæœ‰ç¢°åˆ°ä»€éº¼ç‰¹åˆ¥æƒ³äº†æ·±å…¥äº†è§£çš„ï¼Œå»ºè­°å¯ä»¥çœ‹é€™å€‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.debian.org/doc/user-manuals"&gt;https://www.debian.org/doc/user-manuals&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.debian.org/doc/manuals/debian-reference/index.en.html"&gt;Debain Reference&lt;/a&gt; (online HTML)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="chapter-highlights"&gt;Chapter Highlights&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Chp. No&lt;/th&gt;
&lt;th style="text-align: left;"&gt;Chp. Name&lt;/th&gt;
&lt;th style="text-align: left;"&gt;Highlights&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;GNU/Linux tutorials&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Everything except for 1.3 Midnight Commander&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Debian package management&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Read 2.2 Basic package management operations&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;10&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Data management&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Read 10.1 Sharing, copying, and archiving&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="_4"&gt;å­¸ç¿’ç›®æ¨™&lt;/h2&gt;
&lt;p&gt;å› ç‚ºé€™é‚ŠæŒ‡çš„ Linux ç®—æ˜¯ä¸€å€‹è »å»£çš„å…§å®¹ï¼Œä¸€é–‹å§‹å­¸çš„æ™‚å€™å¾ˆå®¹æ˜“è¿·å¤±æ–¹å‘ã€‚æ‰€ä»¥æˆ‘é¡å¤–åˆ—äº†å¹¾å€‹å¾ˆé‡è¦çš„è§€å¿µï¼Œä½ æ‡‰è©²èƒ½åœ¨å­¸ç¿’ Linux çš„åˆæœŸæŽ¥è§¸åˆ°ä»–å€‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£ &lt;code&gt;$PATH&lt;/code&gt; èˆ‡ç¨‹å¼åŸ·è¡Œä½ç½®çš„é—œä¿‚&lt;ul&gt;
&lt;li&gt;ç‚ºä»€éº¼æ‰“ &lt;code&gt;ls&lt;/code&gt; å¯ä»¥æ‰¾åˆ°é€™éš»åç‚º &lt;code&gt;ls&lt;/code&gt; çš„ç¨‹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;çŸ¥é“ stdinã€stdoutã€stderrï¼›pipeline çš„ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;çŸ¥é“ç’°å¢ƒè®Šæ•¸æ˜¯ä»€éº¼ï¼Œæ€Žéº¼ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;äº†è§£æª”æ¡ˆã€ç›®éŒ„ã€ç›¸å°è·¯å¾‘ï¼›æ¬Šé™è¨­å®š&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;&amp;lt;cmd&amp;gt; -h&lt;/code&gt; &lt;code&gt;&amp;lt;cmd&amp;gt; --help&lt;/code&gt; &lt;code&gt;man &amp;lt;cmd&amp;gt;&lt;/code&gt; ä¾†æŸ¥çœ‹æŒ‡ä»¤çš„åŠŸèƒ½ã€å¯ä¸‹çš„åƒæ•¸&lt;ul&gt;
&lt;li&gt;&amp;lt;cmd&amp;gt; = ä»»ä½•åœ¨ linux ä¸‹çš„æŒ‡ä»¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æžœä½ èŠ±äº†ä¸€å€‹ç¦®æ‹œçš„æ™‚é–“ï¼Œä½†ä¸Šè¿°çš„å…§å®¹é€£è½éƒ½æ²’è½éŽï¼ˆæˆ–æ²’ä»€éº¼ä½¿ç”¨åˆ°ï¼‰ï¼Œé‚£å¾ˆå¯èƒ½ä½ å­¸ç¿’ Linux çš„æ–¹å¼è·Ÿæˆ‘æƒ³å¾—å¾ˆä¸ä¸€æ¨£ï¼Œè«‹å…ˆå¯«å€‹ä¿¡å‘Šè¨´æˆ‘ã€‚ä¸Šé¢é€™äº›è§€å¿µçš„å­¸ç¿’ä¹Ÿæ˜¯æ¼¸è¿‘å¼çš„ï¼ŒéŽäº†ä¸€å€‹ç¦®æ‹œåªæœ‰è½éŽä½†ä¸æ˜¯å¾ˆäº†è§£ï¼Œé€™æ˜¯å¾ˆæ­£å¸¸çš„ç¾è±¡ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è‡ªå·±å¾žé›¶é–‹å§‹å®‰è£ä¸€æ¬¡ Linux ç³»çµ±ï¼ˆå¯ä»¥ç”¨ VMï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸä½¿ç”¨å®ƒä¸€å€‹æ˜ŸæœŸä»¥ä¸Šï¼ˆå³ç†Ÿæ‚‰ &lt;code&gt;cd&lt;/code&gt; &lt;code&gt;ls&lt;/code&gt; ç­‰åŸºç¤ŽæŒ‡ä»¤ï¼‰&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ ssh é€£ç·šåˆ°é ç«¯çš„ Linuxã€‚ï¼ˆè¦æ‰“é–‹ ssh çš„ portï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bonus: åœ¨ ssh é€£ç·šæ™‚ä¸ç”¨æ‰“å¯†ç¢¼ã€‚&lt;/li&gt;
&lt;li&gt;Bonus hint: æŸ¥ &lt;code&gt;authorized_keys&lt;/code&gt;ã€‚æœƒéœ€è¦å»ºç«‹ ssh user identity keypairï¼Œé€™æœƒåœ¨ä¸Šå‚³ GitHub æ™‚ç”¨åˆ°ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£ä¸€å€‹å« &lt;a href="http://hisham.hm/htop/"&gt;htop&lt;/a&gt; çš„ç³»çµ±ç›£æŽ§è»Ÿé«”ã€‚ä½¿ç”¨å®ƒä¾†æŸ¥çœ‹ç³»çµ±è³‡æ–™çš„ä½¿ç”¨ç‹€æ³&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bonus:&lt;ul&gt;
&lt;li&gt;èª¿æ•´æ¬„ä½çš„æŽ’ç‰ˆ&lt;/li&gt;
&lt;li&gt;é–‹å•Ÿ Tree Veiw&lt;/li&gt;
&lt;li&gt;é¸æ“‡é¡¯ç¤ºå–®ä¸€ä½¿ç”¨è€…é‹è¡Œçš„ç¨‹åºï¼ˆå¤ªèˆŠçš„ htop å¯èƒ½æ²’é€™åŠŸèƒ½ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£ä¸€å€‹å« &lt;a href="http://aria2.sourceforge.net/"&gt;aria2&lt;/a&gt; çš„çºŒå‚³è»Ÿé«”ï¼Œä»–å¯ä»¥å¤šç·šç¨‹ä¸‹è¼‰ HTTP(S)ã€FTPã€ç”šè‡³ BTã€‚ä»Šå¤©æƒ³è¦ä¸‹è¼‰ Debian Jessie netinst çš„æ˜ åƒæª”ï¼Œä½¿ç”¨ 2 å€‹ç·šç¨‹åŒæ™‚ä¸‹è¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: æŸ¥ &lt;code&gt;aria2c&lt;/code&gt; çš„ man pageã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­¸æœƒæŸ¥çœ‹ç³»çµ±ç¡¬ç¢Ÿçš„ä½¿ç”¨é‡ï¼›æŸ¥çœ‹ç•¶å‰ç›®éŒ„å…§æ‰€æœ‰æª”æ¡ˆçš„å¤§å°ï¼ˆçµ•å°ä¸æ˜¯ &lt;code&gt;ls -l&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: &lt;code&gt;df&lt;/code&gt; å’Œ &lt;code&gt;du&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;scp æ˜¯å€‹é€éŽ ssh å‚³é€ä¸€æˆ–å¤šå€‹æª”æ¡ˆçš„æŒ‡ä»¤ï¼Œè©¦è‘—ç”¨å®ƒæŠŠè‡ªå·±é›»è…¦çš„æª”æ¡ˆï¼ˆå€‘ï¼‰å‚³åˆ° server ä¸Šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bonus:&lt;ul&gt;
&lt;li&gt;åœ¨è·¯å¾‘ä¸­æ­é…ç‰¹æ®Šå­—å…ƒ &lt;code&gt;*?&lt;/code&gt; å‚³å¤šå€‹æª”æ¡ˆ&lt;/li&gt;
&lt;li&gt;æœ‰ä¸€å€‹æ›´ç²¾å¯†çš„å‚³æª”å·¥å…·å« rsyncï¼Œè©¦è‘—æ”¹ç”¨å®ƒä¾†å‚³æª”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ GUI çš„é ç«¯ä»‹é¢ã€‚é€™ç›¸é—œçš„æŠ€è¡“æœ‰å¾ˆå¤šï¼šVNCã€RDP æœ€å¸¸è¦‹ã€‚RDP åœ¨ windows é€£æŽ¥ä¸Šæ¯”è¼ƒé †æš¢ï¼›VNC åœ¨ç•«é¢å‚³è¼¸æ¯”è¼ƒæ²’æ•ˆçŽ‡ï¼Œé€™æœƒå° server é€ æˆä¸å°çš„è² æ“”ï¼Œä¹Ÿå¾ˆå®¹æ˜“ lagã€‚æœ‰ä¸€å€‹æ–°çš„é€šè¨Šå”å®šå« NXï¼Œå®ƒå°ç•«é¢å£“ç¸®ä½¿ç”¨å³ä¾¿ç¶²é€Ÿå¾ˆæ…¢ä¾ç„¶èƒ½ä½¿ç”¨åœ–å½¢ä»‹ç´¹ã€‚&lt;br&gt;
   è©¦è‘—ç”¨å¯¦ä½œ NX å”å®šçš„è»Ÿé«” X2go åšé ç«¯æ¡Œé¢é€£ç·šåˆ° serverã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hint: ä½ éœ€è¦åœ¨ server èˆ‡ client ç«¯ï¼ˆé€šå¸¸æ˜¯è‡ªå·±çš„é›»è…¦ï¼‰éƒ½è£ä¸Š X2go çš„è»Ÿé«”ï¼Œä¸¦æœƒä½¿ç”¨åˆ° SSH çš„é€£ç·šè¨­å®šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åªç”¨ Linux ç”Ÿå­˜ä¸€å€‹æ˜ŸæœŸä»¥ä¸Šï¼ˆåŒ…å«ä¸­æ–‡è¼¸å…¥ã€ä¸Šç¶²ç­‰ç­‰ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:è¨»2"&gt;
&lt;p&gt;Linux distros æºæµ &lt;a href="http://en.wikipedia.org/wiki/Linux_distribution"&gt;http://en.wikipedia.org/wiki/Linux_distribution&lt;/a&gt;&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»2" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:è¨»3"&gt;
&lt;p&gt;&lt;a href="http://distrowatch.com/"&gt;Distro Watch&lt;/a&gt; æ˜¯ä¸€å€‹ä»‹ç´¹å„ç¨® Linuxã€BSD ç³»çµ±çš„åœ°æ–¹ï¼Œå¯ä»¥ä¾†é€™é‚Šçœ‹å„å€‹ distro çš„ä»‹ç´¹ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»3" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:è¨»4"&gt;
&lt;p&gt;LXDE åŽŸä½œè€…æ˜¯ PCMan å–”ï¼Œä¹Ÿæœ‰ç›¸ç•¶å¤šçš„å°ç£äººåœ¨ç¶­è­·å®ƒã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»4" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:è¨»5"&gt;
&lt;p&gt;LVM ä¸æ‡‚æ²’é—œä¿‚ï¼Œæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒ&lt;a href="http://linux.vbird.org/linux_basic/0420quota.php#lvm"&gt;é³¥å“¥åäº”ç« &lt;/a&gt;ã€&lt;a href="https://wiki.archlinux.org/index.php/LVM"&gt;Arch Wiki&lt;/a&gt; ä»‹ç´¹&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»5" title="Jump back to footnote 4 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:*"&gt;
&lt;p&gt;å­¸ vim æœ‰åˆ¥çš„è³‡æºï¼Œè©³è¦‹ &lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;2 Text Editing&lt;/a&gt;ã€‚&lt;br&gt;&amp;#160;&lt;a class="footnote-backref" href="#fnref:*" title="Jump back to footnote 5 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:â€ "&gt;
&lt;p&gt;æ­£è¦è¡¨ç¤ºï¼ˆregexï¼‰å¾ˆé‡è¦ï¼Œä½†åˆå­¸ Linux æ™‚æœƒè¦ºå¾—å¾ˆè¤‡é›œå¯ä»¥è·³éŽã€‚ &lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;2 Text Editing&lt;/a&gt; æœƒå†æŽ¥è§¸åˆ°ä¸€æ¬¡ vim çš„ regexã€&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;4 Python&lt;/a&gt; ä¹Ÿæœƒå­¸åˆ° Python çš„ regexï¼Œå¯ä»¥ç­‰åˆ°æ™‚å€™å†å›žä¾†å­¸ &lt;code&gt;sed&lt;/code&gt;ã€&lt;code&gt;egrep&lt;/code&gt; ç­‰æŒ‡ä»¤ã€‚&lt;br&gt;&amp;#160;&lt;a class="footnote-backref" href="#fnref:â€ " title="Jump back to footnote 6 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:â€¡"&gt;
&lt;p&gt;APT çš„ä½¿ç”¨æ•™å­¸å¯ä»¥åƒè€ƒ &lt;a href="https://help.ubuntu.com/community/AptGet/Howto"&gt;Ubuntu å®˜ç¶²&lt;/a&gt;ã€&lt;a href="http://blog.longwin.com.tw/2005/05/use_apt/"&gt;ç¶²è·¯ä¸Šå¤§å¤§çš„ç­†è¨˜&lt;/a&gt;ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:â€¡" title="Jump back to footnote 7 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="labcoding"></category></entry><entry><title>Coding åˆå­¸æŒ‡å—ï¼ç¸½ç« </title><link href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/" rel="alternate"></link><published>2016-01-21T21:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-21:/posts/2016/01/lab-coding-intro/</id><summary type="html">&lt;p&gt;çµ¦å¯¦é©—å®¤æ–°ç”Ÿï¼Œäº†è§£ç•¶ä»Šè»Ÿé«”é–‹ç™¼æµç¨‹åŠåŸºæœ¬æŠ€èƒ½çš„èƒŒæ™¯çŸ¥è­˜èˆ‡åˆæ­¥æŠ€èƒ½æ¨¹ã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last Edited: Jan, 2016&lt;/p&gt;
&lt;p&gt;ï¼ˆå¦‚æžœå…§å®¹æœ‰èª¤ï¼Œä½ å¯ä»¥ç•™è¨€ï¼Œæˆ–ç”¨ä»»ä½•ç®¡é“å‘Šè¨´æˆ‘ï¼‰&lt;/p&gt;
&lt;p&gt;é›–ç„¶å¯¦é©—å®¤ä¸æ˜¯æ­£è¦å¯«ç¨‹å¼çš„åœ°æ–¹ï¼Œå¤šæ•¸çš„äººä¹Ÿæ²’æŠŠå¯«ç¨‹å¼ç•¶æˆä¸€å›žäº‹ã€‚ä¸éŽéš¨è‘—è¦åˆ†æžçš„è³‡æ–™ã€æ¨£æœ¬æ•¸è¶Šä¾†è¶Šå¤šï¼Œå¤šåˆ°è‡ªå·±é›»è…¦è·‘ä¸å‹•ï¼Œserver ä¹Ÿè¦è·‘å¾ˆä¹…çš„æ™‚å€™ï¼Œå°±æœƒé¡¯ç¤ºå‡ºç¨‹å¼çš„é‡è¦æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œç¾åœ¨çš„ç ”ç©¶è¬›æ±‚ &lt;em&gt;reproducibility&lt;/em&gt;ï¼Œå¦‚æžœè¦è®“è‡ªå·±çš„åˆ†æžåœ¨ä¸€å¹´ä¹‹å¾Œä¹Ÿèƒ½é‡ç¾ï¼Œæˆ–è€…è®“ä¸–ç•Œä¸Šå…¶ä»–çš„ç ”ç©¶è€…ä¹Ÿèƒ½é‡ç¾çš„è©±ï¼Œéœ€è¦åŸºæœ¬çš„ç¨‹å¼æŠ€å·§ã€‚&lt;/p&gt;
&lt;p&gt;é€™ä¸€ç³»åˆ—çš„æ–‡ç« ï¼Œç›®æ¨™è®“å¯¦é©—å®¤çš„æ–°ç”Ÿï¼Œä¸è«–æ˜¯ä¸æ˜¯ CS èƒŒæ™¯ï¼Œéƒ½èƒ½äº†è§£ç•¶ä»Šè»Ÿé«”é–‹ç™¼æµç¨‹åŠåŸºæœ¬æŠ€èƒ½ã€‚è»Ÿé«”é–‹ç™¼éœ€è¦ä¸€äº›èƒŒæ™¯çŸ¥è­˜ï¼Œæ‰èƒ½èˆ‡é–‹ç™¼è€…æ­£å¸¸äº¤æµã€‚é€™äº›èƒŒæ™¯çŸ¥è­˜åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç†Ÿæ‚‰åœ¨ server ä¸Šå·¥ä½œï¼ˆæˆ– Linux çš„ä½¿ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;ä¸€å€‹å¾ˆå¤šäººç”¨çš„è»Ÿé«”å·¥å…·é•·ä»€éº¼æ¨£&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æŠŠè‡ªå·±çš„ç¨‹å¼èˆ‡åˆ¥äººåˆ†äº«&lt;/li&gt;
&lt;li&gt;å¤šäººå…±åŒé–‹ç™¼&lt;/li&gt;
&lt;li&gt;å…¶ä»–äººéƒ½æ€Žéº¼æ¨£å¯«ç¨‹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›å…§å®¹åœ¨å­¸æ ¡èª²ç¨‹çš„è¨“ç·´ä¸­è¼ƒå°‘ï¼Œå°¤å…¶æ˜¯é›»æ©ŸèƒŒæ™¯çš„è©±åœ¨å¯«ç¨‹å¼åˆæ›´ç‚ºéš¨æ€§ï¼Œä½†é€™å°ä¸€å€‹é•·æœŸçš„è»Ÿé«”å°ˆæ¡ˆæ˜¯å¿…éœ€çš„ã€‚å¸Œæœ›å¤§å®¶èƒ½é¤Šæˆé€™äº›ç¿’æ…£ã€‚&lt;/p&gt;
&lt;p&gt;é€™äº›ä¸»é¡Œéœ€è¦ç†Ÿç·´åˆ°ä»€éº¼ç¨‹åº¦ï¼Œè¦‹äººè¦‹æ™ºï¼Œæ·±å…¥ä¸‹åŽ»æ¯ä¸€å€‹éƒ½å¤ èŠ±å¹¾å€‹æœˆçš„æ™‚é–“é‘½ç ”ï¼Œä½†ä»¥ä¸€å€‹å¯¦é©—å®¤å°ˆé¡Œã€æˆ–è¦å®Œæˆçš„è»Ÿé«”å°ˆæ¡ˆä¾†èªªéƒ½ä¸å¯¦éš›ï¼Œè‡³å°‘è€é—†ä¸€é»žéƒ½ä¸åœ¨æ„ã€‚æ‰€ä»¥å€‹äººè¦ºå¾—ï¼Œæœ€ä½Žæ¨™æº–å°±æ˜¯åœ¨é‡åˆ°è©²èª²é¡Œä¸æ‡‚çš„åœ°æ–¹æ™‚ï¼Œã€Œèƒ½çŸ¥é“æ€Žéº¼ä¸‹é—œéµå­—æŸ¥ã€ä¸”ã€ŒæŸ¥å®Œçš„çµæžœèƒ½çœ‹å¾—æ‡‚ã€ã€‚&lt;/p&gt;
&lt;p&gt;ç³»åˆ—æ–‡åŽŸæœ¬æ”¾åœ¨ &lt;a href="https://gist.github.com/ccwang002/368025d3c541ed983892"&gt;Github Gist&lt;/a&gt; ä¸Šï¼Œä½†ç¾åœ¨æœ‰è‡ªå·±çš„ blog äº†ï¼Œå°±æ•´ç†åˆ°é€™é‚Šé †ä¾¿æ›´æ–°ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;å­¸ç¿’æ–¹å¼&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_2"&gt;å•ï¼šç‚ºä»€éº¼ä¸å¸¶å¤§å®¶æ‰‹æŠŠæ‰‹æ•™å­¸ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;ç†Ÿç·´ä¾†è‡ªç”Ÿæ´»ä¸­çš„å¯¦è¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#windows"&gt;çµ¦ Windows ä½¿ç”¨è€…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#osx"&gt;çµ¦ OSX ä½¿ç”¨è€…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;æ–‡ç« ç›®éŒ„&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="_1"&gt;å­¸ç¿’æ–¹å¼&lt;/h3&gt;
&lt;p&gt;æ¯ä¸€ç¯‡éƒ½æœƒæ˜¯ä¸€å€‹ä¸»é¡Œï¼Œä¸»é¡Œåº•ä¸‹æœƒåˆ—å‡ºä¸€äº›è³‡æºã€‚ä¸»é¡Œçš„æœ€å¾Œæœ‰å­¸ç¿’ç›®æ¨™ï¼Œæ–¹ä¾¿è®“ä½ è©•ä¼°è‡ªå·±å­¸åˆ°ä»€éº¼ç¨‹åº¦ã€‚å­¸ç¿’ç›®æ¨™æœƒçµ¦ä¸€å€‹æ˜Žç¢ºçš„ä»»å‹™ï¼Œæˆ‘ç›¡é‡è®“å®ƒèƒ½è·Ÿï¼ˆå®…å®…çš„ï¼‰æ—¥å¸¸ç”Ÿæ´»çµåˆã€‚é€šå¸¸åªè¦å®Œæˆå‰ä¸€ã€äºŒå€‹ç›®æ¨™å°±è¡Œäº†ï¼Œé€™ä¹Ÿä¸æ˜¯åŠŸèª²æ‰€ä»¥ä¸ç”¨çµ¦æˆ‘çœ‹ã€‚ä½†å¦‚æžœä½ ä¸ä»‹æ„çµ¦æˆ‘çœ‹çš„è©±ï¼Œæˆ‘æœƒåˆ†äº«æˆ‘ä¸»è§€çš„å»ºè­°ã€‚å¤§éƒ¨ä»½çš„ä»»å‹™æ˜¯æ²’æœ‰å”¯ä¸€çš„æ­£ç¢ºç­”æ¡ˆï¼Œåªè¦èƒ½è§£æ±ºå•é¡Œéƒ½æ˜¯å¥½æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹ï¼Œé€™äº›è³‡æºä¸ç”¨å…¨çœ‹ï¼Œä»»å‹™ä¸ç”¨å…¨åšï¼Œå¤§å®¶è‡ªå·±æ–Ÿé…Œè¦èŠ±å¤šå°‘æ™‚é–“åœ¨ä¸åŒçš„ä¸»é¡Œä¸Šã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æŒ‘ä½ å–œæ­¡çš„æ±è¥¿ç›¡é‡é‘½ï¼Œæ²’æœ‰ fu çš„å°±éš¨ä¾¿çœ‹çœ‹æœƒäº†å°±å¥½&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘æœƒç›¡é‡æŒ‰ç…§é›£æ˜“åº¦æŽ’åˆ—ï¼Œä¸­è‹±æ–‡çš„è³‡æºéƒ½æ”¾ã€‚&lt;/p&gt;
&lt;h4 id="_2"&gt;å•ï¼šç‚ºä»€éº¼ä¸å¸¶å¤§å®¶æ‰‹æŠŠæ‰‹æ•™å­¸ï¼Ÿ&lt;/h4&gt;
&lt;p&gt;ç°¡å–®åœ°èªªæ²’ç©ºã€‚èªçœŸåœ°èªªï¼Œå¤§å®¶çš„å­¸ç¿’é€Ÿåº¦è·Ÿåº•å­éƒ½ä¸ä¸€æ¨£ï¼ŒåŒæ­¥å­¸åªæ˜¯æµªè²»å„ä½çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¤§æ¦‚æ²’æœ‰è¾¦æ³•ä¸€å€‹ä¸€å€‹é …ç›®å¸¶å¤§å®¶ç·´ç¿’ï¼Œåº•ä¸‹çš„å¾ˆå¤šé€£çµåªæ˜¯æä¾›ä¸€å€‹å­¸ç¿’çš„çª—å£ï¼ŒçœŸæ­£è¦å­¸ä¸‹åŽ»ï¼Œéƒ½æ˜¯è¦èŠ±ä¸€å®šæ™‚é–“çš„ã€‚æ‰€ä»¥ä¹Ÿä¸è¦æŠ±è‘—ã€Œåªè¦è®€å®Œé€™äº›æ–‡ç« å°±æœƒäº†â—‹â—‹â—‹ã€é€™æ¨£çš„æƒ³æ³•ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç™½è©±çš„ä¾†èªªï¼Œé€™äº›èƒŒæ™¯çŸ¥è­˜å°±åƒéŠæˆ²çš„æŠ€èƒ½æ¨¹ï¼ŒåŸºç¤ŽæŠ€èƒ½è¦å…ˆé»žå¥½æ‰èƒ½é»žé€²éšŽæŠ€èƒ½ã€‚è¦æŠŠåŸºç¤ŽæŠ€èƒ½é»žæ»¿äº†å†ç·´ç­‰ä¹Ÿå¯èƒ½ï¼Œä½†ä¸å¿…è¦ä¸€ç›´ç·´ç­‰ï¼Œå¤§å®¶æœªå¿…å–œæ­¡ï¼Œç¾å¯¦ä¸­ä¹Ÿä¸è¨±ä½ ç·´ç­‰ä¸è§£ä»»å‹™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€é–‹å§‹å¯èƒ½ç¢°åˆ°å°å•é¡Œå°±è¦æŸ¥ï¼Œæˆ–è€…è¦é€£çºŒæŸ¥å¾ˆå¤šå€‹ç¶²é è¢«å°Žå‘å››ã€äº”æ¬¡æ‰èƒ½ç¨å¾®è§£ç­”è‡ªå·±çš„ç–‘å•ã€‚é€™å€‹ç¾è±¡æ˜¯éžå¸¸æ­£å¸¸çš„ï¼Œå¦‚æžœå¤§å®¶èƒ½æ’éŽåˆæœŸé€™æ®µæ¯”è¼ƒæŒ«æŠ˜çš„æ™‚æœŸï¼Œæ—¥å¾Œè¦è‡ªå­¸è»Ÿé«”åŸºæœ¬ä¸Šå°±æ²’å•é¡Œäº†ã€‚&lt;/p&gt;
&lt;h3 id="_3"&gt;ç†Ÿç·´ä¾†è‡ªç”Ÿæ´»ä¸­çš„å¯¦è¸&lt;/h3&gt;
&lt;p&gt;è¦å¾ˆå¿«åœ°å­¸å¥½ç¨‹å¼ï¼Œæˆ‘æŽ¨è–¦ç·´ç¿’æŠŠç¨‹å¼æ‡‰ç”¨åœ¨ç”Ÿæ´»ä¸­ã€‚ä¾‹å¦‚ç”¨æ–‡å­—å‘½ä»¤åˆ—ä¾†ä¸‹è¼‰æª”æ¡ˆï¼›æŠŠè‡ªå·±ç­†é›»è®Šæˆ linux æ¡Œé¢ç³»çµ±ï¼Œç·´ç¿’è‡ªå·±ç·¨è­¯è»Ÿé«”ã€è§£æ±ºå„å¼å®‰è£çš„ç‹€æ³ã€‚è®“è‡ªå·±çš„é›»è…¦æˆç‚ºä¸€å€‹è‡ªå·±èƒ½æŽ¥å—çš„è»Ÿé«”é–‹ç™¼ç’°å¢ƒï¼Œä¸¦ç¶“å¸¸çš„ä½¿ç”¨å®ƒï¼Œå°±èƒ½é™ä½Žå°å¯«ç¨‹å¼çš„é™Œç”Ÿèˆ‡ä¸çŸ¥æ‰€æŽªæ„Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„æ–¹æ³•å¯èƒ½ç¨é›£ä¸€äº›ï¼Œè² æ“”æ¯”è¼ƒå°çš„å¯ä»¥é–‹å§‹åšã€Œæ€è€ƒç·´ç¿’ã€ã€‚æ€è€ƒç·´ç¿’åŒ…å«åŽ»æƒ³ç”Ÿæ´»ä¸­çš„å¤§å°äº‹è©²æ€Žéº¼å¯«ç¨‹å¼ä¾†æŽ§åˆ¶ã€‚ä¾‹å¦‚æˆ‘è©²æ€Žéº¼è¨­è¨ˆä¸€å€‹é›»æ¢¯ç³»çµ±ï¼Ÿè‡‰æ›¸æ€Žéº¼å‘ˆç¾å¤§å®¶çš„å‹•æ…‹ï¼Ÿåªè¦å¤§æ¦‚æƒ³ä¸€æƒ³å°±å¥½äº†ï¼Œæƒ³ä¸å‡ºä¾†ä¹Ÿä¸æœƒæ€Žæ¨£ï¼Œä¹Ÿä¸ç”¨ç‰¹åˆ¥æŸ¥è³‡æ–™ã€‚éŽä¸€æ®µæ™‚é–“å°ç¨‹å¼çš„ sense ä¹Ÿæœƒææ˜‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœéœ€è¦æ›´ç¡¬æ´¾çš„å­¸ç¿’æ–¹å¼ï¼Œä¸å¦¨æŠŠè‡ªå·±é›»è…¦å®‰è£çš„è»Ÿé«”çš„æºå§‹ç¢¼éƒ½æ‹¿å‡ºä¾†çœ‹ä¸€ä¸‹ï¼ŒåŠ å…¥å¹¾å€‹è‡ªå·±å¹³å¸¸ç”¨çš„è»Ÿé«”çš„å°ˆæ¡ˆä¾†ä¿®æ”¹å®ƒï¼Œè®“å®ƒæ›´å°‘å•é¡Œæ›´å¤šåŠŸèƒ½ï¼ˆä¸€èˆ¬å« contributeï¼‰ã€‚ä¹Ÿå¯ä»¥æŠŠå¯¦é©—å®¤æœ‰ç”¨åˆ°çš„å·¥å…·çš„åŽŸå§‹ç¢¼æ‹¿å‡ºä¾†çœ‹ä¸€ä¸‹ï¼Œä¾‹å¦‚ sratoolkitã€cutadaptï¼Œçœ‹çœ‹è‡ªå·±èƒ½ä¸èƒ½è®€æ‡‚åˆ¥äººçš„ç¨‹å¼ç¢¼ã€‚&lt;/p&gt;
&lt;h3 id="windows"&gt;çµ¦ Windows ä½¿ç”¨è€…&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å»ºè­°å¤§å®¶æƒ³è¾¦æ³•è£å€‹ Linuxï¼ˆæˆ–ç”¨ Macï¼‰ã€‚å¦‚æžœä¸æƒ³å–ä»£æŽ‰è‡ªå·±çš„ Windows ç’°å¢ƒè©±ï¼Œå¯ä»¥å®‰è£ VirtualBox è£å€‹è™›æ“¬çš„ Linuxï¼Œæˆ–è€…åœ¨ Amazon ç­‰ VPS æž¶ä¸€å°è™›æ“¬ä¸»æ©Ÿã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Windows å› ç‚ºå°åœ–å½¢ä»‹é¢ï¼ˆGUIï¼‰è¨­è¨ˆçš„å¾ˆå¥½ï¼Œä¹Ÿä¸å®¹æ˜“è®“ä½¿ç”¨è€…ç”¨å‘½ä»¤åˆ—æ¨¡å¼ï¼ˆterminal, console)ã€‚é›–ç„¶ Windows ä¸Šæœ‰åƒ command promptã€Powershell ä¹‹é¡žçš„ç’°å¢ƒï¼Œä½†éƒ½å¾ˆé›£ç”¨å®ƒä¾†æ“æŽ§æ•´å€‹ç³»çµ±ã€‚è€Œä¸”å®ƒæ‰“å¾žéª¨å­å°±è·Ÿ Linux ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥ç›¸é—œçš„æŒ‡ä»¤ä¸å¥½åœ¨ç¶²ä¸Šçš„æ•™å­¸æ–‡ç« ä¸­æ‰¾åˆ°ï¼Œè€Œå¤šæ•¸ Windows çš„é–‹ç™¼è€…ä¹Ÿä¸å–œæ­¡ç”¨ terminalã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œå¤§å®¶å° Visual Studio çš„å°è±¡éƒ½æ˜¯è¦æ”¶éŒ¢çš„&lt;sup id="fnref:è¨»1"&gt;&lt;a class="footnote-ref" href="#fn:è¨»1"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œé€™æ˜¯ Windows ä¸Šæœ€å®Œæ•´æœ€å¥½ç”¨çš„é–‹ç™¼ç’°å¢ƒï¼Œä¸æƒ³ä»˜è²»çš„æƒ…æ³ä¸‹å¯èƒ½å°±æœƒè¦ºå¾—ã€Œå¯«ç¨‹å¼å……æ»¿éšœç¤™ã€ï¼Œæ›´ä½•æ³ VS ä¹Ÿæ˜¯åœ–å½¢åŒ–çš„ç·¨è¼¯å™¨ï¼Œä¹Ÿæœƒä¸äº†è§£èƒŒå¾Œé‹ä½œçš„æ–¹å¼ã€‚å¸‚é¢çš„é–‹æºè»Ÿé«”å¤šåŠåœ¨ *nix ä¸Šé–‹ç™¼ï¼Œå° Windows æ”¯æ´åº¦å·®ä¹ŸåŠ æ·±é€™å€‹éšœç¤™ï¼ˆã€Œæƒ³è¦è‡ªå·±è£ä½†éƒ½ä¸€å †é™åˆ¶åˆå¾ˆå®¹æ˜“å¤±æ•—ã€ï¼‰&lt;/p&gt;
&lt;p&gt;ä¸ç”¨ terminal çš„å£žè™•æ˜¯å¾ˆé›£æƒ³åƒè‡ªå·±ç³»çµ±ä¸­çš„è»Ÿé«”ç‚ºä»€éº¼èƒ½é‹ä½œã€‚æ„Ÿè¦ºè¦å¯«å€‹æœ‰ GUI çš„ç¨‹å¼éƒ½è¦å¾ˆåŽ²å®³ï¼Œè·Ÿè‡ªå·±å­¸éŽçš„å¯«ç¨‹å¼éƒ½ä¸ä¸€æ¨£ã€‚ä½†å¯¦è³ªä¸Šæ˜¯æ²’æœ‰å¤ªå¤šå€åˆ¥çš„ï¼Œåªæ˜¯è¦å®Œæˆä¸€å€‹èƒ½å®‰è£åœ¨ç³»çµ±ä¸­çš„è¦–çª—è»Ÿé«”ï¼Œéœ€è¦çš„æ­¥é©Ÿå¤šå¾ˆå¤šï¼Œä¸€èˆ¬ç°¡å–®çš„å°ˆæ¡ˆéƒ½ä¸æœƒåˆ°é‚£å€‹éšŽæ®µã€‚&lt;/p&gt;
&lt;h3 id="osx"&gt;çµ¦ OSX ä½¿ç”¨è€…&lt;/h3&gt;
&lt;p&gt;Mac OSX ä½¿ç”¨è€…ä¹Ÿæœ‰é€™æ¨£çš„ç¾è±¡ï¼Œä½†å› ç‚º OSX åœ¨åº•å±¤ç”¨çš„æ˜¯è·Ÿ FreeBSD å¾ˆç›¸ä¼¼ï¼Œè€Œ FreeBSD è·Ÿ Linux ç›¸ä¼¼ï¼Œæ‰€ä»¥å®ƒçš„ terminal ç’°å¢ƒæ˜¯å¾ˆå®Œæ•´çš„ã€‚ç¾åœ¨è»Ÿé«”é–‹ç™¼è€…å¾ˆå¤šäººç”¨ OSXï¼Œå› æ­¤ç¶²è·¯ä¸Š Linuxã€OSX è³‡æºéƒ½å¾ˆå¤šï¼Œå…©è€…çš„ç¶“é©—å¸¸èƒ½è‡ªç„¶åœ°ç§»æ¤ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•åœ¨ OSX ä¸Šé–‹ç™¼ç¨‹å¼ï¼Œå¯ä»¥åƒè€ƒ&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;é™„éŒ„ 0&lt;/a&gt; çš„ç­†è¨˜ï¼Œä½†å…§å®¹å¾ˆä¸»è§€ï¼Œä¸æ˜¯æ¯å€‹äººéƒ½æœƒåƒæˆ‘é€™æ¨£ç”¨ã€‚&lt;/p&gt;
&lt;h2 id="_4"&gt;æ–‡ç« ç›®éŒ„&lt;/h2&gt;
&lt;p&gt;å¯«ä¸€å¯«å…§å®¹ä¹Ÿè®Šå¾—è »å¤šçš„ï¼Œæ‰€ä»¥æŠŠå®ƒåˆ‡æˆäº†å¹¾ç¯‡æ–‡ç« ï¼Œè«‹æŒ‰ç…§æ•¸å­—é †åºé–±è®€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-intro/"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-linux/"&gt;Chapter 1 &amp;ndash; Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-text-editing/"&gt;Chapter 2 &amp;ndash; Text Editing (Markdown, Text Editor)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-version-control/"&gt;Chapter 3 &amp;ndash; Version Control (Git)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-python/"&gt;Chapter 4 &amp;ndash; Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-osx-env/"&gt;Appendix 1 &amp;ndash; OSX Development Environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.liang2.tw/posts/2016/01/lab-coding-appendix-bioinfo-python/"&gt;Appendix 2 &amp;ndash; Python in Bioinformatics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ–è€…ï¼Œç”¨ &lt;a href="/tag/labcoding.html"&gt;labcoding&lt;/a&gt; é€™å€‹ tag ä¹Ÿå¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:è¨»1"&gt;
&lt;p&gt;Visual Studio è‡ª 2013 å¾Œæœ‰ &lt;a href="https://www.visualstudio.com/en-us/news/vs2013-community-vs.aspx"&gt;Community&lt;/a&gt; ç‰ˆæœ¬ï¼Œå…è²»ä½†å…§å®¹èˆ‡ Professional ç‰ˆæœ¬å¤§è‡´ç„¡ç•°ï¼Œæ‰€ä»¥æœªä¾†è¦æœ‰ C/C++ 32/64bit Compiler æœƒæ›´å®¹æ˜“ã€‚ä½†å¤šæ•¸çš„é–‹æºè»Ÿé«”é‚„æ²’è·Ÿé€²ï¼Œæ‰€ä»¥å¾ˆå¤šé‚„åœ¨ç”¨èˆŠçš„ VS ç‰ˆæœ¬ï¼ˆå°±è¦ä»˜è²»ï¼‰ï¼Œé€™å€‹ç¾è±¡é‚„æœƒæŒçºŒä¸€é™£ã€‚å­¸æ ¡éƒ½æœ‰è²·ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:è¨»1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="labcoding"></category></entry><entry><title>Numpy Indexing</title><link href="https://blog.liang2.tw/posts/2016/01/numpy-index/" rel="alternate"></link><published>2016-01-18T02:00:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-18:/posts/2016/01/numpy-index/</id><summary type="html">&lt;p&gt;Numpy å¤šç¶­åº¦çš„ indexing è·Ÿ pandas è¡Œç‚ºä¸ä¸€æ¨£ï¼Œéœ€è¦é¡å¤–çš„æ“ä½œã€‚&lt;/p&gt;</summary><content type="html">&lt;p&gt;å‰å¹¾å¤©éœ€è¦å¯« &lt;a href="http://docs.scipy.org/doc/numpy/index.html"&gt;numpy&lt;/a&gt; æ™‚ï¼Œçªç„¶ç™¼ç¾è·Ÿ &lt;a href="http://pandas.pydata.org/"&gt;pandas&lt;/a&gt; åœ¨ indexing çš„è¡Œç‚ºè »ä¸ä¸€æ¨£çš„ã€‚æˆ‘æ„Ÿè¦ºæœªä¾†ä¸€å®šæœƒå¿˜è¨˜ï¼Œå…ˆç­†è¨˜èµ·ä¾†ã€‚&lt;/p&gt;
&lt;p&gt;å°±ç”¨æ™‚äº‹ä¾†èˆ‰ä¾‹å§ï¼ŒæŠŠç¶­åŸºç™¾ç§‘ä¸Š&lt;a href="https://zh.wikipedia.org/wiki/2016%E5%B9%B4%E4%B8%AD%E8%8F%AF%E6%B0%91%E5%9C%8B%E7%AB%8B%E6%B3%95%E5%A7%94%E5%93%A1%E9%81%B8%E8%88%89"&gt;å„æ”¿é»¨ 2016 å¹´è‡ºç£ç«‹æ³•å§”å“¡æåæ•¸&lt;/a&gt;çš„è¡¨æ ¼æŠ“ä¸‹ä¾†ã€‚è™•ç†åŽŸå§‹è³‡æ–™çš„ç¨‹å¼æ”¾åˆ°æ–‡æœ«ï¼Œåšå®Œå¤§æ¦‚é•·é€™æ¨£ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;&lt;/th&gt;
&lt;th style="text-align: right;"&gt;å€åŸŸ&lt;/th&gt;
&lt;th style="text-align: right;"&gt;åŽŸä½æ°‘&lt;/th&gt;
&lt;th style="text-align: right;"&gt;ä¸åˆ†å€&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ä¸­åœ‹åœ‹æ°‘é»¨&lt;/td&gt;
&lt;td style="text-align: right;"&gt;72&lt;/td&gt;
&lt;td style="text-align: right;"&gt;5&lt;/td&gt;
&lt;td style="text-align: right;"&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;æ°‘ä¸»é€²æ­¥é»¨&lt;/td&gt;
&lt;td style="text-align: right;"&gt;60&lt;/td&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: right;"&gt;34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;å°ç£åœ˜çµè¯ç›Ÿ&lt;/td&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0&lt;/td&gt;
&lt;td style="text-align: right;"&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;è¦ªæ°‘é»¨&lt;/td&gt;
&lt;td style="text-align: right;"&gt;6&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: right;"&gt;16&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ç„¡é»¨åœ˜çµè¯ç›Ÿ&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: right;"&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;æ°‘åœ‹é»¨&lt;/td&gt;
&lt;td style="text-align: right;"&gt;13&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: right;"&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ç¶ é»¨ç¤¾æœƒæ°‘ä¸»é»¨è¯ç›Ÿ&lt;/td&gt;
&lt;td style="text-align: right;"&gt;11&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0&lt;/td&gt;
&lt;td style="text-align: right;"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ä¸­è¯çµ±ä¸€ä¿ƒé€²é»¨&lt;/td&gt;
&lt;td style="text-align: right;"&gt;14&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0&lt;/td&gt;
&lt;td style="text-align: right;"&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;æ™‚ä»£åŠ›é‡&lt;/td&gt;
&lt;td style="text-align: right;"&gt;12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0&lt;/td&gt;
&lt;td style="text-align: right;"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;å¤§æ„›æ†²æ”¹è¯ç›Ÿ&lt;/td&gt;
&lt;td style="text-align: right;"&gt;12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0&lt;/td&gt;
&lt;td style="text-align: right;"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="pandas-indexing"&gt;Pandas indexing&lt;/h3&gt;
&lt;p&gt;Pandas indexing èŠ±ä¿åˆ°ç”¨&lt;a href="http://pandas.pydata.org/pandas-docs/stable/indexing.html"&gt;ä¸€&lt;/a&gt;ã€&lt;a href="http://pandas.pydata.org/pandas-docs/stable/advanced.html"&gt;å…©&lt;/a&gt;é ä¹Ÿä»‹ç´¹ä¸å®Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽä»Šå¤©åªæƒ³èªªæœ‰é—œå…©å€‹ç¶­åº¦ä»¥ä¸Šçš„ indexingï¼Œä¾‹å¦‚æƒ³çœ‹åœ‹æ°‘é»¨ã€æ°‘é€²é»¨ã€æ™‚ä»£åŠ›é‡å€åŸŸèˆ‡ä¸åˆ†å€çš„æåå¥½äº†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ä¸­åœ‹åœ‹æ°‘é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ°‘ä¸»é€²æ­¥é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ™‚ä»£åŠ›é‡&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;å€åŸŸ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ä¸åˆ†å€&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šè¿°å…©å€‹æ–¹æ³•éƒ½èƒ½æ‹¿åˆ°ä¸€éƒ¨ä»½çš„è¡¨æ ¼ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;&lt;/th&gt;
&lt;th style="text-align: right;"&gt;å€åŸŸ&lt;/th&gt;
&lt;th style="text-align: right;"&gt;ä¸åˆ†å€&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;ä¸­åœ‹åœ‹æ°‘é»¨&lt;/td&gt;
&lt;td style="text-align: right;"&gt;72&lt;/td&gt;
&lt;td style="text-align: right;"&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;æ°‘ä¸»é€²æ­¥é»¨&lt;/td&gt;
&lt;td style="text-align: right;"&gt;60&lt;/td&gt;
&lt;td style="text-align: right;"&gt;34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;æ™‚ä»£åŠ›é‡&lt;/td&gt;
&lt;td style="text-align: right;"&gt;12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="numpy-indexing"&gt;Numpy indexing&lt;/h3&gt;
&lt;p&gt;ä¸‹æ„è­˜åœ°ä»¥ç‚º &lt;a href="http://docs.scipy.org/doc/numpy/reference/arrays.indexing.html#arrays-indexing"&gt;numpy indexing&lt;/a&gt; æœƒæ˜¯ä¸€æ¨£çš„ï¼Œç•¢ç«Ÿ pandas åº•å±¤å°±æ˜¯ä¸€å€‹ numpy arrayã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;array([[72,  5, 33],&lt;/span&gt;
&lt;span class="go"&gt;       [60,  2, 34],&lt;/span&gt;
&lt;span class="go"&gt;       [ 2,  0, 15],&lt;/span&gt;
&lt;span class="go"&gt;       [ 6,  1, 16],&lt;/span&gt;
&lt;span class="go"&gt;       [ 0,  1,  7]])&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;IndexError: shape mismatch: indexing arrays could not be broadcast &lt;/span&gt;
&lt;span class="go"&gt;together with shapes (3,) (2,) &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å›žåŽ»çœ‹&lt;a href="http://docs.scipy.org/doc/numpy/reference/arrays.indexing.html#arrays-indexing"&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;æ‰æƒ³èµ·ä¾†ï¼Œ numpy é€™æ™‚å€™æ˜¯å¦‚åŒçµ¦å®š (x, y) åº§æ¨™é€™æ¨£ï¼Œä¸€å€‹å€‹æŠŠå…ƒç´ é¸å‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="go"&gt;[72, 2, 6]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç°¡å–®çš„æ–¹å¼æ˜¯åˆ†å…©æ¬¡é¸ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;:][:,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½†é€™æ¨£ numpy æœƒå‚³å…©æ¬¡ copy&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt; å›žä¾†ï¼Œè³‡æ–™å¾ˆå¤§çš„æ™‚å€™å°±æ²’æ•ˆçŽ‡ã€‚æ‰€ä»¥è¦æ€Žéº¼åšå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åƒè€ƒ &lt;a href="http://stackoverflow.com/a/30918530"&gt;Stack Overflow&lt;/a&gt; ä¸Šçš„å›žç­”ï¼Œåº•ä¸‹å¹¾ç¨®æ–¹å¼éƒ½å¯ä»¥ã€‚æœ€ç°¡å–®çš„æ–¹æ³•å°±æ˜¯é€éŽ &lt;a href="http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.ix_.html#numpy.ix_"&gt;numpy.ix_()&lt;/a&gt;ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ix_&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æžœäº†è§£ numpy broadcasting æ©Ÿåˆ¶çš„è©±ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# index must be numpy array&lt;/span&gt;
&lt;span class="n"&gt;cols&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;rows&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cols&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;newaxis&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c1"&gt;# np.newaxis is None&lt;/span&gt;
&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cols&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;rows&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ–è€…ç›´æŽ¥æŠŠæ‰€æœ‰åŒ…å«çš„ index å€¼éƒ½åšå‡ºä¾†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;indices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meshgrid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
    &lt;span class="n"&gt;indexing&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ij&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;arr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;indices&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•´ç†ä¸€ä¸‹ï¼Œé€™åªè¦ä¸€æ®µæ™‚é–“æ²’ç”¨å°±å¸¸æœƒå¿˜è¨˜ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;ç¶­åŸºåŽŸå§‹è³‡æ–™è™•ç†&lt;/h3&gt;
&lt;p&gt;Wikipedia åŽŸå§‹è³‡æ–™å¾ž&lt;a href="https://zh.wikipedia.org/wiki/2016%E5%B9%B4%E4%B8%AD%E8%8F%AF%E6%B0%91%E5%9C%8B%E7%AB%8B%E6%B3%95%E5%A7%94%E5%93%A1%E9%81%B8%E8%88%89"&gt;é€™è£¡&lt;/a&gt;å–å¾—ï¼Œé€™å°±æ˜¯å±•ç¾ pandas è™•ç†èƒ½åŠ›çš„æ™‚å€™äº†ã€‚æ–°ç‰ˆæœ¬å°å­—ä¸²è™•ç†æä¾›æ›´å¤šåŠŸèƒ½ï¼Œéƒ½è®“æˆ‘å¿˜äº†åº•ä¸‹çš„ numpy å° unicode æ”¯æ´å…¶å¯¦ä¸æ€Žéº¼æ¨£ XD&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;urllib.parse&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;quote_plus&lt;/span&gt;

&lt;span class="n"&gt;dfs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_html&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;https://zh.wikipedia.org/wiki/&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; 
    &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;quote_plus&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2016å¹´ä¸­è¯æ°‘åœ‹ç«‹æ³•å§”å“¡é¸èˆ‰&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dfs&lt;/span&gt; 
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç«‹æ³•å§”å“¡æ”¿é»¨æååé¡&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Data cleaning&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;:]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;æ”¿é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;æ”¿é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;\[(è¨» |)\d+\]&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;æ”¿é»¨&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ï¼&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astype&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;åœ¨é€™æƒ…æ³è³‡æ–™æœƒè¢« copy å‚³å›žä¾†ï¼Œä½†å¦‚æžœæ˜¯ &lt;code&gt;start:end:step&lt;/code&gt; çš„ simple indexing å°±åªæœƒå›žå‚³ viewã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="python"></category><category term="numpy"></category><category term="pandas"></category></entry><entry><title>Plot Sequencing Depth with Gviz</title><link href="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/" rel="alternate"></link><published>2016-01-15T23:50:00-06:00</published><updated>2022-05-13T12:58:36-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-15:/posts/2016/01/plot-seq-depth-gviz/</id><summary type="html">&lt;p&gt;&lt;em&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Plot exome sequencing depth and coverage with genome annotation using Gviz in R. Then apply detail control on Gviz annotation track displaying.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This is an extending post from &lt;a href="https://blog.liang2.tw/posts/2015/12/biocondutor-genomic-data/"&gt;Genomic Data Processing in Bioconductor&lt;/a&gt;, though I haven&amp;rsquo;t finished reading all the reference in that post. The background knowledge â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Plot exome sequencing depth and coverage with genome annotation using Gviz in R. Then apply detail control on Gviz annotation track displaying.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This is an extending post from &lt;a href="https://blog.liang2.tw/posts/2015/12/biocondutor-genomic-data/"&gt;Genomic Data Processing in Bioconductor&lt;/a&gt;, though I haven&amp;rsquo;t finished reading all the reference in that post. The background knowledge of this post is basic understanding of how to deal with annotation and genome reference in Bioconductor/R. If you don&amp;rsquo;t deal with genome annotations in R before, you should find some time learning it anyway, a truly life saver.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#convert-sequencing-depth-to-bedgraph-format"&gt;Convert sequencing depth to BedGraph format&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#plot-depth-in-gviz"&gt;Plot depth in Gviz&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#first-gviz-track"&gt;First Gviz track&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#add-genome-axis"&gt;Add genome axis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#add-annotation"&gt;Add annotation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#plot-fine-tune"&gt;Plot fine tune&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#genome-annotation-query-in-bioconductorr"&gt;Genome annotation query in Bioconductor/R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#via-transcripts"&gt;via transcripts()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#via-exonsby"&gt;via exonsBy()&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#show-only-the-annotations-of-certain-genes"&gt;Show only the annotations of certain genes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#display-gene-symbols-at-annotation-track"&gt;Display gene symbols at annotation track&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#supplementary-plot-bam-files-directly"&gt;Supplementary - Plot BAM files directly&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#fancier-alignment-display"&gt;Fancier alignment display&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;I got the chance trying new tricks today when I and other lab members were analyzing our human cancer exome sequencing data. The results were a bunch of BAM files aligned by &lt;a href="https://github.com/lh3/bwa"&gt;BWA-MEM&lt;/a&gt; using reference hg19.&lt;/p&gt;
&lt;p&gt;We want to see how was the sequencing depth and the coverage of all exons designed to be sequenced. Roughly, this can be done in the genome viewer such as &lt;a href="https://www.broadinstitute.org/igv/"&gt;IGV&lt;/a&gt;.&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_IGV.png"/&gt;
  &lt;p class="caption center"&gt;Visualize sequencing depth in IGV&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;IGV is good for daily research, but when it comes to customization, there aren&amp;rsquo;t many options. And if the visualization is aimed for publishing, one might want the figure to be vectorized and, more importantly, &lt;em&gt;reproducible&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Therefore, combining with what I learnt in &lt;a href="https://blog.liang2.tw/posts/2015/12/biocondutor-genomic-data/"&gt;Genomic Data Processing in Bioconductor&lt;/a&gt;, I tried to plot the sequencing depth in R with &lt;a href="https://bioconductor.org/packages/release/bioc/html/Gviz.html"&gt;Gviz&lt;/a&gt;. I thought learning Gviz will be demanding, since its vignette has 80 pages and the function documentation are &lt;a href="http://rpackages.ianhowson.com/bioc/Gviz/man/GeneRegionTrack-class.html"&gt;scarily long spells&lt;/a&gt;. But both of them turned out to be &lt;em&gt;really&lt;/em&gt; helpful and informative, especially when trying to tune its behavior. Figures produced by Gviz are aesthetically pleasing, and Gviz has many features as well (still trying). I&amp;rsquo;m glad that I gave it a shot.&lt;/p&gt;
&lt;p&gt;If you want to follow the code yourself, any human BAM alignment files will do. For example, the GEO dataset &lt;a href="http://dev.3dvcell.org/geo/query/acc.cgi?acc=GSE48215"&gt;GSE48215&lt;/a&gt; contains exome sequencing of breast cancer cell lines.&lt;/p&gt;
&lt;h2 id="convert-sequencing-depth-to-bedgraph-format"&gt;Convert sequencing depth to BedGraph format&lt;/h2&gt;
&lt;p&gt;After a quick search, Gviz&amp;rsquo;s &lt;a href="http://rpackages.ianhowson.com/bioc/Gviz/man/DataTrack-class.html"&gt;DataTrack&lt;/a&gt; accepts BedGraph format. This format can display any numerical value of chromosome ranges, shown as follows,&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;chromosome&lt;/th&gt;
&lt;th&gt;start&lt;/th&gt;
&lt;th&gt;end&lt;/th&gt;
&lt;th style="text-align: right;"&gt;value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;chr1&lt;/td&gt;
&lt;td&gt;10,051&lt;/td&gt;
&lt;td&gt;10,093&lt;/td&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;chr1&lt;/td&gt;
&lt;td&gt;10,093&lt;/td&gt;
&lt;td&gt;10,104&lt;/td&gt;
&lt;td style="text-align: right;"&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;So we need to convert the alignment result as BedGraph format, which can be done by &lt;a href="http://bedtools.readthedocs.org/en/latest/content/tools/genomecov.html"&gt;BEDTools&amp;rsquo; genomecov&lt;/a&gt; command. On BEDTools&amp;rsquo; documentation, it notes that the BAM file should be sorted.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bedtools genomecov -bg -ibam myseq.bam &amp;gt; myseq.bedGraph
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The plain text BedGraph can be huge, pipe&amp;rsquo;d with gzip will reduce file size to around 30% of the original.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bedtools genomecov -bg -ibam myseq.bam &lt;span class="p"&gt;|&lt;/span&gt; gzip &amp;gt; myseq.bedGraph.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="plot-depth-in-gviz"&gt;Plot depth in Gviz&lt;/h2&gt;
&lt;p&gt;R packages of human genome annotations (&lt;a href="http://bioconductor.org/packages/release/data/annotation/html/Homo.sapiens.html"&gt;Homo.sapiens&lt;/a&gt;) and &lt;a href="https://bioconductor.org/packages/release/bioc/html/Gviz.html"&gt;Gviz&lt;/a&gt; itself are required. Also, &lt;a href="https://cran.r-project.org/web/packages/data.table/index.html"&gt;data.table&lt;/a&gt; gives an impressed speed at reading text tables so is recommended to use. During the analysis, I happened to know that data.table supports &lt;a href="https://github.com/Rdatatable/data.table/issues/717"&gt;reading gzip&amp;rsquo;d file through pipe&lt;/a&gt;, which makes it more awesome.&lt;/p&gt;
&lt;h3 id="first-gviz-track"&gt;First Gviz track&lt;/h3&gt;
&lt;p&gt;We should first start at reading our sequencing depth as BedGraph format and plot it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data.table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Gviz&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;bedgraph_dt&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;fread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s"&gt;&amp;#39;./coverage.bedGraph&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;col.names&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;chromosome&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;start&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;end&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;value&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Specifiy the range to plot&lt;/span&gt;
&lt;span class="n"&gt;thechr&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;chr17&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;st&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;41176e3&lt;/span&gt;
&lt;span class="n"&gt;en&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;41324e3&lt;/span&gt;

&lt;span class="n"&gt;bedgraph_dt_one_chr&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;bedgraph_dt&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;chromosome&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;thechr&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;dtrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;DataTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;range&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bedgraph_dt_one_chr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;genome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;hg19&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Seq. Depth&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;plotTracks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dtrack&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we read the sequencing depth data, create a Gviz &lt;code&gt;DataTrack&lt;/code&gt; holding the subset of our data on chr17, then plot Gviz tracks by &lt;code&gt;plotTracks&lt;/code&gt; (though we only made one here) within a given chromosome region. Here is what we got.&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_one_track.png"/&gt;
&lt;/figure&gt;

&lt;h3 id="add-genome-axis"&gt;Add genome axis&lt;/h3&gt;
&lt;p&gt;The figure is a bit weird and lack of information without the genomic location.&lt;/p&gt;
&lt;p&gt;Adding genomic location can be done automatically by Gviz through a new track &lt;code&gt;GenomeAxisTrack&lt;/code&gt;. Also, we&amp;rsquo;d like to show which region of chromosome we are at. This can be done by adding another track, &lt;code&gt;IdeogramTrack&lt;/code&gt;, to show the chromosome ideogram. Note that the latter track will download cytoband data from UCSC so the given genome must have a valid name.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;itrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;IdeogramTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;genome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;hg19&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;chromosome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;thechr&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;gtrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;GenomeAxisTrack&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="nf"&gt;plotTracks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;itrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dtrack&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_with_loc.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;Better now :)&lt;/p&gt;
&lt;h3 id="add-annotation"&gt;Add annotation&lt;/h3&gt;
&lt;p&gt;Since we are using exome sequencing, the curve of sequencing depth only makes senses when combined with the transcript annotations.&lt;/p&gt;
&lt;p&gt;Gviz has &lt;code&gt;GeneRegionTrack&lt;/code&gt; to extract annotation from the R annotation packages. Package Homo.sapiens includes the gene annotation package using UCSC knownGene database. Adding this new track and we will have annotation on our plot.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TxDb.Hsapiens.UCSC.hg19.knownGene&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;txdb&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;TxDb.Hsapiens.UCSC.hg19.knownGene&lt;/span&gt;

&lt;span class="n"&gt;grtrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;GeneRegionTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;txdb&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;chromosome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;thechr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;showId&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Gene Annotation&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;plotTracks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;itrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_with_annotation.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;The plot should now be as informative as what we can get from the IGV. In fact, Gviz can plot the alignment result too. It can read the BAM file directly and show a more detailed coverage that matches what IGV can do. I&amp;rsquo;ll leave that part at the end of this post.&lt;/p&gt;
&lt;p&gt;So far we&amp;rsquo;ve shown the sequencing depth of some chromosome region with annotation. However, there still leave something to be desired, mostly about the annotation:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Can we show only the annotation of certain genes?&lt;/li&gt;
&lt;li&gt;knownGene&amp;rsquo;s identifier is barely meaningless, can we show the gene symbol instead?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So here comes the second part, annotation fine tuning.&lt;/p&gt;
&lt;h2 id="plot-fine-tune"&gt;Plot fine tune&lt;/h2&gt;
&lt;p&gt;Say, we only care about gene &lt;em&gt;BRCA1&lt;/em&gt;. So we need to get its location, or specifically, the genomic range that cover all &lt;em&gt;BRCA1&lt;/em&gt; isoforms. In the following example, I will demonstrate the Gviz&amp;rsquo;s annotation fine tuning.&lt;/p&gt;
&lt;h3 id="genome-annotation-query-in-bioconductorr"&gt;Genome annotation query in Bioconductor/R&lt;/h3&gt;
&lt;p&gt;If you are not familiar with how to query annotations in Bioconductor, it&amp;rsquo;s easier to think by breaking our goal of finding &lt;em&gt;BRCA1&lt;/em&gt;&amp;lsquo;s ranges into two steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Get the transcript IDs&lt;/li&gt;
&lt;li&gt;Query the transcript locations by their IDs&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Getting transcript IDs given their gene symbol is a &lt;code&gt;select()&lt;/code&gt; on OrganismDb object,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Get all transcript IDs of gene BRCA1&lt;/span&gt;
&lt;span class="n"&gt;BRCA1_txnames&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;Homo.sapiens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;BRCA1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;keytype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SYMBOL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ENTREZID&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;TXNAME&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;TXNAME&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;BRCA1_txnames&lt;/span&gt;
&lt;span class="go"&gt; [1] &amp;quot;uc010whl.2&amp;quot; &amp;quot;uc002icp.4&amp;quot; &amp;quot;uc010whm.2&amp;quot; &amp;quot;uc002icu.3&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; [5] &amp;quot;uc010cyx.3&amp;quot; &amp;quot;uc002icq.3&amp;quot; &amp;quot;uc002ict.3&amp;quot; &amp;quot;uc010whn.2&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; [9] &amp;quot;uc010who.3&amp;quot; &amp;quot;uc010whp.2&amp;quot; &amp;quot;uc010whq.1&amp;quot; &amp;quot;uc002idc.1&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;[13] &amp;quot;uc010whr.1&amp;quot; &amp;quot;uc002idd.3&amp;quot; &amp;quot;uc002ide.1&amp;quot; &amp;quot;uc010cyy.1&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;[17] &amp;quot;uc010whs.1&amp;quot; &amp;quot;uc010cyz.2&amp;quot; &amp;quot;uc010cza.2&amp;quot; &amp;quot;uc010wht.1&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Look like it has plenty of isoforms!&lt;/p&gt;
&lt;h4 id="via-transcripts"&gt;via &lt;code&gt;transcripts()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;For the transcript location, the easiest way will be querying the txDb via &lt;code&gt;transcript()&lt;/code&gt;,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;BRCA1_txs&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;transcripts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;Homo.sapiens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;vals&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BRCA1_txnames&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;TXNAME&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;SYMBOL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;EXONID&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;BRCA1_txs&lt;/span&gt;
&lt;span class="go"&gt;GRanges object with 20 ranges and 3 metadata columns:&lt;/span&gt;
&lt;span class="go"&gt;       seqnames               ranges strand   |                   EXONID          TXNAME          SYMBOL&lt;/span&gt;
&lt;span class="go"&gt;          &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt;   |            &amp;lt;IntegerList&amp;gt; &amp;lt;CharacterList&amp;gt; &amp;lt;CharacterList&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;   [1]    chr17 [41196312, 41276132]      -   | 227486,227485,227482,...      uc010whl.2           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;   [2]    chr17 [41196312, 41277340]      -   | 227487,227486,227485,...      uc002icp.4           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;   [3]    chr17 [41196312, 41277340]      -   | 227487,227464,227463,...      uc010whm.2           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;   [4]    chr17 [41196312, 41277468]      -   | 227489,227486,227485,...      uc002icu.3           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;   [5]    chr17 [41196312, 41277468]      -   | 227489,227486,227482,...      uc010cyx.3           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;   ...      ...                  ...    ... ...                      ...             ...             ...&lt;/span&gt;
&lt;span class="go"&gt;  [16]    chr17 [41243452, 41277340]      -   | 227487,227486,227485,...      uc010cyy.1           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;  [17]    chr17 [41243452, 41277468]      -   | 227489,227486,227485,...      uc010whs.1           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;  [18]    chr17 [41243452, 41277500]      -   | 227488,227486,227485,...      uc010cyz.2           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;  [19]    chr17 [41243452, 41277500]      -   | 227488,227486,227485,...      uc010cza.2           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;  [20]    chr17 [41243452, 41277500]      -   |            227488,227474      uc010wht.1           BRCA1&lt;/span&gt;
&lt;span class="go"&gt;  -------&lt;/span&gt;
&lt;span class="go"&gt;  seqinfo: 93 sequences (1 circular) from hg19 genome&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then get the genomic range of these transcripts by &lt;code&gt;seqnames()&lt;/code&gt;, &lt;code&gt;start()&lt;/code&gt; and &lt;code&gt;end()&lt;/code&gt; functions on the &lt;code&gt;GRanages&lt;/code&gt; object,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;thechr &amp;lt;- as.character(unique(
    seqnames(BRCA1_txs)
))
st &amp;lt;- min(start(BRCA1_txs)) - 2e4
en &amp;lt;- max(end(BRCA1_txs)) + 1e3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Some space are added at both ends so the plot won&amp;rsquo;t tightly fit all transcripts and leave some room for the transcript names.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;thechr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;[1] &amp;quot;chr17&amp;quot;    &amp;quot;41176312&amp;quot; &amp;quot;41323420&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="via-exonsby"&gt;via &lt;code&gt;exonsBy()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Another way to obtain the genomic range is getting the exact range of CDS (e.g. exons and UTRs) for each transcript via &lt;code&gt;exonsBy()&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;BRCA1_cds_by_tx&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;exonsBy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;Homo.sapiens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;tx&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;use.names&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;
&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="n"&gt;BRCA1_txnames&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The function returns a &lt;code&gt;GRangesList&lt;/code&gt; object, a list of &lt;code&gt;GRanges&lt;/code&gt; that each &lt;code&gt;GRanges&lt;/code&gt; object corresponds to a transcript respectively.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;BRCA1_cds_by_tx&lt;/span&gt;
&lt;span class="go"&gt;GRangesList object of length 20:&lt;/span&gt;
&lt;span class="go"&gt;$uc010whl.2&lt;/span&gt;
&lt;span class="go"&gt;GRanges object with 22 ranges and 3 metadata columns:&lt;/span&gt;
&lt;span class="go"&gt;       seqnames               ranges strand   |   exon_id   exon_name exon_rank&lt;/span&gt;
&lt;span class="go"&gt;          &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt;   | &amp;lt;integer&amp;gt; &amp;lt;character&amp;gt; &amp;lt;integer&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;   [1]    chr17 [41276034, 41276132]      -   |    227486        &amp;lt;NA&amp;gt;         1&lt;/span&gt;
&lt;span class="go"&gt;   [2]    chr17 [41267743, 41267796]      -   |    227485        &amp;lt;NA&amp;gt;         2&lt;/span&gt;
&lt;span class="go"&gt;   [3]    chr17 [41258473, 41258550]      -   |    227482        &amp;lt;NA&amp;gt;         3&lt;/span&gt;
&lt;span class="go"&gt;   [4]    chr17 [41256885, 41256973]      -   |    227481        &amp;lt;NA&amp;gt;         4&lt;/span&gt;
&lt;span class="go"&gt;   [5]    chr17 [41256139, 41256278]      -   |    227480        &amp;lt;NA&amp;gt;         5&lt;/span&gt;
&lt;span class="go"&gt;   ...      ...                  ...    ... ...       ...         ...       ...&lt;/span&gt;
&lt;span class="go"&gt;  [18]    chr17 [41209069, 41209152]      -   |    227462        &amp;lt;NA&amp;gt;        18&lt;/span&gt;
&lt;span class="go"&gt;  [19]    chr17 [41203080, 41203134]      -   |    227461        &amp;lt;NA&amp;gt;        19&lt;/span&gt;
&lt;span class="go"&gt;  [20]    chr17 [41201138, 41201211]      -   |    227459        &amp;lt;NA&amp;gt;        20&lt;/span&gt;
&lt;span class="go"&gt;  [21]    chr17 [41199660, 41199720]      -   |    227458        &amp;lt;NA&amp;gt;        21&lt;/span&gt;
&lt;span class="go"&gt;  [22]    chr17 [41196312, 41197819]      -   |    227457        &amp;lt;NA&amp;gt;        22&lt;/span&gt;

&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;19 more elements&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;-------&lt;/span&gt;
&lt;span class="go"&gt;seqinfo: 93 sequences (1 circular) from hg19 genome&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;GRangesList&lt;/code&gt; is not merely a R list structure, which can correctly propagate the GRanges-related functions to all the GRanges it contain.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="nf"&gt;start&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BRCA1_cds_by_tx&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;IntegerList of length 20&lt;/span&gt;
&lt;span class="go"&gt;[[&amp;quot;uc010whl.2&amp;quot;]] 41276034 41267743 41258473 ... 41201138 41199660 41196312&lt;/span&gt;
&lt;span class="go"&gt;[[&amp;quot;uc002icp.4&amp;quot;]] 41277199 41276034 41267743 ... 41201138 41199660 41196312&lt;/span&gt;
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here we only cares about the widest range, so the hierarchical structure is not useful. It would be better to flatten the &lt;code&gt;GRangesList&lt;/code&gt; first,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;BRCA1_cds_flatten&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;unlist&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BRCA1_cds_by_tx&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;BRCA1_cds_flatten&lt;/span&gt;
&lt;span class="go"&gt;GRanges object with 284 ranges and 3 metadata columns:&lt;/span&gt;
&lt;span class="go"&gt;             seqnames               ranges strand   |   exon_id   exon_name exon_rank&lt;/span&gt;
&lt;span class="go"&gt;                &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt;   | &amp;lt;integer&amp;gt; &amp;lt;character&amp;gt; &amp;lt;integer&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;  uc010whl.2    chr17 [41276034, 41276132]      -   |    227486        &amp;lt;NA&amp;gt;         1&lt;/span&gt;
&lt;span class="go"&gt;  uc010whl.2    chr17 [41267743, 41267796]      -   |    227485        &amp;lt;NA&amp;gt;         2&lt;/span&gt;
&lt;span class="go"&gt;  uc010whl.2    chr17 [41258473, 41258550]      -   |    227482        &amp;lt;NA&amp;gt;         3&lt;/span&gt;
&lt;span class="go"&gt;  uc010whl.2    chr17 [41256885, 41256973]      -   |    227481        &amp;lt;NA&amp;gt;         4&lt;/span&gt;
&lt;span class="go"&gt;  uc010whl.2    chr17 [41256139, 41256278]      -   |    227480        &amp;lt;NA&amp;gt;         5&lt;/span&gt;
&lt;span class="go"&gt;         ...      ...                  ...    ... ...       ...         ...       ...&lt;/span&gt;
&lt;span class="go"&gt;  uc010cza.2    chr17 [41249261, 41249306]      -   |    227477        &amp;lt;NA&amp;gt;         7&lt;/span&gt;
&lt;span class="go"&gt;  uc010cza.2    chr17 [41247863, 41247939]      -   |    227476        &amp;lt;NA&amp;gt;         8&lt;/span&gt;
&lt;span class="go"&gt;  uc010cza.2    chr17 [41243452, 41246877]      -   |    227474        &amp;lt;NA&amp;gt;         9&lt;/span&gt;
&lt;span class="go"&gt;  uc010wht.1    chr17 [41277288, 41277500]      -   |    227488        &amp;lt;NA&amp;gt;         1&lt;/span&gt;
&lt;span class="go"&gt;  uc010wht.1    chr17 [41243452, 41246877]      -   |    227474        &amp;lt;NA&amp;gt;         2&lt;/span&gt;
&lt;span class="go"&gt;  -------&lt;/span&gt;
&lt;span class="go"&gt;  seqinfo: 93 sequences (1 circular) from hg19 genome&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We have the BRCA1 genomic region, rest of the plotting is the same.&lt;/p&gt;
&lt;h3 id="show-only-the-annotations-of-certain-genes"&gt;Show only the annotations of certain genes&lt;/h3&gt;
&lt;p&gt;Before we start to create our own annotation subset, we first take a look at what Gviz generated. The &lt;code&gt;GeneRegionTrack&lt;/code&gt; track store its annotation data at slot &lt;code&gt;range&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;range&lt;/span&gt;
&lt;span class="go"&gt;GRanges object with 459 ranges and 7 metadata columns:&lt;/span&gt;
&lt;span class="go"&gt;        seqnames               ranges strand   |     feature          id         exon  transcript        gene      symbol   density&lt;/span&gt;
&lt;span class="go"&gt;           &amp;lt;Rle&amp;gt;            &amp;lt;IRanges&amp;gt;  &amp;lt;Rle&amp;gt;   | &amp;lt;character&amp;gt; &amp;lt;character&amp;gt;  &amp;lt;character&amp;gt; &amp;lt;character&amp;gt; &amp;lt;character&amp;gt; &amp;lt;character&amp;gt; &amp;lt;numeric&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;    [1]    chr17 [41177258, 41177364]      +   |        utr5     unknown uc002icn.3_1  uc002icn.3        8153  uc002icn.3         1&lt;/span&gt;
&lt;span class="go"&gt;    [2]    chr17 [41177365, 41177466]      +   |         CDS     unknown uc002icn.3_1  uc002icn.3        8153  uc002icn.3         1&lt;/span&gt;
&lt;span class="go"&gt;    [3]    chr17 [41177977, 41178064]      +   |         CDS     unknown uc002icn.3_2  uc002icn.3        8153  uc002icn.3         1&lt;/span&gt;
&lt;span class="go"&gt;    [4]    chr17 [41179200, 41179309]      +   |         CDS     unknown uc002icn.3_3  uc002icn.3        8153  uc002icn.3         1&lt;/span&gt;
&lt;span class="go"&gt;    [5]    chr17 [41180078, 41180212]      +   |         CDS     unknown uc002icn.3_4  uc002icn.3        8153  uc002icn.3         1&lt;/span&gt;
&lt;span class="go"&gt;    ...      ...                  ...    ... ...         ...         ...          ...         ...         ...         ...       ...&lt;/span&gt;
&lt;span class="go"&gt;  [455]    chr17 [41277294, 41277468]      -   |        utr5     unknown uc010cyx.3_1  uc010cyx.3         672  uc010cyx.3         1&lt;/span&gt;
&lt;span class="go"&gt;  [456]    chr17 [41277294, 41277468]      -   |        utr5     unknown uc002idc.1_1  uc002idc.1         672  uc002idc.1         1&lt;/span&gt;
&lt;span class="go"&gt;  [457]    chr17 [41277294, 41277468]      -   |        utr5     unknown uc010whr.1_1  uc010whr.1         672  uc010whr.1         1&lt;/span&gt;
&lt;span class="go"&gt;  [458]    chr17 [41277294, 41277468]      -   |        utr5     unknown uc010whs.1_1  uc010whs.1         672  uc010whs.1         1&lt;/span&gt;
&lt;span class="go"&gt;  [459]    chr17 [41322143, 41322420]      -   |        utr5     unknown uc010whp.2_1  uc010whp.2         672  uc010whp.2         1&lt;/span&gt;
&lt;span class="go"&gt;  -------&lt;/span&gt;
&lt;span class="go"&gt;  seqinfo: 1 sequence from hg19 genome; no seqlengths&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we filter out unrelated ranges by checking if the value of metadata column &lt;code&gt;transcript&lt;/code&gt; is one of &lt;em&gt;BRCA1&lt;/em&gt;&amp;lsquo;s transcript IDs,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;BRCA_only_range&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;range&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="nf"&gt;mcols&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;range&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;transcript&lt;/span&gt; &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="n"&gt;BRCA1_txnames&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;range&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;BRCA_only_range&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;or by less hacky way that use the new range to construct another &lt;code&gt;GeneRegionTrack&lt;/code&gt;,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;grtrack_BRCA_only&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;GeneRegionTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;BRCA_only_range&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;chromosome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;thechr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;showId&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Gene Annotation (BRCA1 only)&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;plotTracks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;itrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grtrack_BRCA_only&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_BRCA1_only.png"/&gt;
&lt;/figure&gt;

&lt;h3 id="display-gene-symbols-at-annotation-track"&gt;Display gene symbols at annotation track&lt;/h3&gt;
&lt;p&gt;It&amp;rsquo;s more obvious now about how Gviz stores the annotation. All we need is to replace the symbol name with whatever we desire.&lt;/p&gt;
&lt;p&gt;First, we extract the metadata of the &lt;code&gt;GeneRegionTrack&lt;/code&gt;, and query for their gene symbols. Using either the transcript ID or Entrez ID will do.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;grtrack_range&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;range&lt;/span&gt;
&lt;span class="n"&gt;range_mapping&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;Homo.sapiens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;mcols&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;grtrack_range&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;symbol&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;keytype&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;TXNAME&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ENTREZID&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SYMBOL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;range_mapping&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;      TXNAME SYMBOL ENTREZID&lt;/span&gt;
&lt;span class="go"&gt;1 uc002icn.3   RND2     8153&lt;/span&gt;
&lt;span class="go"&gt;2 uc002icn.3   RND2     8153&lt;/span&gt;
&lt;span class="go"&gt;3 uc002icn.3   RND2     8153&lt;/span&gt;
&lt;span class="go"&gt;4 uc002icn.3   RND2     8153&lt;/span&gt;
&lt;span class="go"&gt;5 uc002icn.3   RND2     8153&lt;/span&gt;
&lt;span class="go"&gt;6 uc002icn.3   RND2     8153&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Then we concatenate the information of transcript ID and gene symbol using &lt;a href="https://cran.r-project.org/web/packages/stringr/index.html"&gt;stringr&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stringr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;new_symbols&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;range_mapping&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nf"&gt;str_c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SYMBOL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot; (&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;TXNAME&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sep&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;unique&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;new_symbols&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;[1] &amp;quot;RND2 (uc002icn.3)&amp;quot; &amp;quot;NBR2 (uc002idf.3)&amp;quot; &amp;quot;NBR2 (uc010czb.2)&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;[4] &amp;quot;NBR2 (uc002idg.3)&amp;quot; &amp;quot;NBR2 (uc002idh.3)&amp;quot; &amp;quot;NBR1 (uc010czd.3)&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Like how we extract &lt;em&gt;BRCA1&lt;/em&gt;-only annotations, we construct a new &lt;code&gt;GeneRegionTrack&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;grtrack_symbol&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;GeneRegionTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;range&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;chromosome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;thechr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;showId&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Gene Annotation w. Symbol&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;symbol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;grtrack_symbol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;new_symbols&lt;/span&gt;
&lt;span class="nf"&gt;plotTracks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;itrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grtrack_symbol&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_gene_symbol.png"/&gt;
&lt;/figure&gt;

&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;So we&amp;rsquo;ve learnt how to plot using Gviz. You should go explore other data tracks or try to combine sequencing depth of multiple samples. I found the design of Gviz is clean and easy to modify. I think I&amp;rsquo;ll use Gviz whenever genome-related plots are needed.&lt;/p&gt;
&lt;p&gt;Really glad I&amp;rsquo;ve tried it :)&lt;/p&gt;
&lt;h2 id="supplementary-plot-bam-files-directly"&gt;Supplementary - Plot BAM files directly&lt;/h2&gt;
&lt;p&gt;We will start by replacing &lt;code&gt;DataTrack&lt;/code&gt; with &lt;code&gt;AlignmentsTrack&lt;/code&gt;. Also we select a smaller region this time so the read mapping can be clearly seen.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;st&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;41.196e6L&lt;/span&gt;
&lt;span class="n"&gt;en&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;41.202e6L&lt;/span&gt;
&lt;span class="n"&gt;gtrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;GenomeAxisTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cex&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c1"&gt;# set the font size larger&lt;/span&gt;
&lt;span class="n"&gt;altrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;AlignmentsTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;myseq.bam&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;isPaired&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;col.mates&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;deeppink&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;plotTracks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;altrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;en&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_BAM_default.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;To plot only the coverage, set the type as &lt;code&gt;coverage&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;altrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;AlignmentsTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;myseq.bam&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;coverage&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_BAM_coverage_only.png"/&gt;
&lt;/figure&gt;

&lt;h3 id="fancier-alignment-display"&gt;Fancier alignment display&lt;/h3&gt;
&lt;p&gt;Spend some time reading the documentation, the alignment can be much more fancier.&lt;/p&gt;
&lt;p&gt;For example, when looking at a much smaller genome region, we many want to see the sequence and read mismatches. It could be done by adding a new track &lt;code&gt;SequenceTrack&lt;/code&gt; to include the genome sequence,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;small_st&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;41267.735e3L&lt;/span&gt;
&lt;span class="n"&gt;small_en&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;41267.805e3L&lt;/span&gt;

&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BSgenome.Hsapiens.UCSC.hg19&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;strack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;SequenceTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;Hsapiens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;chromosome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;thechr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;small_en&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;small_st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;cex&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0.8&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We tweak other tracks as well to make sure the figure won&amp;rsquo;t explode by too much information. Gene annotations are collapsed down to one liner. Also, aligned read&amp;rsquo;s height is increased to fit in individual letters (e.g., ATCG).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;grtrack_small&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;GeneRegionTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
   &lt;span class="n"&gt;grtrack&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;range&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="n"&gt;chromosome&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;thechr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;small_st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;small_en&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="n"&gt;stacking&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;dense&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Gene Annotation&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;altrack&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="nf"&gt;AlignmentsTrack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;myseq.bam&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;isPaired&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;min.height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max.height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;coverageHeight&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0.15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;50&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;plotTracks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gtrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;altrack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grtrack_small&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;strack&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;small_st&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;small_en&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/plot-seq-depth-gviz/pics/seqdepth_BAM_small_region.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;We found a C&amp;gt;T SNP here!&lt;/p&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="r"></category><category term="bioconductor"></category><category term="gviz"></category><category term="NGS"></category></entry><entry><title>Jupyter Notebook Theme</title><link href="https://blog.liang2.tw/posts/2016/01/jupyter-notebook-theme/" rel="alternate"></link><published>2016-01-07T00:00:00-06:00</published><updated>2022-05-13T12:58:27-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-07:/posts/2016/01/jupyter-notebook-theme/</id><summary type="html">&lt;p&gt;&lt;a href="http://jupyter.org/"&gt;Jupyter Notebook&lt;/a&gt;ï¼Œä¹Ÿå°±æ˜¯ä»¥å‰çš„ IPython Notebookï¼Œæ‡‰è©²æ˜¯è¨±å¤šäººåœ¨ç”¨ Python åšè³‡æ–™åˆ†æžæ™‚è¨˜éŒ„å¯¦é©—æ­¥é©—èˆ‡çµæžœçš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;ç¾åœ¨ &lt;a href="http://ipython.org/"&gt;IPython&lt;/a&gt; (v4.0+) å·²ç¶“å›žæ­¸åˆ° Interactive Python Shell â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="http://jupyter.org/"&gt;Jupyter Notebook&lt;/a&gt;ï¼Œä¹Ÿå°±æ˜¯ä»¥å‰çš„ IPython Notebookï¼Œæ‡‰è©²æ˜¯è¨±å¤šäººåœ¨ç”¨ Python åšè³‡æ–™åˆ†æžæ™‚è¨˜éŒ„å¯¦é©—æ­¥é©—èˆ‡çµæžœçš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;ç¾åœ¨ &lt;a href="http://ipython.org/"&gt;IPython&lt;/a&gt; (v4.0+) å·²ç¶“å›žæ­¸åˆ° Interactive Python Shell çš„æœ¬è³ªï¼Œè®Šæˆåªæ˜¯æ“´å……å…§å»º Python REPL çš„å¥—ä»¶ï¼Œç›¸ä¾çš„æ¨¡çµ„ä¹Ÿæ¸…æŽ‰äº†ã€‚åŽŸæœ¬çš„ IPyton Notebook ä¸»è¦æ˜¯æä¾›ä¸€å€‹åƒ &lt;a href="https://reference.wolfram.com/language/tutorial/UsingANotebookInterface.html"&gt;Mathematica Notebook&lt;/a&gt; çš„ç’°å¢ƒï¼ŒåŠŸèƒ½å¾ˆå¤šå°±ä¸å¤šæã€‚å®ƒå¯ä»¥ç”¨ web æˆ–è€… QT ä»‹é¢ä¾†è·‘ã€‚&lt;/p&gt;
&lt;p&gt;å¾Œä¾†åˆé–‹å§‹æ•´åˆå¾ˆå¤šèªžè¨€ï¼Œè®Šæˆåƒ Julia / R / Lua ç­‰èªžè¨€éƒ½å¯ä»¥åˆ©ç”¨é€™æ¨£çš„ Notebook æž¶æ§‹ï¼Œæ–¼æ˜¯ &lt;a href="http://jupyter.org/"&gt;Jupyter&lt;/a&gt; å°±å› æ­¤èª•ç”Ÿï¼Œè®ŠæˆåŽŸæœ¬çš„ IPython åªæ˜¯å…¶ä¸­ä¸€å€‹å¯èƒ½çš„èªžè¨€ kernelã€‚Notebook æœ¬èº«å¯ä»¥æ˜¯ R èªžè¨€æˆ–è€… Julia èªžè¨€ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#jupyter-notebook"&gt;Jupyter Notebook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#custom-theme-on-v41"&gt;Custom Theme on v4.1+&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#custom-theme-before-v41"&gt;Custom Theme Before v4.1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="jupyter-notebook"&gt;Jupyter Notebook&lt;/h3&gt;
&lt;p&gt;ç”¨ Python è£ååˆ†ç°¡å–®ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;pip install jupyter
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Jupyter é è¨­èµ° web ä»‹é¢ï¼Œæœƒè·‘ä¸€å€‹ tornado server é è¨­åœ¨ &lt;a href="http://localhost:8888"&gt;http://localhost:8888&lt;/a&gt; ä¸Šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;jupyter notebook
&lt;span class="go"&gt;[I 23:50:58.449 NotebookApp] Serving notebooks from local directory: /Users/liang&lt;/span&gt;
&lt;span class="go"&gt;[I 23:50:58.449 NotebookApp] 0 active kernels&lt;/span&gt;
&lt;span class="go"&gt;[I 23:50:58.450 NotebookApp] The IPython Notebook is running at: http://localhost:8888/&lt;/span&gt;
&lt;span class="go"&gt;[I 23:50:58.450 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ‰è£ browser çš„è©±å°±æœƒè‡ªå‹•é–‹ä¸€å€‹è¦–çª—ã€‚&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/jupyter-notebook-theme/pics/jupyter_default_frontpage.png"/&gt;
  &lt;p class="caption center"&gt;Jupyter Notebook Hub&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;Notebook é è¨­æ˜¯ &lt;code&gt;.ipynb&lt;/code&gt; çš„æª”æ¡ˆã€‚å¸¸è¦‹çš„å…§å®¹åƒé€™æ¨£ï¼š&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/jupyter-notebook-theme/pics/jupyter_default_notebook.png"/&gt;
  &lt;p class="caption center"&gt;Jupyter Notebook Example&lt;/p&gt;
&lt;/figure&gt;

&lt;h3 id="custom-theme-on-v41"&gt;Custom Theme on v4.1+&lt;/h3&gt;
&lt;p&gt;EDIT: 2016-01-11 &lt;a href="https://blog.jupyter.org/2016/01/08/notebook-4-1-release/"&gt;Jupyter Notebook 4.1&lt;/a&gt; å·²é‡‹å‡ºï¼Œè¨­å®šè·¯å¾‘é è¨­éƒ½åœ¨ &lt;code&gt;~/.jupyter&lt;/code&gt; åº•ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©é‡é»žæ˜¯æ›ä¸»é¡Œå˜›ã€‚è¶•å¿«ä¾†åšå§ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€éŽ &lt;code&gt;jupyter --config-dir&lt;/code&gt; æˆ– &lt;code&gt;jupyter --paths&lt;/code&gt; æ‰¾åˆ°è¨­å®šæª”æ‡‰è©²æ”¾çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;jupyter --config-dir
&lt;span class="go"&gt;~/.jupyter&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;jupyter notebook --generate-config  &lt;span class="c1"&gt;# å»ºç«‹ Notebook è¨­å®šæª”&lt;/span&gt;
&lt;span class="go"&gt;Writing default config to: ~/.jupyter/jupyter_notebook_config.py&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æžœåªæ˜¯æ”¹ä¸»é¡Œï¼Œä¸éœ€è¦æ›´å‹• Notebook è¨­å®šæª”ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰è‡ªå·±ä½¿ç”¨çš„ä¸»é¡Œä¾†è‡ª &lt;a href="https://github.com/dunovank/jupyter-themes"&gt;dunovank&lt;/a&gt;ï¼Œä»–æœ‰æ”¶é›†äº†è‡³å°‘æ·±æ·ºå…©è‰²ï¼Œæ‡‰è©²è¶³å¤ ä½¿ç”¨äº†ã€‚CSS å¾žåˆ¥äººçš„åŸºç¤Žä¸Šä¾†èª¿æ•´ä¹Ÿç›¸å°ç°¡å–®ï¼Œæˆ‘è‡ªå·±æœ‰&lt;a href="https://github.com/ccwang002/dotfiles/tree/master/ipy_profile/ipython3"&gt;æ”¹å¯«äº†ä¸€é»ž&lt;/a&gt;ï¼ˆå¿˜äº†æ”¹ä»€éº¼)ã€‚dunovank æœ‰å¯«å€‹å®‰è£ theme çš„å¥—ä»¶ï¼Œä¸éŽä¸ç”¨ä¹Ÿæ²’é—œä¿‚ï¼Œåªè¦æº–å‚™å¥½ CSS å°±èƒ½ç”¨ã€‚æˆ‘ç”¨ Grade3 é€™å€‹ä¸»é¡Œä¾†ç¤ºç¯„ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠ &lt;code&gt;custom.css&lt;/code&gt; æ”¾åˆ° &lt;code&gt;~/.jupyter/static/custom.css&lt;/code&gt;ã€‚è¨­å®šçš„ç›®éŒ„é•·å¾—å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;tree ~/.jupyter -F -L &lt;span class="m"&gt;3&lt;/span&gt;
&lt;span class="go"&gt;~/.jupyter&lt;/span&gt;
&lt;span class="go"&gt;â”œâ”€â”€ custom/&lt;/span&gt;
&lt;span class="go"&gt;â”‚Â Â  â””â”€â”€ custom.css -&amp;gt; /path/to/custom_light.css&lt;/span&gt;
&lt;span class="go"&gt;â””â”€â”€ jupyter_notebook_config.py&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="custom-theme-before-v41"&gt;Custom Theme Before v4.1&lt;/h3&gt;
&lt;p&gt;ç¾åœ¨å› ç‚ºæ­·ç¶“ IPython åˆ° Jupyter çš„éŽç¨‹ï¼Œè¨­å®šé‚„è »åˆ†æ•£çš„ã€‚ä»¥å¾€çš„è¨­å®šæœƒåœ¨ &lt;code&gt;~/.ipython&lt;/code&gt;ï¼Œè€Œåˆ°äº† Jupyter ä¹‹å¾Œï¼Œç›¸é—œè¨­å®šæœƒåœ¨ &lt;code&gt;~/.jupyter&lt;/code&gt;ã€‚æœ‰æ™‚å€™è¨­å®šæ€ªæ€ªçš„è©±å°±å…©å€‹è·¯å¾‘éƒ½æª¢æŸ¥ä¸€ä¸‹å§ã€‚&lt;/p&gt;
&lt;p&gt;åªè¦æŠŠé€™å€‹ CSS æ”¾åˆ° &lt;code&gt;~/.ipython/profile_default/custom.css&lt;/code&gt; å†é‡é–‹ Jupyter Notebook å°±å¯ä»¥äº†&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚æ•ˆæžœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/jupyter-notebook-theme/pics/jupyter_grade3_frontpage.png"/&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/jupyter-notebook-theme/pics/jupyter_grade3_notebook1.png"/&gt;
  &lt;p class="caption center"&gt;Jupyter Notebook Theme Grade3 Demo&lt;/p&gt;
&lt;/figure&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/jupyter-notebook-theme/pics/jupyter_grade3_notebook2.png"/&gt;
  &lt;p class="caption center"&gt;æŠŠ Toolbar å…¨éƒ¨ toggle èµ·ä¾†ï¼Œä»¥åŠè¡¨æ ¼çš„æ¨£å­ã€‚&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;å€‹äººè¦ºå¾—é•·æ™‚é–“ä½¿ç”¨ä¸‹ä¾†ï¼Œå°æ¯”åº¦ä½Žä¸€é»žå°çœ¼ç›æ¯”è¼ƒå¥½ã€‚é»‘åº•ä¹Ÿä¸éŒ¯ï¼Œä¸éŽç•«åœ–å¸¸å¸¸æœƒè‡ªå·±å¸¶ç™½åº•ï¼Œæ•´é«”æ„Ÿè¦ºå°±ä¸æ˜¯å¾ˆæ¼‚äº®ï¼Œå¯èƒ½è¦é€£ matplotlib theme ä¸€èµ·æ”¹å§ XD&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;é€™è·¯å¾‘ä¸¦ä¸ç¬¦åˆ Jupyter è·¨ kernel çš„è¨­è¨ˆç†å¿µï¼Œ&lt;del&gt;æ„Ÿè¦ºæœªä¾†æœƒæ”¹è·¯å¾‘&lt;/del&gt;å·²ç¶“åœ¨ 4.1+ ç‰ˆæœ¬ä¸­å®Œæˆæ•´åˆï¼Œèˆ‡ IPython è¨­å®šåˆ†å®¶äº†ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="jupyter"></category><category term="notebook"></category></entry><entry><title>Blog defaults to HTTPS</title><link href="https://blog.liang2.tw/posts/2016/01/blog-https/" rel="alternate"></link><published>2016-01-06T00:00:00-06:00</published><updated>2022-05-13T12:58:21-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2016-01-06:/posts/2016/01/blog-https/</id><summary type="html">&lt;p&gt;ç°¡è¨€ä¹‹ï¼Œç¾åœ¨ blog ä½¿ç”¨ httpsã€‚ä¸€èˆ¬çš„ http é€£ç·šæœƒè¢«é‡æ–°å°Žå‘è‡³ httpsã€‚&lt;/p&gt;
&lt;p&gt;Blog æœ¬ä¾†å°±æ˜¯æž¶åœ¨ &lt;a href="https://github.com/ccwang002/ccwang002.github.io"&gt;GitHub Pages&lt;/a&gt; ä¸Šï¼Œå…¶å¯¦é è¨­æœ‰ httpsï¼Œä½†åœ¨ç¶²å€æ”¹æˆè‡ªè¨‚ domain ä¹‹å¾Œ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç°¡è¨€ä¹‹ï¼Œç¾åœ¨ blog ä½¿ç”¨ httpsã€‚ä¸€èˆ¬çš„ http é€£ç·šæœƒè¢«é‡æ–°å°Žå‘è‡³ httpsã€‚&lt;/p&gt;
&lt;p&gt;Blog æœ¬ä¾†å°±æ˜¯æž¶åœ¨ &lt;a href="https://github.com/ccwang002/ccwang002.github.io"&gt;GitHub Pages&lt;/a&gt; ä¸Šï¼Œå…¶å¯¦é è¨­æœ‰ httpsï¼Œä½†åœ¨ç¶²å€æ”¹æˆè‡ªè¨‚ domain ä¹‹å¾Œ https è‡ªç„¶å°±å¤±æ•ˆäº†ã€‚åœ¨ GitHub ä¸Šæœ‰é–‹ issue è«‹ä»–å€‘åŠ å…¥ &lt;a href="https://github.com/isaacs/github/issues/156"&gt;HTTPS support for custom domain&lt;/a&gt; é€™åŠŸèƒ½ï¼Œä¸éŽç›®å‰é‚„æ˜¯éœ€è¦è‡ªå·±æƒ³è¾¦æ³•ã€‚éš¨è‘— &lt;a href="https://letsencrypt.org/"&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; é€™ç¨®æœå‹™çš„æµè¡Œï¼ŒGitHub æ‰æœƒåŽ»ç©æ¥µå°‹æ‰¾æ¯”è¼ƒåˆé©çš„è§£æ±ºæ–¹æ¡ˆå§ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#cloudflare-ssl-and-cdn"&gt;CloudFlare SSL and CDN&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#disqus"&gt;Disqus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#justfont"&gt;justfont&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#hinet"&gt;Hinet è½‰å€æœå‹™&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="cloudflare-ssl-and-cdn"&gt;CloudFlare SSL and CDN&lt;/h2&gt;
&lt;p&gt;åœ¨çœ‹é‚£å€‹ &lt;a href="https://github.com/isaacs/github/issues/156"&gt;issue&lt;/a&gt; å°±å¯ä»¥æ‰¾åˆ°å…¶ä»–äººç”¨ CloudFlare çš„è§£æ³•ã€‚æ¦‚å¿µä¸Šå°±å†ç”¨ä¸€å±¤ CloudFlare CDNï¼Œç„¶å¾Œå®ƒçš„ CDN æœ‰æä¾› https ç°½ç« ã€‚ç›´æŽ¥çœ‹ CloudFlare åœ¨ Crypto é çš„ä»‹ç´¹æ¯”è¼ƒå¿«ï¼š&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/blog-https/pics/cloudflare_ssl.png"/&gt;
  &lt;p class="caption center"&gt;source: &lt;a href="https://www.cloudflare.com/ssl/"&gt; CloudFlare one-click SSL&lt;/a&gt;&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;æ‰€ä»¥ CloudFlare åŽ» cache GitHub é é¢æ™‚ç”¨çš„æ˜¯ httpsï¼Œå†åˆ°ä½¿ç”¨è€…æ™‚ä¹Ÿæ˜¯ç”¨ httpsã€‚å‰©ä¸‹å°±æ˜¯ä½ è¦ä¸è¦ç›¸ä¿¡ CloudFlare äº†ã€‚&lt;/p&gt;
&lt;p&gt;CloudFlare çš„è¨­å®šå¯ä»¥åƒè€ƒ &lt;a href="https://blog.keanulee.com/2014/10/11/setting-up-ssl-on-github-pages.html"&gt;Keanu&amp;rsquo;s Blog&lt;/a&gt;ã€‚ä¸€äº›é‡é»žç­†è¨˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›æˆ CloudFlare çš„ DNS Server&lt;/li&gt;
&lt;li&gt;Crypto SSL options é¸ Fullï¼ˆä¸æ˜¯ Strict ç›®å‰ GitHub é‚„ä¸æ”¯æ´ï¼‰&lt;/li&gt;
&lt;li&gt;åœ¨ Page Rules å¼·è¿«æ‰€æœ‰ http é€£çµé‡æ–°ä½¿ç”¨ httpsï¼ˆä¾‹å¦‚ï¼š&lt;code&gt;http://blog.liang2.tw/*&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HTTPS ä»¥åŠ DNS çš„è¨­å®šéƒ½éœ€è¦ä¸€æ®µæ™‚é–“ï¼ŒéŽå¹¾å€‹å°æ™‚æˆ–è§€å¯Ÿå€‹ä¸€å¤©å†æŠŠ http é—œæŽ‰ã€‚&lt;/p&gt;
&lt;p&gt;Pelican ç™¼ä½ˆè¨­å®š &lt;code&gt;publishconf.py&lt;/code&gt; ç®¡ç¶²å€çš„ &lt;code&gt;SITE_URL&lt;/code&gt; èƒ½è¨­æˆ &lt;code&gt;//blog.liang.tw&lt;/code&gt; ä¸ç”¨å¸¶ protocolï¼ˆé€™éº¼é‡è¦çš„è³‡è¨Šæ²’å¯«åœ¨æ–‡ä»¶è£¡å•Šï¼‰ï¼Œé€™æ¨£å°±èƒ½åŒæ™‚ serve http(s)ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ¨£å…¶å¯¦å°±å®Œæˆäº†ã€‚ä½†å‡ºä¹Žæ„å¤–é‚„æ˜¯æœ‰äº›å°å•é¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¶²é å­—åž‹ &lt;a href="http://en.justfont.com/membership"&gt;justfont&lt;/a&gt; è¦ Business Plan æ‰èƒ½æ”¯æ´ HTTPSã€‚&lt;/li&gt;
&lt;li&gt;ç•™è¨€ç³»çµ± &lt;a href="https://disqus.com/"&gt;Disqus&lt;/a&gt; HTTP å’Œ HTTPS ç«Ÿç„¶æ˜¯ç•¶ä½œ&lt;a href="https://github.com/aspnet/Docs/issues/623"&gt;ä¸åŒç•™è¨€æ¿&lt;/a&gt;ä¾†ä½¿ç”¨ï¼Œè€Œä¸”è¦æ‰‹å‹• mergeã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="disqus"&gt;Disqus&lt;/h2&gt;
&lt;p&gt;ä¼¼ä¹Žè§£æ³•åªæœ‰å…¨éƒ¨å°Žå‘åˆ° httpsã€‚é€™é‚„ä¸èƒ½ç›´æŽ¥æ”¹ Disqus è¨­å®šï¼Œè¦ç”¨å®ƒçš„ &lt;a href="https://help.disqus.com/customer/portal/articles/912757-url-mapper"&gt;URL Mapper&lt;/a&gt; ä¸‹è¼‰æ‰€æœ‰ç•™è¨€ç‰ˆå‡ºç¾é€£çµçš„ CSV æ‰‹å‹•ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè¦ºå¾ˆåœŸç ²ã€‚ä¸éŽç«™ä¸Šçš„ç•™è¨€ä¸å¤šï¼Œä¹Ÿä¸ç”¨æ”¹å¤šå°‘ç•™è¨€ï¼Œå¾ˆå¿«å°±åŒæ­¥åˆ°æ–°çš„ä½ç½®ä¸Šã€‚&lt;/p&gt;
&lt;h2 id="justfont"&gt;justfont&lt;/h2&gt;
&lt;p&gt;ä¹‹å‰æœ‰è´ŠåŠ©é‡‘è±è¨ˆç•«ï¼Œå…¶å¯¦æœ‰æ‹¿åˆ°å…©å¹´çš„ Business Planã€‚å¯«ä¿¡çµ¦å®¢æœä¸€å¤©å°±æ”¹å¥½è¨­å®šäº†ã€‚ä¸éŽä¹‹å¾Œå°±è¦å¤šä»˜éŒ¢å•¦ã€‚&lt;/p&gt;
&lt;h2 id="hinet"&gt;Hinet è½‰å€æœå‹™&lt;/h2&gt;
&lt;p&gt;æˆ‘æ²’æœ‰è‡ªå·±æž¶ä»»ä½• serverï¼Œæ‡¶å¾—ç¶­è­·ã€‚ä¸éŽä¹Ÿå¾ˆæ‡¶å¾—æ‰“å­—ã€‚åœ¨å…¶ä»– subdomain éƒ½æ²’ç”¨çš„æƒ…æ³ä¸‹ï¼Œæœ‰é€éŽ Hinet è¨­å®š &lt;a href="http://liang2.tw"&gt;http://liang2.tw&lt;/a&gt; æœƒå°Žå‘è‡³ &lt;a href="http://blog.liang2.tw"&gt;http://blog.liang2.tw&lt;/a&gt; å†è¢«å°Žå‘åˆ° httpsã€‚&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2016/01/blog-https/pics/cloudflare_dns_setting.png"/&gt;
  &lt;p class="caption center"&gt;CloudFlare DNS setting&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;å¤§æ¦‚æ˜¯é€™æ¨£ã€‚å¸Œæœ›èƒ½åœ¨ä¸è¦è‡ªå·±æž¶ server çš„æƒ…æ³ä¸‹ç¹¼çºŒç¶“ç‡Ÿé€™å€‹ blogã€‚&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="blog"></category><category term="pelican"></category><category term="https"></category></entry><entry><title>Overview of Genomic Data Processing in Bioconductor</title><link href="https://blog.liang2.tw/posts/2015/12/biocondutor-genomic-data/" rel="alternate"></link><published>2015-12-29T20:28:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-12-29:/posts/2015/12/biocondutor-genomic-data/</id><summary type="html">&lt;p&gt;Notes of fundamental tools and learning resources for handling genomic data in R with Bioconductor.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Sorry for the late update. In the past two months, I finished my Ph.D. applications (hope to hear good news in the next two months) and was busy preparing the PyCon Taiwan 2016. Also, a year-long website development finally came to the end.&lt;/p&gt;
&lt;p&gt;Now most things are set so I can back to writing my blog.&lt;/p&gt;
&lt;p&gt;Since September, there accumulates at least 5 drafts and I don&amp;rsquo;t know when I can finish them, so I think I have to change my writing strategy. I will first publish things as soon as information collection is done, and deeper reviews will be given in the following posts. Right now I will focus on Bioconductor (and general Bioinformatics topics) and Django.&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#bioconductor"&gt;Bioconductor&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#annotation-and-genome-reference"&gt;Annotation and Genome Reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#experiment-data-storage"&gt;Experiment Data Storage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#operations-on-genome"&gt;Operations on Genome&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#genomic-data-visualization"&gt;Genomic data visualization&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#summary"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="bioconductor"&gt;Bioconductor&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.bioconductor.org/"&gt;Bioconductor&lt;/a&gt; is indeed a rich resources for R both in terms of data and tools. And I found I have yet spent time seriously understanding the whole ecosystem, which I believe can drastically lighten the loading of daily analysis.&lt;/p&gt;
&lt;p&gt;Bioconductor&amp;rsquo;s website is informative. If you are familar with R, you should already know that in order to understand the usage of a package, one of the best way is to read its vignettes. Packages on Bioconductor generally have vignettes, which is really helpful and the website makes them accessible. On top of that, they have &lt;a href="https://www.bioconductor.org/help/course-materials/"&gt;Courses &amp;amp; Conferences&lt;/a&gt; and &lt;a href="https://www.bioconductor.org/help/workflows/"&gt;Workflows&lt;/a&gt;. The former section collects all conference materials in the past few years, which contains package hands-on, analysis tutorial, and R advanced topics. It&amp;rsquo;s a hidden gem to me since I have already found numerous materials worth reading only after a glance over it. The latter one should be well-known. It gives examples of typical analysis workflows.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;m interested in the following topics in Biocondutor:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Annotation and genome reference (OrgDb, TxDb, OrganismDb, BSgenome)&lt;/li&gt;
&lt;li&gt;Experiment data storage (ExpressionSets)&lt;/li&gt;
&lt;li&gt;Operations on genome (GenomicRanges)&lt;/li&gt;
&lt;li&gt;Genomic data visualization (Gviz, ggbio)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Keywords in Biocondutors for each topic are attached in the parens, mostly being the package name. For each topic, I&amp;rsquo;ll put the related resources I collected in the following sections.&lt;/p&gt;
&lt;p&gt;Before the listing, I found &lt;a href="http://genomicsclass.github.io/book/"&gt;PH525x series&lt;/a&gt; maintained by Rafael Irizarry and Michael Love from Harvard serves as a comprehensive entry point for almost every related topic. The site is the accompanied resources for their edX classes. Both of them worth taking a look.&lt;/p&gt;
&lt;h3 id="annotation-and-genome-reference"&gt;Annotation and Genome Reference&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://genomicsclass.github.io/book/pages/annoPhen.html"&gt;Annotating phenotypes and molecular function&lt;/a&gt; from &lt;a href="http://genomicsclass.github.io/book/"&gt;PH525x series&lt;/a&gt; gives a good overview and a taste of the powerful ecosystem Bioconductor provides.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://www.bioconductor.org/help/course-materials/2015/BioC2015/Annotation_Resources.html"&gt;Annotation Resources&lt;/a&gt; from &lt;a href="https://www.bioconductor.org/help/course-materials/2015/BioC2015/"&gt;BioC 2015&lt;/a&gt; gives more extensive introduction about all available types of references from genome sequences to transcriptome and gene info.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For example, human comes with&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://bioconductor.org/packages/release/data/annotation/html/org.Hs.eg.db.html"&gt;org.Hs.eg.db&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://bioconductor.org/packages/release/data/annotation/html/TxDb.Hsapiens.UCSC.hg38.knownGene.html"&gt;TxDb.Hsapiens.UCSC.hg38.knownGene&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://bioconductor.org/packages/release/data/annotation/html/Homo.sapiens.html"&gt;Homo.sapiens&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://bioconductor.org/packages/release/data/annotation/html/BSgenome.Hsapiens.UCSC.hg38.html"&gt;BSgenome.Hsapiens.UCSC.hg38&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="experiment-data-storage"&gt;Experiment Data Storage&lt;/h3&gt;
&lt;p&gt;ExpressionSet helps store the expression experiment data, which one can combine   expression values and phenotypes of the same sample. Additionally the experiment data (like descriptions of GEO dataset) can be attached as well.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://genomicsclass.github.io/book/pages/eset.html"&gt;The ExpressionSet container&lt;/a&gt; from &lt;a href="http://genomicsclass.github.io/book/"&gt;PH525x series&lt;/a&gt; gives an intro. It should be sufficient enough to use ExpressionSet in daily work.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://www.bioconductor.org/packages/release/bioc/vignettes/Biobase/inst/doc/ExpressionSetIntroduction.pdf"&gt;The ExpressionSet Introduction&lt;/a&gt; from its package &lt;a href="https://www.bioconductor.org/packages/release/bioc/html/Biobase.html"&gt;Biobase&lt;/a&gt;â€™s vignette gives detailed explanation.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="operations-on-genome"&gt;Operations on Genome&lt;/h3&gt;
&lt;p&gt;I haven&amp;rsquo;t gone into the details, but operations about genomic ranges are often tricky and more importantly, badly optimized.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://genomicsclass.github.io/book/pages/iranges_granges.html"&gt;IRanges and GRanges&lt;/a&gt; and &lt;a href="http://genomicsclass.github.io/book/pages/operateGRanges.html"&gt;GRanges operations&lt;/a&gt; from &lt;a href="http://genomicsclass.github.io/book/"&gt;PH525x series&lt;/a&gt; give the overview of using the package &lt;a href="https://bioconductor.org/packages/release/bioc/html/GenomicRanges.html"&gt;GenomicRanges&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://www.bioconductor.org/packages/release/bioc/vignettes/GenomicRanges/inst/doc/GenomicRangesIntroduction.pdf"&gt;An Introduction to Genomic Ranges Classes&lt;/a&gt;, a &lt;a href="https://bioconductor.org/packages/release/bioc/html/GenomicRanges.html"&gt;GenomicRanges&lt;/a&gt; vignette, gives a detailed view.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Also, their paper, &lt;a href="http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1003118"&gt;&amp;ldquo;Software for Computing and Annotating Genomic Ranges&amp;rdquo;, &lt;em&gt;PLOS One&lt;/em&gt;&lt;/a&gt; should be another overview source of the package.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://cran.r-project.org/web/packages/data.table/index.html"&gt;data.table&lt;/a&gt;&amp;lsquo;s &lt;code&gt;foverlap&lt;/code&gt; function worth the comparison, since I already use it and I know it is &lt;a href="https://github.com/Rdatatable/data.table/wiki/talks/EARL2014_OverlapRangeJoin_Arun.pdf"&gt;blazingly fast&lt;/a&gt;. &lt;code&gt;foverlap&lt;/code&gt; handles the overlapping of integer ranges so it can be applied to genomic operation. Its code is quite complex so its mechanism is still a myth to me. I&amp;rsquo;d like to see its comparison with using database like SQLite.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="genomic-data-visualization"&gt;Genomic data visualization&lt;/h3&gt;
&lt;p&gt;Basically I can find two packages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://bioconductor.org/packages/release/bioc/html/Gviz.html"&gt;Gviz&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://bioconductor.org/packages/release/bioc/html/ggbio.html"&gt;ggbio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Don&amp;rsquo;t know their difference yet. Both of them can produce well-done figures. But I think I have some experience with ggbio, which was a bit tricky to use. So for now I will go for Gviz.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.bioconductor.org/help/course-materials/2012/BiocEurope2012/GvizEuropeanBioc2012.pdf"&gt;Visualizing genomic features with the Gviz package&lt;/a&gt; given at Bioc Europe 2012 has a decent introduction about Gviz.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://bioconductor.org/packages/release/bioc/vignettes/Gviz/inst/doc/Gviz.pdf"&gt;The Gviz User Guide&lt;/a&gt; looks very comprehensive, which also cover usage with expression and alignment results.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="summary"&gt;Summary&lt;/h2&gt;
&lt;p&gt;These resources should be enough for weeks of trying. It&amp;rsquo;s excited to find so many useful tools.&lt;/p&gt;
&lt;p&gt;So, good luck to me for my Ph.D. application, PyCon Taiwan 2016, and a shorter blog posting frequency.&lt;/p&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="r"></category><category term="bioconductor"></category></entry><entry><title>Customize Django User Model</title><link href="https://blog.liang2.tw/posts/2015/11/django-custom-user/" rel="alternate"></link><published>2015-11-04T18:23:00-06:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-11-04:/posts/2015/11/django-custom-user/</id><summary type="html">&lt;p&gt;Django å¸³è™Ÿçš„æ¬„ä½å®šç¾©åœ¨ &lt;code&gt;django.contrib.auth&lt;/code&gt; çš„ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/contrib/auth/#fields"&gt;User&lt;/a&gt; ä¸­ï¼Œå°ä½¿ç”¨è€…è€Œè¨€åŒ…å«äº†ï¼šusername*ã€first_nameã€last_nameã€emailã€password*ã€‚åŒæ™‚å°é–‹ç™¼è€…ä¾†èªªï¼Œé‚„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‡å®š Group å’Œ Permission&lt;/li&gt;
&lt;li&gt;æ˜¯å¦ç‚º staffã€superuser&lt;/li&gt;
&lt;li&gt;å¸³ â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Django å¸³è™Ÿçš„æ¬„ä½å®šç¾©åœ¨ &lt;code&gt;django.contrib.auth&lt;/code&gt; çš„ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/contrib/auth/#fields"&gt;User&lt;/a&gt; ä¸­ï¼Œå°ä½¿ç”¨è€…è€Œè¨€åŒ…å«äº†ï¼šusername*ã€first_nameã€last_nameã€emailã€password*ã€‚åŒæ™‚å°é–‹ç™¼è€…ä¾†èªªï¼Œé‚„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‡å®š Group å’Œ Permission&lt;/li&gt;
&lt;li&gt;æ˜¯å¦ç‚º staffã€superuser&lt;/li&gt;
&lt;li&gt;å¸³è™Ÿé–‹é€šã€æœ€å¾Œä¸€æ¬¡ç™»å…¥æ™‚é–“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…§å»ºçš„å¸³è™ŸåŠŸèƒ½æ‡‰è©²å¾ˆå¯¦ç”¨ï¼Œå®‰å…¨æ€§ä¹Ÿå¾ˆå¥½ã€‚æ‰€ä»¥ä¸€èˆ¬ä¾†èªªéƒ½ä¸æœƒåŽ»æ”¹å®ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœåªæ˜¯æƒ³è¦å¹« User åŠ å€‹ profileï¼Œä¾‹å¦‚ç”Ÿæ—¥ã€ä¾†è‡ªå“ªå€‹æ˜Ÿçƒç­‰æ¬„ä½ï¼Œä¹Ÿä¸éœ€è¦æ”¹å¯« Userã€‚åƒè€ƒå®˜ç¶² &lt;a href="https://docs.djangoproject.com/en/1.8/topics/auth/customizing/#extending-the-existing-user-model"&gt;Extending the existing User model&lt;/a&gt;ï¼Œåªéœ€è¦å»ºä¸€å€‹ one-to-one relationship æŒ‡åˆ° User å°±å¥½äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UserProfile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;OneToOneField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AUTH_USER_MODEL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;birth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DateField&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;orig_planet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½† Django é è¨­ç”¨ username ä¾†ç™»å…¥ï¼Œå¦‚æžœè¦æ”¹ç”¨ email ç™»å…¥è¦æ€Žéº¼åšï¼Ÿ&lt;/p&gt;
&lt;h3 id="email"&gt;æ”¹ç”¨ Email åšå¸³è™Ÿç™»å…¥&lt;/h3&gt;
&lt;p&gt;å› ç‚º User æ˜¯å€‹å¾ˆé‡è¦çš„ modelï¼Œæ‰€ä»¥æ”¹å¯«æ™‚è¦æ³¨æ„ç›¸å®¹æ€§çš„å•é¡Œã€‚å…¶å¯¦å®˜ç¶²ä¹Ÿæœ‰æ•™å­¸ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/auth/customizing/#specifying-a-custom-user-model"&gt;Specifying a custom User model&lt;/a&gt;ï¼Œä¸éŽé€™æ•™å­¸æ¯”å‰é¢é•·å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;ç¶²è·¯ä¸Šå·²ç¶“æœ‰äºº @jcugat åšäº†ä¸€å€‹å¥—ä»¶ &lt;a href="https://github.com/jcugat/django-custom-user"&gt;django-custom-user&lt;/a&gt;ï¼Œä»–å¯¦ä½œäº† &lt;code&gt;EmailUser&lt;/code&gt; å³ç”¨ email ä½œç‚ºå¸³è™Ÿç™»å…¥ã€‚å·²ç¶“æŠŠæ‰€æœ‰è‹¦å·¥éƒ½åšå¥½äº†ï¼Œæ‰€ä»¥å¦‚æžœæƒ³è¦å†åŠ ä¸Šè‡ªå·±çš„æ¬„ä½ç­‰ç­‰ï¼Œå¯ä»¥ç¹¼æ‰¿ä»–çš„ &lt;code&gt;AbstractEmailUser&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å¯¦å¦‚æžœçœ‹å®Œè‡ªå®š User ä¹‹å¾Œï¼Œå¯«å¥½ User Model ä¸é›£ï¼Œæ¯”è¼ƒè¤‡é›œçš„æ˜¯åƒå‰µå»ºã€ä¿®æ”¹ User ä»¥åŠ admin çš„è¨­å®šã€‚é™¤äº†è®€é€™å€‹å¥—ä»¶çš„ source code ä¹‹å¾Œï¼Œ&lt;a href="http://stackoverflow.com/questions/15012235"&gt;é€™ä¸² Stack Overflow è¨Žè«–&lt;/a&gt;ä¹Ÿæåˆ°äº†ä¸åŒçš„å¯¦ä½œæ–¹å¼ã€‚Django é€™éƒ¨ä»½çš„ source code è »å¥½è®€çš„ï¼Œä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å› ç‚ºä¹‹å¾Œè¦åš Email èªè¨¼ï¼Œæ‡‰è©²æœƒç”¨ &lt;a href="https://github.com/pennersr/django-allauth"&gt;django-allauth&lt;/a&gt; åšã€‚æ„Ÿè¦ºå¾ˆä¹…æ²’ç™¼æ–‡äº†ï¼Œæ‡‰è©²è¦æŠŠæ–‡ç« æ‹†çŸ­æ‰å° XD&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="django"></category><category term="python"></category></entry><entry><title>æ•¸ä½æ™‚ä»£çš„ç”Ÿæ°£</title><link href="https://blog.liang2.tw/posts/2015/10/digital-anger/" rel="alternate"></link><published>2015-10-10T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-10-10:/posts/2015/10/digital-anger/</id><summary type="html">&lt;p&gt;åœ¨æ•¸ä½æ™‚ä»£ï¼Œå¾ˆç”¨åŠ›åœ°çš„ç”Ÿæ°£æ˜¯ä»¶å¾ˆå›°é›£çš„äº‹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæºé€šåª’ä»‹å°±ä¸å¤ªé¼“å‹µé€™ç¨®äº‹ã€‚æƒ³è¦åœ¨ FB ä¸Šæ”¾åœ°åœ–ç ²ç‹‚è­™ä¸€ä»¶äº‹ï¼Œä½† FB æœƒ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åœ¨æ•¸ä½æ™‚ä»£ï¼Œå¾ˆç”¨åŠ›åœ°çš„ç”Ÿæ°£æ˜¯ä»¶å¾ˆå›°é›£çš„äº‹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæºé€šåª’ä»‹å°±ä¸å¤ªé¼“å‹µé€™ç¨®äº‹ã€‚æƒ³è¦åœ¨ FB ä¸Šæ”¾åœ°åœ–ç ²ç‹‚è­™ä¸€ä»¶äº‹ï¼Œä½† FB æœƒå› ç‚ºå¤ªæ¿€çƒˆçš„ç™¼è¨€ï¼Œæ‰€ä»¥çœŸæ­£çœ‹åˆ°çš„äººå…¶å¯¦ä¸å¤šï¼Œæˆ–è€…åªæœƒæŽ¨æ’­åˆ°æ“æœ‰ç›¸åŒåå¥½çš„é‚£ç¾¤äººï¼Œå¥½åƒé”ä¸åˆ°ã€Œè­™äººã€çš„ç›®æ¨™ã€‚å…¶å¯¦çµ•å¤§å¤šæ•¸çš„ç¤¾ç¾¤ç¶²ç«™æˆ–å¤šæˆ–å°‘éƒ½æœ‰é€™ç¨®ã€Œå–æš–çš„åŠŸèƒ½ã€ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†ï¼Œæ’‡é–‹ç”Ÿæ°£çš„å°è±¡ï¼Œä¸è«–æ˜¯ä¸€å€‹ç¾¤é«”ï¼Œæˆ–è€…æ˜¯ç§ä¸‹çš„å¹¾å€‹äººä¹‹é–“ï¼Œæ•¸ä½æ™‚ä»£çš„ç”Ÿæ°£é‚„æ˜¯å¾ˆä¸ä¸€æ¨£çš„ã€‚å…ˆå¾žä¸€èˆ¬çš„æƒ…ç·’è¡¨é”èªªèµ·å§ï¼Œæ•¸ä½æ™‚ä»£çš„å·¥å…·å€‘ï¼Œå¤§å¹…åœ°åŠ å¼·æŠ’ç™¼è‡ªå·±æ—¥å¸¸çš„æƒ…ç·’çš„è¡¨ç¾åŠ›ã€‚å¾žå‚³çµ±æ–‡æ›¸å¤šå°‘èƒ½ä½¿ç”¨çš„é¡æ–‡å­—ï¼Œåˆ°è¡¨æƒ…ç¬¦è™Ÿï¼Œåˆ°è²¼åœ–ã€æœƒå‹•çš„è²¼åœ–ï¼Œäººå€‘è¶Šä¾†è¶Šæœ‰è¾¦æ³•æŠŠæ—¥å¸¸ä¸­å†å°çš„æƒ…ç·’æ³¢å‹•ï¼Œç”¨å¾ˆèª‡å¼µçš„æ–¹å¼è¡¨ç¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œç™¼ç¾åžƒåœ¾è»Šä»Šå¤©æ—©ä¾†çš„ååˆ†é˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»Šå¤©åžƒåœ¾è»Šç«Ÿç„¶æ—©ä¾†ååˆ†é˜ï¼ˆæ€’ï¼‰&lt;/li&gt;
&lt;li&gt;ä»Šå¤©åžƒåœ¾è»Šç«Ÿç„¶æ—©ä¾†ååˆ†é˜ Î£(Â°Ð”Â°;&lt;/li&gt;
&lt;li&gt;ä»Šå¤©åžƒåœ¾è»Šç«Ÿç„¶æ—©ä¾†ååˆ†é˜ !!!!!!!!ï¼ˆé™„ä¸ŠæŠ±é ­ç—›å“­çš„å‹•åœ–ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½†å¾ˆæ¥µç«¯çš„è² é¢æƒ…ç·’å‘¢ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»Šå¤©é†’ä¾†ç™¼ç¾ç¸½çµ±è·Ÿåœ‹æœƒæœ€å¤§é»¨ï¼Œéƒ½é‚„æ˜¯åœ‹æ°‘é»¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€™æ¨£åƒ…é™³è¿°äº†äº‹å¯¦ï¼Œä½†æ²’æœ‰è¡¨é”å‡ºè‡ªå·±å¿ƒä¸­çš„æ†¤æ€’ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¹¾çžªè‘—çœ¼èººåœ¨åºŠä¸Šæœªèƒ½èµ·èº«ï¼Œå’¬è‘—ç‰™æ†¤æ¨åœ°å‘å¤©èŠ±æ¿ç©ºæ®æ‹³é ­ï¼Œé›™æ‰‹äº¤æ›¿è‘—ç›´åˆ°æ‰‹è‡‚ä¹Ÿå¤±åŽ»äº†åŠ›é‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;â€¦â€¦å¹²æˆ‘å±äº‹ï¼Œè€Œä¸”å‹•ä½œå¤ªé•·äº†åƒåœ¨å¯«å°èªªï¼Œå¯èƒ½ä¹Ÿè¶…éŽä¸€äº›åª’é«”çš„å­—æ•¸é™åˆ¶ã€‚é¡æ–‡å­—å¥½åƒä¹Ÿä¸ç—›ä¸ç™¢ï¼Œç”¨&lt;code&gt;ï¼ˆâ•¯â€µâ–¡â€²ï¼‰â•¯ï¸µâ”´â”€â”´&lt;/code&gt; ï¼ˆç¿»æ¡Œï¼‰è¡¨é”é€™æ¨£çš„æƒ…ç·’ï¼Ÿåªæœƒæ„Ÿè¦ºå¾ˆã€Œä¸æ­£å¼ã€é —å…·æˆ²è¬”ä¹‹æ„ï¼Œä½†çœŸæ­£æ†¤æ€’çš„äººæ˜¯ä¸æœƒé–‹çŽ©ç¬‘çš„ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³äº†æƒ³ï¼Œå¥½åƒé‚„æ˜¯åªèƒ½å›žæ­¸åˆ°å‚³çµ±ç•«ä¿¡æ™‚ä»£çš„æ–¹å¼ï¼Œå¤–åŠ å¯¦é«”çš„å‹•ä½œã€‚åƒæ˜¯å¤±è¯ï¼Œè§£é™¤æœ‹å‹ï¼ŒUnfollowï¼Œæˆ–è€…æ”¹ç”¨æ›´æ¿€é€²çš„æ‰‹æ®µèˆ‡è©žå½™ï¼Œé«’è©±å°±å¾ˆæœ‰æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;ä½†é€™æ¨£çš„æŽ¨è«–è®“æˆ‘å¾ˆå¥½å¥‡ï¼Œä»¥å‰çš„äººæ˜¯æ€Žéº¼è·Ÿåˆ¥äººåµæž¶çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å¯¦è®“æˆ‘è§€å¯Ÿåˆ°ç”Ÿæ°£åœ¨ä¸åŒåª’ä»‹çš„è¡¨é”ï¼Œä¸¦ä¸æ˜¯ç·£æ–¼å‰è¿°ç‹€æ³ã€‚é€™èµ·æºæ–¼ä¸€æ¬¡æˆ‘åœ¨çœ‹è€äººå®¶ç”¨ FB è¨Šæ¯åµæž¶ã€‚ä¾‹å¦‚å¹´è¼•äººå¤±ç´„äº†ï¼Œè€äººå°±æœƒå¾ˆç”Ÿæ°£çš„æ‹¿å‡ºâ€¦â€¦æ‰‹æ©Ÿæ•²é‚£å€‹äººï¼Œæˆ‘çŒœä»–æƒ³èªªçš„æ˜¯&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…¨éƒ¨äººéƒ½åœ¨ç­‰ä½ ä¸€å€‹äº†ï¼â€¦ï¼ˆä¸‹ç•¥äº”åå­—æ°£è©±ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½†æœ€å¾Œé€å‡ºçš„è¨Šæ¯æ˜¯&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ç­‰ä½  æ©&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå¤ªæº«æŸ”äº†ã€‚åŽŸå› å¾ˆç°¡å–®ï¼Œè€äººå¾ˆé›£é€£çºŒæ‰“è¶…éŽåå€‹æ­£ç¢ºå­—ï¼Œåœ¨çˆ†æ€’çš„ç‹€æ…‹ï¼Œèƒ½éœéœåœ°ï¼ˆæ‰‹å¯«ï¼‰é¸å­—äº”å€‹å­—å°±äº†ä¸èµ·äº†ï¼Œé‚£å€‹ã€Œæ©ã€ä¹Ÿåªæ˜¯ä¸å°å¿ƒæŒ‰åˆ°ã€‚æ‰€ä»¥å°±æœƒçœ‹åˆ°ä¸€å€‹äººå˜´å·´ä¸Šå¾ˆç”Ÿæ°£çš„éœ¹é‚å•ªå•¦è¿¸å‡ºä¸€å †å­—å¥ï¼Œä½†æ‰‹æ©Ÿä¸Šæ‰“çš„ã€å‚³éŽåŽ»çš„å»æ²’ä»€éº¼ã€‚&lt;/p&gt;
&lt;p&gt;æ„å¤–åœ°æ˜¯ï¼Œé€™æ¨£çš„åª’ä»‹åè€Œå……ç•¶ä¸€å€‹ä¸éŒ¯çš„æƒ…ç·’ç·©è¡ï¼Œå°è€äººå€‘ä¾†èªªã€‚æœ¬ä¾†å¾ˆæ°£çš„ï¼Œåœ¨é€å‡ºè¨Šæ¯ï¼Œå¦ä¸€ç«¯å›žè¦†ä¹‹å¾Œï¼Œä¸çŸ¥æ€Žéº¼åœ°å°±å¹³å¾©äº†è¨±å¤šã€‚&lt;/p&gt;
&lt;p&gt;é‚£å¹´è¼•äººå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é‚„æ²’æœ‰è¶³å¤ çš„è§€å¯Ÿè¨˜éŒ„ï¼ˆå¤§å®¶ä¹Ÿä¸è¦é€™æ¨£æˆ°æˆ‘ &amp;gt; &amp;lt;ï¼‰ä½†æˆ‘æƒ³ï¼Œæ˜Žå¹´å¤§å®¶éƒ½æŠ•æŸ±æŸ±å§å°±èƒ½æ”¶é›†è¶³å¤ çš„æ¨£æœ¬äº†ï¼ˆç¬‘ï¼‰&lt;/p&gt;
&lt;p&gt;EDIT 2015-10-10: å¯èƒ½é‚„æ²’æ©ŸæœƒæŠ•æŸ±æŸ±å§å‘¢ã€‚ä¸–å±€æ”¹è®Šå¾—å¤ªå¿«ã€‚&lt;/p&gt;
&lt;p&gt;/&lt;/p&gt;
&lt;p&gt;é¡Œç›®æ˜¯åœ¨æ—…ç¨‹ä¸­æƒ³åˆ°çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€é–‹å§‹æ˜¯æƒ³åˆ°ä¸­æ–‡çš„ã€Œæ•¸ä½æ™‚ä»£çš„ç”Ÿæ°£ã€ï¼Œä½†ç¸½è¦ºå¾—ä¸å¤ å¸¥æ°£ï¼Œæ”¹å–äº†å€‹ dichotomized affectionï¼Œdicho- æ˜¯å€‹åœ¨å¯«è«–æ–‡å­¸åˆ°çš„è©žï¼Œå…¶å¯¦è·Ÿ binarize æ˜¯å·®ä¸å¤šçš„æ¦‚å¿µï¼Œä½†æƒ³äº†æƒ³ï¼Œé€™ç¯‡è¦è¬›çš„ä¹Ÿä¸æ˜¯åœ¨æƒ…æ„Ÿå–®ä½è£¡æ‰¾å€‹ threshold åŽ»å€åˆ† 0/1ï¼Œå†æ”¹æˆäº† polarized affectionï¼Œä½†æƒ³äº†æƒ³ï¼Œé€™å€‹æƒ…å¢ƒæ‡‰è©²æ¯”è¼ƒåƒç„¡æ³•åŽŸåŽŸæœ¬æœ¬åœ°è¢«å‚³è¼¸è¨Šè™Ÿï¼Œæ‡‰è©²æ˜¯å€‹ low-pass filterâ€¦â€¦æ˜¯èªªæˆ‘åœ¨å¹¹éº»ï¼Œä¸­æ–‡æ›–æ˜§åœ°ä¹¾è„†ï¼Œé€™æ¨£å°±å¥½äº† :P&lt;/p&gt;
&lt;p&gt;/&lt;/p&gt;
&lt;p&gt;é€™æ˜¯ç¯‡èˆŠæ–‡ï¼Œå¯«æ–¼ 2015-08-26ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©çœ‹åˆ° Facebook è¦æŽ¨æ–°æ›´å¤šæ¨£çš„è¡¨æƒ…ç¬¦è™Ÿï¼Œè€Œä¸å†åªæ˜¯è®šã€‚æ–¼æ˜¯å°±æƒ³èµ·äº†å®ƒã€‚ä¹Ÿé †ä¾¿çœ‹çœ‹éƒ¨è½æ ¼è²¼é€™ç¨®æ–‡ç« æœƒæœ‰ä»€éº¼å›žéŸ¿ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Today, Facebook is taking the wraps off what form the new Like may take. It is rolling out â€œReactions,â€ a new set of six emoji that will sit alongside the original thumbs-up to let users quickly respond with love, laughter, happiness, shock, sadness and anger.
(Source: &lt;a href="http://techcrunch.com/2015/10/08/with-reactions-facebook-supercharges-the-like-button-with-6-empathetic-emoji"&gt;TechCrunch&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;/&lt;/p&gt;
&lt;p&gt;é‚£æ™‚å€™æœ‰äººå›žè¦†èªªæ‡‰è©²è¦è€ƒæ…®é«’è©±çš„å½¢æ³ã€‚&lt;/p&gt;
&lt;p&gt;é«’è©±æ‡‰è©²å°±æ˜¯æœ€æœ‰æ•ˆå‚³é”æƒ…ç·’çš„ç”¨è©žäº†ï¼Œä½†æˆ‘åª½æœ‰æ•™æˆ‘ä¸èƒ½è¬›é«’è©±ï¼Œæ‰€ä»¥ä¸åœ¨è€ƒæ…®ç¯„åœå…§ xd&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼ˆå‡è¨­ï¼‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ˜Žæ˜Žèªªä»Šå¹´å¯ä»¥ç•¢æ¥­ï¼Œçµæžœè€é—†ä¸è‚¯ç°½é›¢æ ¡å–®ï¼Œå¹¹&lt;/li&gt;
&lt;li&gt;åŽ»ä½ çš„æ˜Žæ˜Žèªªä»Šå¹´å¯ä»¥é›¢é–‹é€™ä»–Xçš„é¬¼åœ°æ–¹ï¼Œçµæžœé‚£å€‹æ­»è€é ­ä¸è‚¯ç°½é›¢æ ¡å–®ï¼Œå¹¹é€™ä»€éº¼å±Žæƒ…æ³&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘è¦ºå¾—é‚„æ˜¯æ²’æœ‰æ¯”è¡¨æƒ…ç¬¦è™Ÿä¾†å¾—æœ‰æ•ˆï¼Œæˆ–è€…èªªï¼Œæƒ…ç·’å¯†åº¦ä¸å¤ é«˜ï¼Œè€Œä¸”æƒ³è¦é”åˆ°æ›´æ·±çš„å¹¹æ„(?)ï¼Œå¸¸è¦‹å°±å¤šåŠ å¹¾å€‹é«’è©±ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä¸ç¢ºå®šå¤§å®¶å¹³å¸¸æ€Žéº¼é–±è®€çš„ï¼Œé™¤äº†å¾ˆå¤šåŒ¿åè¨Žè«–å€å¤–ï¼Œç¶²è·¯ä¸Šå¤§å®¶ä¹Ÿä¸ç”¨æŒ‡è‘—å°æ–¹é¼»å­è¬›ï¼Œè©±è¬›èµ·ä¾†éƒ½æ²’ä»€é¡§å¿Œï¼Œé€™äº›çœ‹ä¹…ä¹‹äº†å¾Œï¼Œå°é€™ç¨®ç”¨è©žæœƒè‡ªå‹•æ¿¾æŽ‰ï¼Œä¸ç„¶å°±æ˜¯å¾ˆé›£çŸ¥é“å°æ–¹åˆ°åº•æœ‰å¤šç”Ÿæ°£ã€‚&lt;/p&gt;
&lt;p&gt;å°æˆ‘ä¾†èªªï¼Œæ”¹è®Šå°æŸäººçš„èªçŸ¥é æ¯”èµ·ä»–ä½¿ç”¨çš„é«’è©±ä¾†å¾—éœ‡æ’¼ã€‚ã€Œå“‡åŽŸä¾†é€™å€‹äººç”Ÿæ°£èµ·ä¾†é€™éº¼å¯æ€•ï¼ˆç­†è¨˜ï¼‰ã€ï¼Œå¥½åƒæ˜¯è·¨éŽçµ•å°ä¸èƒ½è·¨éŽçš„ç´…ç·šã€‚ä½†é€™è®Šæˆæ˜¯è¨Žè«–ã€Œæ•¸ä½æ™‚ä»£çš„åº•ç·šã€æˆ–ã€Œæ•¸ä½æ™‚ä»£çš„å½¢è±¡ã€äº†ï¼Œé è¶…éŽæˆ‘ç›®å‰æ€è€ƒç¯„ç–‡å•Šã€‚&lt;/p&gt;</content><category term="misc"></category><category term="zh"></category></entry><entry><title>ç”¨ Django èˆ‡ SQLite æž¶æŠ½ç±¤ç¶²ç«™</title><link href="https://blog.liang2.tw/posts/2015/10/django-draw-member/" rel="alternate"></link><published>2015-10-04T14:55:00-05:00</published><updated>2022-05-13T13:06:42-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-10-04:/posts/2015/10/django-draw-member/</id><summary type="html">&lt;p&gt;æŠŠä¹‹å‰ç”¨ Flask æž¶çš„æŠ½ç±¤ç¶²ç«™æ”¹ç”¨ Django å¯¦ä½œï¼Œä¹Ÿè—‰é€™å€‹æ©Ÿæœƒæ¯”è¼ƒä¸€ä¸‹å…©å€‹ Framework è¨­è¨ˆæ¦‚å¿µçš„ä¸åŒã€‚&lt;/p&gt;</summary><content type="html">&lt;h4 id="_1"&gt;å‰æƒ…æè¦&lt;/h4&gt;
&lt;p&gt;æˆ‘æŠŠ LoveLive! å…©å­£çœ‹å®Œäº†ï¼Î¼&amp;rsquo;s åœ¨ç¬¬ä¸€å­£çš„æˆé•·å……æ»¿æ„Ÿå‹•å•Šã€‚&lt;strong&gt;\çœŸå§«æœ€é«˜/&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€¦â€¦å‘ƒå¥½å•¦ï¼Œä¹‹å‰è¬›äº†&lt;a href="../../09/flask-draw-member"&gt;ç”¨ Flask åŽ»æž¶ä¸€å€‹æŠ½ç±¤ç¶²ç«™&lt;/a&gt;ã€‚ä¸éŽæˆ‘å€‘æœ€çµ‚çš„ç›®æ¨™æ˜¯ç”¨ Django å˜›ï¼Œæ‰€ä»¥æŽ¥ä¸‹ä¾†å°±è¦æ”¹å¯«ã€‚ä¹Ÿè—‰é€™å€‹æ©Ÿæœƒæ¯”è¼ƒä¸€ä¸‹å…©å€‹ Framework è¨­è¨ˆæ¦‚å¿µçš„ä¸åŒï¼ˆ&lt;del&gt;ä¾‹å¦‚ Django ä¸€é–‹å§‹å¯«æœ‰å¤šå†—&lt;/del&gt;ã€&lt;del&gt;Flask å¯«åˆ°æœ€å¾Œæœ‰å¤šå†—&lt;/del&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="from-flask-to-django"&gt;From Flask to Django&lt;/h3&gt;
&lt;p&gt;ç‚ºäº†è½‰æ›ä½†åˆä¸è¦ä¸€ä¸‹å­æŠŠæ‰€æœ‰ Django çš„åŠŸèƒ½éƒ½æ”¾é€²ä¾†ï¼Œä¸­é–“éŽç¨‹æœ‰å¾ˆå¤šã€Œä¸å¸¸è¦‹çš„å¯«æ³•ã€ã€‚æƒ³è¦ç›´æŽ¥å¯« Django best practice çš„è©±ï¼Œå¯ä»¥åƒè€ƒ TP å¤§å¤§çš„&lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers"&gt;ã€Šç‚ºç¨‹å¼äººå¯«çš„ Django Tutorial ã€‹&lt;/a&gt;ï¼Œä»–çš„è¦åŠƒæ˜¯ 30 å€‹å–®å…ƒåšä¸€å€‹è¨‚é¤ç³»çµ±ã€‚&lt;/p&gt;
&lt;p&gt;éŽç¨‹ä¸­æœƒç”¨åˆ°å¾ˆå¤š Django APIï¼Œæ²’æœ‰è§£é‡‹çš„è©±å¯ä»¥åˆ°&lt;a href="https://docs.djangoproject.com/en/1.8/"&gt;å®˜ç¶²&lt;/a&gt;åŽ»æŸ¥ä½¿ç”¨ã€‚å¦å¤–æˆ‘ç™¼ç¾å¦‚æžœèƒ½ç”¨ debugger åŽ» trace Django åŸ·è¡Œçš„æµç¨‹èƒ½å¹«åŠ©ç†è§£ï¼Œæƒ³è¦ä¸€å€‹ç²¾ç¾Žçš„ debugger çš„è©±å¯ä»¥è£åƒ PyCharm çš„ IDEã€‚&lt;/p&gt;
&lt;p&gt;æ•´é«”çš„è¦åŠƒæœƒæ¼¸è¿‘æŠŠ Django çš„åŠŸèƒ½åŠ é€²ä¾†ï¼Œä¾åºæ‡‰è©²æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Django View, Template&lt;/li&gt;
&lt;li&gt;Django Model, ORM&lt;/li&gt;
&lt;li&gt;Django Form&lt;/li&gt;
&lt;li&gt;(Django Admin æ²’æœ‰ç”¨åˆ°)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æžœçœ‹ &lt;a href="https://docs.djangoproject.com/en/1.8/"&gt;Django doc&lt;/a&gt; é¦–é çš„è©±ï¼Œä¹Ÿæ˜¯åˆ†é€™å¹¾å€‹éƒ¨ä»½ï¼Œé›–ç„¶é€™ç¯‡æ–‡ç« ä¸¦ä¸æœƒæŠŠæ‰€æœ‰æ¦‚å¿µéƒ½ä»‹ç´¹ä¸€éã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œåœ¨æ”¹å¯«çš„æ™‚å€™æœƒè·³éŽç”¨ raw SQLï¼Œå› ç‚ºå®Œå…¨ä¸ç”¨ ORM æœ‰é»žé›£éŠœæŽ¥å…¶ä»– Django éƒ¨ä»½ã€‚æœ‰èˆˆè¶£çš„è©±åœ¨è¬›å®Œ Model ä¹‹å¾Œå¯ä»¥åƒè€ƒ Detailsã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;å‰æƒ…æè¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#from-flask-to-django"&gt;From Flask to Django&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django"&gt;Django åˆå§‹è¨­å®š&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#django-server"&gt;Django server&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-app"&gt;ç¬¬ä¸€å€‹ Django app&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-settings"&gt;Django settings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#database-migration"&gt;Database Migration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#url-dispatcher"&gt;URL dispatcher&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-model-and-orm"&gt;Django Model and ORM&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#migration-the-tracker-of-model-changes"&gt;Migration the tracker of model changes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#orm-queries-in-shell"&gt;ORM queries in shell&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#data-in-orm-and-fixtures"&gt;Data in ORM and fixtures&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-template"&gt;Django Template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#more-on-djangos-model-template-and-view-mtv"&gt;More on Django&amp;rsquo;s model, template and view (MTV)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django-form"&gt;Django Form&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#more-django-form-in-view"&gt;More Django form in view&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#details"&gt;Details&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#raw-sql"&gt;Raw SQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#better-queryset"&gt;Better QuerySet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#timezone"&gt;Timezone&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#post-form-and-csrf"&gt;POST form and CSRF&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="django"&gt;Django åˆå§‹è¨­å®š&lt;/h3&gt;
&lt;p&gt;ä¸€æ¨£é–‹ä¸€å€‹ Python è™›æ“¬ç’°å¢ƒï¼ˆé€™æ™‚å€™å°±æ˜¯å®ƒçš„å¥½è™•äº†ï¼Œèƒ½æŠŠä¸åŒå°ˆæ¡ˆçš„å¥—ä»¶éš”é›¢ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip install django pytz ipython pyyaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="http://pythonhosted.org/pytz/"&gt;pytz&lt;/a&gt; åœ¨&lt;a href="../../09/datetime-sqlite"&gt;å‰ä¸€ç¯‡&lt;/a&gt;å·²ç¶“ä»‹ç´¹éŽï¼Œæ˜¯è™•ç†æ™‚å€çš„å¥—ä»¶ã€‚&lt;a href="http://ipython.org/"&gt;IPython&lt;/a&gt; å…¨åæ˜¯ Interactive Pythonï¼ŒåŒæ¨£æ˜¯ Python shell ä½†æä¾›äº†å¾ˆå¤šé™„åŠ åŠŸèƒ½ï¼Œæœ€å¸¸ç”¨çš„æ‡‰è©²æ˜¯è‡ªå‹•è£œå®Œã€‚&lt;a href="http://pyyaml.org/"&gt;PyYAML&lt;/a&gt; ç”¨ä¾†è™•ç† YAML ç‰©ä»¶ï¼Œå¯è£å¯ä¸è£ï¼Œä¸è£ä¹‹å¾Œçš„ä¾‹å­å°±ç”¨ JSON å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘çš„å°ˆæ¡ˆæ ¹ç›®éŒ„æ˜¯ &lt;code&gt;demo_django_draw_member&lt;/code&gt;ã€‚å› ç‚º Django çš„è¨­å®šå¾ˆå¤šï¼Œå…ˆåœ¨é€™ç›®éŒ„ä¸‹ç”¨ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/contrib/admin/"&gt;django-admin&lt;/a&gt; æŠŠåŸºæœ¬çš„æž¶æ§‹å»ºèµ·ä¾†ã€‚æˆ‘å€‘å»ºäº†ä¸€å€‹åç‚º &lt;code&gt;draw_site&lt;/code&gt; çš„å°ˆæ¡ˆï¼ˆProjectï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ django-admin startproject draw_site
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŸ·è¡Œå®Œä¹‹å¾Œæ‡‰è©²æœƒå¤šå‡ºä¸€å †æª”æ¡ˆï¼Œçµæ§‹å¦‚ä¸‹ã€‚æ³¨æ„åˆ°æœ‰å…©å±¤ &lt;code&gt;draw_site&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;demo_django_draw_member/
â””â”€â”€ draw_site/
    â”œâ”€â”€ draw_site/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ settings.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ wsgi.py
    â””â”€â”€ manage.py*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹‹å¾Œå·¥ä½œçš„ç›®éŒ„å…¶å¯¦æ˜¯ &lt;code&gt;demo_django_draw_member/draw_site/&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯æœ‰ &lt;code&gt;manage.py&lt;/code&gt; çš„é‚£å±¤ç›®éŒ„ï¼Œä¹‹å¾Œçš„è·¯å¾‘éƒ½æ˜¯ç›¸å°æ–¼ &lt;code&gt;demo_django_draw_member/draw_site/&lt;/code&gt;ã€‚ä»‹ç´¹ä¸€ä¸‹æ¯å€‹æª”æ¡ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;manage.py&lt;/code&gt; ä¹‹å¾Œå°±æœƒå–ä»£ django-admin çš„åŠŸèƒ½ã€‚å…©è€…æœ€å¤§çš„å·®åˆ¥æ˜¯ manage.py çŸ¥é“ project çš„è¨­å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;draw_site/settings.py&lt;/code&gt; è£¡é¢å­˜è‘— Django çš„å„ç¨®è¨­å®šï¼Œåƒ secret keyã€databaseã€template engineã€app ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;draw_site/urls.py&lt;/code&gt; è£¡é¢å­˜è‘— URL dispatching è¨­å®šï¼Œå³å“ªå€‹è·¯å¾‘è¦ç”¨å“ªå€‹ function åŽ»è™•ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;draw_site/wsgi.py&lt;/code&gt; &lt;a href="http://wsgi.org/"&gt;WSGI&lt;/a&gt; æ˜¯è¦ç¯„ Python web server çš„æ¨™æº–ï¼Œé€šå¸¸ä¸æœƒå‹•é€™å€‹æª”æ¡ˆå°±ä¸ç´°æã€‚Flaskã€Django éƒ½æ˜¯ç›¸å®¹ WSGI çš„å¯¦ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€å€‹ Django ç”±ä¸€å€‹ project å’Œå¾ˆå¤šå€‹ apps æ‰€çµ„æˆã€‚æ¯å€‹ app å°±å°ˆæ³¨åœ¨ç¶²ç«™çš„æŸå€‹åŠŸèƒ½ä¸Šï¼Œå„è‡ªåŒ…è‘—å„è‡ªéœ€è¦çš„ database schemaã€templateã€view logicsã€‚é€™æ¨£çš„å¥½è™•æ˜¯åŒæ¨£çš„åŠŸèƒ½å°±ä¸ç”¨é‡å¯«ï¼ŒåŒæ™‚åœ¨å¾ˆå¤§çš„ç¶²ç«™æ™‚é€™æ¨£çš„çµæ§‹æœ‰åŠ©æ–¼ç®¡ç†é‹ä½œçš„é‚è¼¯ã€‚&lt;/p&gt;
&lt;h4 id="django-server"&gt;Django server&lt;/h4&gt;
&lt;p&gt;å…ˆæŠŠ Django è·‘èµ·ä¾†çœ‹çœ‹å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;python manage.py runserver
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;Django version 1.8.5, using settings &amp;#39;draw_site.settings&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;Starting development server at http://127.0.0.1:8000/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_initial.png"/&gt;
  &lt;figcaption&gt;Django Hello World&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;é€™æ˜¯ Django å…§å»ºåœ¨ä»€éº¼ URL éƒ½æ²’è¨­å®šæ™‚çš„æ­¡è¿Žç•«é¢ã€‚çœ‹åˆ°é€™å€‹è‡³å°‘è¡¨ç¤ºåŸºæœ¬çš„ settings æ­£å¸¸ã€‚Django è·Ÿ Flask ä¸€æ¨£ï¼Œå…§å»ºçš„ server æœƒåœ¨ source code æœ‰æ”¹è®Šçš„æ™‚å€™ reloadï¼Œæ‰€ä»¥ä¸€ç›´é–‹è‘—è·‘ä¹Ÿå¯ä»¥ã€‚&lt;/p&gt;
&lt;h4 id="django-app"&gt;ç¬¬ä¸€å€‹ Django app&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘çš„ç¶²ç«™åªæœƒç”¨åˆ°ä¸€å€‹ appï¼ŒæŠŠå®ƒå»ºå‡ºä¾†å–åç‚º &lt;code&gt;draw_member&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python manage.py startapp draw_member
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;demo_django_draw_member/
â””â”€â”€ draw_site/
    â”œâ”€â”€ draw_member/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ migrations/
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ draw_site/
    â”‚Â Â  â””â”€â”€ ...
    â””â”€â”€ manage.py*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° app èˆ‡ project çš„æž¶æ§‹æ˜¯ä¸ä¸€æ¨£çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¦æŠŠé€™å€‹æ–°çš„ app åŠ åˆ° project è£¡ï¼Œä¿®æ”¹ &lt;code&gt;draw_site/settings.py&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_site/settings.py&lt;/span&gt;

&lt;span class="n"&gt;INSTALLED_APPS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;draw_member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;    &lt;span class="c1"&gt;# åŠ é€™ä¸€è¡Œ&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.admin&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.auth&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.contenttypes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.sessions&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.messages&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;django.contrib.staticfiles&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é è¨­å…¶å¯¦è£äº†å¾ˆå¤š appã€‚æš«æ™‚ä¸ç†ä»–å€‘æ˜¯ä»€éº¼ã€‚&lt;/p&gt;
&lt;h4 id="django-settings"&gt;Django settings&lt;/h4&gt;
&lt;p&gt;å…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹ &lt;code&gt;draw_site/settings.py&lt;/code&gt;ã€‚é™¤äº†å‰›å‰›ç”¨åˆ° INSTALLED_APPSï¼Œè¬›å¹¾å€‹è·Ÿé€™é‚Šæ¯”è¼ƒæœ‰é—œçš„åƒæ•¸ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Database&lt;/span&gt;
&lt;span class="c1"&gt;# https://docs.djangoproject.com/en/1.8/ref/settings/#databases&lt;/span&gt;

&lt;span class="n"&gt;DATABASES&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;default&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ENGINE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;django.db.backends.sqlite3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;NAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BASE_DIR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;db.sqlite3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Internationalization&lt;/span&gt;
&lt;span class="c1"&gt;# https://docs.djangoproject.com/en/1.8/topics/i18n/&lt;/span&gt;

&lt;span class="n"&gt;LANGUAGE_CODE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;en-us&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;TIME_ZONE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;UTC&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;USE_TZ&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;DATABSES è£¡å®šç¾©äº†ä½¿ç”¨çš„è³‡æ–™åº«ã€‚é è¨­æœƒä½¿ç”¨ &lt;code&gt;db.sqlite3&lt;/code&gt; é€™å€‹ SQLite è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æ˜¯èªžè¨€ã€æ™‚å€çš„è¨­å®šã€‚é è¨­æ˜¯ UTC ä¸¦ä¸”ä½¿ç”¨ timezoneï¼Œä¹Ÿå°±æ˜¯ server çš„æ™‚é–“éƒ½æ˜¯ç”¨ UTC è¨˜éŒ„çš„ã€‚&lt;/p&gt;
&lt;h4 id="database-migration"&gt;Database Migration&lt;/h4&gt;
&lt;p&gt;åœ¨ä»€éº¼ code éƒ½é‚„æ²’å¯«ä¹‹å‰ï¼Œä»‹ç´¹ä¸€å€‹ database è§€å¿µï¼š&lt;a href="https://docs.djangoproject.com/en/1.8/topics/migrations/"&gt;migration&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„ä¾‹å­å¯ä»¥çŸ¥é“ï¼Œæˆ‘å€‘æœƒå…ˆè¨­è¨ˆä¸€å€‹è³‡æ–™åº«è©²å­˜ä»€éº¼æ±è¥¿ï¼Œæ•´å€‹ç¶²ç«™æµç¨‹æœƒæ€Žéº¼ç”¨é€™äº›è³‡æ–™ï¼Œé€™äº›å½¢æˆ table schemaã€‚ä½†æ˜¯éš¨è‘—æ™‚é–“ï¼Œå¯èƒ½ç¶²ç«™æœ‰æ–°çš„åŠŸèƒ½ï¼Œå¾ˆé›£èªªå®Œå…¨ä¸åŽ»æ›´å‹• schemaã€‚&lt;/p&gt;
&lt;p&gt;æ›´å‹• schema ä¸æ˜¯ä»¶ç°¡å–®çš„äº‹ï¼Œå¦‚æžœæ˜¯ä¸Š production çš„ç¶²ç«™ï¼Œè³‡æ–™åº«æœƒæœ‰é‹ä½œä»¥ä¾†ç´¯ç©çš„è³‡æ–™ï¼Œç¸½ä¸èƒ½ schema æ”¹äº†é€™äº›è³‡æ–™å°±ä¸ŸæŽ‰å§ï¼Ÿè€Œä¸”åœ¨ç¶²ç«™é–‹ç™¼çš„æ™‚å€™ï¼Œåœ¨ä¸åŒç‰ˆæœ¬çš„ï¼ˆæˆ–ä¸åŒäººé–‹ç™¼çš„ï¼‰code å°±å¯èƒ½æœ‰ä¸åŒçš„ schemaã€‚è¦æ€Žéº¼ç¢ºä¿ code èˆ‡ database çš„ç‹€æ…‹å°±è¦é  migrationã€‚&lt;/p&gt;
&lt;p&gt;â€¦â€¦ä¸€é–‹å§‹å°±é€™éº¼è¤‡é›œï¼Ÿå¥½å•¦æˆ‘å€‘çš„ä¾‹å­æ²’æœ‰ç”¨åˆ° migration å¤§å¤šæ•¸çš„åŠŸèƒ½ï¼Œåªæœ‰ç”¨å®ƒ initiate databaseã€‚å…§å»ºçš„ app éƒ½æœ‰è‡ªå·±çš„ database schemaï¼Œå¯ä»¥ç”¨å®ƒæŠŠè³‡æ–™åº«çš„ table å»ºå‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;python manage.py migrate
&lt;span class="go"&gt;Operations to perform:&lt;/span&gt;
&lt;span class="go"&gt;  Synchronize unmigrated apps: messages, staticfiles&lt;/span&gt;
&lt;span class="go"&gt;  Apply all migrations: sessions, auth, contenttypes, admin&lt;/span&gt;
&lt;span class="go"&gt;Synchronizing apps without migrations:&lt;/span&gt;
&lt;span class="go"&gt;  Creating tables...&lt;/span&gt;
&lt;span class="go"&gt;    Running deferred SQL...&lt;/span&gt;
&lt;span class="go"&gt;  Installing custom SQL...&lt;/span&gt;
&lt;span class="go"&gt;Running migrations:&lt;/span&gt;
&lt;span class="go"&gt;  Rendering model states... DONE&lt;/span&gt;
&lt;span class="go"&gt;  Applying contenttypes.0001_initial... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0001_initial... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying admin.0001_initial... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying contenttypes.0002_remove_content_type_name... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0002_alter_permission_name_max_length... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0003_alter_user_email_max_length... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0004_alter_user_username_opts... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0005_alter_user_last_login_null... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying auth.0006_require_contenttypes_0002... OK&lt;/span&gt;
&lt;span class="go"&gt;  Applying sessions.0001_initial... OK&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;migration å°±æœƒä¸€æ­¥æ­¥æŠŠ database èª¿æ•´åˆ°ç¬¦åˆç¾åœ¨ code çš„ç‹€æ…‹ï¼Œé€™äº›èª¿æ•´å°±æœƒè¨˜éŒ„åœ¨ &lt;code&gt;&amp;lt;app&amp;gt;/migrations/&lt;/code&gt; åº•ä¸‹ï¼Œç­‰ç­‰å°±æœƒçœ‹åˆ°äº†ã€‚&lt;/p&gt;
&lt;h3 id="url-dispatcher"&gt;URL dispatcher&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æŽ¥ä¸‹ä¾†è¦æ”¹é¦–é ï¼ŒæŠŠ Django é è¨­çš„ &lt;code&gt;/&lt;/code&gt; é¦–é æ›æˆ Hello Worldã€‚&lt;/p&gt;
&lt;p&gt;Flask URL routing æ˜¯ç›´æŽ¥ç”¨ decorator å¯«åœ¨ view function ä¸Šé¢ã€‚å¹«å¤§å®¶å›žé¡§ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Django çš„ view å’Œ URL æ˜¯åˆ†é–‹çš„ï¼Œé¦–å…ˆæ˜¯ viewï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_member/views.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.shortcuts&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;  &lt;span class="c1"&gt;# å…ˆæš«æ™‚ç•™è‘—&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.http&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çµæ§‹ä¸Šå¤§åŒå°ç•°ï¼ˆä¹Ÿå› ç‚ºæœ‰ &lt;a href="http://wsgi.org/"&gt;WSGI&lt;/a&gt; è¦ç¯„çš„é—œä¿‚å•¦ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æ˜¯ URL è¨­å®šã€‚æˆ‘å€‘å…ˆæŠŠ URL åŠ åœ¨ project è¨­å®šã€‚é€™é‚Šå¯èƒ½è¦ºå¾—è¨­å®šæœ‰é»žåˆ†æ•£æ¯”è¼ƒæ€ªï¼Œç­‰ä¸€ä¸‹å†æŠŠå®ƒæ”¾åˆ° app è£¡é¢ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_site/urls.py&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;draw_site URL Configuration&lt;/span&gt;

&lt;span class="sd"&gt;The `urlpatterns` list routes URLs to views. For more information please see:&lt;/span&gt;
&lt;span class="sd"&gt;    https://docs.djangoproject.com/en/1.8/topics/http/urls/&lt;/span&gt;
&lt;span class="sd"&gt;...&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf.urls&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.contrib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;admin&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member.views&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;

&lt;span class="n"&gt;urlpatterns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;home&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^admin/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;admin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;urls&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¦‚å¿µä¹Ÿå¾ˆç°¡å–®ï¼ŒæŠŠè¦çš„ view function å¾ž app import é€²ä¾†ï¼ˆæ‰€ä»¥ app ç›®éŒ„æ˜¯å€‹ Python moduleï¼Œåº•ä¸‹æœƒ &lt;code&gt;__init__.py&lt;/code&gt;ï¼‰ï¼Œçµ¦ä¸€å€‹ regex è¡¨ç¤ºçš„è·¯å¾‘ï¼Œå¾Œé¢æ”¾ä¸Šè™•ç† function ä»¥åŠä¸€å€‹ optional çš„åå­—ï¼Œé€™å€‹åå­—å°±ä»£è¡¨äº†é€™å€‹ URL è·¯å¾‘ï¼Œä¹‹å¾Œå¯ä»¥åæŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ¸¬ä¸€ä¸‹ç¢ºèªè¨­å®šéƒ½æ˜¯æ­£ç¢ºçš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;curl -XGET &lt;span class="s2"&gt;&amp;quot;localhost:8000&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†çœ‹ä¸€ä¸‹ &lt;code&gt;draw_site/urls.py&lt;/code&gt;ï¼Œå¯ä»¥çœ‹åˆ° Django é è¨­æ”¾äº†å€‹ &lt;code&gt;/admin&lt;/code&gt; å¾Œé¢ç”¨çš„æ˜¯ &lt;code&gt;include(app.urls)&lt;/code&gt;ï¼Œè¡¨ç¤ºé€™ä¸€æ•´åŒ…åªè¦æ˜¯ admin/ é–‹é ­çš„ URL éƒ½äº¤çµ¦ admin.site.urls åŽ»è™•ç†è·¯å¾‘ã€‚é€™æ¨£æ–¹ä¾¿ app åœ¨ä¸åŒç¶²ç«™ä¸­é‡è¦†åˆ©ç”¨ï¼Œå› ç‚ºå¯èƒ½æ”¾çš„è·¯å¾‘éƒ½ä¸ä¸€æ¨£ï¼Œä½†ä¸€å€‹ app å…§çš„ URL è™•ç†æœƒæœ‰ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é¦¬ä¸Šä¾†æ”¹å¯«ä¸€ä¸‹ã€‚é¦–å…ˆåœ¨ app &lt;strong&gt;draw_member&lt;/strong&gt; åº•ä¸‹åŠ ä¸€å€‹ &lt;code&gt;urls.py&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_member/urls.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf.urls&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.views&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;  &lt;span class="c1"&gt;# explicit relative import&lt;/span&gt;

&lt;span class="n"&gt;urlpatterns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;home&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŸºæœ¬ä¸Šæ ¼å¼å°±æ˜¯ç…§æŠ„åŽŸæœ¬å°±æœ‰çš„ã€‚å› ç‚ºæ”¾åœ¨åŒå€‹ app è£¡é¢äº†ï¼Œimport view æ™‚å°±å¯ä»¥ç”¨ explicit relative importï¼ˆé€™ä¸æ˜¯ relative import å–”ï¼‰&lt;/p&gt;
&lt;p&gt;åŽŸæœ¬çš„ urls.py å°±æ”¹æˆæŠŠ URL çš„è™•ç†ã€Œdispatchã€çµ¦é€™å€‹ appï¼Œæ”¹æˆåº•ä¸‹é€™æ¨£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# draw_site/urls.py
from django.conf.urls import include, url
from django.contrib import admin


urlpatterns = [
    url(r&amp;#39;^admin/&amp;#39;, include(admin.site.urls)),
    url(r&amp;#39;^&amp;#39;, include(&amp;#39;draw_member.urls&amp;#39;)),
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;r'^'&lt;/code&gt; ä»£è¡¨å¾žæ ¹ç›®éŒ„å°±äº¤çµ¦é€™å€‹ app åŽ»ç®¡ç†ï¼Œä¹Ÿå› ç‚ºé€™æ¨£æ¯”è¼ƒå°ˆä¸€çš„è·¯å¾‘è¦æ”¾å‰é¢ï¼Œåƒæ˜¯ /adminã€‚ç”¨å­—ä¸²è¡¨ç¤ºåœ¨åŸ·è¡Œçš„æ™‚å€™æ‰ import é€™å€‹ moduleï¼Œä¸æƒ³ä¹Ÿå¯ä»¥æ‹¿æŽ‰å­—ä¸²æŠŠ app import é€²ä¾†ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/http/urls/"&gt;URL dispatching&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="django-model-and-orm"&gt;Django Model and ORM&lt;/h3&gt;
&lt;p&gt;æŽ¥è‘—è™•ç†è³‡æ–™åº«çš„å•é¡Œã€‚ç•¶ç„¶å¯ä»¥åœ¨ Django è£¡é¢å¯« raw SQLï¼Œä½†é€™é‚Šæä¾›å¦ä¸€å€‹æƒ³æ³•ï¼šObject-relational Mapping (ORM)ã€‚ORM æŠŠè³‡æ–™ç”¨ç‰©ä»¶å°Žå‘çš„æ–¹å¼æ•´ç†ï¼ŒæŠŠ SQLã€tableã€database çš„ç´°ç¯€äº¤çµ¦ ORM engine åŽ»ç¿»è­¯ã€‚é€™å¯ä»¥åœ¨æ‰¾åˆ°éžå¸¸å¤šä»‹ç´¹ï¼Œç›´æŽ¥è·³åˆ°å¯¦ä½œã€‚&lt;/p&gt;
&lt;pre style="font-family: Consolas, 'Courier New', monospace"&gt;
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ members             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id          INTEGER â”‚ &lt;â”€â”
    â”‚ name           TEXT â”‚   â”‚
    â”‚ group_name     TEXT â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ draw_histories      â”‚   â”‚ foreign
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ key
    â”‚ memberid    INTEGER â”‚ â”€â”€â”˜
    â”‚ time       DATETIME â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/pre&gt;

&lt;p&gt;å›žæƒ³ä¸€ä¸‹æˆ‘å€‘çš„ schema è¨­è¨ˆã€‚æ”¹ç”¨ ORM ä¾†æ€è€ƒæˆ‘å€‘å°±æœƒæœ‰æˆå“¡ï¼ˆMemberï¼‰ä»¥åŠæŠ½ç±¤æ­·å²ï¼ˆHistoryï¼‰å…©å¤§ modelsã€‚&lt;strong&gt;Member&lt;/strong&gt; è¨˜éŒ„äº†åå­—èˆ‡æ‰€å±¬åœ˜é«”ï¼›&lt;strong&gt;History&lt;/strong&gt; æœƒè¨˜éŒ„æ™‚é–“ã€é€™ç­†æŠ½ç±¤æ˜¯å±¬æ–¼å“ªå€‹æˆå“¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Django ä¸­ï¼Œmodel å®šç¾©åœ¨ &lt;code&gt;models.py&lt;/code&gt; è£¡é¢ï¼Œé¦¬ä¸Šä¾†å¯«å¯«çœ‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_members/models.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.db&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.utils.timezone&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;now&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__str__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt; of &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;member&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;related_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draw_histories&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# now() will return datetime.utcnow()&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DateTimeField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__str__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt; at &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸€å€‹ class è£¡çš„å±¬æ€§å°±å°æ‡‰åˆ°ä¸€å€‹æ¬„ä½ï¼ˆFieldï¼‰ï¼Œæ¬„ä½æœƒæœ‰ä»–çš„åž‹åˆ¥ä»¥åŠè³‡æ–™åº«å¯¦ä½œä¸Šçš„é™åˆ¶ï¼ˆä¾‹å¦‚å­—ä¸²æœ‰ä¸Šé™ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä¸è¨­ï¼‰ã€‚Field type å¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#field-types"&gt;å®˜ç¶²&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Member&lt;/strong&gt; åº•ä¸‹éƒ½æ˜¯å­—ä¸²æ‰€ä»¥æ˜¯ &lt;code&gt;CharField&lt;/code&gt;ã€‚ &lt;strong&gt;History&lt;/strong&gt; ç¨å¾®è¤‡é›œä¸€é»žï¼Œæ™‚é–“çš„è¨˜éŒ„ date ç”¨ &lt;code&gt;DateTimeField&lt;/code&gt;ï¼Œé€™æ¨£æ¬„ä½æ‹¿å›žä¾†å°±æœƒè½‰æ›æˆ Python datetime objectï¼›å¦ä¸€å€‹ member ç”¨çš„æ˜¯ &lt;code&gt;ForeignKey&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ relationship fieldï¼Œä¾†è¡¨ç¤ºé€™ç­†æŠ½ç±¤å±¬æ–¼æ‹¿å€‹æˆå“¡ã€‚å¾Œé¢çš„ &lt;code&gt;related_name&lt;/code&gt; æä¾›äº†åæŸ¥åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯èƒ½å¾žä¸€å€‹ member åŽ»æŸ¥ä»–æ‰€æœ‰çš„ historiesã€‚&lt;/p&gt;
&lt;p&gt;åŒæ™‚å…ˆå¯«å¥½å…©å€‹ class åº•ä¸‹çš„ &lt;code&gt;__str__&lt;/code&gt;ï¼Œé€™æ¨£ç­‰ä¸‹åœ¨ Python shell æ“ä½œæ™‚å®¹æ˜“è¾¨èªæ¯å€‹ç‰©ä»¶çš„å…§å®¹ã€‚&lt;/p&gt;
&lt;h4 id="migration-the-tracker-of-model-changes"&gt;Migration the tracker of model changes&lt;/h4&gt;
&lt;p&gt;å¤šèªªç„¡ç”¨ï¼Œé¦¬ä¸Šä¾†è©¦ä¸€è©¦ã€‚&lt;/p&gt;
&lt;p&gt;â€¦â€¦ç­‰ç­‰ï¼Œæƒ³åˆ° migration äº†å—Žï¼Ÿæ¯æ¬¡æ›´å‹• database model éƒ½è¦è·‘ migrationï¼Œç¢ºä¿ code èˆ‡è³‡æ–™åº«ç‹€æ…‹ä¸€è‡´ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;python manage.py makemigrations draw_member
&lt;span class="go"&gt;python manage.py makemigrations draw_member&lt;/span&gt;
&lt;span class="go"&gt;Migrations for &amp;#39;draw_member&amp;#39;:&lt;/span&gt;
&lt;span class="go"&gt;  0001_initial.py:&lt;/span&gt;
&lt;span class="go"&gt;    - Create model History&lt;/span&gt;
&lt;span class="go"&gt;    - Create model Member&lt;/span&gt;
&lt;span class="go"&gt;    - Add field member to history&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° Django å¾ˆè°æ˜Žçš„çŸ¥é“æˆ‘å€‘å¤šå®šç¾©äº†å…©å€‹ modelsï¼Œè£¡é¢æœ‰äº›å°æ‡‰åˆ°è³‡æ–™åº«çš„æ¬„ä½åž‹æ…‹ã€‚é€™äº›è³‡è¨Šæœƒå¯«åœ¨ migration file è£¡é¢ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_member/migrations/0001_initial.py&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Migration&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Migration&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="n"&gt;dependencies&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="n"&gt;operations&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CreateModel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;History&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AutoField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serialize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verbose_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auto_created&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DateTimeField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utils&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
            &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CreateModel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AutoField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serialize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;primary_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verbose_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ID&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auto_created&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CharField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
            &lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;migrations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AddField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;model_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ForeignKey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;draw_member.Member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;related_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;draw_histories&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„åˆ° Django ORM è‡ªå‹•å¹«æˆ‘å€‘åŠ äº† &lt;code&gt;id&lt;/code&gt; é€™å€‹ primary keyï¼Œç­‰ç­‰å°±æœƒç”¨åˆ°ã€‚Migration è£¡é¢çš„ç´°ç¯€ç­‰å° Django æ›´ç†Ÿäº†ä¹‹å¾Œå°±èƒ½æ…¢æ…¢äº†è§£äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†æ–°çš„ migration å°±è¦åŒæ­¥è³‡æ–™åº«çš„ç‹€æ…‹ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;python manage.py migrate
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;Running migrations:&lt;/span&gt;
&lt;span class="go"&gt;  Rendering model states... DONE&lt;/span&gt;
&lt;span class="go"&gt;  Applying draw_member.0001_initial... OK&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="orm-queries-in-shell"&gt;ORM queries in shell&lt;/h4&gt;
&lt;p&gt;æŽ¥ä¸‹ä¾†æˆ‘å€‘æ“ä½œä¸€ä¸‹ ORMã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python manage.py shell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°±æœƒæ‰“é–‹ä¸€å€‹ Python shellã€‚å¦‚æžœè£äº† IPython å°±æœƒæ‰“é–‹ IPython shellã€‚
é€™å€‹èˆ‡ä¸€èˆ¬çš„æœ‰ä»€éº¼å·®åˆ¥å‘¢ï¼Ÿä»–æœƒå¸¶æœ‰ Django project çš„è¨­å®šã€‚å¦‚æžœæ˜¯å¾žä¸€èˆ¬çš„ shell å¯ä»¥å…ˆè·‘ä»¥ä¸‹çš„æŒ‡ä»¤ä¾†é”åˆ°ç›¸åŒçš„æ•ˆæžœã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;$ DJANGO_SETTINGS_MODULE=&amp;quot;draw_site.settings&amp;quot; python&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;django&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;In [1]: from draw_member.models import Member, History
In [2]: m1 = Member(name=&amp;quot;é«˜å‚ ç©‚ä¹ƒæžœ&amp;quot;, group_name=&amp;quot;Î¼&amp;#39;s&amp;quot;)
In [4]: m2 = Member(name=&amp;quot;å¹³æ²¢ å”¯&amp;quot;, group_name=&amp;quot;K-ON!&amp;quot;)
In [5]: m1, m2
Out[5]: (&amp;lt;Member: é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s&amp;gt;, &amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;)
In [7]: m1.save()
In [8]: m2.save()
In [6]: h1 = History(member=m1)
In [9]: h1.save()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨ä¸Šå°±æŠŠè³‡æ–™ç•¶ä½œç‰©ä»¶ä¾†æ“ä½œï¼Œå¦‚åŒ ORM å­—é¢çš„æ„æ€ã€‚æ³¨æ„åªæœ‰åœ¨ &lt;code&gt;.save()&lt;/code&gt; æ‰çœŸæ­£è¢«å­˜åˆ°è³‡æ–™è£¡ã€‚æ‹¿æ²’æœ‰å­˜çš„ object ä¾†æ“ä½œ database å°±æœƒå‡ºç¾ exceptionã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h_failed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;FF&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h_failed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="c"&gt;...&lt;/span&gt;
&lt;span class="gr"&gt;IntegrityError&lt;/span&gt;: &lt;span class="n"&gt;NOT NULL constraint failed: draw_member_history.member_id&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¦ºå¾—éº»ç…©çš„è©±ï¼Œç”¨ &lt;code&gt;Model.objects.create()&lt;/code&gt; å°±å¯ä»¥ä¸€æ­¥æžå®šã€‚æ­£ç¢ºçš„å­˜å¥½ä¹‹å¾Œï¼Œç¾åœ¨è³‡æ–™åº«å·²ç¶“æœ‰è³‡æ–™äº†ã€‚æˆ‘å€‘å¯ä»¥å…ˆåœ¨ SQLite è£¡ç¢ºèªã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;-- sqlite3 db.sqlite3&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_member_member&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;id|name|group_name&lt;/span&gt;
&lt;span class="go"&gt;1|é«˜å‚ ç©‚ä¹ƒæžœ|Î¼&amp;#39;s&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_member_history&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;id|time|member_id&lt;/span&gt;
&lt;span class="go"&gt;1|2015-10-05 15:17:32.061384|1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€éŽåƒå‰›å‰› object çš„æ“ä½œï¼Œæˆ‘å€‘ä¹Ÿèƒ½å»ºå‡ºå¦‚åŒæ‰‹å¯« SQL ä¸€æ¨£çš„è³‡æ–™åº«ï¼Œç•¶ç„¶åƒ &lt;code&gt;id&lt;/code&gt;ã€&lt;code&gt;member_id&lt;/code&gt; é€™äº›æ¬„ä½æ˜¯ ORM engine è‡ªå‹•å¹«æˆ‘å€‘åšå‡ºä¾†çš„ï¼Œé€™äº›å¯ä»¥è‡ªè¨‚ï¼Œä¸éŽé è¨­çš„è¡Œç‚ºä¸é›£ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;è¦æ€Žéº¼å¾ž ORM åƒå‰›å‰›ä¸‹ SQL ä¸€æ¨£æ’ˆè³‡æ–™å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s&amp;gt;, &amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;History: é«˜å‚ ç©‚ä¹ƒæžœ at 2015-10-05 15:17:32.061384+00:00&amp;gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è³‡æ–™é€éŽ &lt;code&gt;Model.objects&lt;/code&gt; é€™å€‹ Manager åŽ»æŸ¥è©¢ï¼Œç´°ç¯€å°±åŽ»çœ‹ Django é—œæ–¼ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/db/queries"&gt;Making queries&lt;/a&gt; çš„å…§å®¹å§ã€‚æŸ¥è©¢è³‡æ–™åº«å°±æœƒå›žå‚³ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/models/querysets/#django.db.models.query.QuerySet"&gt;QuerySet&lt;/a&gt;ï¼Œé€™ä¸¦ä¸æœƒçœŸçš„åŽ»ã€ŒæŸ¥ã€è³‡æ–™åº«ï¼Œä½†å…ˆæŠŠæŒ‡ä»¤å­˜è‘—ç­‰çœŸçš„è¦ç”¨åˆ°å€¼æ™‚æ‰åŽ»è¨ˆç®—ï¼Œä¹Ÿå°±æ˜¯ lazy evaluationã€‚&lt;/p&gt;
&lt;p&gt;QuerySet åº•ä¸‹å°±æœ‰å¾ˆå¤šå°æ‡‰åˆ° SQL æŒ‡ä»¤çš„æŸ¥è©¢ï¼Œåƒæ˜¯æ‹¿å›žæ‰€æœ‰ objects çš„ &lt;code&gt;QuerySet.all()&lt;/code&gt;ï¼Œå‰é¢å·²ç¶“ç”¨éŽäº†ã€‚æˆ–è€…ç¯©é¸çš„ &lt;code&gt;QuerySet.filter()&lt;/code&gt;ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name__contains&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­ &lt;code&gt;&amp;lt;field&amp;gt;__contains&lt;/code&gt; å°±æ˜¯ Django ORM ç‚ºäº†å¯¦åšåƒ SQL &lt;code&gt;LIKE&lt;/code&gt; æŒ‡ä»¤çš„å°æ‡‰æ¬„ä½ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆè¬›å¹¾å€‹æœ‰é—œçš„ï¼Œé¦–å…ˆæ¯å€‹ Model éƒ½æœ‰å€‹ primary key &lt;code&gt;pk&lt;/code&gt;ï¼Œé è¨­æŒ‡åˆ° &lt;code&gt;Model.id&lt;/code&gt; é€™å€‹æ¬„ä½ä¸Šï¼Œå¦ç”¨ &lt;code&gt;QuerySet.get()&lt;/code&gt; å¯ä»¥æ‹¿åˆ°å–®ä¸€ç‰©ä»¶ï¼Œé€™æ™‚å€™è¬ç”¨çš„ pk å°±æ´¾ä¸Šç”¨å ´äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;Member: é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŸ¥ relation ä¹Ÿå¾ˆç°¡å–®ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;Member: é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s&amp;gt;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;h1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‚„è¨˜å¾—ä¹‹å‰è¨­å¾— &lt;code&gt;related_name="draw_histories"&lt;/code&gt;ï¼Œè¡¨ç¤ºæˆ‘å€‘èƒ½å¾ž &lt;strong&gt;Member&lt;/strong&gt; åæŸ¥å›žåŽ»è©²äººç›¸é—œçš„æ­·å²ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;History: é«˜å‚ ç©‚ä¹ƒæžœ at 2015-10-05 15:17:32.061384+00:00&amp;gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ€å¾Œæˆ‘å€‘ä¾†åˆªè³‡æ–™ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç•¶ç„¶ä¸€é–‹å§‹æˆ‘å€‘å¯ä»¥æš´åŠ›æŠŠ &lt;code&gt;db.sqlite3&lt;/code&gt; æ•´å€‹åˆªæŽ‰å†é‡æ–° &lt;code&gt;python manage.py migrate&lt;/code&gt; ä¸€æ¬¡å°±å¯ä»¥è®“ database å°æ‡‰çš„ table éƒ½å»ºç«‹å¥½ï¼Œä¸éŽåªé©ç”¨æ–¼ SQLite è€Œå·²ã€‚æˆ–è€…ï¼Œæ­£ç¢ºçš„ã€Œæ¸…ç©ºè³‡æ–™åº«ã€åšæ³•æ˜¯ç”¨ &lt;code&gt;flush&lt;/code&gt; æŒ‡ä»¤ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;python manage.py flush
&lt;span class="go"&gt;You have requested a flush of the database.&lt;/span&gt;
&lt;span class="go"&gt;This will IRREVERSIBLY DESTROY all data currently in the &amp;#39;draw_site/db.sqlite3&amp;#39; database,&lt;/span&gt;
&lt;span class="go"&gt;and return each table to an empty state.&lt;/span&gt;
&lt;span class="go"&gt;Are you sure you want to do this?&lt;/span&gt;

&lt;span class="go"&gt;    Type &amp;#39;yes&amp;#39; to continue, or &amp;#39;no&amp;#39; to cancel: yes&lt;/span&gt;
&lt;span class="go"&gt;Installed 0 object(s) from 0 fixture(s)&lt;/span&gt;
&lt;span class="go"&gt;Installed 0 object(s) from 0 fixture(s)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="data-in-orm-and-fixtures"&gt;Data in ORM and fixtures&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘æŠŠ &lt;code&gt;members.csv&lt;/code&gt; çš„è³‡æ–™å¡«åˆ°è³‡æ–™åº«å§ã€‚é€™é‚Šå°±ä¸ç”¨ç´°èªªäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;In [1]: import csv
In [2]: with open(&amp;#39;../../draw_member/members.csv&amp;#39;, newline=&amp;#39;&amp;#39;) as f:
   ...:    csv_reader = csv.DictReader(f)
   ...:    members = [
   ...:    (row[&amp;#39;åå­—&amp;#39;], row[&amp;#39;åœ˜é«”&amp;#39;])
   ...:    for row in csv_reader
   ...:    ]
In [3]: from draw_member.models import Member
In [4]: for m in members:
   ...:     Member(name=m[0], group_name=m[1]).save()
   ...:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥è‡ªå·±æª¢æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯ 14 å€‹äººéƒ½å¯«åˆ°è³‡æ–™åº«äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽç¾åœ¨æœ‰å€‹å•é¡Œæ˜¯ï¼Œä¹‹å¾Œå¯èƒ½æœƒå¸¸å¸¸æŠŠè³‡æ–™åº«ç æŽ‰é‡ç·´ï¼Œæˆ–è€…è¦æŠŠé€™äº›ï¼ˆæˆ–å¾ˆå¤šä¾†æºï¼‰çš„è³‡æ–™è®€åˆ°è³‡æ–™åº«ï¼Œæ¯æ¬¡éƒ½é‡æ–°è®€å¯«ä¹Ÿæ˜¯å¯ä»¥ï¼Œä½†æœ‰æ²’æœ‰åˆ¥çš„åšæ³•èƒ½æŠŠè³‡æ–™å…ˆå­˜èµ·ä¾†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é€™é‚Šå°±è¦ä»‹ç´¹ &lt;a href="https://docs.djangoproject.com/en/1.8/howto/initial-data/#providing-initial-data-with-fixtures"&gt;Django fixtures&lt;/a&gt; äº†ã€‚ä»–èƒ½æŠŠè³‡æ–™åº«çš„è³‡æ–™å­˜æˆ JSONã€YAMLï¼ˆéœ€è¦ &lt;a href="http://pyyaml.org/"&gt;PyYAML&lt;/a&gt;ï¼‰ç­‰æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ fixtures æ˜¯è¢«åœ¨ &lt;code&gt;&amp;lt;app&amp;gt;/fixtures/&lt;/code&gt; ç›®éŒ„åº•ä¸‹ï¼Œè¨˜å¾—å…ˆæŠŠç›®éŒ„å»ºå‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mkdir draw_member/fixtures
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ ¹æ“š database çš„å…§å®¹å»ºç«‹ fixtures å¯ä»¥ä½¿ç”¨ &lt;code&gt;dumpdata&lt;/code&gt; æŒ‡ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python manage.py dumpdata &lt;span class="se"&gt;\&lt;/span&gt;
    --format&lt;span class="o"&gt;=&lt;/span&gt;yaml &lt;span class="se"&gt;\&lt;/span&gt;
    --indent&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --output draw_member/fixtures/anime_members.yaml
    draw_member.Member &lt;span class="se"&gt;\&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_member/fixtures/anime_members.yaml&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nt"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p p-Indicator"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u03BC&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt;&lt;span class="nt"&gt; name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u9AD8\u5742&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="se"&gt;\u7A42\u4E43\u679C&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;draw_member.member&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;pk&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nt"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p p-Indicator"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u03BC&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt;&lt;span class="nt"&gt; name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\u7D62\u702C&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="se"&gt;\u7D75\u91CC&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;draw_member.member&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;pk&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;2&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="c1"&gt;# ...&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨ JSON è¼¸å‡ºä¹Ÿå¯ä»¥ï¼Œæ”¹æˆ &lt;code&gt;--format=json&lt;/code&gt; å°±å¯ä»¥äº†&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;model&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draw_member.member&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;pk&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\u9ad8\u5742 \u7a42\u4e43\u679c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\u03bc&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥ç”¨ &lt;code&gt;python manage.py flush&lt;/code&gt; æŠŠè³‡æ–™åº«æ¸…æŽ‰ï¼Œæ¨¡æ“¬è³‡æ–™çš„è®€å…¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;python manage.py loaddata anime_members.yaml
&lt;span class="go"&gt;Installed 14 object(s) from 1 fixture(s)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£è³‡æ–™çš„å­˜å–å°±ä»‹ç´¹å¾—å·®ä¸å¤šäº†ã€‚æ›´å¤šçš„ç´°ç¯€å¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#the-model-layer"&gt;å®˜ç¶² model layer&lt;/a&gt; çš„èªªæ˜Žã€‚&lt;/p&gt;
&lt;h3 id="django-template"&gt;Django Template&lt;/h3&gt;
&lt;p&gt;åœ¨é€²è¡Œä¸‹åŽ»ä¹‹å‰ï¼Œå…ˆç¢ºèªæˆ‘å€‘çš„ç›®éŒ„çµæ§‹æ˜¯ä¸€æ¨£çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;demo_django_draw_member/
â””â”€â”€ draw_site/
    â”œâ”€â”€ db.sqlite3
    â”œâ”€â”€ draw_member/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ fixtures/
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ anime_members.json
    â”‚Â Â  â”‚Â Â  â””â”€â”€ anime_members.yaml
    â”‚Â Â  â”œâ”€â”€ migrations/
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 0001_initial.py
    â”‚Â Â  â”‚Â Â  â””â”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ draw_site/
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ settings.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ wsgi.py
    â””â”€â”€ manage.py*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Django çš„ template é è¨­æ˜¯æ”¾åœ¨ &lt;code&gt;&amp;lt;app&amp;gt;/templates/&lt;/code&gt; åº•ä¸‹ã€‚ä¸éŽç‚ºäº†åœ¨è·¨ app æ™‚ä¸è¦è¡åˆ°åå­—ï¼Œæˆ‘å€‘æœƒå¤šåŒ…ä¸€å±¤ app ç‚ºåçš„è³‡æ–™å¤¾ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mkdir -p draw_member/templates/draw_member
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®ƒè·Ÿ Flask ç”¨çš„ Jinja2 templates ä¹çœ‹ä¸‹éžå¸¸é¡žä¼¼ï¼ˆJinja2 æ¨¡ä»¿ Django templateï¼‰ï¼Œå…©è€…æœ€å¤§çš„å·®åˆ¥æ˜¯åœ¨ Jinja2 è£¡èƒ½å¾ˆè‡ªç”±çš„ä½¿ç”¨ Python functionï¼Œä¸éŽ Django é çš„æ˜¯ template tag ä»¥åŠ filterã€‚æˆ‘å€‘çš„ä¾‹å­å…©è€…æ˜¯æ²’å·®å¤šå°‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ¨£å…ˆæŠŠ &lt;code&gt;base.html&lt;/code&gt; ä»¥åŠ &lt;code&gt;home.html&lt;/code&gt; åšå‡ºä¾†ã€‚æˆ‘å€‘ä¹Ÿå…ˆæŠŠ Form å¯«ä¸Šäº†ï¼Œæš«æ™‚å…ˆç”¨ GETã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_member/templates/draw_member/base.html #}&lt;/span&gt;
&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt; &lt;span class="na"&gt;lang&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;en&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;width=device-width&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤ç³»çµ±&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;hr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åŠŸèƒ½åˆ—&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;home&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¦–é ï¼ˆæŠ½ç±¤ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;history&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æ­·å²è¨˜éŒ„&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_member/templates/draw_member/home.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;label&lt;/span&gt; &lt;span class="na"&gt;for&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åœ˜éšŠåç¨±ï¼š&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;label&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Î¼&amp;#39;s
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;K-ON!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;K-ON!
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;radio&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;group_name&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ALL&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;checked&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ï¼ˆå…¨ï¼‰
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•´é«”çš„æ¦‚å¿µæ‡‰è©²å¾ˆå¥½ç†è§£ã€‚&lt;code&gt;{% url 'xxxx' %}&lt;/code&gt; å°±æ˜¯ URL resolverï¼Œé‚„è¨˜å¾—åœ¨ &lt;code&gt;urls.py&lt;/code&gt; çš„è¨­å®šæ™‚æœ‰çµ¦å€‹ &lt;code&gt;name&lt;/code&gt; åƒæ•¸å—Žï¼Œé€™é‚Šå°±æœƒæ ¹æ“šé‚£å€‹åå­—å›žå‚³æ­£ç¢ºçš„ç¶²å€ã€‚&lt;/p&gt;
&lt;p&gt;é †ä¾¿æ›´æ–°ä¸€ä¸‹ URL æŠŠé€™äº› view å…ˆåŠ å¥½ï¼Œä¸ç„¶ç­‰ä¸‹ runserver æœƒèªªæ‰¾ä¸åˆ°é€™äº›ç¶²å€ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_members/urls.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf.urls&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.views&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt;

&lt;span class="n"&gt;urlpatterns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;home&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^draw/$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draw&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^history/$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_members/views.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.shortcuts&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.http&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Draw&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;History&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç·ŠæŽ¥è‘—æ”¹å¯«æˆ‘å€‘çš„é¦–é ï¼Œè®“å®ƒç”¨ä¸Š &lt;code&gt;home.html&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/home.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_home.png"/&gt;
  &lt;figcaption&gt;åŠ ä¸Š template çš„é¦–é &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Template æ›´å¤šçš„èªªæ˜Žå¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#the-template-layer"&gt;å®˜ç¶² template layer&lt;/a&gt; çš„èªªæ˜Žã€‚&lt;/p&gt;
&lt;h3 id="more-on-djangos-model-template-and-view-mtv"&gt;More on Django&amp;rsquo;s model, template and view (MTV)&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æŠŠæœ€é‡è¦çš„æŠ½ç±¤åŠŸèƒ½å¯¦ä½œå‡ºä¾†å§ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šéœ€è¦ç†è§£çš„å°±æ˜¯ï¼ŒDjango æœƒæŠŠå‚³åˆ° GET / POST çš„åƒæ•¸ä»¥ dict å­˜åœ¨ &lt;code&gt;request.GET&lt;/code&gt; / &lt;code&gt;request.POST&lt;/code&gt; è£¡é¢ï¼Œ&lt;code&gt;@require_GET&lt;/code&gt; é™åˆ¶åªèƒ½ä½¿ç”¨ GET åŽ»æºé€šã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–çš„é‚è¼¯éƒ½æ˜¯ç…§æŠ„ä»¥å‰çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.shortcuts&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.http&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Http404&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.views.decorators.http&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;require_GET&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;

&lt;span class="nd"&gt;@require_GET&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Retrieve all related members&lt;/span&gt;
    &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GET&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# Raise 404 if no members are found given the group name&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;valid_members&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;Http404&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;No member in group &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# Lucky draw&lt;/span&gt;
    &lt;span class="n"&gt;lucky_member&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# Update history&lt;/span&gt;
    &lt;span class="n"&gt;draw_history&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;member&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lucky_member&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;draw_history&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;HttpResponse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0.name}&lt;/span&gt;&lt;span class="s2"&gt;ï¼ˆåœ˜é«”ï¼š&lt;/span&gt;&lt;span class="si"&gt;{0.group_name}&lt;/span&gt;&lt;span class="s2"&gt;ï¼‰&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;
        &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lucky_member&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨ ORM å¯«èµ·ä¾†æ¯” raw SQL ä¹¾æ·¨å¤šäº†ï¼Œä¸éŽä¸€é–‹å§‹è¦æŠŠå°æ‡‰çš„ function éƒ½è¨˜èµ·ä¾†å°±æ˜¯ã€‚
é¦¬ä¸Šæ¸¬è©¦ä¸€ä¸‹ï¼Œä¸€æ¨£å·æ‡¶å…ˆä¸åŽ»å¯« templateã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;curl -XGET &lt;span class="s2"&gt;&amp;quot;localhost:8000/draw/?group=ALL&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;p&amp;gt;å°æ³‰ èŠ±é™½ï¼ˆåœ˜é«”ï¼šÎ¼&amp;#39;sï¼‰&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æžœæ˜¯å¾žé¦–é åŽ»é»žçš„ï¼Œè§€å¯Ÿä¸€ä¸‹ç¶²å€çš„è®ŠåŒ–ã€‚ä¾‹å¦‚ï¼š&lt;code&gt;http://localhost:8000/draw/?group_name=K-ON!&lt;/code&gt;ï¼Œå¯ä»¥çœ‹åˆ° form çš„é¸é …ç›´æŽ¥å¯«åœ¨ç¶²å€åˆ—ã€‚é€™æ˜¯ä½¿ç”¨ POST èˆ‡ GET æœ€å¤§çš„ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æŠŠæ­·å²è¨˜éŒ„çš„éƒ¨ä»½ä¹Ÿå¯«ä¸€ä¸‹ï¼Œä¹ŸæŠŠ template éƒ½è£œä¸Šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_member/templates/history.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤æ­·å²&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ç±¤æ­·å²ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;thead&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åå­—&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åœ˜é«”&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ä¸­æ™‚é–“&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;thead&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;history&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;recent_histories&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.member.name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.member.group_name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;history.time&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nf"&gt;date&lt;/span&gt;&lt;span class="s2"&gt;:&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;history.html èˆ‡æœ¬ä¾† Flask ä¸ä¸€æ¨£çš„åœ°æ–¹ï¼Œåœ¨ç”¨ä¸Šäº† &lt;code&gt;date:"r"&lt;/code&gt; çš„ filterï¼Œå‚³çš„åƒæ•¸æŽ¥åœ¨ &lt;code&gt;:&lt;/code&gt; ä¹‹å¾Œã€‚ä¹Ÿæ›´æ–°å°æ‡‰ view çš„å‹•ä½œï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;recent_draws&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()[:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/history.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;recent_histories&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;recent_draws&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_history.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°é è¨­ç”¨çš„æ˜¯ UTC æ™‚å€ï¼Œæ™‚å€çš„è½‰æ›ç´°ç¯€æ”¾åˆ°æ–‡æœ«å§ã€‚æˆ‘å€‘å¯ä»¥åœ¨ view è£¡æ›´æ”¹è¦å‘ˆç¾çš„æ™‚å€ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.utils.timezone&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;activate&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;activate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_history_tz.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;é€™æ¨£åŸºæœ¬åŠŸèƒ½å°±æžå®šå•¦ï¼ç´°ç¯€ä¸€æ¨£åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#the-view-layer"&gt;å®˜ç¶² view layer&lt;/a&gt; çš„èªªæ˜Žã€‚&lt;/p&gt;
&lt;h3 id="django-form"&gt;Django Form&lt;/h3&gt;
&lt;p&gt;ç›´æŽ¥æŠŠ form å¯«åœ¨ template è£¡é¢ä¹Ÿæ˜¯å¯ä»¥ï¼Œæœ‰æ™‚å€™ form å¯èƒ½è·Ÿ model æ¯æ¯ç›¸é—œï¼Œè€Œä¸” form input å¤šäº†ä¹‹å¾Œæ¯å€‹æ¬„ä½éƒ½è¦è‡ªå·±è®€å¯«ä¹Ÿå¤ªä¸ç›´è¦ºã€‚æƒ³è¦é©—è¨¼ä½¿ç”¨è€…çš„ input çš„è©±å°±æ›´è¤‡é›œäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯å°±æœ‰äº† Django Formã€‚é¦¬ä¸Šä¾†çœ‹ç”¨èµ·ä¾†æ˜¯æ€Žéº¼æ¨£ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# draw_member/forms.py
from django import forms

class DrawForm(forms.Form):
    GROUP_CHOICES = [
        (&amp;quot;Î¼&amp;#39;s&amp;quot;, &amp;quot;Î¼&amp;#39;s&amp;quot;),
        (&amp;quot;K-ON!&amp;quot;, &amp;quot;K-ON!&amp;quot;),
        (&amp;quot;ALL&amp;quot;, &amp;quot;ï¼ˆå…¨ï¼‰&amp;quot;),
    ]
    group = forms.ChoiceField(
        choices=GROUP_CHOICES,
        label=&amp;#39;åœ˜éšŠåç¨±&amp;#39;,
        label_suffix=&amp;#39;ï¼š&amp;#39;,
        widget=forms.RadioSelect,
        initial=&amp;#39;ALL&amp;#39;
    )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å»ºäº†ä¸€å€‹æ–°çš„ form classï¼Œåƒ Model ä¸€æ¨£ï¼Œè£¡é¢è¦å®šäº†æ¯å€‹æ¬„ä½çš„å±¬æ€§ã€‚æˆ‘å€‘é€™é‚Šåªæœ‰ä¸€å€‹ &lt;code&gt;group&lt;/code&gt; æ˜¯å€‹å–®é¸çš„ ChoiceFieldï¼Œ&lt;code&gt;choices&lt;/code&gt; æ˜¯å€‹ list of two-item tuplesï¼Œç¬¬ä¸€å€‹æ˜¯å…§éƒ¨çš„å€¼ï¼Œç¬¬äºŒå€‹æ˜¯é¡¯ç¤ºçš„å­—ã€‚å…¶ä»–çš„éƒ½æ˜¯ç´°ç¯€çš„èª¿æ•´ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠé€™å€‹ form ç”¨åˆ° view è£¡é¢ã€‚æ–°å»ºä¸€å€‹ form object &lt;code&gt;form&lt;/code&gt;ï¼Œç„¶å¾ŒæŠŠé€™å€‹è®Šæ•¸ &lt;code&gt;form&lt;/code&gt; å‚³é€² template è£¡é¢ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.forms&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;home&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/home.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;form&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†ä¾†ä¿®æ”¹ templateï¼Œå°±ä¸ç”¨è‡ªå·±å¯« form çš„å…§å®¹äº†ï¼Œæ”¹æˆ &lt;code&gt;{{ form }}&lt;/code&gt; Django å°±æœƒè‡ªå‹•ç”¢ç”Ÿã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_member/home.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;form&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_form.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;ä¸éŽé€™å€‹é•·å¾—è·Ÿæˆ‘å€‘åŽŸæœ¬çš„ form ä¸ä¸€æ¨£å˜›ã€‚å¥½åœ¨ Django form æ˜¯å¾ˆå½ˆæ€§çš„ï¼Œform åœ¨è¢« render æˆ HTML æ™‚å¯ä»¥æä¾›ç´°ç¯€çš„èª¿æ•´ï¼Œå¤§å®¶å¯ä»¥åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/topics/forms/#form-rendering-options"&gt;å®˜ç¶² Form rendering options&lt;/a&gt; èª¿æ•´ã€‚æˆ‘ç›´æŽ¥çµ¦èª¿å¥½çš„çµæžœå§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;get&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;form.group.label_tag&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;radio&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;form.group&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
      &lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;radio.tag&lt;/span&gt; &lt;span class="cp"&gt;}}{{&lt;/span&gt; &lt;span class="nv"&gt;radio.choice_label&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨çµæžœåŽ»å°ç…§æ¯å€‹ &lt;code&gt;{{ ... }}&lt;/code&gt; éƒ¨ä»¶å°æ‡‰çš„ HTML å…ƒç´ å§ã€‚&lt;/p&gt;
&lt;h4 id="more-django-form-in-view"&gt;More Django form in view&lt;/h4&gt;
&lt;p&gt;Form çš„åŠŸèƒ½å¯ä¸åªé€™æ¨£ï¼Œå¯ä»¥åœ¨å‰µå»º DrawForm æ™‚ç›´æŽ¥æŠŠ &lt;code&gt;request.GET&lt;/code&gt; å‚³å…¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_member/views.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Retrieve all related members&lt;/span&gt;
    &lt;span class="n"&gt;form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GET&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_valid&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cleaned_data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;valid_members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# Raise 404 if no members are found given the group name&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;Http404&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;No member in group &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;
                      &lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="c1"&gt;# Lucky draw&lt;/span&gt;
    &lt;span class="n"&gt;lucky_member&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨ &lt;code&gt;form.is_valid()&lt;/code&gt; å¯ä»¥é©—è¨¼æ¯å€‹æ¬„ä½çš„è³‡æ–™æ˜¯ä¸æ˜¯æ­£ç¢ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ä¹Ÿé †ä¾¿æŠŠ /draw åŠ ä¸Š template å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_member/draw.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/base.html&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;æŠ½ç±¤çµæžœ&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;

&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ç±¤çµæžœ&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;lucky_member.name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;ï¼ˆåœ˜é«”ï¼š&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;lucky_member.group_name&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_member/views.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw_member/draw.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;lucky_member&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;lucky_member&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ›´å¤š Forms çš„ä»‹ç´¹ä¸€æ¨£åƒè€ƒ&lt;a href="https://docs.djangoproject.com/en/1.8/#forms"&gt;å®˜ç¶²&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;ç¸½çµ&lt;/h3&gt;
&lt;p&gt;åšå®Œçš„æˆå“åœ¨ &lt;a href="https://github.com/ccwang002/draw_member_django"&gt;Github&lt;/a&gt; ä¸Šï¼Œåƒè€ƒ README å°±å¯ä»¥è¨­å®šå¥½ç’°å¢ƒäº†ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ¨£å°±æŠŠ Django æœ€åŸºæœ¬çš„ Model, View, Template, Form å¹¾å€‹å¤§éƒ¨ä»½é«”é©—ä¸€éäº†ã€‚å¯ä»¥æ„Ÿè¦ºå‡ºä¾† Django æä¾›çš„åŠŸèƒ½æ¯” Flask å¤šå¾ˆå¤šï¼Œä½†ä¹Ÿä»£è¡¨è¦èŠ±æ›´å¤šçš„æ™‚å€™å­¸ç¿’ä½¿ç”¨å®ƒã€‚å…¶å¯¦æ”¹å¯«åˆ°æœ€å¾Œæˆ‘å€‘çš„ code éžå¸¸å°‘ï¼Œå¯ä»¥ç‚ºäº†çµæ§‹åŒ–çš„ code é‚„æ¯”è¼ƒå¤šã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ç„¶é€™ä¸ä»£è¡¨å°±å­¸æœƒ Django äº†ã€‚æœ€å¾Œä¾†ä»‹ç´¹å¹¾å€‹å¯ä»¥æŽ¥çºŒå­¸ç¿’çš„ Django è³‡æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers"&gt;ã€Šç‚ºç¨‹å¼äººå¯«çš„ Django Tutorial ã€‹&lt;/a&gt;æ˜¯å€‹çœŸæ­£å¾žé›¶åˆ°ä¸€çš„ 30 å¤©å­¸ç¿’è¦åŠƒï¼ˆé›–ç„¶æˆ‘å­¸äº†å¥½å¹¾å€‹æœˆ T___Tï¼‰ï¼Œæœ‰äº†é€™å€‹æŠ½ç±¤ç¨‹å¼çš„æ¦‚å¿µå†åŽ»è®€ä¸€æ¬¡æ‡‰è©²æœƒæ›´æ¸…æ¥šæ•´å€‹ Django çš„è¨­è¨ˆã€‚ä½œè€…ï¼šTzu-ping Chung (@uranusjr)&lt;/li&gt;
&lt;li&gt;&lt;a href="http://masteringdjango.com"&gt;&lt;em&gt;Mastering Django: Core&lt;/em&gt;&lt;/a&gt;, the successor to &lt;a href="http://www.djangobook.com/en/2.0/index.html"&gt;&lt;em&gt;The Django Book&lt;/em&gt;&lt;/a&gt; last updated in 2009, is the definitive guide to Django targeting the latest Django version 1.8 at the time of writing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šçš„ Django æŠ€èƒ½æ¨¹é¸æ“‡è«‹è¦‹ TP çš„ &lt;a href="https://github.com/uranusjr/django-tutorial-for-programmers/blob/master/30-moving-on.md"&gt;lesson 30&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="details"&gt;Details&lt;/h3&gt;
&lt;p&gt;è·Ÿ Flask ä¸€æ¨£ï¼Œåº•ä¸‹è¨˜éŒ„ä¸€äº›ç´°ç¯€æˆ–æ”¹å–„ç­‰ç­‰ç‚ºäº†é¿å…ç¯‡å¹…éŽé•·ï¼ˆå·²ç¶“å¤ªé•·äº†ï¼‰è€Œç§»è‡³æ­¤çš„æ®µè½ã€‚&lt;/p&gt;
&lt;h4 id="raw-sql"&gt;Raw SQL&lt;/h4&gt;
&lt;p&gt;åœ¨ä»‹ç´¹ Django Model çš„æ™‚å€™ç›´æŽ¥ç”¨äº† ORMï¼Œä½†å¯¦éš›ä¸Š Django æ˜¯å¯ä»¥å¯« raw SQL äº†ï¼Œè€Œä¸”é‚„æœ‰ã€Œè°æ˜Žç‰ˆã€çš„ raw SQL èƒ½å¤ æ‹¿å›žå°æ‡‰çš„ model objectã€‚é¦¬ä¸Šä¾†çœ‹æ€Žéº¼å›žäº‹ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆä¾†çœ‹è°æ˜Žç‰ˆçš„ raw SQLï¼Œä½¿ç”¨ &lt;code&gt;Model.objects.raw&lt;/code&gt; æ‹¿å›žæ‰€æœ‰åœ˜é«”æ˜¯ K-ON é¡žçš„æˆå“¡ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;SELECT id, name, group_name&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;FROM draw_member_member&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;WHERE group_name LIKE &amp;#39;K-ON&lt;/span&gt;&lt;span class="si"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;[&amp;lt;Member: å¹³æ²¢ å”¯ of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ç§‹å±± æ¾ª of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ç”°äº•ä¸­ å¾‹ of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ç´å¹ ç´¬ of K-ON!&amp;gt;,&lt;/span&gt;
&lt;span class="go"&gt; &amp;lt;Member: ä¸­é‡Ž æ¢“ of K-ON!&amp;gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœƒå›žå‚³ä¸€å€‹ RawQuerySetï¼Œè£¡é¢å…¶å¯¦ä¹Ÿæ˜¯ Member objectsï¼Œé€™æ˜¯é  Django åŽ»èªå°æ‡‰çš„ primary keyï¼Œä¹Ÿå°±æ˜¯èªªåœ¨ raw() SQL query è£¡ä¸€å®šè¦æ”¾ primary keyã€‚æ³¨æ„é‚£å€‹ &lt;code&gt;%&lt;/code&gt; éœ€è¦è¢« escape å› ç‚º raw() çš„ SQL query æ˜¯èƒ½æ”¾åƒæ•¸çš„ï¼ˆå°±åƒ Python å…§å»º str %-formattingï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽæˆ‘å€‘æ€Žéº¼çŸ¥é“ Member æ˜¯å­˜åœ¨å“ªå€‹ table å‘¢ï¼Ÿé è¨­æ˜¯ &lt;code&gt;&amp;lt;app&amp;gt;_&amp;lt;model&amp;gt;&lt;/code&gt;ï¼Œä½†è³‡è¨Šåœ¨ meta options è£¡çš„ &lt;code&gt;db_table&lt;/code&gt;ï¼Œä¹Ÿèƒ½è¢«è¦†å¯«ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_meta&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;db_table&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;draw_member_member&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å› ç‚º Member è£¡é¢æœ‰åƒ nameã€group_name ç­‰æ¬„ä½ï¼Œåœ¨ä¸‹ query çš„æ™‚å€™ä¸ä¸€å®šéƒ½æœƒå¯«åœ¨ SELECT è£¡é¢æŠŠæ‹¿å€¼å›žä¾†ï¼Œé‚£éº¼é€™äº›æ¬„ä½å°±æ˜¯ deferred ç‹€æ…‹ï¼Œåªæœ‰åœ¨çœŸçš„æ‹¿å€¼æ™‚æ‰æœƒåŽ»è·Ÿ database è¦ã€‚ä¸€èˆ¬ä½¿ç”¨ä¸æœƒæœ‰æ„Ÿè¦ºå…©è€…çš„å·®ç•°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s2"&gt;&amp;quot;SELECT id FROM draw_member_member&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;))[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;draw_member.models.Member_Deferred_group_name_name&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_deferred_fields&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="go"&gt;{&amp;#39;group_name&amp;#39;, &amp;#39;name&amp;#39;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½†æˆ‘å°±æ˜¯ä¸æƒ³ç”¨ ORMï¼Œé€Ÿåº¦æ…¢ï¼Œä¹Ÿæ²’è¾¦æ³•å¯«è¤‡é›œçš„ queryï¼ˆæˆ°ï¼‰ã€‚é€™å°±å›žæ­¸åˆ°æœ€å‚³çµ±çš„ database connection, cursor é€™äº›æ¦‚å¿µï¼Œå°±åƒæ²’æœ‰ SQLAlchemy çš„ Flaskã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.db&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;connection&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;SELECT name&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;FROM draw_member_member&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;WHERE group_name LIKE &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;K-ON&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="go"&gt;[(&amp;#39;å¹³æ²¢ å”¯&amp;#39;,), (&amp;#39;ç§‹å±± æ¾ª&amp;#39;,), (&amp;#39;ç”°äº•ä¸­ å¾‹&amp;#39;,), (&amp;#39;ç´å¹ ç´¬&amp;#39;,), (&amp;#39;ä¸­é‡Ž æ¢“&amp;#39;,)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;SELECT member_id, time&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;FROM draw_member_history&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;LIMIT 3&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;[(8, datetime.datetime(2015, 10, 5, 17, 36, 41, 608078, tzinfo=&amp;lt;UTC&amp;gt;)),&lt;/span&gt;
&lt;span class="go"&gt; (11, datetime.datetime(2015, 10, 5, 17, 37, 26, 164830, tzinfo=&amp;lt;UTC&amp;gt;)),&lt;/span&gt;
&lt;span class="go"&gt; (11, datetime.datetime(2015, 10, 5, 17, 37, 37, 483697, tzinfo=&amp;lt;UTC&amp;gt;))]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Here you go.&lt;/p&gt;
&lt;h4 id="better-queryset"&gt;Better QuerySet&lt;/h4&gt;
&lt;p&gt;çœ‹éŽäº† raw SQL ä¹‹å¾Œï¼Œæˆ‘å€‘ä¾†æƒ³æƒ³ ORM çš„æ”¹å–„å§ã€‚é›–ç„¶èªªæ¯æ¬¡è¦æŸ¥è©¢çš„æ™‚å€™åƒå¯« SQL ä¸€æ¨£æŠŠ query çµ„åˆå‡ºä¾†ä¹Ÿå¯ä»¥ï¼Œä½†ç”¨ ORM çš„å¥½è™•æ‡‰è©²æ˜¯èƒ½æŠŠé€™äº›å¯¦ä½œç´°ç¯€è·Ÿã€ŒåŒ…è£èµ·ä¾†ã€ã€‚ä¾‹å¦‚æœ€è¿‘ n æ¬¡æŠ½ç±¤è¨˜éŒ„ã€æ‰€æœ‰æˆå“¡çš„åœ˜é«”åç¨±ï¼ˆç›®å‰æ˜¯å¯«æ­»åœ¨ DrawForm è£¡é¢ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ™‚å€™å°±å¯ä»¥æŠŠå¸¸ç”¨çš„ query è®Šæˆä¸€å€‹ methodï¼Œä¾‹å¦‚æœ€è¿‘ 10 æ¬¡æŠ½ç±¤è¨˜éŒ„å°±åªè¦ç”¨ &lt;code&gt;History.objects.recent(10)&lt;/code&gt; å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;é€™å…¶å¯¦æœ‰å¾ˆå¤šåšæ³•ï¼Œåƒæ˜¯å¯«ä¸€å€‹ classmethodã€Override default Managerã€Override default QuerySetã€‚å“ªå€‹æ–¹æ³•æ¯”è¼ƒå¥½å‘¢ï¼Ÿåœ¨ &lt;a href="http://stackoverflow.com/a/2213341"&gt;StackOverflow&lt;/a&gt;ã€&lt;a href="https://groups.google.com/forum/#!topic/django-users/0WSdnWFTuUg"&gt;mail list&lt;/a&gt; éƒ½æœ‰è¨Žè«–ã€‚åŸºæœ¬ä¸Šéƒ½èƒ½é”åˆ°ç›¸åŒçš„æ•ˆæžœï¼Œä½†å¾Œå…©è€…çš„åšæ³•æ˜¯æ¯”è¼ƒåå¥½çš„ï¼Œå› ç‚º Manager(or QuerySet for Django 1.7+) è² è²¬è™•ç† model å°æ‡‰åˆ°çš„ database table ç­‰ç´šçš„æ“ä½œï¼Œä½† classmethod æ‡‰è©²æ˜¯è™•ç†å·²ç¶“å¾ž table row ä¸­æ‹¿å‡ºçš„ä¸€å€‹ model object ç›¸é—œçš„æ“ä½œã€‚å¦‚æžœæŠŠåŒæ¨£æ€§è³ªçš„ code æ”¾åœ¨ä¸€èµ·ï¼Œå°±æ‡‰è©²ä½¿ç”¨ Manager(QuerySet)ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸” TP ä¹Ÿåœ¨ Gitter ä¸Šé–‹ç¤ºäº†ï¼Œå°±æ˜¯é€™æ¨£ï¼ˆçµæ¡ˆï¼‰ã€‚ä¾†æ”¹å¯« modelã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_member/models.py&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MemberQuerySet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;QuerySet&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;unique_groups&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values_list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;flat&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;distinct&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HistoryQuerySet&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;QuerySet&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;recent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;order_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[:&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Member&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;objects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MemberQuerySet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_manager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;History&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;objects&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;HistoryQuerySet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;as_manager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ Member æˆ‘å€‘å®šç¾©äº†ä¸€å€‹ &lt;code&gt;unique_groups&lt;/code&gt; æ‹¿å›žæ‰€æœ‰åœ˜é«”çš„åç¨±ï¼›åœ¨ History å®šç¾©äº† &lt;code&gt;recent&lt;/code&gt; æ‹¿å‡ºæŒ‰æ™‚é–“æŽ’åºæœ€å‰é¢ n å€‹ã€‚æ–°å®šç¾©çš„ &lt;code&gt;QuerySet.as_manager()&lt;/code&gt; å°±å–ä»£æŽ‰æœ¬ä¾†çš„ &lt;code&gt;Model.objects&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŽ¥è‘—ä¾†æ”¹å¯« view æŠŠä¹‹å‰å¯«çš„ query æ›æŽ‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#draw_member/views.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="n"&gt;recent_draws&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;History&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£å°±ç°¡æ½”ä¸€é»žã€‚å†ä¾†é †ä¾¿æŠŠ form æ”¹å¾—æ¯”è¼ƒå½ˆæ€§ï¼Œä¸è¦æŠŠåœ˜é«”åå¯«æ­»ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#draw_member/forms.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;member_group_choices&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;valid_groups&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Member&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unique_groups&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;choices&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;grp&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;valid_groups&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;grp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;grp&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ï¼ˆå…¨ï¼‰&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;choices&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;forms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Form&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;forms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ChoiceField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;choices&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;member_group_choices&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="timezone"&gt;Timezone&lt;/h4&gt;
&lt;p&gt;æ„Ÿè¦ºæœ€è¿‘ä¸€ç›´åœ¨å¯«&lt;a href="../../09/datetime-sqlite/"&gt;æ™‚å€ç›¸é—œçš„æ±è¥¿&lt;/a&gt;å•Šã€‚åŸºæœ¬ä¸Š server è¨˜éŒ„çš„æ™‚é–“éƒ½ç”¨ UTC å•é¡Œå°±å°‘å¾ˆå¤šï¼Œä½†æœ€å¾Œé‚„æ˜¯è¦å‘ˆç¾ä¸€å€‹ä½¿ç”¨è€…ç”¨çš„æ™‚å€ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å•é¡Œæ˜¯ HTTP header è£¡é¢ä¸¦æ²’æœ‰é€™æ¨£çš„è³‡è¨Šï¼Œæ‰€ä»¥ä¸€ä¾†ç”¨ geoip åŽ»çŒœï¼ŒäºŒä¾†ç”¨å¯«å€‹ javascript åœ¨ä½¿ç”¨è€…è¼‰å…¥çš„æ™‚å€™åŽ»åˆ¤æ–·æ™‚å€ï¼Œç¸½ä¹‹æ˜¯å€‹è¦å¦å¤–è¨˜éŒ„çš„æ±è¥¿ã€‚ç´°ç¯€&lt;a href="https://docs.djangoproject.com/en/1.8/topics/i18n/timezones/#selecting-the-current-time-zone"&gt;å®˜ç¶²ä¸Šä¹Ÿæœ‰èªªæ˜Ž&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ–‡ä¸­æ˜¯ä½¿ç”¨ &lt;code&gt;activate('Aisa/Taipei')&lt;/code&gt; æŠŠæ™‚å€æ”¹æˆ UTC+8ã€‚é€™é‚Šä»‹ç´¹å¦ä¸€å€‹æ–¹å¼ï¼Œæ˜¯å¯«åœ¨ template è£¡é¢çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_member/templates/draw_member/history.html #}&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;block&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;load&lt;/span&gt; &lt;span class="nv"&gt;tz&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æŠ½ç±¤æ­·å²ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="c"&gt;{# ... #}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;timezone&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;history&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;recent_histories&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="c"&gt;{# ... #}&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endtimezone&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tbody&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endblock&lt;/span&gt; &lt;span class="nv"&gt;content&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="post-form-and-csrf"&gt;POST form and CSRF&lt;/h4&gt;
&lt;p&gt;å¿˜è¨˜è¬›äº†ï¼Œæˆ‘å€‘çš„ form ç›®å‰æ˜¯ç”¨ &lt;code&gt;action="get"&lt;/code&gt;ï¼Œç•¶ç„¶å¯ä»¥æ”¹å›žç”¨ POSTï¼Œä¹Ÿå¾ˆç°¡å–®ï¼Œå°± GET æ›æˆ POST å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_site/views.py&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.views.decorators.http&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;require_POST&lt;/span&gt;

&lt;span class="nd"&gt;@require_POST&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Retrieve all related members&lt;/span&gt;
    &lt;span class="n"&gt;form&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DrawForm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;POST&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_site/templates/home.html #}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é¦¬ä¸Šä¾†è©¦è©¦çœ‹ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/10/django-draw-member/pics/django_csrf_failed.png"/&gt;
  &lt;figcaption&gt;POST form without CSRF token&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æ‹¿åˆ°äº†ä¸€å€‹ 403 Forbidden &amp;ldquo;CSRF verification failed.&amp;rdquo;ã€‚CSRF (Cross Site Request Forgery) åœ¨ &lt;a href="https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"&gt;wiki&lt;/a&gt; æœ‰æ¯”è¼ƒå®Œæ•´çš„ä»‹ç´¹ï¼Œé€™æ˜¯ä¸€ç¨®æ”»æ“Šæ‰‹æ³•ï¼Œåœ¨ä½¿ç”¨è€…ç™»å…¥ç¶²ç«™ä¹‹å¾Œï¼ˆsession ç‚ºç™»å…¥ç‹€æ…‹ï¼‰ï¼Œå½é€ ä¸€å€‹è·Ÿç¶²ç«™ä¸Šä¸€æ¨£çš„ form ä¾†å½è£ä½¿ç”¨è€…çš„è¡Œç‚ºã€‚ä¾‹å¦‚è³¼ç¥¨ç³»çµ±è²·ç¥¨ï¼Œå¦‚æžœæ²’æª¢æŸ¥çš„è©±ï¼Œæˆ‘å¯ä»¥æ‹¿ä½¿ç”¨è€…çš„ session åŽ»ç¶²ç«™ä¸Šéš¨ä¾¿è²·ç¥¨ï¼Œç¶²ç«™éƒ½æœƒèªç‚ºæ˜¯ä½¿ç”¨è€…åœ¨æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ &lt;a href="https://docs.djangoproject.com/en/1.8/ref/csrf/"&gt;CSRF token&lt;/a&gt; ç”¨ä¾†é˜²ç¯„é€™å€‹å½é€ ï¼Œåœ¨ç”¢ç”Ÿ form çš„æ™‚å€™ï¼Œç¶²ç«™æœƒå†ç”¢ç”Ÿä¸€å€‹æ¬„ä½çš„å€¼ï¼Œé€™å€‹æ¬„ä½çš„å€¼æ¯æ¬¡éƒ½æœƒæ”¹è®Šï¼Œé€™æ¨£å°±èƒ½ç¢ºå®šé€™å€‹ form æ˜¯å¾žç¶²ç«™ä¸Šæ‹¿åˆ°çš„ã€‚Django è™•ç† CSRF protection æ˜¯é€éŽ &lt;a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/"&gt;Middleware&lt;/a&gt;ï¼Œä¸€å€‹ä»¥å‰æ²’æœ‰æåˆ°çš„æ¦‚å¿µï¼Œè¡¨ç¤ºä»–æ˜¯æ¯”è¼ƒåº•å±¤çš„æ±è¥¿ã€‚ç›¸å°è€Œè¨€ï¼Œä¹Ÿä¸ç”¨æ”¹æˆ‘å€‘çš„ codeï¼Œåœ¨é€™å€‹ä¾‹å­å°±åªè¦æŠŠ &lt;code&gt;{% csrf_token %}&lt;/code&gt; åŠ åˆ° form è£¡é¢å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c"&gt;{# draw_site/templates/home.html #}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;action&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;draw&amp;#39;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="c"&gt;{# ... #}&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;csrf_token&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;submit&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="django"></category><category term="sqlite"></category><category term="python"></category></entry><entry><title>Datetime in SQLite and Python</title><link href="https://blog.liang2.tw/posts/2015/09/datetime-sqlite/" rel="alternate"></link><published>2015-09-28T12:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-28:/posts/2015/09/datetime-sqlite/</id><summary type="html">&lt;p&gt;æ•´ç†åœ¨ Python ä¸­è™•ç†æ™‚å€çš„å•é¡Œï¼Œä¸¦å¦‚ä½•è‡ª SQLite å­˜å–è€ƒæ…®æ™‚å€çš„æ™‚é–“&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¦æ­£ç¢ºè™•ç†æ™‚é–“ä¸¦ä¸å®¹æ˜“ã€‚æ‰¿æŽ¥&lt;a href="../flask-draw-member"&gt;æˆ‘å€‘å…ˆå‰çš„ä¾‹å­&lt;/a&gt;ï¼Œå…¶å¯¦æ˜¯ç›´æŽ¥æŠŠæ™‚é–“è½‰æ›å‡ºä¾†çš„å­—ä¸²å­˜åœ¨ SQLite è£¡ã€‚é€™æœ‰å¹¾å€‹å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯æ™‚å€çš„å•é¡Œã€‚æˆ‘å€‘ç›´æŽ¥æŠŠ server æ‰€åœ¨æ™‚å€çš„æ™‚é–“å­˜åˆ°è³‡æ–™åº«åŽ»ï¼Œå°åŒ—çš„æ™‚å€ç‚º &lt;a href="https://en.wikipedia.org/wiki/Asia/Taipei"&gt;Asia/Taipei&lt;/a&gt; (UTC+8)ã€‚å¦‚æžœä»Šå¤© server è·‘åˆ°å¦ä¸€å€‹æ™‚å€ï¼Œä¾‹å¦‚æ±äº¬ Asia/Tokyo (UTC+9) å¥½äº†ï¼Œé€™æ™‚å€™è³‡æ–™åº«è£¡å°±åŒ…å«äº†å…©å€‹æ™‚å€çš„æ™‚é–“ï¼Œä½†å› ç‚ºæ˜¯å­—ä¸²æ˜¯å®Œå…¨çœ‹ä¸å‡ºå·®ç•°çš„ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†ç”¨å­—ä¸²å­˜æ™‚é–“ä¹Ÿæœ‰ä¸€äº›å•é¡Œã€‚é¦–å…ˆæ˜¯æŽ’åºï¼Œé›–ç„¶æˆ‘å€‘çš„ä¾‹å­æ˜¯èƒ½æ­£ç¢ºçš„æŽ’åºï¼Œä½†å¦‚æžœæ™‚é–“æ ¼å¼æ›äº†ï¼ˆåƒ &lt;code&gt;%H:%M:%S %Y-%m-%d&lt;/code&gt;ï¼‰é‚£å°±ä¸ä¸€å®šã€‚å†ä¾†å¯ä»¥çœ‹åˆ°å¾ŒçºŒæƒ³è™•ç†æ™‚é–“å°±æœƒæ¯”è¼ƒè¤‡é›œã€‚ä¸éŽé€™ä¸€éƒ¨ä»½æ˜¯å› ç‚º SQLite æ²’æœ‰å°ˆé–€è™•ç†æ—¥æœŸæ™‚é–“çš„è³‡æ–™åž‹æ…‹ï¼Œåƒ PostgreSQL å°±èƒ½çœ‹å¾—æ‡‚ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æƒ³è¦æ­£ç¢ºè™•ç†æ™‚é–“æœ‰å¹¾å€‹è¦é»žï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜åˆ°è³‡æ–™åº«çš„æ™‚é–“æ‡‰è©²è¦ UTC ä¾†è¡¨ç¤º&lt;/li&gt;
&lt;li&gt;åœ¨è™•ç†æ™‚é–“æ™‚ï¼ˆæŽ’åºã€é¡¯ç¤ºã€è™•ç†æ™‚å€ï¼‰ï¼Œæ‡‰è©²è½‰æˆæ­£ç¢ºçš„è³‡æ–™æ ¼å¼ï¼ˆä¾‹å¦‚ &lt;a href="https://docs.python.org/3.5/library/datetime.html#datetime-objects"&gt;datetime&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å‘ˆç¾çµ¦ä½¿ç”¨è€…æ™‚å†è½‰æ›åˆ°è©²äººï¼ˆæˆ– serverï¼‰æ‰€åœ¨æ™‚å€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åº•ä¸‹æ˜¯æ¯”è¼ƒæ­£ç¢ºè™•ç†æ™‚é–“çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#timezone"&gt;æ™‚å€ï¼ˆTimezoneï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datetime-in-sqlite-again"&gt;Datetime in SQLite, again&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python-3-timezone"&gt;Python 3 å…§å»º timezone æ”¯æ´&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#python-sqlite-adapter"&gt;è®“ Python å…§å»º SQLite adapter æ”¯æ´æ™‚å€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="timezone"&gt;æ™‚å€ï¼ˆTimezoneï¼‰&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘éƒ½é‚„æ²’æœ‰è™•ç†éŽæ™‚å€ã€‚æ™‚å€åœ¨ Python å…§å»ºçš„ datetime åªæ˜¯å€‹ã€Œæ¦‚å¿µã€ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä½¿ç”¨è€…å¯ä»¥å‚³é€²åŽ»ä¸åŒçš„æ™‚å€ï¼ˆå­˜åœ¨ &lt;code&gt;datetime.tzinfo&lt;/code&gt; ä¸­ï¼‰ï¼ŒPython èƒ½é‡å°æœ‰æä¾›æ™‚å€çš„ datetime åšæ­£ç¢ºçš„åˆ¤æ–·ã€‚ä½†å°åŒ—çš„æ™‚å€æ˜¯å¤šå°‘ï¼Œç´ç´„çš„æ™‚å€æ˜¯å¤šå°‘å®ƒä¸çŸ¥é“ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºä»€éº¼ä¸è™•ç†å„åœ°æ™‚å€é€™éº¼é‡è¦çš„æ¦‚å¿µï¼Ÿå› ç‚ºæ™‚é–“è®Šå‹•çš„é€Ÿåº¦å¾ˆå¿«ï¼ŒåŠ ä¸Šæ—¥å…‰ç¯€ç´„æ™‚é–“æ¯å¹´å¯èƒ½éƒ½ä¸ä¸€æ¨£ï¼ŒPython ä¸‹ä¸€ç‰ˆé‚„æ²’å‡ºæ™‚å€çš„è³‡è¨Šå·²ç¶“æ›´æ–°äº†å¾ˆå¤šæ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤åœ¨ Python ä¸­å¯¦éš›ä¸Šæ™‚å€è™•ç†é å¾—æ˜¯ç¬¬ä¸‰æ–¹å¥—ä»¶ &lt;a href="http://pythonhosted.org/pytz/"&gt;pytz&lt;/a&gt;ã€‚åƒå®‰è£ Flask ä¸€æ¨£ï¼Œç”¨ &lt;code&gt;pip install pytz&lt;/code&gt; å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯¦éš›æ“ä½œçœ‹çœ‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;      &lt;span class="c1"&gt;# local time&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 16, 33, 39, 537111)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;   &lt;span class="c1"&gt;# UTC time&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 8, 33, 39, 538745)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é¦–å…ˆï¼Œå¯ä»¥çœ‹åˆ° datetime æœ¬èº«æä¾›äº† &lt;code&gt;now()&lt;/code&gt; ä»¥åŠ &lt;code&gt;utcnow()&lt;/code&gt; å…©å€‹ function ä¾†æ‹¿åˆ°ç¾åœ¨çš„æ™‚é–“ã€‚å°åŒ—æ˜¯ UTC+8 æ‰€ä»¥æ™‚é–“æ¯” UTC æ™‚é–“å­—é¢ä¸Šå¿« 8 å°æ™‚ã€‚æ³¨æ„åˆ°å…©å€‹å›žå‚³çš„ datetime ç‰©ä»¶éƒ½æ²’æœ‰åŒ…å«æ™‚å€çš„è³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;è™•ç†æ™‚é–“åŽŸå‰‡ä¸Šéƒ½ä»¥ UTC ç‚ºåŸºæº–ã€‚æˆ‘å€‘å»ºç«‹ä¸€å€‹ UTC çš„ç¾åœ¨æ™‚é–“å­˜åœ¨è®Šæ•¸ &lt;code&gt;utcnow&lt;/code&gt;ï¼Œä¸¦ä¸”ç”¨ pytz è™•ç†æ™‚é–“ã€‚Import pytz é€²ä¾†ï¼Œä¸¦ä¸”å®šç¾©äº†å…©å€‹æ™‚å€ï¼šUTC ä»¥åŠ TPEï¼ˆå°åŒ—æ™‚é–“ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 8, 38, 14, 738241)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 8, 38, 14, 738241, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 16, 38, 14, 738241, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨ pytz å®šç¾©çš„æ™‚å€è™•ç† datetime ä¹‹å¾Œå°±æœƒå¤šäº† &lt;code&gt;tzinfo&lt;/code&gt; çš„è³‡è¨Šã€‚é€™æ™‚ä¹Ÿèƒ½æ­£ç¢ºæ¯”è¼ƒä¸åŒæ™‚å€çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•è™•ç†ä¸€å€‹ä»»æ„å®šç¾©çš„æ™‚é–“å‘¢ï¼Ÿä¾‹å¦‚ 2016 å¹´å°åŒ—å…ƒæ—¦å¥½äº†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;2016-01-01 00:00:00&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2016, 1, 1, 0, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 12, 31, 16, 0, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code&gt;.localize(&amp;lt;datetime&amp;gt;)&lt;/code&gt; çµ¦äºˆä¸€å€‹åˆå§‹æ²’æœ‰æ™‚å€è³‡è¨Šçš„ &lt;code&gt;datetime&lt;/code&gt; æ™‚å€ã€‚æœ‰äº†æ™‚å€ä¹‹å¾Œï¼Œè¦åœ¨ä¸åŒæ™‚å€é–“è½‰æ›å°±ä½¿ç”¨ &lt;code&gt;.normalize(&amp;lt;datetime&amp;gt;)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥å†æŸ¥æŸ¥ç•¶å°åŒ— 2016 å…ƒæ—¦æ™‚ï¼Œç¾Žåœ‹æ±å²¸æ™‚é–“æ˜¯å¹¾é»žã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;est&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;US/Eastern&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;est&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 12, 31, 11, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;US/Eastern&amp;#39; EST-1 day, 19:00:00 STD&amp;gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»¥å¾Œè¦çœ‹çƒè³½è½‰æ’­ã€é‡è¦ç™¼è¡¨å°±ä¸æœƒå†æžä¸æ¸…æ¥šæ™‚é–“äº†ã€‚&lt;/p&gt;
&lt;h3 id="datetime-in-sqlite-again"&gt;Datetime in SQLite, again&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æœƒè™•ç† datetime èˆ‡æ™‚å€äº†ï¼Œé‚£éº¼å°±ä¾†æ”¹å¯«ä¸€ä¸‹æœ¬ä¾† SQLite å­˜æ™‚é–“çš„æ–¹å¼ã€‚å…¶å¯¦ Python datetime æ”¯æ´ SQLite è½‰æ›ï¼ŒåŒæ¨£å¾ž&lt;a href="https://docs.python.org/3.5/library/sqlite3.html#default-adapters-and-converters"&gt;Python module èªªæ˜Žæ–‡ä»¶&lt;/a&gt;è£¡é¢æ‹¿å‡ºä¾†çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s2"&gt;&amp;quot;test.db&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;detect_types&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_DECLTYPES&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_COLNAMES&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;CREATE TABLE test(dt timestamp)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;sqlite3.Cursor object at 0x10a59b960&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è³‡æ–™æ¬„ä½çš„è¨­ç‚º &lt;code&gt;timestamp&lt;/code&gt;ï¼Œä¸¦ä¸”åœ¨é€£æŽ¥çš„æ™‚å€™è¨­å®š &lt;code&gt;PARSE_DECLTYPES&lt;/code&gt; åŠ &lt;code&gt;PARSE_COLNAMES&lt;/code&gt;ï¼Œç¨å¾Œå¯ä»¥çœ‹åˆ°ä»–å€‘çš„æ•ˆæžœã€‚
è¶•å¿«æŠŠæ™‚é–“å­˜é€²åŽ»å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 12, 48, 16, 671538)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="s1"&gt;&amp;#39;INSERT INTO test(dt) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utcnow&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;sqlite3.Cursor object at 0x1082380a0&amp;gt;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 12, 31, 16, 0, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc_dt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_2016_newyear&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="s1"&gt;&amp;#39;INSERT INTO test(dt) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utc_dt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;sqlite3.Cursor object at 0x10a59b960&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å­˜äº†å…©å€‹æ™‚é–“ï¼Œä¸€å€‹æ˜¯ UTC çš„ç¾åœ¨æ™‚é–“ï¼Œå¦ä¸€å€‹æ˜¯ä»¥ UTC è¡¨ç¤ºçš„å°åŒ— 2016 å…ƒæ—¦ã€‚æ³¨æ„å…©å€‹æ™‚é–“éƒ½æŠŠ UTC æ™‚å€åŽ»æŽ‰äº†ï¼Œå› ç‚ºåœ¨æŸäº›æƒ…æ³åº•ä¸‹ SQLite èˆ‡ python çš„ datetime adapter æœƒçœ‹ä¸æ‡‚æ™‚å€ï¼ˆé€™æ˜¯å€‹ &lt;a href="https://bugs.python.org/issue19065"&gt;bug #19065&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœç”¨ SQLite å¯ä»¥çœ‹åˆ°æ™‚é–“éƒ½æ˜¯ä»¥ UTC å‘ˆç¾ã€‚ä»å¯ä»¥ç”¨å®ƒå…§å»ºçš„ &lt;code&gt;datetime('&amp;lt;UTC time&amp;gt;', 'localtime')&lt;/code&gt; æŠŠ UTC æ™‚é–“å­—ä¸²è½‰æ›æˆé›»è…¦çš„ç•¶åœ°æ™‚é–“ã€‚é€™æ¨£è™•ç†æ˜¯å®¹æ˜“èˆ‡å…¶ä»–æ‡‰ç”¨ç¨‹å¼ç›¸å®¹çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;-- sqlite3 test.db&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;schema&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;CREATE TABLE test(dt timestamp);&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 12:48:16.671538&lt;/span&gt;
&lt;span class="go"&gt;2015-12-31 16:00:00&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;localtime&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 20:48:16&lt;/span&gt;
&lt;span class="go"&gt;2016-01-01 00:00:00&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†ç”¨ Python è®€å›žä¾†ä»ç„¶æ˜¯ datetime æ ¼å¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;ret_vals&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SELECT dt AS &amp;quot;[timestamp]&amp;quot; FROM test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;ret_vals&lt;/span&gt;
&lt;span class="go"&gt;[(datetime.datetime(2015, 9, 29, 12, 48, 16, 671538),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2015, 12, 31, 16, 0),)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;ret_vals&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2015, 9, 29, 20, 48, 16, 671538, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 1, 1, 0, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="python-3-timezone"&gt;Python 3 å…§å»º timezone æ”¯æ´&lt;/h4&gt;
&lt;p&gt;ç‚ºäº†å¯«é€™ç¯‡ blog åˆç ”ç©¶äº†ä¸€ä¸‹å…§å»ºçš„ datetime.timezoneã€‚Python 2 æ²’æœ‰é€™å€‹åŠŸèƒ½ï¼Œä¸éŽåŸºæœ¬çš„ timedelta æœ‰ï¼Œæ‰€ä»¥è¦è‡ªå·±åšæ‡‰è©²ä¹Ÿæ˜¯åšå¾—åˆ°â€¦å§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å…§å»ºçš„ datetime.timezone ç”±ä¸€å€‹ utcoffset åšå»ºç«‹ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å‚³å€‹ç›¸å°æ–¼ UTC çš„æ™‚é–“å·®ï¼Œä»¥ datetime.timedelta è¡¨ç¤ºã€‚ä¸€æ¨£å…§å»ºå¸¶æœ‰ UTC æ™‚å€ï¼Œé€™é‚Šè©¦è‘—å»ºäº†å°åŒ—ä»¥åŠæ±äº¬çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;dt&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 20, 40, 49, 347568)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_delta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_delta&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn_delta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jpn_delta&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘äººåœ¨å°åŒ—ï¼Œæ‰€ä»¥ datetime.datetime.now() æœƒçµ¦æˆ‘å°åŒ—æ™‚é–“ï¼Œå†ç”¨ timedelta æ‰‹å‹•ç®—å‡ºå„æ™‚å€çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc_now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe_now&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;tpe_delta&lt;/span&gt;  &lt;span class="c1"&gt;# manually time shift&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn_now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;jpn_delta&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;utc_now&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 12, 40, 49, 347568)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt;
&lt;span class="go"&gt;False&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç›´æŽ¥æ¯”è¼ƒé€™äº›ç®—å‡ºä¾†çš„æ™‚é–“ï¼Œä¸æ„å¤–ä¸ç›¸ç­‰ï¼Œå› ç‚ºé è¨­çš„ tzinfo æ˜¯ç©ºçš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 20, 40, 49, 347568, tzinfo=datetime.timezone(datetime.timedelta(0, 28800)))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;jpn_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;jpn&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çµ¦äº†å„åœ°çš„æ™‚å€çš„ tzinfo ä¹‹å¾Œï¼Œå¯ä»¥çœ‹åˆ° datetime åœ¨åšæ¯”è¼ƒçš„æ™‚å€™æ˜¯æœ‰è€ƒæ…®æ™‚å€ä½ç§»çš„ã€‚&lt;/p&gt;
&lt;p&gt;æŽ¥è‘—å†ä¾†çœ‹ä¸€ä¸‹pytz èˆ‡å…§å»º datetime.timezone çš„ç›¸å®¹ç¨‹åº¦ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz_utc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz_tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jpn_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;jpn&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="go"&gt;datetime.datetime(2015, 9, 29, 12, 40, 49, 347568, tzinfo=&amp;lt;UTC&amp;gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pytz_tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe_now&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;utc_now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¯”è¼ƒè·Ÿè½‰æ›éƒ½æ²’æœ‰å•é¡Œï¼Œå¯ä»¥æ”¾å¿ƒè½‰æ›ã€‚&lt;/p&gt;
&lt;h3 id="python-sqlite-adapter"&gt;è®“ Python å…§å»º SQLite adapter æ”¯æ´æ™‚å€&lt;/h3&gt;
&lt;p&gt;çœ‹äº†ä¸€ä¸‹ &lt;a href="https://bugs.python.org/issue19065"&gt;Python issue 19065&lt;/a&gt;ï¼Œä¹‹æ‰€ä»¥æ²’æœ‰è§£æ±ºå…¶å¯¦æ˜¯ç¼º patchï¼Œå› ç‚ºç¾åœ¨çš„ patch ä¸¦ä¸ç›¸å®¹ Python 2.xï¼ˆæ²’æœ‰ datetime.timezoneï¼‰ï¼Œç„¶å¾Œ pysqlite çš„ç¶­è­·è€…ä¸¦æ²’æœ‰æƒ³è¦æ”¯æ´ timezone çš„æ„æ€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽé‚£åªæ˜¯å…§å»ºçš„ adapter for datetime.datetime objectï¼Œè¦è‡ªå·±åšä¹Ÿæ²’å•é¡Œã€‚åƒè€ƒ issue è£¡é¢æä¾›çš„è§£æ³•ï¼ˆåœ¨ Github &lt;a href="https://gist.github.com/acdha/6655391"&gt;gist&lt;/a&gt; ä¸Šï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# tz_aware_adpater.py&lt;/span&gt;
&lt;span class="c1"&gt;# Adapt from https://gist.github.com/acdha/6655391&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;tz_aware_timestamp_adapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;datepart&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;month&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;datepart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tz_offset&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rsplit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;tz_offset&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;00:00&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tz_offset&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timedelta&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;

    &lt;span class="n"&gt;timepart_full&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;timepart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seconds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timepart_full&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;timepart_full&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;microseconds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;{:0&amp;lt;6.6}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;timepart_full&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;()))&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;microseconds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;

    &lt;span class="n"&gt;val&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;month&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;hours&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;microseconds&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;tzinfo&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;val&lt;/span&gt;

&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;register_converter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;timestamp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tz_aware_timestamp_adapter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;python3 -i tz_aware_adpater.py&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s1"&gt;&amp;#39;test.db&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;     &lt;span class="n"&gt;detect_types&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_DECLTYPES&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PARSE_COLNAMES&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pytz&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Asia/Taipei&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2016&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;2016-06-03 08:00:00+08:00&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executemany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="s1"&gt;&amp;#39;INSERT INTO test(dt) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt;&lt;span class="p"&gt;,),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pytz&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;normalize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pycontw&lt;/span&gt;&lt;span class="p"&gt;),)]&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å­˜äº†å…©å€‹å¸¶æœ‰æ™‚å€çš„æ™‚é–“ï¼ˆå…©å€‹æ™‚é–“æ˜¯ç›¸åŒçš„ï¼‰ã€‚å…ˆå¾ž SQLite ä¾†è®€è®€çœ‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 12:48:16.671538&lt;/span&gt;
&lt;span class="go"&gt;2015-12-31 16:00:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 08:00:00+08:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 00:00:00+00:00&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;localtime&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;2015-09-29 20:48:16&lt;/span&gt;
&lt;span class="go"&gt;2016-01-01 00:00:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 08:00:00&lt;/span&gt;
&lt;span class="go"&gt;2016-06-03 08:00:00&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ™‚å€æ˜¯ç›´æŽ¥å¯«åˆ° SQLite è£¡é¢ï¼Œæ²’æœ‰çš„è©±å°±ç•¶æˆæ˜¯ UTC æ™‚å€ã€‚&lt;/p&gt;
&lt;p&gt;å†ç”¨ Python è®€å›žä¾†ï¼Œæ¸¬ä¸€ä¸‹ä¿®æ”¹çš„ adapterã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;dts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SELECT dt FROM test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;dts&lt;/span&gt;
&lt;span class="go"&gt;[(datetime.datetime(2015, 9, 29, 12, 48, 16, 671538),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2015, 12, 31, 16, 0),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2016, 6, 3, 8, 0, tzinfo=datetime.timezone(datetime.timedelta(0, 28800))),),&lt;/span&gt;
&lt;span class="go"&gt; (datetime.datetime(2016, 6, 3, 0, 0, tzinfo=datetime.timezone.utc),)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astimezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dts&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:]]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è®€å›žä¾†æ²’æœ‰å•é¡Œï¼Œå¦‚æžœè¦å®Œæ•´è™•ç†æ‰€æœ‰æƒ…æ³ï¼ˆå‰é¢å…©å€‹ datetime æ˜¯ naive æ²’æœ‰æ™‚å€ï¼‰&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astimezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;  &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="n"&gt;utc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;localize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dts&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2015, 9, 29, 12, 48, 16, 671538, tzinfo=&amp;lt;UTC&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2015, 12, 31, 16, 0, tzinfo=&amp;lt;UTC&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 0, 0, tzinfo=&amp;lt;UTC&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 0, 0, tzinfo=&amp;lt;UTC&amp;gt;)]&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astimezone&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tzinfo&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;  &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="n"&gt;tpe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromutc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dts&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="go"&gt;[datetime.datetime(2015, 9, 29, 20, 48, 16, 671538, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 1, 1, 0, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;),&lt;/span&gt;
&lt;span class="go"&gt; datetime.datetime(2016, 6, 3, 8, 0, tzinfo=&amp;lt;DstTzInfo &amp;#39;Asia/Taipei&amp;#39; CST+8:00:00 STD&amp;gt;)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="_1"&gt;ç¸½çµ&lt;/h3&gt;
&lt;p&gt;æ™‚å€çœŸçš„å¾ˆç…©ï¼Œå°¤å…¶æ˜¯å¾ˆå¤šåœ°æ–¹ä¸ä¸€å®šéƒ½å®Œæ•´æ”¯æ´æ™‚å€ï¼Œæœ€å¥½çš„æƒ…æ³é‚„æ˜¯ç”¨ UTC æºé€šï¼Œåªæœ‰åœ¨çœŸçš„éœ€è¦æ™‚å†è½‰æ›æˆç•¶åœ°æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœå¤§å®¶å°æ™‚å€å¾ˆæœ‰èˆˆè¶£ï¼Œä¸ä¹…å‰ &lt;a href="https://www.python.org/dev/peps/pep-0495/"&gt;PEP 495&lt;/a&gt; å·²ç¶“è¢«æŽ¥å—ï¼Œæ²’æœ‰æ„å¤–æ‡‰è©²æœƒå‡ºç¾åœ¨ Python 3.6 è£¡é¢ï¼Œå®ƒè™•ç†çš„æ˜¯æ—¥å…‰ç¯€ç´„æ™‚é–“çš„å•é¡Œã€‚ï¼ˆæ„Ÿè¦ºåœ¨è‡ºç£å°æ—¥å…‰ç¯€ç´„æ™‚é–“å®Œå…¨æ²’æœ‰æ¦‚å¿µå•Šï¼‰&lt;/p&gt;
&lt;p&gt;ä¸å¾—ä¸èªªè¦æ­£ç¢ºè™•ç†æ™‚é–“â€¦å¾ˆéº»ç…©å•Šã€‚&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="datetime"></category><category term="pytz"></category><category term="sqlite"></category><category term="python"></category></entry><entry><title>ç”¨ Flask èˆ‡ SQLite æž¶æŠ½ç±¤ç¶²ç«™</title><link href="https://blog.liang2.tw/posts/2015/09/flask-draw-member/" rel="alternate"></link><published>2015-09-28T12:00:00-05:00</published><updated>2022-05-13T13:06:34-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-28:/posts/2015/09/flask-draw-member/</id><summary type="html">&lt;p&gt;ç‚ºäº†å¯¦é©—å®¤çš„å°ˆé¡Œç”Ÿè€Œå¯«ã€‚&lt;/p&gt;
&lt;p&gt;ç›®æ¨™å…¶å¯¦æ˜¯ Django + Django ORM + PostgreSQLï¼Œä¸éŽä¸€æ¬¡æŽ¥è§¸å¤ªå¤šæœƒæœ‰åæ•ˆæžœï¼Œå…ˆæ“ä½œæ¯”è¼ƒç°¡å–®çš„æ‰å¥½ä¸Šæ‰‹ã€‚æ‰€ä»¥é€™é‚Šè¬› â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç‚ºäº†å¯¦é©—å®¤çš„å°ˆé¡Œç”Ÿè€Œå¯«ã€‚&lt;/p&gt;
&lt;p&gt;ç›®æ¨™å…¶å¯¦æ˜¯ Django + Django ORM + PostgreSQLï¼Œä¸éŽä¸€æ¬¡æŽ¥è§¸å¤ªå¤šæœƒæœ‰åæ•ˆæžœï¼Œå…ˆæ“ä½œæ¯”è¼ƒç°¡å–®çš„æ‰å¥½ä¸Šæ‰‹ã€‚æ‰€ä»¥é€™é‚Šè¬›çš„ä¸¦ä¸æ˜¯ best practiceï¼Œä½†ä½¿ç”¨æœ€å°‘ï¼ˆåº•å±¤ï¼‰çš„çŸ¥è­˜èˆ‡å·¥å…·ã€‚å¦‚æžœä¸€é–‹å§‹è®“å¤ªå¤šå¥—ä»¶ï¼ˆåƒ SQLAlchemyï¼‰åšæŽ‰äº†ç´°ç¯€éƒ¨ä»½ï¼Œåè€Œä¸å¤ªèƒ½æŽŒæ¡åˆ°é‡è¦çš„æ¦‚å¿µä»¥åŠç‚ºä»€éº¼éœ€è¦é€™äº›å¥—ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬ç¯‡æ–‡ç« éžå¸¸é•·ï¼Œæ‡‰è©²æ²’è¾¦æ³•å¹¾åˆ†é˜å…§è®€å®Œã€‚å°è±¡æ˜¯åˆå­¸è€…å­¸ç¿’ç°¡å–®ç¶²ç«™æž¶è¨­ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€™å€‹å°ˆæ¡ˆçš„ç›®æ¨™ï¼šå› ç‚ºå¤§å®¶ meeting çš„æ™‚å€™éƒ½ä¸å•å•é¡Œï¼Œæ•™æŽˆéœ€è¦ä¸€å€‹æŠ½ç±¤é»žäººå•å•é¡Œçš„å·¥å…·ã€‚æˆ‘å€‘å¯¦é©—å®¤æœ‰åˆ†æˆå¹¾å€‹çµ„åˆ¥ï¼Œæ‰€ä»¥æŠ½ç±¤çš„æ™‚å€™ä¹Ÿè¦èƒ½é‡å°å–®å€‹çµ„åˆ¥æŠ½ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä½¿ç”¨ &lt;a href="https://zh.wikipedia.org/wiki/LoveLive!"&gt;LoveLive!&lt;/a&gt; é‚„æœ‰ &lt;a href="https://zh.wikipedia.org/wiki/K-ONï¼è¼•éŸ³éƒ¨"&gt;K-ON!&lt;/a&gt; çš„æˆå“¡ä¾†ç•¶ä¾‹å­ã€‚&lt;strong&gt;å…ˆè²æ˜Žæˆ‘å…©å€‹å‹•ç•«éƒ½æ²’æœ‰çœ‹éŽï¼Œå¦‚æžœæœ‰ä»€éº¼åå­—æ‰“éŒ¯è«‹å‘Šè¨´æˆ‘ï¼Œçµ•å°ä¸æ˜¯æ•…æ„çš„ã€‚&lt;/strong&gt;ï¼ˆ2016-06-14 æ›´æ–°ï¼šæˆ‘æŠŠå…©å€‹å‹•ç•«éƒ½çœ‹å®Œäº†ï¼ï¼‰&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;è³‡æ–™è¨­è¨ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ç¶²ç«™æž¶æ§‹è¦åŠƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;å¯¦ä½œç’°å¢ƒè¨­å®š&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#python"&gt;Python ç’°å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#flaskjinja2"&gt;å®‰è£ Flaskã€Jinja2 ç­‰å¥—ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sqlite-database"&gt;SQLite Database&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#csv"&gt;æŠŠ CSV å¯«é€²è³‡æ–™åº«&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#flask"&gt;Flask åŸºæœ¬æž¶æ§‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#flask-sqlite"&gt;Flask èˆ‡ SQLite è³‡æ–™åº«è®€å–&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#first-view-first-template"&gt;First view, first template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;æŠ½ç±¤åŠŸèƒ½&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#get-vs-post"&gt;GET vs POST&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#form"&gt;Form&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#request-form-post-handling-in-flask"&gt;Request (Form / POST) handling in Flask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#demo"&gt;Demo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#more-on-templates"&gt;More on templates&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_5"&gt;æ­·å²è¨˜éŒ„&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#datetime"&gt;æ™‚é–“è™•ç†ç”¨ datetime&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#whats-next"&gt;What&amp;rsquo;s Next&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#static-files-and-better-theme"&gt;Static files and better theme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#more-how-web-works"&gt;More how web works&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#object-relational-model-orm"&gt;Object Relational Model (ORM)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#django"&gt;Django&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_6"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#details"&gt;Details&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#sqlite-table-info"&gt;SQLite table info&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sqlite-foreign-key-check"&gt;SQLite foreign key check&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_7"&gt;é‡æ–°è®€å…¥è³‡æ–™&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datetime-in-sqlite-and-python"&gt;Datetime in SQLite and Python&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="_1"&gt;è³‡æ–™è¨­è¨ˆ&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å…ˆå‡è¨­æ‰€æœ‰æª”æ¡ˆéƒ½æ”¾åœ¨åŒå€‹è³‡æ–™å¤¾è£¡ï¼Œä¼°ä¸”å« &lt;code&gt;draw_member&lt;/code&gt;ã€‚ä¹‹å¾Œæ²’æœ‰é¡å¤–èªªæ˜Žçš„è©±ï¼Œéƒ½æ˜¯åœ¨é€™å€‹ç›®éŒ„ä¸‹æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åŽŸå§‹è³‡æ–™ç”¨ CSV æ ¼å¼ä¾†å„²å­˜ï¼Œæœ‰ã€Œåå­—ã€ä»¥åŠã€Œåœ˜é«”ã€å…©å€‹æ¬„ä½ã€‚ä¸éŽè€ƒæ…®åˆ°å¯èƒ½æœƒæŠŠæª”æ¡ˆåŒ¯å‡ºï¼Œåœ¨åŽŸå§‹æª”æ¡ˆå¤šåŠ ä¸€å€‹ã€Œæœ€è¿‘è¢«æŠ½åˆ°çš„æ—¥æœŸã€æ¬„ä½ï¼Œå¸Œæœ›æœ€è¿‘è¢«æŠ½åˆ°çš„æœƒæ¯”å…¶ä»–äººå†è¢«æŠ½åˆ°çš„æ©Ÿæœƒä½Žä¸€é»žã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹ CSV æª”æ¡ˆå‘½åç‚º &lt;code&gt;members.csv&lt;/code&gt;ã€‚ä¸€é–‹å§‹æ²’æœ‰äººè¢«æŠ½åˆ°ï¼Œæ‰€ä»¥æœ€å¾Œä¸€æ¬„éƒ½å…ˆè¨­æˆç©ºçš„&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œç¬¬ä¸€è¡Œæ˜¯æ¯ä¸€æ¬„æ¬„ä½çš„åç¨±ã€‚å¦‚æžœå¾žè³‡æ–™åº«åŒ¯å‡ºï¼Œé€™æ¬„ä½å°±æœƒæœ‰å€¼ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;åå­—&amp;quot;,&amp;quot;åœ˜é«”&amp;quot;,&amp;quot;æœ€è¿‘è¢«æŠ½åˆ°çš„æ—¥æœŸ&amp;quot;
&amp;quot;é«˜å‚ ç©‚ä¹ƒæžœ&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;çµ¢ç€¬ çµµé‡Œ&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;å— ã“ã¨ã‚Š&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;åœ’ç”° æµ·æœª&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;æ˜Ÿç©º å‡›&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;è¥¿æœ¨é‡Ž çœŸå§«&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;æ±æ¢ å¸Œ&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;å°æ³‰ èŠ±é™½&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;çŸ¢æ¾¤ ã«ã“&amp;quot;,&amp;quot;Î¼&amp;#39;s&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;å¹³æ²¢ å”¯&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ç§‹å±± æ¾ª&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ç”°äº•ä¸­ å¾‹&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ç´å¹ ç´¬&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&amp;quot;ä¸­é‡Ž æ¢“&amp;quot;,&amp;quot;K-ON!&amp;quot;,&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é¦–å…ˆæˆ‘å€‘å…ˆç¢ºå®šæœƒç”¨ Python æŠŠè³‡æ–™è®€å‡ºä¾†ã€‚åœ¨ Python ç•¶ä¸­æœ‰å€‹å« &lt;code&gt;csv&lt;/code&gt; çš„å…§å»ºæ¨¡çµ„ï¼ˆmoduleï¼‰å¯ä»¥è™•ç† CSV çš„æª”æ¡ˆè®€å¯«ã€‚åœ¨é€™é‚Šæˆ‘å€‘é¸ç”¨ &lt;a href="https://docs.python.org/3.5/library/csv.html#csv.DictReader"&gt;csv.DictReader&lt;/a&gt;ï¼Œå®ƒé è¨­æœƒæŠŠæª”æ¡ˆçš„ç¬¬ä¸€è¡Œç•¶æˆæ¬„ä½åç¨±ï¼Œç„¶å¾Œæ ¹æ“šé€™åç¨±ï¼Œæ¯ä¸€è¡Œéƒ½æœƒç”¢ç”Ÿä¸€å€‹ &lt;code&gt;dict&lt;/code&gt; ç‰©ä»¶ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./members.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥æŠŠé€™æ®µç¨‹å¼ç¢¼ç›´æŽ¥æ‰“åœ¨ Python REPL è£¡æˆ–è€…å­˜æˆä¸€å€‹æª”æ¡ˆå¾Œå†ç”¨ Python åŸ·è¡Œå®ƒï¼Œçµæžœéƒ½æœƒæ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;çµ¢ç€¬ çµµé‡Œ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;å— ã“ã¨ã‚Š&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ’ç”° æµ·æœª&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ˜Ÿç©º å‡›&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;è¥¿æœ¨é‡Ž çœŸå§«&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;æ±æ¢ å¸Œ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;å°æ³‰ èŠ±é™½&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;çŸ¢æ¾¤ ã«ã“&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Î¼&amp;#39;s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;å¹³æ²¢ å”¯&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç§‹å±± æ¾ª&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç”°äº•ä¸­ å¾‹&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ç´å¹ ç´¬&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ä¸­é‡Ž æ¢“&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æžœä¸è¦ç›´æŽ¥ &lt;code&gt;print(row)&lt;/code&gt; ï¼Œè€Œæ˜¯ç¨å¾®æ•´ç†ä¸€ä¸‹è³‡æ–™å†è¼¸å‡ºï¼Œæ”¹æˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./members.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;{}&lt;/span&gt;&lt;span class="s1"&gt; of &lt;/span&gt;&lt;span class="si"&gt;{}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‰‡è¼¸å‡ºçµæžœæœƒæ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;é«˜å‚ ç©‚ä¹ƒæžœ of Î¼&amp;#39;s
çµ¢ç€¬ çµµé‡Œ of Î¼&amp;#39;s
å— ã“ã¨ã‚Š of Î¼&amp;#39;s
åœ’ç”° æµ·æœª of Î¼&amp;#39;s
æ˜Ÿç©º å‡› of Î¼&amp;#39;s
è¥¿æœ¨é‡Ž çœŸå§« of Î¼&amp;#39;s
æ±æ¢ å¸Œ of Î¼&amp;#39;s
å°æ³‰ èŠ±é™½ of Î¼&amp;#39;s
çŸ¢æ¾¤ ã«ã“ of Î¼&amp;#39;s
å¹³æ²¢ å”¯ of K-ON!
ç§‹å±± æ¾ª of K-ON!
ç”°äº•ä¸­ å¾‹ of K-ON!
ç´å¹ ç´¬ of K-ON!
ä¸­é‡Ž æ¢“ of K-ON!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£å°±ç¢ºå®šæˆ‘å€‘æœ‰è¾¦æ³•æŠŠè³‡æ–™ç”¨ Python è®€å–äº†ã€‚è¦æ‹¿æ¯å€‹æ¬„ä½çš„å…§å®¹ä¹Ÿå¾ˆç°¡å–®ï¼Œåƒè¦åå­—çš„è©±ï¼Œåªè¦ç”¨ &lt;code&gt;row['åå­—']&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;ç¶²ç«™æž¶æ§‹è¦åŠƒ&lt;/h3&gt;
&lt;p&gt;é€™å€‹æŠ½ç±¤ç¶²ç«™ä¸»è¦å°±å¹¾å€‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¦–é &lt;/strong&gt;å¯ä»¥é¸æ“‡å…¶ä¸­ä¸€å€‹åœ˜é«”æˆ–æ‰€æœ‰äººåŽ»æŠ½ç±¤&lt;ul&gt;
&lt;li&gt;é€å‡ºä¹‹å¾Œå¯ä»¥çœ‹åˆ°çµæžœ&lt;/li&gt;
&lt;li&gt;ä¸¦ä¸”æŠŠé€™å€‹æŠ½ç±¤çµæžœæ›´æ–°åˆ°æ­·å²è¨˜éŒ„è£¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­·å²è¨˜éŒ„&lt;/strong&gt;åˆ—å‡ºéŽåŽ»è¢«æŠ½åˆ°çš„è¨˜éŒ„&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ›´æ–°æˆå“¡&lt;/strong&gt;æ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼Œé‡æ–°è®€å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯ä¸€é æˆ‘å€‘è¦æœ‰å€‹åŠŸèƒ½è¡¨åˆ—ï¼Œæ–¹ä¾¿åŠŸèƒ½çš„åˆ‡æ›ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥è³‡æ–™åº«çš„éƒ¨ä»½æœƒæœ‰å…©å¼µè¡¨æ ¼ï¼š&lt;strong&gt;members&lt;/strong&gt; ä»¥åŠ &lt;strong&gt;draw_histories&lt;/strong&gt; åˆ†åˆ¥è¨˜éŒ„æˆå“¡ä»¥åŠè¢«æŠ½éŽçš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;pre style="font-family: Consolas, 'Courier New', monospace"&gt;
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ members             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id          INTEGER â”‚ &lt;â”€â”
    â”‚ name           TEXT â”‚   â”‚
    â”‚ group_name     TEXT â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ draw_histories      â”‚   â”‚ foreign
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ key
    â”‚ memberid    INTEGER â”‚ â”€â”€â”˜
    â”‚ time       DATETIME â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/pre&gt;

&lt;p&gt;Table &lt;strong&gt;members&lt;/strong&gt; æ‡‰è©²å¾ˆå¥½ç†è§£ï¼Œä¸€å€‹æ¬„ä½æ˜¯åå­— nameï¼Œä¸€å€‹æ˜¯åœ˜é«”åç¨± group_nameã€‚å…¶ä¸­ id é€™å€‹æ¬„ä½æ˜¯ç¨‹å¼å…§éƒ¨åœ¨ä½¿ç”¨çš„ï¼Œå®ƒæœƒåœ¨è®€å…¥è³‡æ–™çš„æ™‚å€™è‡ªå‹•ç”¢ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;Table &lt;strong&gt;draw_histories&lt;/strong&gt; è¨˜éŒ„æ¯æ¬¡æŠ½ç±¤ç™¼ç”Ÿçš„æ™‚é–“ time é‚„æœ‰èª°è¢«æŠ½åˆ° memberidï¼Œå¯ä»¥ç™¼ç¾ memberid æ˜¯ç”¨æˆå“¡çš„ idï¼Œå› æ­¤æˆ‘å€‘å¤šåŠ ä¸€å€‹é™åˆ¶æ˜¯é€™æ¬„ä½çš„å€¼æ‡‰è©²è¦åœ¨ members è£¡çš„ id ä¸­å‡ºç¾éŽã€‚&lt;/p&gt;
&lt;h3 id="_3"&gt;å¯¦ä½œç’°å¢ƒè¨­å®š&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘é¸ç”¨ &lt;a href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; æž¶è¨­ serverï¼Œå› ç‚ºå®ƒä¸€é–‹å§‹ç”¨ç›¸ç•¶ç°¡å–®ã€‚è³‡æ–™çš„éƒ¨ä»½æœƒè®€åˆ° &lt;a href="https://www.sqlite.org/"&gt;SQLite&lt;/a&gt; è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Flask&lt;/em&gt; is a microframework for Python based on Werkzeug, Jinja 2 and good intentions. (Flask official site)&lt;/p&gt;
&lt;p&gt;&lt;em&gt;SQLite&lt;/em&gt; is a software library that implements a self-contained, serverless, zero-configuration, transactional SQL database engine. (SQLite official site)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="python"&gt;Python ç’°å¢ƒ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a href="https://www.python.org/downloads/"&gt;Python 3.5&lt;/a&gt;ã€‚ç†è«–ä¸Š SQLite å°±å·²ç¶“è£å¥½äº†èƒ½ç›´æŽ¥ä½¿ç”¨ã€‚ä¸€èˆ¬åœ¨é–‹ç™¼ Python ç¨‹å¼çš„æ™‚å€™æœƒä½¿ç”¨è™›æ“¬ç’°å¢ƒï¼Œå¥½è™•è™›æ“¬ç’°å¢ƒå®‰è£çš„ Python å¥—ä»¶å¯ä»¥ç¨ç«‹ç®¡ç†ï¼Œä¸å—ç³»çµ±æˆ–å…¶ä»–è™›æ“¬ç’°å¢ƒå½±éŸ¿ã€‚æˆ‘å€‘ç”¨å…§å»ºçš„ &lt;a href="https://docs.python.org/3.5/library/venv.html#module-venv"&gt;venv&lt;/a&gt; å»ºç«‹ä¸€å€‹åç¨±ç‚º &lt;code&gt;VENV&lt;/code&gt; çš„è™›æ“¬ç’°å¢ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python3.5 -m venv VENV
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ™‚å€™ç›®éŒ„åº•ä¸‹å°±æœƒå¤šä¸€å€‹ &lt;code&gt;VENV&lt;/code&gt; è³‡æ–™å¤¾ï¼Œè£¡é¢æ˜¯å€‹å®Œæ•´çš„ Python åŸ·è¡Œçµæ§‹ï¼Œå°±å¥½åƒåœ¨é€™å€‹è·¯å¾‘å®‰è£ Python ä¸€æ¨£ã€‚å…ˆæš«æ™‚ä¸ç®¡å®ƒæ€Žéº¼åšåˆ°è™›æ“¬éš”é›¢ï¼ŒçŸ¥é“æ€Žéº¼ç”¨å°±å¥½ã€‚ä½¿ç”¨è·Ÿé›¢é–‹åˆ†åˆ¥æ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ &lt;span class="nb"&gt;source&lt;/span&gt; VENV/bin/activate
&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ which python
&lt;span class="c1"&gt;# /path/to/draw_member/VENV/bin/python&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ deactivate
$  &lt;span class="c1"&gt;# å‰é¢çš„ (VENV) æœƒæ¶ˆå¤±&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="flaskjinja2"&gt;å®‰è£ Flaskã€Jinja2 ç­‰å¥—ä»¶&lt;/h4&gt;
&lt;p&gt;Python ä½¿ç”¨ pip ç®¡ç†å®‰è£çš„å¥—ä»¶ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ pip install flask jinja2
&lt;span class="c1"&gt;# Collecting flask&lt;/span&gt;
&lt;span class="c1"&gt;# Collecting jinja2&lt;/span&gt;
&lt;span class="c1"&gt;# ... (é€£å¸¶è£äº†ç›¸é—œçš„å¥—ä»¶ï¼‰&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ™‚å€™å¦‚æžœæŸ¥çœ‹è£äº†å“ªäº›å¥—ä»¶å°±æœƒçœ‹åˆ°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ pip freeze
&lt;span class="c1"&gt;# Flask==0.10.1&lt;/span&gt;
&lt;span class="c1"&gt;# itsdangerous==0.24&lt;/span&gt;
&lt;span class="c1"&gt;# Jinja2==2.8&lt;/span&gt;
&lt;span class="c1"&gt;# MarkupSafe==0.23&lt;/span&gt;
&lt;span class="c1"&gt;# Werkzeug==0.10.4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç‚ºäº†æ–¹ä¾¿ä¹‹å¾ŒæŠŠç’°å¢ƒå®‰è£åœ¨åˆ¥çš„é›»è…¦ä¸Šï¼Œè¨˜å¾—ç”¨&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip freeze &amp;gt; requirements.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŠŠå¥—ä»¶ç‰ˆæœ¬çš„è³‡è¨Šéƒ½å­˜åœ¨ä¸€å€‹æª”æ¡ˆè£¡çš„å¥½è™•æ˜¯ï¼Œä¸‹æ¬¡æŠŠè¦ç’°å¢ƒæž¶èµ·ä¾†å°±åªè¦&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip install -r requirements.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°±è¨­å®šå®Œæˆäº†ã€‚&lt;/p&gt;
&lt;h4 id="sqlite-database"&gt;SQLite Database&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘å…ˆæŠŠ SQLite æ¯å€‹è³‡æ–™è¡¨è¨­å®šå¥½ï¼Œé€™æ¨£ä¹‹å¾Œåœ¨å¯«ç¨‹å¼å°±åªè¦å°ˆå¿ƒè®€å¯«è³‡æ–™å°±å¥½äº†ã€‚æ ¹æ“šå‰é¢å»ºçš„æ¨¡åž‹ï¼Œæˆ‘å€‘å¯ä»¥è½‰æ›æˆ SQL èªžæ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;-- create_db.sql&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INTEGER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIMARY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ASC&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;AUTOINCREMENT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INTEGER&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DATETIME&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DEFAULT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;now&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;localtime&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;FOREIGN&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;REFERENCES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŠŠé€™ä¸² SQL å¯«åˆ°ä¸€å€‹æª”æ¡ˆ &lt;code&gt;create_db.sql&lt;/code&gt; å¾Œå°±å¯ä»¥å¯¦éš›æ¸¬è©¦ä¸€ä¸‹ã€‚æˆ‘å€‘æŠŠå…©å€‹æˆå“¡å¯«åˆ°æª”æ¡ˆè£¡é¢ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sqlite3 -init create_db.sql test.db
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;-- Loading resources from create_db.sql&lt;/span&gt;

&lt;span class="go"&gt;SQLite version 3.8.11.1 2015-07-29 20:00:57&lt;/span&gt;
&lt;span class="go"&gt;Enter &amp;quot;.help&amp;quot; for usage hints.&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Î¼&amp;#39;&amp;#39;s&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;å¹³æ²¢ å”¯&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;K-ON!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;id|name|group_name&lt;/span&gt;
&lt;span class="go"&gt;1|é«˜å‚ ç©‚ä¹ƒæžœ|Î¼&amp;#39;s&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;sqlite3 -init xxx.sql&lt;/code&gt; æ„æ€æ˜¯æŠŠ &lt;code&gt;xxx.sql&lt;/code&gt; è£¡é¢çš„ SQL æŒ‡ä»¤éƒ½åŸ·è¡Œäº†ä¸€éï¼Œæ‰€ä»¥ä¸€é€²åˆ° SQLite shell è£¡é¢å°±å»ºç«‹å¥½è¡¨æ ¼äº†ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æˆ‘å€‘æ¨¡æ“¬å¹¾æ¬¡æŠ½ç±¤çš„éŽç¨‹ã€‚æ³¨æ„åˆ°æˆ‘å€‘ä¹‹å‰æœ‰å¯« &lt;strong&gt;draw_histories&lt;/strong&gt;.time çš„é è¨­å€¼ï¼Œæ‰€ä»¥æŠ½ç±¤åªè¦å¯«æ˜¯èª°å°±å¯ä»¥äº†ï¼Œæ™‚é–“ SQLite æœƒè‡ªå‹•æ ¹æ“šæŒ‡ä»¤åŸ·è¡Œçš„æ™‚é–“çµ¦å€¼ã€‚ä¸éŽæˆ‘å€‘éƒ½è©¦ä¸€ä¸‹å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;time&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;2015-09-25 16:30&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰€ä»¥ç¬¬ä¸€æ¬¡ INSERT æŒ‡ä»¤æŠ½äº†æžœæžœä»¥åŠå°å”¯å„ä¸€æ¬¡ã€‚ç¬¬äºŒæ¬¡ INSERT å†æŠ½äº†ä¸€æ¬¡å°å”¯ï¼Œé€™æ¬¡é‚„æœ‰é¡å¤–æŒ‡å®šæ™‚é–“ç‚ºçš„ 9 æœˆ 25 è™Ÿä¸‹åˆ 4 é»žåŠã€‚é—œæ–¼ SQLite è£¡ &lt;code&gt;datetime&lt;/code&gt; çš„æ›´å¤šä½¿ç”¨æ–¹å¼å¯ä»¥åƒè€ƒ&lt;a href="https://sqlite.org/lang_datefunc.html"&gt;å®˜ç¶²èªªæ˜Žæ–‡ä»¶&lt;/a&gt;ï¼Œæˆ‘å€‘çš„ä¾‹å­åªè¦é€™æ¨£å°±è¶³å¤ äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;memberid|time&lt;/span&gt;
&lt;span class="go"&gt;1|2015-09-28 16:55:03&lt;/span&gt;
&lt;span class="go"&gt;2|2015-09-28 16:55:03&lt;/span&gt;
&lt;span class="go"&gt;2|2015-09-25 16:30:00&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‰å…©å€‹å°±æ˜¯ç¬¬ä¸€æ¬¡ INSERT æ‰€å»ºç«‹çš„æŠ½ç±¤æ­·å²ï¼Œè·Ÿä½ ä¸‹æŒ‡ä»¤çš„æ™‚é–“æœ‰é—œã€‚ç¬¬äºŒæ¬¡ INSERT æœ‰çµ¦å®šæ™‚é–“ï¼Œæ‰€ä»¥è¨˜éŒ„æ°¸é æ˜¯ 9 æœˆ 25 è™Ÿä¸‹åˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;draw_histories&lt;/strong&gt; åªå„²å­˜äº† member_idï¼Œæˆ‘å€‘å¯ä»¥åšä¸€å€‹æ¯”è¼ƒè¤‡é›œçš„æŸ¥è©¢ï¼ŒæŠŠæˆå“¡çš„åå­—è·Ÿæ‰€å±¬åœ˜é«”ä¸€èµ·åˆ—å‡ºä¾†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_time&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;AS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;as&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WHERE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;   ...&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;time&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ASC&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;id|name|group_name|draw_time&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!|2015-09-25 16:30:00&lt;/span&gt;
&lt;span class="go"&gt;1|é«˜å‚ ç©‚ä¹ƒæžœ|Î¼&amp;#39;s|2015-09-28 16:55:03&lt;/span&gt;
&lt;span class="go"&gt;2|å¹³æ²¢ å”¯|K-ON!|2015-09-28 16:55:03&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="csv"&gt;æŠŠ CSV å¯«é€²è³‡æ–™åº«&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å°±æŠŠä¹‹å¾Œè¦ç”¨çš„è³‡æ–™åº«å–åç‚º &lt;code&gt;members.db&lt;/code&gt;ã€‚æˆ‘å€‘å…ˆæŠŠåˆå§‹çš„è³‡æ–™å¯«é€²è³‡æ–™åº«è£¡ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‚Šåªæœ‰å¤šä¸€å€‹åœ¨ Python è£¡æ“ä½œ SQLite çš„æ­¥é©Ÿã€‚é€éŽ Python å…§å»ºçš„ &lt;a href="https://docs.python.org/3.5/library/sqlite3.html"&gt;sqlite&lt;/a&gt; module å°±å¯ä»¥æŽ§åˆ¶è³‡æ–™åº«å­˜å–ã€‚å…ˆç¢ºå®šæœ‰é€™äº›æª”æ¡ˆäº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;members.csv&lt;/code&gt;: æ‰€æœ‰æˆå“¡è³‡æ–™&lt;/li&gt;
&lt;li&gt;&lt;code&gt;create_db.sql&lt;/code&gt;: è³‡æ–™åº« schema&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…ˆ import ç”¨åˆ°çš„ module&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŠŠæˆå“¡è³‡æ–™å¾ž CSV è®€é€²ä¾†ï¼Œè·Ÿä¹‹å‰ä¸€æ¨£ï¼Œåªæ˜¯æˆ‘å€‘ç¨å¾®æ•´ç†ä¸€ä¸‹æ ¼å¼ï¼Œå­˜åœ¨ &lt;code&gt;members&lt;/code&gt; é€™å€‹è®Šæ•¸ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./members.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;csv_reader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;csv_reader&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;
&lt;span class="go"&gt;[(&amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;çµ¢ç€¬ çµµé‡Œ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;å— ã“ã¨ã‚Š&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;åœ’ç”° æµ·æœª&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;),&lt;/span&gt;
&lt;span class="go"&gt; # ...&lt;/span&gt;
&lt;span class="go"&gt; (&amp;#39;ä¸­é‡Ž æ¢“&amp;#39;, &amp;#39;K-ON!&amp;#39;)]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŽ¥è‘—æ˜¯æ–°çš„éƒ¨ä»½ï¼Œè¦å…ˆç”¨ &lt;code&gt;sqlite3.connect()&lt;/code&gt; å»ºç«‹ SQLite database é€£ç·šï¼Œç„¶å¾Œå†ç”¨é€™å€‹é€£ç·šåŽ»ä¸‹ SQL æŒ‡ä»¤ã€‚é¦–å…ˆè¦æŠŠ table éƒ½å»ºç«‹å‡ºä¾†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;create_db.sql&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;create_db_sql&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;members.db&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executescript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;create_db_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;db.executescript('...')&lt;/code&gt; å¯ä»¥åŸ·è¡Œä¸€ç³»åˆ—çš„ SQL æŒ‡ä»¤ï¼ˆæ³¨æ„æŒ‡ä»¤é–“è¦æœ‰åˆ†è™Ÿï¼‰ã€‚å¦å¤–ä½¿ç”¨ &lt;code&gt;with db: ...&lt;/code&gt; ä½œç”¨æ˜¯æœƒ sqlite3 module æœƒè‡ªå‹•å¹«æˆ‘å€‘æŠŠä¸­é–“çš„ SQL æŒ‡ä»¤é€å‡º&lt;sup id="fnref:sqlite3 auto commit"&gt;&lt;a class="footnote-ref" href="#fn:sqlite3 auto commit"&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œç­‰åŒæ–¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cursor&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executescript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;create_db_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†ä¾†æŠŠè®€é€²ä¾†çš„ &lt;code&gt;members&lt;/code&gt; è®Šæ•¸å¯«åˆ°è³‡æ–™è¡¨è£¡é¢ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executemany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="s1"&gt;&amp;#39;INSERT INTO  members (name, group_name) VALUES (?, ?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;        &lt;span class="n"&gt;members&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è©¦è‘—æŠŠè³‡æ–™è®€å‡ºä¾†ï¼Œç¢ºå®šçœŸçš„å­˜é€²åŽ»äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SELECT * FROM members LIMIT 3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="go"&gt;(1, &amp;#39;é«˜å‚ ç©‚ä¹ƒæžœ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;)&lt;/span&gt;
&lt;span class="go"&gt;(2, &amp;#39;çµ¢ç€¬ çµµé‡Œ&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;)&lt;/span&gt;
&lt;span class="go"&gt;(3, &amp;#39;å— ã“ã¨ã‚Š&amp;#39;, &amp;quot;Î¼&amp;#39;s&amp;quot;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åˆ°äº†é€™é‚Šæˆ‘å€‘è³‡æ–™çš„éƒ¨ä»½æ²’å•é¡Œäº†ï¼ŒæŽ¥ä¸‹ä¾†å°±è¦è™•ç†ç¶²ç«™æµç¨‹æœ¬èº«ã€‚&lt;/p&gt;
&lt;h3 id="flask"&gt;Flask åŸºæœ¬æž¶æ§‹&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://flask.pocoo.org/"&gt;Flask&lt;/a&gt; çš„ web server å¯ä»¥æŠŠæ‰€æœ‰åŠŸèƒ½éƒ½å¯«åœ¨ä¸€å€‹æª”æ¡ˆï¼Œåœ¨é€™é‚Šå°±ä»¥ &lt;code&gt;draw_member.py&lt;/code&gt; ç‚ºä¾‹å­ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;
&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„ Flask server æž¶æ§‹ã€‚å…ˆä¾†æ¸¬è©¦çœ‹çœ‹ï¼Œéƒ½å·²ç¶“ç­‰å¾…ä¸€åƒå…­ç™¾å¤šå­—äº†ã€‚å…ˆæŠŠ server è·‘èµ·ä¾†ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;(&lt;/span&gt;VENV&lt;span class="o"&gt;)&lt;/span&gt; $ python draw_member.py
 * Running on http://127.0.0.1:5000/ &lt;span class="o"&gt;(&lt;/span&gt;Press CTRL+C to quit&lt;span class="o"&gt;)&lt;/span&gt;
 * Restarting with stat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†ä¾†å¯ä»¥é–‹ç€è¦½å™¨è¨ªå• &lt;a href="http://localhost:5000/"&gt;http://localhost:5000/&lt;/a&gt;ï¼Œæˆ–è€…ç”¨ command line ä¾†è¨ªå•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ curl &lt;span class="s1"&gt;&amp;#39;http://localhost:5000/&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# &amp;lt;p&amp;gt;Hello World!&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœƒçœ‹åˆ° server å›žå‚³ã€ŒHello World!ã€ã€‚å¤ªæ„Ÿå‹•äº†ï¼åº•ä¸‹å…ˆèªªæ˜Žæ•´å€‹æµç¨‹èˆ‡ code çš„é—œä¿‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;app&lt;/code&gt; æ˜¯æ•´å€‹ Flask application çš„æ ¸å¿ƒç‰©ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æœ€å¾Œæˆ‘å€‘æœƒå‘¼å«å®ƒçš„ &lt;code&gt;.run()&lt;/code&gt; ä¾†ç”¢ç”Ÿä¸€å€‹å¯ä»¥å‹•çš„ web serverã€‚&lt;code&gt;debug=True&lt;/code&gt; è¡¨ç¤ºå¦‚æžœ server æœ‰éŒ¯èª¤çš„æ™‚å€™ Flask æœƒæä¾›æˆ‘å€‘å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯ï¼ŒåŒ…å«éŒ¯èª¤æ˜¯åœ¨å“ªå€‹ Python function è£¡ç”¢ç”Ÿçš„ï¼ŒéŒ¯èª¤æ™‚å„å€‹è®Šæ•¸çš„å€¼ç­‰ç­‰ã€‚å› ç‚ºé€™æ¨£æœƒä¹Ÿæœƒè®“æœ‰å¿ƒäººå£«çŸ¥é“ç¶²ç«™æ˜¯æ€Žéº¼é‹è¡Œçš„ï¼Œè®Šæ­£å¼ç¶²ç«™ï¼ˆä¸Š productionï¼‰æ™‚æœƒæŠŠé€™å€‹é¸é …é—œæŽ‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å®šç¾©äº†ä¸€å€‹ &lt;code&gt;index&lt;/code&gt; function ä¸¦ä¸”ç”¨ decorator æŠŠé€™å€‹å‡½å¼ç¶å®šåœ¨ &lt;code&gt;/&lt;/code&gt; è·¯å¾‘ä¹Ÿå°±æ˜¯é¦–é ä¸Šã€‚ä½¿ç”¨è€…è¨ªå• &lt;code&gt;/&lt;/code&gt; å°±æœƒè·‘åˆ°é€™å€‹ function è£¡ä¾†ã€‚&lt;/p&gt;
&lt;h3 id="flask-sqlite"&gt;Flask èˆ‡ SQLite è³‡æ–™åº«è®€å–&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘å…ˆæŠŠè³‡æ–™åº«ç›¸é—œçš„å‡½å¼éƒ½å…ˆå¯«å¥½ï¼Œé€™é‚ŠåŸºæœ¬ä¸Šåƒç…§ &lt;a href="http://flask.pocoo.org/docs/0.10/patterns/sqlite3/#using-sqlite-3-with-flask"&gt;Flask å®˜ç¶² SQLite ä½¿ç”¨æ–¹å¼&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;csv&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sqlite3&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;

&lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Flask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;SQLITE_DB_PATH&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;members.db&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;SQLITE_DB_SCHEMA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;create_db.sql&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;MEMBER_CSV_PATH&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;members.csv&amp;#39;&lt;/span&gt;


&lt;span class="c1"&gt;# SQLite3-related operations&lt;/span&gt;
&lt;span class="c1"&gt;# See SQLite3 usage pattern from Flask official doc&lt;/span&gt;
&lt;span class="c1"&gt;# http://flask.pocoo.org/docs/0.10/patterns/sqlite3/&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;getattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;_database&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_database&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SQLITE_DB_PATH&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c1"&gt;# Enable foreign key check&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PRAGMA foreign_keys = ON&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;teardown_appcontext&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;close_connection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;exception&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;getattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;_database&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸€ä¸‹å­å¤šäº†å¾ˆå¤š codeï¼Œå¦‚æžœå¤ªè¤‡é›œå¯ä»¥å…ˆç•¶ä½œå°±æ˜¯é€™æ¨£å§ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦äº†è§£çš„éƒ¨ä»½ï¼Œç¬¬ä¸€æ˜¯ &lt;code&gt;g&lt;/code&gt; é€™å€‹è®Šæ•¸è£¡å¯ä»¥æ”¾å¾ˆå¤šéœ€è¦å‚³ä¾†å‚³åŽ»çš„è®Šæ•¸ï¼Œæ‰€ä»¥å°±æŠŠå»ºç«‹å¥½çš„è³‡æ–™åº«é€£ç·šæ”¾åœ¨ &lt;code&gt;g._database&lt;/code&gt;ã€‚å¹³å¸¸å¦‚æžœè¦ç”¨é€™å€‹é€£ç·šçš„è©±ï¼Œå°±ç”¨ &lt;code&gt;db = get_db()&lt;/code&gt; åŽ»æ‹¿ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒæ˜¯æˆ‘å€‘æŠŠè³‡æ–™çš„è·¯å¾‘ç­‰ç­‰ï¼Œéƒ½å¯«æˆè®Šæ•¸æ”¾åœ¨ç¨‹å¼ç¢¼çš„æœ€é–‹é ­ã€‚é€™æ˜¯å€‹å¥½ç¿’æ…£ï¼ŒæŠŠå¸¸æ•¸è·Ÿç¨‹å¼åˆ†é–‹ä¾†ï¼Œç®¡ç†æ‰æ–¹ä¾¿&lt;sup id="fnref:flask-config"&gt;&lt;a class="footnote-ref" href="#fn:flask-config"&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;h3 id="first-view-first-template"&gt;First view, first template&lt;/h3&gt;
&lt;p&gt;å…ˆä¾†åšé¦–é ï¼ŒæŠŠ HTML æ”¾åœ¨ &lt;code&gt;templates/index.html&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;width=device-width&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æˆå“¡æŠ½ç±¤&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;åŠŸèƒ½åˆ—&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h3&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;é¦–é ï¼ˆæŠ½ç±¤ï¼‰&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æ­·å²è¨˜éŒ„&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;æ¸…é™¤è¨˜éŒ„ã€æ›´æ–°æˆå“¡è³‡æ–™&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;ul&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™åªæ˜¯å€‹å–®ç´”çš„é¦–é ï¼Œæœ‰å€‹æ¨™é¡Œï¼Œé‚„æœ‰å€‹åŠŸèƒ½åˆ—ï¼Œä½†æš«æ™‚éƒ½æ²’æœ‰åŠŸèƒ½ã€‚æˆ‘å€‘ä¿®æ”¹ä¸€ä¸‹ &lt;code&gt;draw_member.py&lt;/code&gt; è£¡å®šç¾©çš„ index è®“ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;

&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;index.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é¦¬ä¸Šä¾†åŸ·è¡Œçœ‹çœ‹ï¼Œç”¨ä¸€æ¨£çš„æ–¹å¼ã€‚ä¸éŽä¹‹å‰åŸ·è¡Œçš„é‚£å€‹å¯èƒ½æ²’æœ‰çµæŸï¼Œè¨˜å¾—ä¸€å€‹ port åªèƒ½æœ‰ä¸€å€‹æœå‹™ï¼Œæ‰€ä»¥è¦ä¸æ˜¯ç”¨èˆŠçš„ï¼ˆFlask å¾ˆè°æ˜Žï¼Œåœ¨ &lt;code&gt;debug=True&lt;/code&gt; æ™‚çŸ¥é“æª”æ¡ˆè¢«æ›´æ–°æ™‚å°±æœƒç”¨æ–°çš„ï¼‰ï¼Œè¦ä¸æ˜¯å°±é—œæŽ‰å†é‡é–‹ä¸€å€‹æ–°çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‰“é–‹ç€è¦½å™¨è¨ªå• &lt;a href="http://localhost:5000"&gt;http://localhost:5000&lt;/a&gt; æ‡‰è©²æœƒå‡ºç¾åº•ä¸‹çš„ç•«é¢ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_helloworld.png"/&gt;
  &lt;figcaption&gt;Flask Hello World&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id="_4"&gt;æŠ½ç±¤åŠŸèƒ½&lt;/h3&gt;
&lt;p&gt;æŽ¥ä¸‹ä¾†è¦å¯¦ä½œæŠ½ç±¤çš„åŠŸèƒ½å•¦ï¼Œç…§å‰é¢èªªçš„ï¼Œæˆ‘å€‘åœ¨é¦–é æœƒè¨­ä¸€å€‹åœ˜é«”åˆ—è¡¨ï¼Œä½¿ç”¨è€…å°±æœƒé¸æ“‡æŸå€‹åœ˜é«”åŽ»æŠ½ç±¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¯¦ä½œä¹‹å‰è¦ä¾†èƒŒæ™¯ä»‹ç´¹ä¸€ä¸‹ï¼Œè¦å…ˆè¬›ä¸€ä¸‹ GET èˆ‡ POST çš„å·®ç•°ã€‚&lt;/p&gt;
&lt;h4 id="get-vs-post"&gt;GET vs POST&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨è€…å¹³å¸¸åœ¨è¨ªå•ç¶²ç«™æ™‚ï¼Œè©²äººè¼¸å…¥ä¸€å€‹ç¶²ç«™ã€é»žä¸€å€‹è¶…é€£å€ï¼Œé€™æ™‚å€™ç€è¦½å™¨æœƒç™¼é€ä¸€å€‹ GET request åˆ°å°æ‡‰çš„ server ä»¥åŠè·¯å¾‘ã€‚ç€è¦½å™¨ï¼ˆé€šå¸¸ï¼‰å°±æœƒå›žå‚³ä¸€å€‹å°æ‡‰çš„ HTML æª”æ¡ˆï¼Œç€è¦½å™¨å°±æœƒè² è²¬æŠŠå®ƒé¡¯ç¤ºåœ¨ç•«é¢ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä½†ç•¶ä½¿ç”¨è€…è·Ÿç¶²ç«™æœ‰æ›´å¤šäº’å‹•çš„æ™‚å€™ï¼Œå¸¸å¸¸æ˜¯è¦æŠŠä½¿ç”¨è€…çš„è³‡è¨Šé€çµ¦ç¶²ç«™æ™‚ï¼Œåƒå¸³è™Ÿç™»å…¥ã€å¡«å•å·è¡¨å–®ï¼Œæˆ–è€…åœ¨é€™é‚Šçš„é¸æ“‡æŸå€‹åœ˜é«”åŽ»æŠ½ç±¤ï¼Œé€™æ™‚å€™å°±æœƒé€éŽ POSTã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šçš„ GET/POST ä»¥åŠå…¶ä»–çš„ HTTP requestï¼Œå¯ä»¥åƒè€ƒ&lt;a href="https://archer1609wp.wordpress.com/2014/03/02/httppost%E8%88%87get/"&gt;ä¸€é å¼ä»‹ç´¹ï¼ˆä¸­ï¼‰&lt;/a&gt;æˆ–&lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTTP"&gt;éžå¸¸å®Œæ•´çš„ä»‹ç´¹åœ¨ Mozilla Developer Network (MDN)ï¼ˆè‹±ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="form"&gt;Form&lt;/h4&gt;
&lt;p&gt;æœ€å¸¸è¦‹çš„ POST å°±æ˜¯æ­é…&lt;a href="https://developer.mozilla.org/en/docs/Web/HTML/Element/form"&gt;è¡¨å–® (form)&lt;/a&gt; ä½¿ç”¨ã€‚åƒç™»å…¥è¦å¡«å¸³è™Ÿå¯†ç¢¼ã€å•å·å•é¡Œèˆ‡å›žç­”ï¼Œå°±å¾ˆå¸¸ç”¨ form å¯¦ä½œã€‚Form è£¡é¢æœ‰å¾ˆå¤šç¨® inputï¼Œä»£è¡¨ä½¿ç”¨è€…èƒ½å¡«çš„æ¬„ä½ï¼Œé¡žåž‹å¯èƒ½æ˜¯å–®é¸ã€è¤‡é¸ã€å–®è¡Œã€å¤šè¡Œã€å¯†æ–‡ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å°±å…ˆçœ‹ä¸€ä¸‹ form å¯¦éš›çš„é•·ç›¸å§ã€‚æ”¹å¯« &lt;code&gt;templates/index.html&lt;/code&gt;ï¼ŒåŠ ä¸Šä¸€å€‹æŠ½ç±¤é¸åœ˜é«”çš„ formã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;h1&amp;gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&amp;lt;/h1&amp;gt;&amp;lt;!-- æœ¬ä¾†æœ‰çš„ --&amp;gt;
&amp;lt;p&amp;gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&amp;lt;/p&amp;gt;
&amp;lt;form action=&amp;quot;/draw&amp;quot; method=&amp;quot;post&amp;quot;&amp;gt;
  &amp;lt;label for=&amp;quot;group_name&amp;quot;&amp;gt;åœ˜éšŠåç¨±ï¼š&amp;lt;/label&amp;gt;
  &amp;lt;input type=&amp;quot;radio&amp;quot; name=&amp;quot;group_name&amp;quot; value=&amp;quot;Î¼&amp;#39;s&amp;quot;&amp;gt;Î¼&amp;#39;s
  &amp;lt;input type=&amp;quot;radio&amp;quot; name=&amp;quot;group_name&amp;quot; value=&amp;quot;K-ON!&amp;quot;&amp;gt;K-ON!
  &amp;lt;input type=&amp;quot;radio&amp;quot; name=&amp;quot;group_name&amp;quot; value=&amp;quot;ALL&amp;quot; checked&amp;gt;ï¼ˆå…¨ï¼‰
  &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;Submit&amp;quot;&amp;gt;
&amp;lt;/form&amp;gt;
&amp;lt;hr&amp;gt;&amp;lt;!-- é€™æ˜¯åˆ†éš”ç·š --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŸºæœ¬ä¸ŠåŠ åœ¨ body è£¡é¢å°±å¯ä»¥ã€‚é€™å€‹ form åŒ…å«äº†ä¸€å€‹æ¨™ç±¤ï¼ŒæŒ‡å®šæ˜¯çµ¦åç‚º &lt;code&gt;group_name&lt;/code&gt; çš„ inputã€‚åº•ä¸‹æŽ¥å››å€‹ input tags ä½†å¯¦éš›ä¸Šåªæœ‰å…©å¤§å€‹ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€å¤§å€‹æ˜¯åœ˜é«”çš„å–®é¸é¸é …å…±ä¸‰å€‹ inputï¼Œæ³¨æ„åˆ°ä»–å€‘çš„ &lt;code&gt;name&lt;/code&gt; éƒ½æ˜¯ &lt;code&gt;group_name&lt;/code&gt; ä½† &lt;code&gt;value&lt;/code&gt; ä¸åŒï¼Œå¾Œé¢æŽ¥è‘—ä»–å€‘é¡¯ç¤ºçš„å­—ã€‚å…¶ä¸­ã€Œï¼ˆå…¨ï¼‰ã€å®ƒå¤šäº†ä¸€å€‹ &lt;code&gt;checked&lt;/code&gt; è¡¨ç¤ºé è¨­é¸æ“‡é€™å€‹é¸é …ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€å¤§å€‹æ˜¯ &lt;code&gt;type=submit&lt;/code&gt; çš„ inputï¼Œä»–å°±æ˜¯é€å‡ºçš„è¡¨å–®çš„æŒ‰éˆ•ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†æ³¨æ„ form tag æœ¬èº«ã€‚&lt;code&gt;method="post"&lt;/code&gt; æ‡‰è©²å¾ˆå¥½ç†è§£ï¼Œè¡¨ç¤ºè¦é€å‡º POST requestï¼›&lt;code&gt;action="/draw"&lt;/code&gt; è¡¨ç¤ºé€™å€‹ POST è¦ç™¼åˆ° &lt;code&gt;/draw&lt;/code&gt; é€™å€‹è·¯å¾‘ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ¨£ï¼Œform åº•ä¸‹ä¹Ÿå¾ˆå¤šç´°ç¯€ï¼Œæ­¡è¿Žå†åŽ» &lt;a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms"&gt;MDN&lt;/a&gt; äº†è§£ã€‚&lt;/p&gt;
&lt;h4 id="request-form-post-handling-in-flask"&gt;Request (Form / POST) handling in Flask&lt;/h4&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘å€‘é¦¬ä¸Šä¾†å¯«è™•ç† &lt;code&gt;/draw&lt;/code&gt; POST çš„ view å§ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;flask&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/draw&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# Get the database connection&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="c1"&gt;# Draw member ids from given group&lt;/span&gt;
    &lt;span class="c1"&gt;# If ALL is given then draw from all members&lt;/span&gt;
    &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;form&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;valid_members_sql&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;SELECT id FROM members &amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;cursor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;valid_members_sql&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;WHERE group_name = ?&amp;#39;&lt;/span&gt;
        &lt;span class="n"&gt;cursor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_members_sql&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;valid_member_ids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;cursor&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="c1"&gt;# If no valid members return 404 (unlikely)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;valid_member_ids&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;err_msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;p&amp;gt;No members in group &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;&amp;lt;/p&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;group_name&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;err_msg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;

    &lt;span class="c1"&gt;# Randomly choice a member&lt;/span&gt;
    &lt;span class="n"&gt;lucky_member_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;choice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;valid_member_ids&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# Obtain the lucy member&amp;#39;s information&lt;/span&gt;
    &lt;span class="n"&gt;member_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;member_group_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;SELECT name, group_name FROM members WHERE id = ?&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lucky_member_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchone&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;p&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;ï¼ˆåœ˜é«”ï¼š&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;ï¼‰&amp;lt;/p&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;member_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;member_group_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Flask æœƒæŠŠä½¿ç”¨è€…ç™¼çµ¦ server çš„ request å­˜åœ¨ &lt;code&gt;request&lt;/code&gt; è£¡é¢ï¼Œå…¶å¯¦ä½¿ç”¨è€…æœƒå‚³è »å¤šè³‡è¨Šçš„ï¼Œåƒè©²äººçš„èªžè¨€ã€ç”¨çš„ç€è¦½å™¨ã€æ™‚é–“ç­‰ç­‰ï¼Œé€™äº›éƒ½èƒ½åœ¨ &lt;code&gt;request&lt;/code&gt; æ‰¾åˆ°ã€‚è€Œä½¿ç”¨è€…å¡«å¥½çš„ form çš„å…§å®¹æœƒå­˜åœ¨ç•¶ä¸­ &lt;code&gt;request.form&lt;/code&gt; è£¡ï¼Œè€Œæˆ‘å€‘å…ˆå‰å®šç¾©åœ¨ form ä¸­ input name å°±æœƒè®Šæˆé€™é‚Šçš„ dict keyã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤å¦‚æžœè¦æ‹¿ä½¿ç”¨è€…æ±ºå®šçš„ &lt;code&gt;group_name&lt;/code&gt; æ™‚ï¼Œå°±æœƒå¯«æˆ &lt;code&gt;request.form.get('group_name', 'ALL')&lt;/code&gt;ã€‚é€™ç›¸ç•¶æ–¼ &lt;code&gt;request.form['group_name']&lt;/code&gt; ä½†åœ¨æ²’æœ‰é€™å€‹ key æ™‚å›žå‚³é è¨­å€¼ &lt;code&gt;'ALL'&lt;/code&gt;ã€‚æ­£å¸¸ä½¿ç”¨ä¸¦ä¸æœƒæ‰¾ä¸åˆ°é€™å€‹ keyï¼Œä½†ç¶²ç«™é–‹ç™¼è€…æ°¸é ä¸è¦ç›¸ä¿¡ä½¿ç”¨è€…æœƒä¹–ä¹–å›žå‚³é€™äº›å…§å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‹¿äº†åœ˜é«”åç¨±ä¹‹å¾Œï¼Œå°±ç”¨åœ˜é«”åç¨±åŽ»ä¸‹æŸ¥è©¢çš„ SQLã€‚åŒç†é€™åç¨±å¯èƒ½æ²’æœ‰çµæžœï¼Œé€™æ™‚å°±å›žå‚³ä¸€å€‹ HTTP status code ç‚º 404 çš„éŒ¯èª¤è¨Šæ¯ã€‚ä¸€èˆ¬æƒ…æ³ 4XX éƒ½ä»£è¡¨ä½¿ç”¨è€…çµ¦çš„è³‡æ–™æœ‰å•é¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‹¿åˆ°äº†æ‰€æœ‰æˆå“¡çš„ id å¾Œï¼Œç”¨äº†å€‹ &lt;code&gt;random.choice&lt;/code&gt; éš¨æ©ŸæŠ½ä¸€å€‹å‡ºä¾†ã€‚å¦‚åŒå­—é¢ä¸Šçš„æ„æ€ï¼Œ&lt;a href="https://docs.python.org/3.5/library/random.html#random.choice"&gt;random&lt;/a&gt; æ˜¯å€‹ Python å…§å»ºçš„ moduleã€‚å†æŠŠé€™å€‹ id æ‹¿åŽ»æŸ¥åå­—èˆ‡åœ˜é«”ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘ç¸½å…±åšäº†å…©å€‹è³‡æ–™åº«æŸ¥è©¢ï¼Œç¬¬ä¸€æ¬¡æŠŠå¯èƒ½çš„ member id éƒ½å‚³å›žä¾†ï¼Œç¬¬äºŒæ¬¡æŠŠæŠ½ä¸­çš„äººçš„åå­—ã€åœ˜é«”éƒ½æ‹¿å›žä¾†ã€‚æš«æ™‚é‚„æ²’åšå¯«åˆ°æ­·å²çš„åŠŸèƒ½ï¼Œä½†é‚£å€‹ä¹Ÿä¸é›£ï¼Œä¹‹å¾Œå†èªªã€‚å…ˆä¸åš templateï¼ŒæŠŠçµæžœåŒ…åœ¨ HTML æœ€åŸºæœ¬çš„ &lt;code&gt;&amp;lt;p&amp;gt;&lt;/code&gt; å…ƒç´ å°±å‚³å›žä¾†ã€‚&lt;/p&gt;
&lt;h4 id="demo"&gt;Demo&lt;/h4&gt;
&lt;p&gt;é‡æ–°æ•´ç†é¦–é ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€å€‹è¡¨å–®ï¼ˆå»¢è©±ï¼‰ã€‚Flask çš„ web server å¾ˆè°æ˜Žï¼Œä¸ç”¨é‡æ–°å•Ÿå‹•å®ƒï¼Œæœƒè‡ªå‹•çœ‹åˆ°æª”æ¡ˆæœ‰æ›´æ–°åš reloadã€‚å¯ä»¥å›žåŽ»æ¯”å°ä¸€ä¸‹è‡ªå·±å¯«åœ¨ &lt;code&gt;index.html&lt;/code&gt; è£¡ HTML åœ¨ç€è¦½å™¨ä¸Šå‘ˆç¾çš„å°æ‡‰é—œä¿‚ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_index_form.png"/&gt;
  &lt;figcaption&gt;æ–°çš„é¦–é ï¼Œå¤šäº†ä¸€å€‹è¡¨å–®&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;æŒ‰ä¸‹ Submit ä¹‹å¾Œå°±æœƒè·³åˆ°æŠ½ç±¤çµæžœï¼ˆæ³¨æ„ URL çš„è®ŠåŒ–ï¼‰&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_draw_result.png"/&gt;
  &lt;figcaption&gt;æŠ½ç±¤çµæžœ&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;é è¨ˆæ˜¯æŠ½å…¨éƒ¨ï¼Œä½ ä¹Ÿå¯ä»¥å›žåˆ°ä¸Šä¸€é ï¼Œé¸è‡ªå·±æƒ³è¦çš„åœ˜é«”ã€‚&lt;/p&gt;
&lt;p&gt;æœ€é‡è¦çš„åŠŸèƒ½å°±å®Œæˆå•¦ï¼å¦‚æžœè‡ªå·±ç¨‹å¼é‡åˆ°ä¸€äº›ç‹€æ³çš„è©±ï¼Œå¯ä»¥çœ‹&lt;a href="https://github.com/ccwang002/draw_member/blob/169d81650d8ca649c5484c43c05324885e7cb7fb/draw_member.py"&gt;æˆ‘å¯«çš„å®Œæ•´ç‰ˆæœ¬&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id="more-on-templates"&gt;More on templates&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰æˆ‘å€‘ &lt;code&gt;render_template&lt;/code&gt; å…¶å¯¦éƒ½æ˜¯å‚³ä¸€å€‹å®Œæ•´çš„ HTML å…§å®¹çµ¦å®ƒï¼Œä¸¦æ²’æœ‰ç”¨åˆ° template åŠŸèƒ½ã€‚Template æœ‰å¹¾å€‹ç”¨è™•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›†ä¸­é‡è¦†ç”¨åˆ°çš„ç‰‡æ®µã€çµæ§‹&lt;/li&gt;
&lt;li&gt;è®“ä¸€éƒ¨ä»½ HTML çš„å…§å®¹å—è®Šæ•¸æŽ§åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦¬ä¸Šä¾†æ”¹å¯«ä¸€ä¸‹å§ã€‚æˆ‘å€‘çš„åŠŸèƒ½è¡¨æ‡‰è©²æ¯ä¸€é éƒ½è¦å‡ºç¾ï¼Œå†ä¾†æˆ‘å€‘å¸Œæœ› &lt;code&gt;/draw&lt;/code&gt; çš„é é¢ä¹Ÿæ˜¯å€‹å®Œæ•´çš„ HTMLã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå…ˆæŠŠå¸¸ç”¨çš„éƒ¨ä»½ç¨ç«‹å‡ºä¾†ï¼Œåšæˆ &lt;code&gt;templates/base.html&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;!-- templates/base.html --&amp;gt;
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
  &amp;lt;head&amp;gt;
    &amp;lt;meta charset=&amp;quot;utf-8&amp;quot;&amp;gt;
    &amp;lt;meta name=&amp;quot;viewport&amp;quot; content=&amp;quot;width=device-width&amp;quot;&amp;gt;
    &amp;lt;title&amp;gt;{% block title %}æˆå“¡æŠ½ç±¤{% endblock title %}&amp;lt;/title&amp;gt;
  &amp;lt;/head&amp;gt;
  &amp;lt;body&amp;gt;
    {% block content %}{% endblock content %}
    &amp;lt;hr&amp;gt;
    &amp;lt;h3&amp;gt;åŠŸèƒ½åˆ—&amp;lt;/h3&amp;gt;
    &amp;lt;ul&amp;gt;
      &amp;lt;li&amp;gt;&amp;lt;a href=&amp;quot;/&amp;quot;&amp;gt;é¦–é ï¼ˆæŠ½ç±¤ï¼‰&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
      &amp;lt;li&amp;gt;&amp;lt;a href=&amp;quot;/history&amp;quot;&amp;gt;æ­·å²è¨˜éŒ„&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
      &amp;lt;li&amp;gt;&amp;lt;a href=&amp;quot;/reset&amp;quot;&amp;gt;æ¸…é™¤è¨˜éŒ„ã€æ›´æ–°æˆå“¡è³‡æ–™&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
    &amp;lt;/ul&amp;gt;
  &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åƒåŠŸèƒ½åˆ—é€™ç¨®ä¸æœƒè®Šçš„å°±å¾ˆé©åˆæ”¾åœ¨é€™é‚Šã€‚è€Œæˆ‘å€‘çš„é¦–é å°±å¯ä»¥é‡è¦†ä½¿ç”¨é€™å€‹çµæ§‹ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;!-- templates/index.html --&amp;gt;
{% extends &amp;quot;base.html&amp;quot; %}

{% block content %}
&amp;lt;h1&amp;gt;ä¾†æŠ½å‡ºå¿«æ¨‚çš„å¤¥ä¼´å§ï¼&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;é¸æ“‡è¦è¢«æŠ½çš„åœ˜é«”&amp;lt;/p&amp;gt;
&amp;lt;form action=&amp;quot;/draw&amp;quot; method=&amp;quot;post&amp;quot;&amp;gt;
  &amp;lt;label for=&amp;quot;group_name&amp;quot;&amp;gt;åœ˜éšŠåç¨±ï¼š&amp;lt;/label&amp;gt;
  &amp;lt;input type=&amp;quot;radio&amp;quot; name=&amp;quot;group_name&amp;quot; value=&amp;quot;Î¼&amp;#39;s&amp;quot;&amp;gt;Î¼&amp;#39;s
  &amp;lt;input type=&amp;quot;radio&amp;quot; name=&amp;quot;group_name&amp;quot; value=&amp;quot;K-ON!&amp;quot;&amp;gt;K-ON!
  &amp;lt;input type=&amp;quot;radio&amp;quot; name=&amp;quot;group_name&amp;quot; value=&amp;quot;ALL&amp;quot; checked&amp;gt;ï¼ˆå…¨ï¼‰
  &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;Submit&amp;quot;&amp;gt;
&amp;lt;/form&amp;gt;
{% endblock content %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°æœ€å¤§çš„å·®ç•°å°±æ˜¯æˆ‘å€‘çš„ &lt;code&gt;index.html&lt;/code&gt; è®Šç°¡å–®äº†ã€‚å®ƒå°±åƒç‰©ä»¶ç¹¼æ‰¿ä¸€æ¨£ï¼Œ&lt;code&gt;{% extends "base.html" %}&lt;/code&gt;ï¼Œè¡¨ç¤ºå…ˆæŠŠ &lt;code&gt;base.html&lt;/code&gt; çš„å…§å®¹æ”¾é€²ä¾†ï¼Œè€Œè£¡é¢å®šç¾©äº†å…©å€‹ blockï¼š&lt;code&gt;title&lt;/code&gt; ä»¥åŠ &lt;code&gt;content&lt;/code&gt;ã€‚Index æœ‰å®šç¾© content çš„å…§å®¹ï¼Œæ‰€ä»¥å°±å–ä»£æŽ‰åŽŸæœ¬å®šç¾©åœ¨ base è£¡ç©ºçš„ contentã€‚  Index ä¸¦æ²’æœ‰å®šç¾© titleï¼Œé‚£å°±æœƒç”¨åŽŸæœ¬ block å…§çš„å€¼ï¼Œå³ã€Œæˆå“¡æŠ½ç±¤ã€ã€‚&lt;/p&gt;
&lt;p&gt;å†ä¾†è™•ç† &lt;code&gt;/draw&lt;/code&gt; çš„éƒ¨ä»½ï¼Œæˆ‘å€‘é™¤è€Œå†åˆ©ç”¨ &lt;code&gt;base.html&lt;/code&gt; ä¹‹å¤–ï¼Œé‚„è¦å¼•å…¥ template variable çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;!-- templates/draw.html --&amp;gt;
{% extends &amp;quot;base.html&amp;quot; %}

{% block title %}æŠ½ç±¤çµæžœ{% endblock title %}

{% block content %}
&amp;lt;h1&amp;gt;æŠ½ç±¤çµæžœ&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;{{ name }}ï¼ˆåœ˜é«”ï¼š{{ group }}ï¼‰&amp;lt;/p&amp;gt;
{% endblock content %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç‰¹åˆ¥çš„æ˜¯ &lt;code&gt;{{ name }}&lt;/code&gt; å’Œ &lt;code&gt;{{ group }}&lt;/code&gt;ã€‚é€™èªžæ³•è¡¨ç¤ºä»–å€‘çš„å€¼åˆ†åˆ¥å— &lt;code&gt;name&lt;/code&gt; å’Œ &lt;code&gt;group&lt;/code&gt; é€™å…©å€‹è®Šæ•¸æ±ºå®šï¼Œè®Šæ•¸çš„å€¼åœ¨ &lt;code&gt;render_template&lt;/code&gt; æ™‚æ‰æœƒæ±ºå®šã€‚è¦æ€Žéº¼æŠŠè®Šæ•¸çš„å€¼å‚³åˆ° template è£¡å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/draw&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="c1"&gt;# return &amp;#39;&amp;lt;p&amp;gt;%sï¼ˆåœ˜é«”ï¼š%sï¼‰&amp;lt;/p&amp;gt;&amp;#39; % (member_name, member_group_name)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;draw.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;member_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;member_group_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ”¹å¯«å¥½çš„ draw ä½¿ç”¨ template &lt;code&gt;templates/draw.html&lt;/code&gt;ï¼Œä¸¦åœ¨ &lt;code&gt;render_template&lt;/code&gt; æ™‚æŠŠè®Šæ•¸çš„å€¼éƒ½æ”¾é€²åŽ»ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ™‚å€™æ‰é‡æ–°æŠ½ç±¤å¯ä»¥çœ‹åˆ°æ–°çš„ template çš„è¼¸å‡ºçµæžœï¼ŒåŠŸèƒ½è¡¨ä¹Ÿå‡ºç¾äº†ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_new_draw_result.png"/&gt;
&lt;/figure&gt;

&lt;h3 id="_5"&gt;æ­·å²è¨˜éŒ„&lt;/h3&gt;
&lt;p&gt;è¨˜å¾—è¦åœ¨æŠ½ç±¤çš„æ™‚å€™æŠŠè¨˜éŒ„åŠ åˆ° database è£¡ã€‚å› ç‚ºä¹‹å‰æœ‰è¨­å¥½ schema é è¨­ç”¨ç¾åœ¨æ™‚é–“ç•¶æŠ½ç±¤æ™‚é–“ï¼Œæ‰€ä»¥æ™‚é–“çš„è™•ç†å®Œå…¨äº¤çµ¦ SQLiteã€‚ç”¨ SQL èªžæ³• &lt;code&gt;LIMIT 10&lt;/code&gt; ä»¥åŠ &lt;code&gt;ORDER BY&lt;/code&gt; é¸æ“‡æœ€è¿‘çš„åç­†ï¼ŒåŒæ™‚åœ¨æŸ¥çµæžœæ™‚ï¼Œä¹ŸåŒæ™‚æŸ¥è©¢ &lt;strong&gt;members&lt;/strong&gt; table å°æ‡‰çš„åå­—èˆ‡åœ˜é«”ã€‚é€™å€‹å°ˆæ¥­è¡“èªžå« &lt;a href="https://en.wikipedia.org/wiki/Join_%28SQL%29"&gt;JOIN&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠé€™å€‹ view æ”¾åœ¨ &lt;code&gt;/history&lt;/code&gt; è·¯å¾‘ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/draw&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;draw&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="c1"&gt;# ...&lt;/span&gt;
    &lt;span class="c1"&gt;# Update draw history&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;INSERT INTO draw_histories (memberid) VALUES (?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lucky_member_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="c1"&gt;# Render template&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;


&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;recent_histories&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;SELECT m.name, m.group_name, d.time &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;FROM draw_histories AS d, members as m &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;WHERE m.id == d.memberid &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ORDER BY d.time DESC &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;LIMIT 10&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;history.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;recent_histories&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;recent_histories&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŒç†ä¹Ÿè¦å»ºç«‹å°æ‡‰çš„ templateã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;!-- templates/history.html --&amp;gt;
{% extends &amp;quot;base.html&amp;quot; %}

{% block title %}æŠ½ç±¤æ­·å²{% endblock title %}

{% block content %}
&amp;lt;h1&amp;gt;æŠ½ç±¤æ­·å²ï¼ˆæœ€è¿‘ 10 ç­†ï¼‰&amp;lt;/h1&amp;gt;
&amp;lt;table&amp;gt;
  &amp;lt;thead&amp;gt;
    &amp;lt;tr&amp;gt;
      &amp;lt;th&amp;gt;åå­—&amp;lt;/th&amp;gt;
      &amp;lt;th&amp;gt;åœ˜é«”&amp;lt;/th&amp;gt;
      &amp;lt;th&amp;gt;æŠ½ä¸­æ™‚é–“&amp;lt;/th&amp;gt;
    &amp;lt;/tr&amp;gt;
  &amp;lt;/thead&amp;gt;
  &amp;lt;tbody&amp;gt;
    {% for history in recent_histories %}
    &amp;lt;tr&amp;gt;
      &amp;lt;td&amp;gt;{{ history.0 }}&amp;lt;/td&amp;gt;
      &amp;lt;td&amp;gt;{{ history.1 }}&amp;lt;/td&amp;gt;
      &amp;lt;td&amp;gt;{{ history.2 }}&amp;lt;/td&amp;gt;
    &amp;lt;/tr&amp;gt;
    {% endfor %}
  &amp;lt;/tbody&amp;gt;
&amp;lt;/table&amp;gt;
{% endblock content %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™é‚Šç”¨äº†æ–°çš„ template èªžæ³• for loopï¼Œæ¯æ¬¡ loop &lt;code&gt;history&lt;/code&gt; çš„å€¼éƒ½æœƒè®Šï¼Œè€Œä¸”é‚„å¯ä»¥å†å­˜å–å®ƒåº•ä¸‹çš„å±¬æ€§ï¼Œå¯«æˆ Python å°±åƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;history&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;recent_histories&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Flask ç”¨çš„ Jinja2 template åŠŸèƒ½å¾ˆå¤šï¼Œç¾åœ¨å„ä½å·²ç¶“æ¯”è¼ƒç†è§£ server çš„é‹ä½œäº†ï¼Œå¯ä»¥åŽ»é–±è®€ä¸€ä¸‹ &lt;a href="http://jinja.pocoo.org/docs/dev/templates/"&gt;Jinja2 å®˜ç¶²æ–‡ä»¶&lt;/a&gt;çœ‹å®Œæ•´çš„ä½¿ç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_history.png"/&gt;
&lt;/figure&gt;

&lt;h4 id="datetime"&gt;æ™‚é–“è™•ç†ç”¨ datetime&lt;/h4&gt;
&lt;p&gt;å¦‚æžœæœ‰æ³¨æ„åˆ°çš„è©±ï¼Œæˆ‘å€‘ç”¨çš„æ™‚é–“å¾ž SQLite å›žå‚³å›žä¾†å…¶å¯¦æ˜¯å­—ä¸²ã€‚æƒ³è¦æ”¹å¯«æ™‚é–“æ ¼å¼æ€Žéº¼è¾¦ï¼Ÿé€™æ™‚å€™å°±è¦ç”¨ä¸Šå…§å»º module &lt;a href="https://docs.python.org/3.5/library/datetime.html#datetime-objects"&gt;datetime&lt;/a&gt; è£¡æä¾›çš„ &lt;code&gt;datetime&lt;/code&gt; ç‰©ä»¶ã€‚åŒæ™‚æˆ‘å€‘ä¹Ÿé †ä¾¿æŠŠæœ¬ä¾†ç”¨ &lt;code&gt;fetchall()&lt;/code&gt; çš„çµæžœï¼Œæ”¹æˆç”¨ dict è¡¨ç¤ºæ¯ä¸€ç­†æ­·å²ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;

&lt;span class="nd"&gt;@app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;route&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/history&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;history&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;SELECT m.name, m.group_name, d.time AS &amp;quot;draw_time [timestamp]&amp;quot; &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;FROM draw_histories AS d, members as m &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;WHERE m.id == d.memberid &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ORDER BY d.time DESC &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;LIMIT 10&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fetchall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;recent_histories&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;recent_histories&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;group&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;draw_time&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strptime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;%Y-%m-&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s1"&gt; %H:%M:%S&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;render_template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{% for history in recent_histories %}
&amp;lt;tr&amp;gt;
  &amp;lt;td&amp;gt;{{ history.name }}&amp;lt;/td&amp;gt;
  &amp;lt;td&amp;gt;{{ history.group }}&amp;lt;/td&amp;gt;
  &amp;lt;td&amp;gt;{{ history.draw_time.strftime(&amp;quot;%Y å¹´ %m æœˆ %d æ—¥ %H æ™‚ %M åˆ†&amp;quot;) }}&amp;lt;/td&amp;gt;
&amp;lt;/tr&amp;gt;
{% endfor %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° for loop ä¸å†ä½¿ç”¨ 0, 1, 2 åŽ»æ‹¿æ¯ç­†æ­·å²å„æ¬„ä½çš„å€¼ï¼Œè€Œæ˜¯ç”¨æ¬„ä½åç¨±ï¼Œç›¸ç•¶æ–¼ &lt;code&gt;history['name']&lt;/code&gt;ã€‚é€™æ¨£çš„åšæ³•æ¯”è¼ƒå¥½ï¼Œå› ç‚ºç”¨æ•¸å­—ä¸€ä¸‹å°±å¿˜äº†ï¼Œéš¨ä¾¿èª¿æ•´ä¸€ä¸‹ view çš„å…§å®¹é †åºå°±ä¸ä¸€å®šæ˜¯é€™æ¨£äº†ï¼›å–®ç¨è®€ template ä¹Ÿèƒ½æ‡‚æ¯å€‹æ¬„ä½çš„æ„æ€ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/flask-draw-member/pics/flask_history_zh.png"/&gt;
&lt;/figure&gt;

&lt;h3 id="whats-next"&gt;What&amp;rsquo;s Next&lt;/h3&gt;
&lt;h3 id="static-files-and-better-theme"&gt;Static files and better theme&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘åªç”¨äº† HTML templateã€‚æƒ³è¦è®“ç¶²ç«™çœ‹èµ·ä¾†æ›´æ¼‚äº®ï¼Œå°±è¦å¯« CSS èˆ‡ Javascript (JS)ã€‚æœ‰åƒ Bootstrapã€PureCSSã€Semantic UI é€™é¡žçš„ã€Œframeworkã€ï¼Œå¥—ç”¨ä¹‹å¾Œèƒ½åœ¨çŸ­æ™‚é–“ç•«å‡ºç¾Žè§€å¯¦ç”¨çš„ç‰ˆé¢ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ CSSã€JSï¼Œä»¥åŠç«™ä¸Šå¤§å¤§å°çš„å…¶ä»–æª”æ¡ˆéƒ½å¿…éœ€è¦å¾ž server å‚³é€åˆ°ç”¨æˆ¶ç«¯ä¸Šï¼Œé€™é‚Šå°±æ˜¯ static files çš„è™•ç†ã€‚&lt;/p&gt;
&lt;h3 id="more-how-web-works"&gt;More how web works&lt;/h3&gt;
&lt;p&gt;é™¤äº† HTTP GETã€POST ä¹‹å¤–ï¼Œé‚„æœ‰ HTTPSã€sessionã€cookie ç­‰å¾ˆå¸¸è¦‹çš„æŠ€è¡“ã€‚&lt;/p&gt;
&lt;h3 id="object-relational-model-orm"&gt;Object Relational Model (ORM)&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘åªèˆ‰äº†ç´”å¯« SQL çš„ä¾‹å­ï¼Œä½†ç•¶å°ˆæ¡ˆè®Šè¤‡é›œçš„æ™‚å€™ï¼Œç´” SQL ç®¡ç†ä¸Šè¶Šä¾†è¶Šè¤‡é›œã€‚ORM æ˜¯ä¸€ç¨®è§£æ±ºçš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id="django"&gt;Django&lt;/h3&gt;
&lt;p&gt;ç•¶ç„¶å¯ä»¥ç¹¼çºŒæŠŠ Flask ç ”ç©¶ä¸‹åŽ»ï¼Œå®ƒä¹Ÿæ˜¯å€‹å¾ˆå¥½çš„ web frameworkã€‚ä¸éŽæˆ‘å€‘ä¸»è¦çš„ code base æ˜¯ Djangoã€‚æ‰€ä»¥å¸Œæœ›å¤§å®¶åœ¨äº†è§£ä¸€å€‹ web server (app) é•·å¾—åƒæ€Žæ¨£ä¹‹å¾Œï¼Œå°±å¯ä»¥é–‹å§‹å­¸ç¿’ Djangoã€‚Django èˆ‡ Flask æœ€å¤§çš„è¨­è¨ˆä¸åŒå°±æ˜¯ Django ä¸€é–‹å§‹å°±æä¾›äº†å¾ˆå¤šæ¨¡çµ„èˆ‡åŠŸèƒ½ï¼Œæ„Ÿè¦ºå¾ˆã€Œè‚¥ã€ï¼Œè€Œ Flask åªæä¾›äº†å¿…è¦çš„åŠŸèƒ½&lt;/p&gt;
&lt;h3 id="_6"&gt;ç¸½çµ&lt;/h3&gt;
&lt;p&gt;é€™æ¨£å°±æ˜¯ä¸€å€‹å®Œæ•´çš„æŠ½ç±¤çš„ç¶²ç«™äº†ã€‚å…¶å¯¦æž¶ç¶²ç«™çš„ä¸»è¦çŸ¥è­˜ä¹Ÿå·®ä¸å¤šæ˜¯é€™äº›ï¼Œå†ä¾†å°±æ˜¯ç´°ç¯€ä»¥åŠçŸ¥è­˜çš„åŠ å¼·ã€‚&lt;/p&gt;
&lt;p&gt;åšå¥½çš„æˆå“æˆ‘ä¹Ÿæ”¾åœ¨ &lt;a href="https://github.com/ccwang002/draw_member"&gt;Github&lt;/a&gt; ä¸Šäº†ï¼Œè£¡é¢çš„ commit log è¨˜éŒ„äº†å¹¾å€‹é‡è¦çš„æ­¥é©Ÿï¼Œæ‰€ä»¥æƒ³è¦çœ‹çœ‹æ¯ä¸€æ­¥çš„çµæžœå¯ä»¥ç”¨ &lt;code&gt;git checkout&lt;/code&gt; å›žåˆ°æ¯å€‹è¨˜éŒ„é»žï¼Œä¾‹å¦‚æƒ³è¦çœ‹æŠ½ç±¤åŠŸèƒ½å¯«å®Œï¼Œç”¨ä¸Š template çš„ç‰ˆæœ¬å°±å¯ä»¥åˆ° &lt;code&gt;git checkout f39fc1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;PS: æ²’æƒ³åˆ°æœƒå¯«é€™éº¼é•·å•Šâ€¦â€¦&lt;/p&gt;
&lt;h3 id="details"&gt;Details&lt;/h3&gt;
&lt;p&gt;åº•ä¸‹è¨˜äº†å¾ˆå¤šæŠ€è¡“ç´°ç¯€ï¼Œæœ‰èˆˆè¶£å†çœ‹å§ã€‚&lt;/p&gt;
&lt;h4 id="sqlite-table-info"&gt;SQLite table info&lt;/h4&gt;
&lt;p&gt;é™¤äº†ç”¨ &lt;code&gt;.schema&lt;/code&gt; åŽ»çœ‹æ¯å€‹ TABLE å»ºç«‹æ™‚çš„æŒ‡ä»¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨ &lt;code&gt;PRAGMA table_info&lt;/code&gt; åŽ»çœ‹æŸå€‹ table æ¯å€‹æ¬„ä½çš„è¨­å®šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="go"&gt;-- Run `sqlite -init create_db.sql`&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;column&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;table_info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;members&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;cid  name         type       notnul  dflt_value                    pk&lt;/span&gt;
&lt;span class="go"&gt;---  -----------  ---------  ------  ----------------------------  --&lt;/span&gt;
&lt;span class="go"&gt;0    id           INTEGER    0                                     1&lt;/span&gt;
&lt;span class="go"&gt;1    name         TEXT       1                                     0&lt;/span&gt;
&lt;span class="go"&gt;2    group_name   TEXT       0                                     0&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;table_info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;cid  name         type       notnul  dflt_value                    pk&lt;/span&gt;
&lt;span class="go"&gt;---  -----------  ---------  ------  ----------------------------  --&lt;/span&gt;
&lt;span class="go"&gt;0    memberid     INTEGER    0                                     0&lt;/span&gt;
&lt;span class="go"&gt;1    draw_time    DATETIME   0       datetime(&amp;#39;now&amp;#39;, &amp;#39;localtime&amp;#39;)  0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="sqlite-foreign-key-check"&gt;SQLite foreign key check&lt;/h4&gt;
&lt;p&gt;SQLite3 åœ¨æ¯”è¼ƒæ–°ç‰ˆæ‰æœƒåŽ»è™•ç† foreign key é™åˆ¶çš„åŠŸèƒ½ï¼Œåƒè€ƒ&lt;a href="https://www.sqlite.org/foreignkeys.html#fk_enable"&gt;å®˜ç¶²çš„èªªæ˜Ž&lt;/a&gt;ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreign_keys&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æžœæ˜¯ 0 çš„è©±è¡¨ç¤º SQLite ä¸¦ä¸æœƒåŽ»æª¢æŸ¥ foreign keyã€‚é€™å¯ä»¥æ‰‹å‹•æ‰“é–‹æª¢æŸ¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreign_keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;PRAGMA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;foreign_keys&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;1&lt;/span&gt;
&lt;span class="gp"&gt;sqlite&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;draw_histories&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memberid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="go"&gt;Error: FOREIGN KEY constraint failed&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="_7"&gt;é‡æ–°è®€å…¥è³‡æ–™&lt;/h4&gt;
&lt;p&gt;æˆ‘å€‘å…ˆåŒ…å¥½ä¸€å€‹ function &lt;code&gt;reset_db&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# draw_members.py&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;reset_db&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SQLITE_DB_SCHEMA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;create_db_sql&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="c1"&gt;# Reset database&lt;/span&gt;
    &lt;span class="c1"&gt;# Note that CREATE/DROP table are *immediately* committed&lt;/span&gt;
    &lt;span class="c1"&gt;# even inside a transaction&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DROP TABLE IF EXISTS draw_histories&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DROP TABLE IF EXISTS members&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executescript&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;create_db_sql&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# Read members CSV data&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MEMBER_CSV_PATH&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newline&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;csv_reader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;csv&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DictReader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;members&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
            &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åå­—&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;åœ˜é«”&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;csv_reader&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="c1"&gt;# Write members into databse&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executemany&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;INSERT INTO members (name, group_name) VALUES (?, ?)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;members&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;reset_db()&lt;/code&gt; æœƒ DROP æŽ‰èˆŠçš„ database ï¼Œç„¶å¾Œå†ç”¨å‰›å‰›ä»‹ç´¹çš„æ–¹æ³•å†æŠŠè³‡æ–™å¾ž CSV è®€é€²ä¾†ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥é€™å€‹ function è¦æ€Žéº¼ä½¿ç”¨ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸€å€‹æ˜¯åƒä¹‹å‰ä¸€æ¨£ç¶å®šä¸€å€‹è·¯å¾‘ &lt;code&gt;@app.route('/reset')&lt;/code&gt;ï¼›å¦ä¸€å€‹æ–¹å¼æˆ‘å€‘å¯ä»¥é€éŽ python shell é”åˆ°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;draw_member&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reset_db&lt;/span&gt;
&lt;span class="gp"&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app_context&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;span class="gp"&gt;... &lt;/span&gt;    &lt;span class="n"&gt;reset_db&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id="datetime-in-sqlite-and-python"&gt;Datetime in SQLite and Python&lt;/h4&gt;
&lt;p&gt;é€™ç¯‡æ–‡ç« å¤ªé•·äº†ï¼Œå¯«åˆ°&lt;a href="../datetime-sqlite/#datetime-sqlite"&gt;ä¸‹ä¸€ç¯‡åŽ»&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;2016-06-14 æ›´æ–°ï¼šå¢žåŠ ä½¿ç”¨ &lt;code&gt;datetime.datetime&lt;/code&gt; çš„èªªæ˜Žé¿å…è·Ÿ module åç¨±æ··æ·† (credit: é¦¬åœ‹è–°)&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;åœ¨è³‡æ–™è™•ç†ä¸Šå…¶å¯¦æœƒæœ‰å€‹ NA çš„å€¼ä¾†å€åˆ†ã€Œç©ºã€ä»¥åŠã€Œç©ºå€¼ã€çš„æ¦‚å¿µã€‚ä¸éŽé€™ç”¨ Python å…§å»ºçš„ &lt;code&gt;csv.reader&lt;/code&gt; è™•ç†æœƒå¤ªè¤‡é›œå°±å…ˆç®—äº†ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:sqlite3 auto commit"&gt;
&lt;p&gt;åƒè€ƒ&lt;a href="https://docs.python.org/3.5/library/sqlite3.html#using-the-connection-as-a-context-manager"&gt;å®˜æ–¹èªªæ˜Žæ–‡ä»¶&lt;/a&gt;ï¼Œå®ƒæ˜¯åœ¨é€²å…¥ &lt;code&gt;with db: ...&lt;/code&gt; code block æ™‚é–‹å•Ÿä¸€å€‹ transactionï¼Œä¸¦åœ¨æ­£å¸¸é›¢é–‹çš„æ™‚å€™è‡ªå‹• commitã€‚å¦‚æžœä¸­é–“é‡åˆ°æ²’æœ‰è™•ç†çš„ Exception æ™‚ï¼Œå°±æœƒè‡ªå‹• roll backã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:sqlite3 auto commit" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:flask-config"&gt;
&lt;p&gt;å…¶å¯¦ Flask ç›¸é—œçš„è¨­å®šé€šå¸¸æ”¾åœ¨ &lt;code&gt;app.config&lt;/code&gt; è£¡é¢ï¼Œä¸éŽæˆ‘å€‘çš„ä¾‹å­æ²’å·®ã€‚&amp;#160;&lt;a class="footnote-backref" href="#fnref:flask-config" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="flask"></category><category term="sqlite"></category><category term="jinja2"></category><category term="python"></category></entry><entry><title>FASTA/Q sequence processing toolkit -- seqtk</title><link href="https://blog.liang2.tw/posts/2015/09/seqtk/" rel="alternate"></link><published>2015-09-27T14:11:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-27:/posts/2015/09/seqtk/</id><summary type="html">&lt;p&gt;This post demonstrates the FASTQ to FASTA conversion and sequence quality check using seqtk.&lt;/p&gt;</summary><content type="html">&lt;p&gt;This is the first post of the series of my common NGS processing workflows and notes.&lt;/p&gt;
&lt;p&gt;Some of the most common operation in sequence processing is FASTQ â†’ FASTA conversion. Tons of conversion scripts using either sed or awk can be found by search. For example,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# FASTQ to FASTA&lt;/span&gt;
&lt;span class="c1"&gt;# Assume every read record takes exactly 4 line&lt;/span&gt;
&lt;span class="c1"&gt;# Ref: http://stackoverflow.com/a/10359425&lt;/span&gt;
$ sed -n &lt;span class="s1"&gt;&amp;#39;1~4s/^@/&amp;gt;/p;2~4p&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The assumption of 4 lines per read usually holds for recent NGS sequencing data, so not a big deal.&lt;/p&gt;
&lt;p&gt;In many case the sequence is gzip&amp;rsquo;d. It is still a piece of cake when combining with pipe editing,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gzcat myseq.fq.gz &lt;span class="p"&gt;|&lt;/span&gt; sed -n &lt;span class="s1"&gt;&amp;#39;1~4s/^@/&amp;gt;/p;2~4p&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; gzip &amp;gt; myseq.fa.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;However, things can get complex really fast when one wants to additionally do reverse complement, randomly sample a subset of reads, and many other types of sequence manipulation. Efficiency matters if those tasks are applied to tens of millions of reads. Even a few nanoseconds longer of computing time difference per read can make a difference at this scale of reads.&lt;/p&gt;
&lt;h3 id="seqtk"&gt;Seqtk&lt;/h3&gt;
&lt;p&gt;So &lt;a href="https://github.com/lh3/seqtk"&gt;seqtk&lt;/a&gt; comes into rescue. It is written in C and MIT licensed. &lt;a href="https://www.biostars.org/p/85929/#86082"&gt;A quick comparison&lt;/a&gt; shows it is generally faster than other UNIX-based solutions, let alone implementations based on scripting languages.&lt;/p&gt;
&lt;p&gt;Seqtk bundles many other operations, but I&amp;rsquo;ll just mention those I frequently use.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nv"&gt;$seqtk&lt;/span&gt;

Usage:   seqtk &amp;lt;command&amp;gt; &amp;lt;arguments&amp;gt;
Version: &lt;span class="m"&gt;1&lt;/span&gt;.0-r77-dirty

Command: seq       common transformation of FASTA/Q
         comp      get the nucleotide composition of FASTA/Q
         sample    subsample sequences
         subseq    extract subsequences from FASTA/Q
         fqchk     fastq QC &lt;span class="o"&gt;(&lt;/span&gt;base/quality summary&lt;span class="o"&gt;)&lt;/span&gt;
         mergepe   interleave two PE FASTA/Q files
         trimfq    trim FASTQ using the Phred algorithm

         hety      regional heterozygosity
         mutfa     point mutate FASTA at specified positions
         mergefa   merge two FASTA/Q files
         dropse    drop unpaired from interleaved PE FASTA/Q
         rename    rename sequence names
         randbase  choose a random base from hets
         cutN      cut sequence at long N
         listhet   extract the position of each het
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="fastq-fasta"&gt;FASTQ â†’ FASTA&lt;/h3&gt;
&lt;p&gt;Read (gzip&amp;rsquo;d) FASTQ and write out as FASTA,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ seqtk seq -A &lt;span class="k"&gt;in&lt;/span&gt;.fq&lt;span class="o"&gt;[&lt;/span&gt;.gz&lt;span class="o"&gt;]&lt;/span&gt; &amp;gt; out.fa
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To make the output gzip&amp;rsquo;d again, piped with gzip,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ seqtk seq -A &lt;span class="k"&gt;in&lt;/span&gt;.fq&lt;span class="o"&gt;[&lt;/span&gt;.gz&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; gzip &amp;gt; out.fa.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="reverse-complement"&gt;Reverse complement&lt;/h3&gt;
&lt;p&gt;If one wants to debug the R2 reads of pair-end sequencing (second read on forward strand), since they contain reverse complement sequence of the insert DNA, one needs to reverse complement R2 reads again to debug directly by bare human eyes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ seqtk seq -r R2.fq &amp;gt; R2_rc.fq

$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;gt; Example R2 seq&lt;/span&gt;
&lt;span class="s1"&gt;  GCATTGGTGGTTCAGTGGTAGAATTCT&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; seqtk seq -r
&lt;span class="c1"&gt;# &amp;gt; Example R2 seq&lt;/span&gt;
&lt;span class="c1"&gt;# AGAATTCTACCACTGAACCACCAATGC&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="quality-check"&gt;Quality check&lt;/h3&gt;
&lt;p&gt;To be honest, &lt;a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/"&gt;FastQC&lt;/a&gt; is more frequently used for quality check because it generates &lt;a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/good_sequence_short_fastqc.html"&gt;reports with beautiful figures&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;But for a detail report on each read position, one should consider &lt;code&gt;seqtk fqchk&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ seqtk fqchk myseq.fq&lt;span class="o"&gt;[&lt;/span&gt;.gz&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;By default it sets &lt;code&gt;-q 20&lt;/code&gt;. This quality threshold determines the threshold of counting a base as low or high quality, shown as &lt;code&gt;%low&lt;/code&gt; and &lt;code&gt;%high&lt;/code&gt; per read position. In the default case, quality score higher than 20 will be treated as high quality bases.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;min_len: 10; max_len: 174; avg_len: 28.92; 37 distinct quality values
POS #bases    %A   %C   %G   %T   %N  avgQ errQ %low %high
ALL 236344886 17.0 22.5 31.3 29.2 0.0 39.9 37.6 0.1  99.9
1   8172342   8.9  12.4 57.0 21.7 0.0 39.6 29.0 0.5  99.5
2   8172342   7.7  62.5 16.2 13.7 0.0 39.8 37.8 0.2  99.8
3   8172342   50.3 24.1 11.9 13.6 0.0 39.8 38.2 0.1  99.9
4   8172342   10.4 22.9 15.3 51.3 0.0 39.9 38.7 0.1  99.9
5   8172342   14.3 12.9 22.3 50.5 0.0 39.8 37.0 0.2  99.8
# ... (trimmed)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The following columns, &lt;code&gt;avgQ&lt;/code&gt; and &lt;code&gt;errQ&lt;/code&gt;, need more explanation. Average quality (&lt;code&gt;avgQ&lt;/code&gt;) is computed by weighted mean of each base&amp;rsquo;s quality,&lt;/p&gt;
&lt;p&gt;&lt;span class="katex-display"&gt;&lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math display="block" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi mathvariant="normal"&gt;a&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;v&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;g&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;âˆ‘&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;mn&gt;93&lt;/mn&gt;&lt;/munderover&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;â‹…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;âˆ‘&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;mn&gt;93&lt;/mn&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo separator="true"&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;
    \mathrm{avgQ} = \dfrac{\sum_{q=0}^{93} q \cdot n_q}{\sum_{q = 0}^{93} n_q},
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathrm"&gt;avgQ&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:3.0597em;vertical-align:-1.2798em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mopen nulldelimiter"&gt;&lt;/span&gt;&lt;span class="mfrac"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:1.7798em;"&gt;&lt;span style="top:-2.156em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mop"&gt;&lt;span class="mop op-symbol small-op" style="position:relative;top:0em;"&gt;âˆ‘&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.954em;"&gt;&lt;span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;span class="mrel mtight"&gt;=&lt;/span&gt;&lt;span class="mord mtight"&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.2029em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;93&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.4358em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal"&gt;n&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.23em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="frac-line" style="border-bottom-width:0.04em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.8258em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mop"&gt;&lt;span class="mop op-symbol small-op" style="position:relative;top:0em;"&gt;âˆ‘&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.954em;"&gt;&lt;span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;span class="mrel mtight"&gt;=&lt;/span&gt;&lt;span class="mord mtight"&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.2029em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;93&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.4358em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord mathnormal" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2222em;"&gt;&lt;/span&gt;&lt;span class="mbin"&gt;â‹…&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2222em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal"&gt;n&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:1.2798em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mclose nulldelimiter"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mpunct"&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;where &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;n_q&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal"&gt;n&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; is the number of bases with quality score being &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;q&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.625em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord mathnormal" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;. The magic number 93 comes from the quality score of Sanger sequencing&lt;sup id="fnref:sanger-qual-score"&gt;&lt;a class="footnote-ref" href="#fn:sanger-qual-score"&gt;1&lt;/a&gt;&lt;/sup&gt;, whose score ranges from 0 to 93.&lt;/p&gt;
&lt;p&gt;For &lt;code&gt;errQ&lt;/code&gt; we need more background knowledge about how quality score is computed. A base with quality score &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;q&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.625em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord mathnormal" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; implies the probability of being erroneously called, &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;P_q&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal" style="margin-right:0.13889em;"&gt;P&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;, is&lt;/p&gt;
&lt;p&gt;&lt;span class="katex-display"&gt;&lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math display="block" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;âˆ’&lt;/mo&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;/mfrac&gt;&lt;/msup&gt;&lt;mo separator="true"&gt;,&lt;/mo&gt;&lt;mspace width="1em"&gt;&lt;/mspace&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;âˆ’&lt;/mo&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;â¡&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;mi mathvariant="normal"&gt;.&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;
    P_q = 10^{\frac{-q}{10}}, \hspace{1em} q = -10\log_{10}{P_q}.
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal" style="margin-right:0.13889em;"&gt;P&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:1.2228em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;1&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord"&gt;0&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:1.0283em;"&gt;&lt;span style="top:-3.413em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mopen nulldelimiter sizing reset-size3 size6"&gt;&lt;/span&gt;&lt;span class="mfrac"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.879em;"&gt;&lt;span style="top:-2.656em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size3 size1 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;10&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.2255em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="frac-line mtight" style="border-bottom-width:0.049em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.4624em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size3 size1 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;âˆ’&lt;/span&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.344em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mclose nulldelimiter sizing reset-size3 size6"&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mpunct"&gt;,&lt;/span&gt;&lt;span class="mspace" style="margin-right:1em;"&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord mathnormal" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;âˆ’&lt;/span&gt;&lt;span class="mord"&gt;10&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mop"&gt;&lt;span class="mop"&gt;lo&lt;span style="margin-right:0.01389em;"&gt;g&lt;/span&gt;&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.207em;"&gt;&lt;span style="top:-2.4559em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;10&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2441em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal" style="margin-right:0.13889em;"&gt;P&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mord"&gt;.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Therefore, given &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;q&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.625em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord mathnormal" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; being &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo separator="true"&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo separator="true"&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo separator="true"&gt;,&lt;/mo&gt;&lt;mo&gt;â€¦&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;0, 1, 2, \ldots&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;0&lt;/span&gt;&lt;span class="mpunct"&gt;,&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;1&lt;/span&gt;&lt;span class="mpunct"&gt;,&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;2&lt;/span&gt;&lt;span class="mpunct"&gt;,&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="minner"&gt;â€¦&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;, seqtk has a conversion table &lt;code&gt;perr&lt;/code&gt; from quality score to probability,&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Q&lt;/th&gt;
&lt;th style="text-align: right;"&gt;0&lt;/th&gt;
&lt;th style="text-align: right;"&gt;1&lt;/th&gt;
&lt;th style="text-align: right;"&gt;2&lt;/th&gt;
&lt;th style="text-align: right;"&gt;3&lt;sup id="fnref:2"&gt;&lt;a class="footnote-ref" href="#fn:2"&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;strong&gt;P&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Q&lt;/th&gt;
&lt;th style="text-align: right;"&gt;4&lt;/th&gt;
&lt;th style="text-align: right;"&gt;5&lt;/th&gt;
&lt;th style="text-align: center;"&gt;&amp;hellip;&lt;/th&gt;
&lt;th style="text-align: right;"&gt;38&lt;/th&gt;
&lt;th style="text-align: right;"&gt;39&lt;/th&gt;
&lt;th style="text-align: right;"&gt;40&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;strong&gt;P&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.398107&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.316228&lt;/td&gt;
&lt;td style="text-align: center;"&gt;&amp;hellip;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.000158&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.000126&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.000100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Based on the probability, it computes the expected number of base call errors, num_err, and the empirical probability of having a base call error at this position, errP,&lt;/p&gt;
&lt;p&gt;&lt;span class="katex-display"&gt;&lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math display="block" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi mathvariant="normal"&gt;n&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;u&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mtext&gt;err&lt;/mtext&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;âˆ‘&lt;/mo&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;â‹…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;mo separator="true"&gt;,&lt;/mo&gt;&lt;mspace width="1em"&gt;&lt;/mspace&gt;&lt;mtext&gt;errP&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi mathvariant="normal"&gt;n&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;u&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mtext&gt;err&lt;/mtext&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;âˆ‘&lt;/mo&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mi mathvariant="normal"&gt;.&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;
    \mathrm{num}_\text{err} = \sum_q P_q \cdot n_q, \hspace{1em} \text{errP} = \frac{\mathrm{num}_\text{err}}{\sum_q n_q}.
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.5806em;vertical-align:-0.15em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord"&gt;&lt;span class="mord mathrm"&gt;num&lt;/span&gt;&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord text mtight"&gt;&lt;span class="mord mtight"&gt;err&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.15em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:2.4361em;vertical-align:-1.3861em;"&gt;&lt;/span&gt;&lt;span class="mop op-limits"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:1.05em;"&gt;&lt;span style="top:-1.9em;margin-left:0em;"&gt;&lt;span class="pstrut" style="height:3.05em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.05em;"&gt;&lt;span class="pstrut" style="height:3.05em;"&gt;&lt;/span&gt;&lt;span&gt;&lt;span class="mop op-symbol large-op"&gt;âˆ‘&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:1.3861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal" style="margin-right:0.13889em;"&gt;P&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2222em;"&gt;&lt;/span&gt;&lt;span class="mbin"&gt;â‹…&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2222em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal"&gt;n&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mpunct"&gt;,&lt;/span&gt;&lt;span class="mspace" style="margin-right:1em;"&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord text"&gt;&lt;span class="mord"&gt;errP&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:2.2294em;vertical-align:-1.1218em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mopen nulldelimiter"&gt;&lt;/span&gt;&lt;span class="mfrac"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:1.1076em;"&gt;&lt;span style="top:-2.314em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mop"&gt;&lt;span class="mop op-symbol small-op" style="position:relative;top:0em;"&gt;âˆ‘&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.0017em;"&gt;&lt;span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.4358em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathnormal"&gt;n&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mathnormal mtight" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2861em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.23em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="frac-line" style="border-bottom-width:0.04em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="top:-3.677em;"&gt;&lt;span class="pstrut" style="height:3em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord"&gt;&lt;span class="mord"&gt;&lt;span class="mord mathrm"&gt;num&lt;/span&gt;&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.1514em;"&gt;&lt;span style="top:-2.55em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord text mtight"&gt;&lt;span class="mord mtight"&gt;err&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.15em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:1.1218em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mclose nulldelimiter"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mord"&gt;.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Thus the &lt;code&gt;errQ&lt;/code&gt; is the equivalent quality score of errP, which better interprets the probability of base call error than &lt;code&gt;avgQ&lt;/code&gt;,&lt;/p&gt;
&lt;p&gt;&lt;span class="katex-display"&gt;&lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math display="block" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi mathvariant="normal"&gt;e&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;r&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;r&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;âˆ’&lt;/mo&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;â¡&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mi mathvariant="normal"&gt;e&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;r&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;r&lt;/mi&gt;&lt;mi mathvariant="normal"&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mi mathvariant="normal"&gt;.&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;
    \mathrm{errQ} = -10\log_{10}{\mathrm{errP}}.
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord mathrm"&gt;errQ&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;âˆ’&lt;/span&gt;&lt;span class="mord"&gt;10&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mop"&gt;&lt;span class="mop"&gt;lo&lt;span style="margin-right:0.01389em;"&gt;g&lt;/span&gt;&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t vlist-t2"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.207em;"&gt;&lt;span style="top:-2.4559em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;10&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-s"&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.2441em;"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.1667em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord"&gt;&lt;span class="mord mathrm"&gt;errP&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mord"&gt;.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;By passing &lt;code&gt;-q 0&lt;/code&gt; to &lt;code&gt;seqtk fqchk&lt;/code&gt;, one can get the proportion of all distinct quality scores at each position. This information is pretty useful if the sequencing data is all a mess and one needs to figure out the cause.&lt;/p&gt;
&lt;p&gt;Though some of the &lt;code&gt;seqtk fqchk&lt;/code&gt;&amp;lsquo;s behavior is not documented, it should be straight forward enough to understand. All in all, the details can always be found in the &lt;a href="https://github.com/lh3/seqtk/blob/4feb6e81444ab6bc44139dd3a125068f81ae4ad8/seqtk.c#L1483"&gt;source code&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id="summary"&gt;Summary&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/lh3/seqtk"&gt;Seqtk&lt;/a&gt; is fast to use for daily routines of FASTA/Q conversion. On top of that it provide various functionalities such as read random sampling, quality check, and many I haven&amp;rsquo;t tried or mentioned.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:sanger-qual-score"&gt;
&lt;p&gt;See multiple specifications of quality score at &lt;a href="http://scikit-bio.org/docs/latest/generated/skbio.io.format.fastq.html#quality-score-variants"&gt;sckit-bio doc&lt;/a&gt;. The score is &lt;a href="https://en.wikipedia.org/wiki/Phred_quality_score"&gt;Phred quality score&lt;/a&gt;. More other score representations can be found at &lt;a href="https://en.wikipedia.org/wiki/FASTQ_format"&gt;FASTQ wiki&lt;/a&gt;.&amp;#160;&lt;a class="footnote-backref" href="#fnref:sanger-qual-score" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Note that the probability of q less than 4 is fixed with 0.5. A quick computation can see when &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;q = 3&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.625em;vertical-align:-0.1944em;"&gt;&lt;/span&gt;&lt;span class="mord mathnormal" style="margin-right:0.03588em;"&gt;q&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.6444em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;, its actual Phred probability is &lt;span class="katex"&gt;&lt;span class="katex-mathml"&gt;&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mrow&gt;&lt;mo&gt;âˆ’&lt;/mo&gt;&lt;mn&gt;0.3&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.501&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;10 ^ {-0.3} = 0.501&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span aria-hidden="true" class="katex-html"&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.8141em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;1&lt;/span&gt;&lt;span class="mord"&gt;&lt;span class="mord"&gt;0&lt;/span&gt;&lt;span class="msupsub"&gt;&lt;span class="vlist-t"&gt;&lt;span class="vlist-r"&gt;&lt;span class="vlist" style="height:0.8141em;"&gt;&lt;span style="top:-3.063em;margin-right:0.05em;"&gt;&lt;span class="pstrut" style="height:2.7em;"&gt;&lt;/span&gt;&lt;span class="sizing reset-size6 size3 mtight"&gt;&lt;span class="mord mtight"&gt;&lt;span class="mord mtight"&gt;âˆ’&lt;/span&gt;&lt;span class="mord mtight"&gt;0.3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;span class="mrel"&gt;=&lt;/span&gt;&lt;span class="mspace" style="margin-right:0.2778em;"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="base"&gt;&lt;span class="strut" style="height:0.6444em;"&gt;&lt;/span&gt;&lt;span class="mord"&gt;0.501&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;.&amp;#160;&lt;a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Bioinfo"></category><category term="en"></category><category term="seqtk"></category><category term="NGS"></category></entry><entry><title>æ¸…é™¤ ^H</title><link href="https://blog.liang2.tw/posts/2015/09/remove-%5EH/" rel="alternate"></link><published>2015-09-27T02:28:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-27:/posts/2015/09/remove-^H/</id><summary type="html">&lt;p&gt;ä¸­æ–‡è¼¸å…¥æˆ‘ç”¨å˜¸è¦ç±³ï¼Œåœ¨æ‰“ä¸­è‹±æ–‡åˆ‡æ›æ™‚å€™ï¼Œå¾ˆå®¹æ˜“æ‰“å‡º &lt;code&gt;\x08&lt;/code&gt; é€™æ±è¥¿ï¼Œåœ¨ vim å°±æœƒé¡¯ç¤ºæˆ &lt;code&gt;^H&lt;/code&gt;ï¼ŒåŠŸèƒ½æ˜¯ &lt;kbd&gt;Backspace&lt;/kbd&gt;ï¼Œä½†åœ¨ä¸€èˆ¬ GUI ç’°å¢ƒè£¡ï¼Œå¯èƒ½å°± â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸­æ–‡è¼¸å…¥æˆ‘ç”¨å˜¸è¦ç±³ï¼Œåœ¨æ‰“ä¸­è‹±æ–‡åˆ‡æ›æ™‚å€™ï¼Œå¾ˆå®¹æ˜“æ‰“å‡º &lt;code&gt;\x08&lt;/code&gt; é€™æ±è¥¿ï¼Œåœ¨ vim å°±æœƒé¡¯ç¤ºæˆ &lt;code&gt;^H&lt;/code&gt;ï¼ŒåŠŸèƒ½æ˜¯ &lt;kbd&gt;Backspace&lt;/kbd&gt;ï¼Œä½†åœ¨ä¸€èˆ¬ GUI ç’°å¢ƒè£¡ï¼Œå¯èƒ½å°±æœƒå› ç‚ºå®ƒè€ŒæŠŠå‰é¢çš„å­—åƒæŽ‰ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ä»Šå¤©å¯«äº†å€‹å°è…³æœ¬å¯ä»¥æŠŠæ¸…æŽ‰ç•¶ç›®éŒ„åº•ä¸‹çš„æ–‡å­—æª”çš„ &lt;code&gt;^H&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ag -l &lt;span class="s1"&gt;&amp;#39;\x08&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; xargs sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;s/\x08//&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://github.com/ggreer/the_silver_searcher"&gt;ag&lt;/a&gt; èƒ½å¤ æ›æˆæ¯”è¼ƒæ…¢ä½†å…§å»ºå°±æœ‰çš„ grepï¼Œåƒæ•¸å…©è€…æ˜¯ç›¸å®¹çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æžœè¦é †ä¾¿å°å‡ºæ”¹äº†å“ªäº›æª”æ¡ˆçš„è©±ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Found ^H in the following files:&amp;#39;&lt;/span&gt;
ag -l &lt;span class="s1"&gt;&amp;#39;\x08&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; tee /dev/fd/2 &lt;span class="p"&gt;|&lt;/span&gt; xargs sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;s/\x08//&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨ tee æŠŠ stdout å°Žå‘åˆ° stderr é‚„è »æœ‰è¶£çš„ï¼Œä»¥å‰éƒ½ä¸çŸ¥é“é€™æ¨£ç”¨ã€‚&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category></entry><entry><title>ä½¿ç”¨ Zotero ç®¡ç†æ–‡ç»æ›¸ç›®</title><link href="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/" rel="alternate"></link><published>2015-09-26T00:00:00-05:00</published><updated>2022-05-13T13:06:27-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-26:/posts/2015/09/ref-management-zotero/</id><summary type="html">&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Use Zotero to sync references, webpages, and everything.&lt;/p&gt;
&lt;p&gt;ä¸€é–‹å§‹æœƒæƒ³è¦æ”¶é›† reference ç„¡éžæ˜¯åšç ”ç©¶ã€‚å¯«è«–æ–‡ã€å¹³å¸¸å ±å‘Šé€²åº¦éœ€è¦æ”¾ä¸Š citationï¼Œè€Œåœ¨å­¸è¡“ç•Œæœ€å¸¸å°±æ˜¯ cite åˆ¥ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt; Use Zotero to sync references, webpages, and everything.&lt;/p&gt;
&lt;p&gt;ä¸€é–‹å§‹æœƒæƒ³è¦æ”¶é›† reference ç„¡éžæ˜¯åšç ”ç©¶ã€‚å¯«è«–æ–‡ã€å¹³å¸¸å ±å‘Šé€²åº¦éœ€è¦æ”¾ä¸Š citationï¼Œè€Œåœ¨å­¸è¡“ç•Œæœ€å¸¸å°±æ˜¯ cite åˆ¥äººçš„æœŸåˆŠã€‚æœŸåˆŠ citation æœ‰å®ƒä¸€å®šçš„æ ¼å¼ï¼Œè€Œä¸”æ¯å€‹æœŸåˆŠç”¨çš„æ ¼å¼ä¸åŒï¼Œæ‰‹æ‰“å®¹æ˜“éŒ¯ï¼Œä¹Ÿå¾ˆé›£ç¶­è­·ã€‚æ‰€ä»¥æœ€å¥½çš„æ–¹å¼å°±æ˜¯æŠŠæœŸåˆŠå®Œæ•´çš„è³‡è¨Šå­˜åœ¨è³‡æ–™åº«ï¼Œç„¶å¾Œå¼•ç”¨çš„æ™‚å€™å†æ’åˆ°æ–‡ä»¶è£¡é¢ã€‚&lt;/p&gt;
&lt;p&gt;æ•´å€‹å•é¡Œå°±è®Šæˆæ€Žéº¼ç®¡ç†é€™äº›æœŸåˆŠè³‡è¨Šã€‚&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#bibtex-is-for-latex"&gt;BibTex is for LaTeX&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#bibdesk"&gt;BibDesk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#endnote-is-for-word"&gt;EndNote is for Word&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#zotero-bridges-the-both-world"&gt;Zotero bridges the both world&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#zotfile"&gt;Zotfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#how-to-sync-data-storage"&gt;How to sync data storage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç¸½çµ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="bibtex-is-for-latex"&gt;BibTex is for LaTeX&lt;/h3&gt;
&lt;p&gt;åœ¨ &lt;a href="https://www.latex-project.org/"&gt;LaTeX&lt;/a&gt; ç•¶ä¸­å¯ä»¥åˆ©ç”¨ &lt;a href="http://www.bibtex.org/"&gt;BibTeX&lt;/a&gt;ï¼ˆæˆ–æ›´æ–°çš„ &lt;a href="https://www.ctan.org/pkg/biblatex"&gt;BibLaTeX&lt;/a&gt;ï¼‰æä¾›çš„æµç¨‹è™•ç† citation èˆ‡ç®¡ç† referenceï¼ˆå³ &lt;a href="https://en.wikibooks.org/wiki/LaTeX/Bibliography_Management"&gt;Bibliography ç®¡ç†&lt;/a&gt;ï¼‰ã€‚ä»–æŠŠæ‰€æœ‰ reference é›†ä¸­åœ¨ä¸€å€‹ç´”æ–‡å­—çš„æª”æ¡ˆï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;@article&lt;span class="nb"&gt;{&lt;/span&gt;Calin:2006aa,
    Author = &lt;span class="nb"&gt;{&lt;/span&gt;Calin, George A. and Croce, Carlo M.&lt;span class="nb"&gt;}&lt;/span&gt;,
    Journal = &lt;span class="nb"&gt;{&lt;/span&gt;Nat Rev Cancer&lt;span class="nb"&gt;}&lt;/span&gt;,
    Month = &lt;span class="nb"&gt;{&lt;/span&gt;11&lt;span class="nb"&gt;}&lt;/span&gt;,
    Number = &lt;span class="nb"&gt;{&lt;/span&gt;11&lt;span class="nb"&gt;}&lt;/span&gt;,
    Pages = &lt;span class="nb"&gt;{&lt;/span&gt;857--866&lt;span class="nb"&gt;}&lt;/span&gt;,
    Title = &lt;span class="nb"&gt;{&lt;/span&gt;MicroRNA signatures in human cancers&lt;span class="nb"&gt;}&lt;/span&gt;,
    Volume = &lt;span class="nb"&gt;{&lt;/span&gt;6&lt;span class="nb"&gt;}&lt;/span&gt;,
    Year = &lt;span class="nb"&gt;{&lt;/span&gt;2006&lt;span class="nb"&gt;}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¯ç¯‡æ–‡ç« æœƒæœ‰ä¸€å€‹ cite keyï¼Œåœ¨å…§æ–‡ç”¨åˆ°çš„æ™‚å€™å°±å¯ä»¥å¼•ç”¨ï¼Œè€Œ BibTeX å°±æœƒæ ¹æ“šç¾åœ¨å®šç¾©çš„ style åŽ»æ”¾ citation ä»¥åŠåœ¨æ–‡æœ«åŠ ä¸Šå°æ‡‰çš„ referenceã€‚&lt;/p&gt;
&lt;h4 id="bibdesk"&gt;BibDesk&lt;/h4&gt;
&lt;p&gt;çœŸæ­£è®“ BibTeX èƒ½åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­å¾ˆå¥½ä½¿ç”¨ï¼Œæœ‰ä¸€éƒ¨ä»½è¦æ­¸åŠŸæ–¼åƒ &lt;a href="http://bibdesk.sourceforge.net/"&gt;BibDesk&lt;/a&gt; é€™æ¨£çš„åœ–å½¢å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bibdesk.sourceforge.net/"&gt;BibDesk&lt;/a&gt; æ˜¯å€‹ OSX çš„æ‡‰ç”¨ç¨‹å¼ï¼ŒåŒ…å«åœ¨ &lt;a href="https://tug.org/mactex/"&gt;MacTex&lt;/a&gt; distribution è£¡é¢ã€‚é™¤äº†èƒ½è‡ªå‹•å¾žåŒ¯å…¥ä¾†è‡ªç¶²ç«™æˆ–ä¸åŒæ ¼å¼çš„ citation ä¹‹å¤–ï¼Œé‚„æœ‰æª”æ¡ˆé™„ä»¶çš„åŠŸèƒ½ï¼Œèƒ½æŠŠä¾‹å¦‚è«–æ–‡çš„ PDFã€Supplementary files è‡ªå‹•è·Ÿå°æ‡‰çš„æ¢ç›®åšé€£æŽ¥ï¼Œé‡æ–°å‘½åä¸¦æ”¾åœ¨ä¸€å€‹æž¶æ§‹åŒ–çš„è³‡æ–™å¤¾ã€‚é‡æ–°å‘½åè·Ÿæ­¸æª”çš„æ–¹å¼éƒ½èƒ½è‡ªè¨‚ï¼Œä¾‹å¦‚å¯ä»¥ç…§ æœŸåˆŠåç¨±/å¹´ä»½ åŽ»åˆ†é¡žï¼Œç„¶å¾ŒæŠŠé€™å€‹è³‡æ–™å¤¾æ”¾åœ¨ Dropbox ä¸Šå°±å®Œæˆäº†è‡ªå‹•åŒæ­¥ã€‚&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/bibdesk_usage.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;BibDesk ä½¿ç”¨ç•«é¢&lt;/span&gt;&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;é€™æ¨£è§£æ±ºäº†å¹¾ä¹Žæ‰€æœ‰å¯« paper æœƒç¢°åˆ°çš„å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;å¹³å¸¸æœƒæœ‰å€‹è¶…ç´šå¤§çš„ BibTeX æª”ï¼Œè£¡é¢æœ‰æ‰€æœ‰å„å¼å„æ¨£çš„ referenceã€‚è¦å¯« paper çš„æ™‚å€™å°±æŠŠç›¸é—œçš„ paper æ‹¿å‡ºä¾† export æˆä¸€å€‹å°çš„æª”æ¡ˆï¼Œç„¶å¾ŒæŠŠä¸€äº›æ¢ç›®è£¡ä¸ç›¸é—œçš„è³‡è¨Šæ‹¿æŽ‰ï¼Œå°±ä¸ç”¨å†åŽ»æƒ³æ–‡ç»å¼•ç”¨çš„éƒ¨ä»½ã€‚æˆ‘æœ‰å¥½å¹¾å¹´éƒ½æ˜¯é€™æ¨£ç®¡ç† reference çš„ã€‚&lt;/p&gt;
&lt;h3 id="endnote-is-for-word"&gt;EndNote is for Word&lt;/h3&gt;
&lt;p&gt;ä¸éŽä¸æ˜¯æ‰€æœ‰äººéƒ½ç”¨ LaTeX å¯« paperï¼Œä¾‹å¦‚æˆ‘å€‘å¯¦é©—å®¤å°±åªæœ‰æˆ‘ä¸€å€‹äººç”¨ LaTeXï¼Œå…¶ä»–äººéƒ½ç”¨ Wordã€‚Word ä¸Šé¢å°±æ²’é€™éº¼ç°¡å–®åˆå¥½ç”¨çš„ç®¡ç†å·¥å…·äº†ã€‚æœ€å¤šäººç”¨çš„æ˜¯ EndNoteã€‚å®ƒæ˜¯ä»˜è²»çš„ï¼Œä½†å› ç‚ºæˆ‘æ˜¯å…¬ç«‹å¤§å­¸çš„å­¸ç”Ÿï¼Œæ‰€ä»¥è¬è¬å„ä½ç´ç¨…äººï¼Œè®“æˆ‘èƒ½å…è²»ä½¿ç”¨å®ƒï¼ˆéž èº¬ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;EndNote åšåˆ°çš„åŠŸèƒ½è·Ÿ BibTeX ä¸€æ¨£ï¼Œç”¨äº†å®ƒä¹‹å¾Œåœ¨ word è£¡é¢å°±ä¸ç”¨å†ç®¡ç†æ›¸ç›®çš„æ ¼å¼ã€‚ä¸éŽæˆ‘å¹³å¸¸éƒ½æ˜¯å¾žåˆ¥çš„åœ°æ–¹æŠŠ reference export å†ä¸Ÿé€² EndNote è£¡ï¼Œæ‰€ä»¥ä¹Ÿä¸æ¸…æ¥šå®ƒæœ‰ä»€éº¼åˆ¥çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å™¢ï¼Œä»–æœ‰å€‹å¥½è™•å°±æ˜¯åœ¨ OSX å’Œåœ¨ Windows ä¸Šéƒ½ä¸€æ¨£å¥½ç”¨ã€‚&lt;/p&gt;
&lt;h3 id="zotero-bridges-the-both-world"&gt;Zotero bridges the both world&lt;/h3&gt;
&lt;p&gt;BibDesk (BibTeX) çœŸçš„å¾ˆæ–¹ä¾¿ï¼Œè®“æˆ‘æœ‰æ™‚å€™æƒ³è¦ç®¡ç†ä¸€äº›å¾ˆç¶“å…¸çš„æŠ€è¡“æ–‡ç« ï¼Œæƒ³è¦å­˜ä¸€äº›æœ‰ç”¨çš„ä¸è«–æ˜¯ PDFã€å½±ç‰‡ã€ç¶²ç«™ï¼Œéƒ½æƒ³è¦æ”¾åˆ° BibDesk è£¡é¢ã€‚ä½†é€™äº›åœ°æ–¹éƒ½æ²’æœ‰æä¾› BibTex citation format è®“äººç›´æŽ¥è¤‡è£½è²¼ä¸Šï¼Œè€Œä¸”å®ƒçš„èªžæ³•ä¹Ÿæ²’æœ‰è¨­è¨ˆè¦è§£æ±ºé€™éº¼å¤šä¾†æºï¼Œæ‰€ä»¥å¯«èµ·ä¾†å¾ˆå¡ã€å¾ˆèŠ±æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œç¾åœ¨æŸ¥è³‡æ–™éƒ½æ˜¯ç”¨ç€è¦½å™¨ï¼Œçœ‹åˆ°ä¸€ç¯‡è«–æ–‡ï¼Œå¦‚æžœè¦ Export citationã€æ‰“é–‹ BibDeskã€Import citationã€Download PDF(s)ã€Link PDF(s) é€™ä¸€é€£ä¸²å‹•ä½œä¹Ÿå¾ˆéº»ç…©ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å°±æœ‰äº† &lt;a href="https://www.zotero.org/"&gt;Zotero&lt;/a&gt; [zoh-TAIR-oh] é€™æ•´åˆåœ¨ç€è¦½å™¨çš„å·¥å…·ã€‚ç›®å‰æ”¯æ´ Firefoxã€Chromeã€Safariï¼Œä¹Ÿæœ‰æä¾› Plugin çµ¦ Word æˆ– LibreOffice ä½¿ç”¨ã€‚æ‰€ä»¥å®ƒæ‡‰è©²è¶³å¤ å–ä»£å‰é¢çš„å·¥å…·ï¼Œé›–ç„¶æˆ‘ä¸¦æ²’æœ‰çµåˆ Word ä½¿ç”¨éŽã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ç•«é¢è »ç°¡å–®çš„ï¼Œå¤§æ¦‚æ‰€æœ‰çš„æ›¸ç›®ç®¡ç†è»Ÿé«”éƒ½å·®ä¸å¤šï¼Œåªæ˜¯å®ƒæ˜¯æ•´åˆåœ¨ Browser ç•¶ä¸­ï¼Œ&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotero.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;Zotero ä½¿ç”¨ç•«é¢&lt;/span&gt;&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;ä½¿ç”¨å¾ˆç°¡å–®ï¼Œå°±å…©å€‹æŒ‰éˆ• &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotero_icon.png" style="height: 1.6em;"/&gt;ï¼Œå·¦é‚Šæ‰“é–‹ Zotero è¦–çª—ï¼Œå³é‚ŠæŠŠç•¶å‰ç¶²é å­˜é€²è‡ªå·±çš„ library è£¡ï¼Œå®ƒå³ä¸‹è§’å°±æœƒå‡ºç¾è™•ç†çš„è¨Šæ¯ï¼Œå¦‚æžœæ˜¯æœŸåˆŠç¶²ç«™è€Œä¸”æœ‰ full text PDF çš„æ¬Šé™ï¼Œå°±æœƒä¸€èµ·æŠŠ PDF éƒ½å­˜èµ·ä¾†ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotero_saving.png"/&gt;
&lt;/figure&gt;

&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotero_citation.png"/&gt;
&lt;/figure&gt;

&lt;p&gt;å¹³å¸¸è¦æ”¾åˆ°è«–æ–‡è£¡æ™‚ï¼Œæˆ‘é‚„æ˜¯æœƒå…ˆåŒ¯å‡ºåˆ° BibTeX æˆ– EndNoteã€‚ä¸éŽå®ƒé¡å¤–é‚„æœ‰å¥½ç”¨çš„åŠŸèƒ½ï¼Œèƒ½æŠŠ citation è¼¸å‡ºæˆ RTF/HTML çš„ bibliographyï¼Œé€™å¯ä»¥ç›´æŽ¥è²¼åœ¨ Powerpoint åšæŠ•å½±ç‰‡å¾ˆæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;Torsten Thomas, Jack Gilbert &amp;amp; Folker Meyer. Metagenomics - a guide from sampling to data analysis. &lt;em&gt;Microbial Informatics and Experimentation&lt;/em&gt; &lt;strong&gt;2&lt;/strong&gt;, 3 (2012).&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;Zotero æœ‰æä¾›å…è²» 300MB è®“ä½¿ç”¨è€…åŒæ­¥ libraryï¼Œé€™å°æ–¼å–®ç´” citation æœ¬èº«å·²ç¶“å¾ˆè¶³å¤ äº†ï¼Œå®ƒä¹Ÿæ”¯æ´åŒæ­¥åˆ°è‡ªå·±æž¶è¨­çš„ WebDAVã€‚&lt;/p&gt;
&lt;p&gt;PS: Zotero æŽ¡ç”¨ AGPL v3 æŽˆæ¬Šï¼ŒåŽŸå§‹ç¢¼åœ¨ &lt;a href="https://github.com/zotero/zotero"&gt;Github&lt;/a&gt; ä¸Šã€‚&lt;/p&gt;
&lt;h4 id="zotfile"&gt;Zotfile&lt;/h4&gt;
&lt;p&gt;Zotero å…§å»ºçš„ PDF attachment åŠŸèƒ½ä¸å¦‚ BibDesk é€™éº¼å®Œæ•´ï¼Œå› æ­¤æœ‰ &lt;a href="http://zotfile.com/"&gt;Zotfile&lt;/a&gt; ä¾†é¡å¤–ç®¡ç† PDF æª”æ¡ˆçš„åŠŸèƒ½ã€‚å†è€… Zotero çš„ç©ºé–“æœ‰é™ï¼Œæœƒæƒ³æŠŠ PDF ç­‰å¤§çš„æª”æ¡ˆæ”¾åœ¨åƒ Dropbox çš„åœ°æ–¹ï¼Œä¸è¦éƒ½ç”¨ Zotero åŒæ­¥ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotfile_file_location.png"/&gt;
  &lt;p class="caption left"&gt;è‡ªè¨‚ (PDF) æª”æ¡ˆå­˜æ”¾è·¯å¾‘ï¼Œåº•ä¸‹å¯ä»¥å†è¨­å®šå­ç›®éŒ„ã€‚åœ¨é€™é‚Šæ˜¯æœƒæŒ‰ç…§&lt;code&gt;æœŸåˆŠå/å¹´åˆ†&lt;/code&gt;åŽ»åˆ†ç›®éŒ„ã€‚&lt;/p&gt;
&lt;/figure&gt;

&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotfile_rename_setting.png"/&gt;
  &lt;figcaption&gt;è‡ªè¨‚æª”æ¡ˆå‘½åè¦å‰‡&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;ä¸éŽå¦‚æžœæ˜¯åŒæ­¥åˆ° Dropbox çš„è©±ï¼Œå¯èƒ½æ¯å°é›»è…¦çš„è·¯å¾‘éƒ½ä¸ä¸€æ¨£ï¼Œä¾‹å¦‚ OSX å¯èƒ½æ˜¯ &lt;code&gt;/Users/me/Dropbox&lt;/code&gt;ï¼Œä½† Debian å¯èƒ½æ˜¯ &lt;code&gt;/home/me/Dropbox&lt;/code&gt;ï¼Œé€™æ™‚å€™å­˜æ”¾çš„è·¯å¾‘å°±è¦æ”¹æˆç›¸å°è·¯å¾‘ã€‚&lt;/p&gt;
&lt;figure class="align-center"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotero_file_location.png"/&gt;
  &lt;figcaption&gt;Zotero Advanced è¨­å®šè£¡ä¿®æ”¹ library ç›¸é—œæª”æ¡ˆçš„è·¯å¾‘ã€‚&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;é€™é‚Šè¦é¡å¤–èªªæ˜Žä¸€ä¸‹ Linked Attachment Base Directory ä»¥åŠ Data Directory çš„å·®ç•°ã€‚åƒ PDF é€™é¡žå¦‚æžœè¢« Zotfile æ‰€ç®¡ç†çš„æª”æ¡ˆï¼Œæˆ–æ˜¯è‡ªå·±æ‰‹å‹•é¸ã€ŒAttach Link &amp;hellip;ã€çš„æª”æ¡ˆï¼Œä»–ä½¿ç”¨çš„æ˜¯ linked attachmentï¼Œicon æœƒæœ‰å€‹é€£çµçš„ç¬¦è™Ÿ &lt;img src="https://blog.liang2.tw/posts/2015/09/ref-management-zotero/pics/zotfile_fileicon.png" style="height: 1.6em;"/&gt;ã€‚å…¶ä»–åƒ Webpage Snapshot æˆ–æ˜¯é è¨­çš„ PDF æª”éƒ½æ˜¯æ”¾åœ¨ Data Directoryã€‚&lt;/p&gt;
&lt;h4 id="how-to-sync-data-storage"&gt;How to sync data storage&lt;/h4&gt;
&lt;p&gt;å¦‚æžœè¦é€²ä¸€æ­¥è®“ data storage ä¹Ÿç”¨ Dropbox åŒæ­¥çš„è©±ï¼Œåƒè€ƒå®˜ç¶²é—œæ–¼ &lt;a href="https://www.zotero.org/support/sync"&gt;sync çš„ä»‹ç´¹&lt;/a&gt;ï¼ŒOSX ä¸Š Zotero Firefox çš„è³‡æ–™æœƒå­˜æ”¾åœ¨&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;~/Library/Application Support/Firefox/Profiles/xxxxxxxx.default/zotero
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­ data storage å°±åœ¨åº•ä¸‹çš„ &lt;code&gt;storage&lt;/code&gt; è³‡æ–™å¤¾ã€‚å®˜ç¶²å»ºè­°ä¸è¦æŠŠ Zotero çš„ SQLite database ç­‰éƒ½åŒæ­¥åœ¨ Dropbox ä¸Šï¼Œæ‰€ä»¥åªè¦æŠŠé€™å€‹è³‡æ–™ç§»åˆ° Dropbox å† soft link å›žä¾†å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;ç¸½çµ&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://www.zotero.org/"&gt;Zotero&lt;/a&gt; æ˜¯å€‹å¯¦ç”¨ä¸¦ä¸”è·Ÿç€è¦½å™¨æ•´åˆçš„æ–‡ç»ï¼ˆæ›¸ç›®ï¼‰ç®¡ç†å·¥å…·ã€‚ä½†å®ƒä¹Ÿèƒ½è™•ç†åƒç¶²é ç­‰å…¶ä»–ç¶²è·¯ä¸Šä¹Ÿå¾ˆå¸¸è¦‹çš„æ ¼å¼ï¼Œä¹Ÿèƒ½èˆ‡æ—¢æœ‰çš„å·¥å…·ã€æ–‡ä»¶ç·¨è¼¯è»Ÿé«”çµåˆï¼Œä¸¦æœ‰åŒæ­¥åŠŸèƒ½ï¼Œéžå¸¸é©åˆä½œç‚ºå¤–éƒ¨è¨˜æ†¶åº«ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆæ‡‰è©²è¦ç”¨è‹±æ–‡å¯«çš„ï¼Œä»€éº¼æ™‚å€™æ‰æœƒæœ‰ç¬¬ä¸€ç¯‡è‹±æ–‡ blog post QAQï¼‰&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="zotero"></category></entry><entry><title>PNG Optimizer</title><link href="https://blog.liang2.tw/posts/2015/09/png-optim/" rel="alternate"></link><published>2015-09-22T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-22:/posts/2015/09/png-optim/</id><summary type="html">&lt;p&gt;éƒ¨è½æ ¼å‰›æˆç«‹ç¸½æ˜¯ç‰¹åˆ¥èˆˆå¥®ï¼Œæ¸¬äº†ä¸€ä¸‹ç€è¦½åƒé€™æ¨£çš„ç¶²ç«™è¦ç”¨å¤šå°‘é »å¯¬ã€‚é¦–é èƒ½å£“åœ¨ 600KB å·¦å³ï¼Œå› ç‚ºæ–‡ç«  summary è£¡é¢æš«æ™‚é‚„æ²’åœ– â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;éƒ¨è½æ ¼å‰›æˆç«‹ç¸½æ˜¯ç‰¹åˆ¥èˆˆå¥®ï¼Œæ¸¬äº†ä¸€ä¸‹ç€è¦½åƒé€™æ¨£çš„ç¶²ç«™è¦ç”¨å¤šå°‘é »å¯¬ã€‚é¦–é èƒ½å£“åœ¨ 600KB å·¦å³ï¼Œå› ç‚ºæ–‡ç«  summary è£¡é¢æš«æ™‚é‚„æ²’åœ–ã€‚ä¸éŽåƒéƒ¨è½æ ¼è¨­å®šé€™ç¯‡æ–‡ç« ï¼Œè£¡é¢æœ‰å¹¾å¼µèž¢å¹•æˆªåœ–çš„å°±è¦èŠ±å¿« 2MB å‚³ã€‚&lt;/p&gt;
&lt;p&gt;å°±æƒ³äº†ä¸€ä¸‹åœ–æª”æœ‰ä»€éº¼å£“ç¸®æ–¹å¼ã€‚å¦‚æžœæ˜¯ JPG çš„è©±ï¼Œ&lt;a href="https://github.com/tjko/jpegoptim"&gt;jpegoptim&lt;/a&gt; ç°¡å–®åˆæœ‰æ•ˆï¼›å¦‚æžœæ˜¯ PNG çš„è©±ï¼Œä»¥å‰éƒ½æ˜¯ç”¨ &lt;a href="http://optipng.sourceforge.net/"&gt;OptiPNG&lt;/a&gt;ï¼Œä½†æ•ˆæžœæœ‰é™ï¼Œè€Œä¸”æ˜¯ç„¡æå£“ç¸®ã€‚åœ¨èž¢å¹•æˆªåœ–çš„æƒ…æ³ï¼Œæˆ‘å€’ä¸ä»‹æ„å¹¾å€‹åƒç´ çš„é¡è‰²ç¨å¾®ä¸ä¸€æ¨£ï¼ˆå…¶å¯¦äººçœ¼ç„¡æ³•åˆ†è¾¨ï¼‰&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯ï¼Œéœ€è¦æ¯”è¼ƒçœ‹çœ‹å¸‚é¢æ‰¾å¾—åˆ°çš„å¹¾ç¨® PNG å£“ç¸®æ–¹å¼ã€‚å¾ˆç¢°å·§æ‰¾åˆ° &lt;a href="http://css-ig.net/png-tools-overview.html"&gt;http://css-ig.net/png-tools-overview.html&lt;/a&gt; å°ˆè¬› PNG å„ªåŒ–çš„æ¯”è¼ƒï¼Œå°±æŒ‘äº†å¹¾æ¬¾ä¾†è©¦ã€‚&lt;/p&gt;
&lt;p&gt;ç›´æŽ¥æŠŠçµæžœæ•´ç†æˆä¸‹è¡¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Filename&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Original size&lt;/th&gt;
&lt;th style="text-align: right;"&gt;&lt;a href="http://optipng.sourceforge.net/"&gt;OptiPNG&lt;/a&gt; (lossless)&lt;/th&gt;
&lt;th style="text-align: right;"&gt;&lt;a href="https://github.com/google/zopfli"&gt;Zopfli&lt;/a&gt; (lossless)&lt;/th&gt;
&lt;th style="text-align: right;"&gt;&lt;a href="https://pngquant.org/"&gt;pngquant&lt;/a&gt; (lossy)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_desktop.png"&gt;blog_desktop.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;180K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;108K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;100K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_mobile.png"&gt;blog_mobile.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;72K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;52K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;44K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;28K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/justfont_setting.png"&gt;justfont_setting.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;272K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;196K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;164K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;84K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/oldsite.png"&gt;oldsite.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;604K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;536K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;492K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;288K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="https://blog.liang2.tw/posts/2015/09/png-optim/pics/oldsite_full.png"&gt;oldsite_full.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;816K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;684K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;644K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;376K&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="optipng"&gt;OptiPNG&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://optipng.sourceforge.net/"&gt;OptiPNG&lt;/a&gt; é‚„æ˜¯æœ‰éƒ¨ä»½æ•ˆæžœï¼Œä¸éŽä»–è·‘ä¸å¿«ã€‚&lt;/p&gt;
&lt;h3 id="zopfli-zopflipng"&gt;Zopfli (Zopflipng)&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/google/zopfli"&gt;Zopfli&lt;/a&gt; æ˜¯ Google é–‹ç™¼çš„å£“ç¸®æ¼”ç®—æ³•ï¼Œç›¸å®¹æ–¼ deflate, gzip, zlib æ ¼å¼ã€‚ä¹Ÿå› æ­¤èƒ½ç”¨åœ¨ PNG ä¸Šé¢ã€‚ä»–ä¹Ÿæ˜¯ lossless compressionã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Zopfli Compression Algorithm is a compression library programmed in C to perform very good, but slow, deflate or zlib compression.
(&lt;a href="https://github.com/google/zopfli"&gt;Zopfli Readme&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€™å€‹ &lt;a href="https://github.com/google/zopfli/blob/master/README.zopflipng"&gt;Zopflipng&lt;/a&gt; ä¹Ÿæ˜¯åŒå€‹ repo ç¶­è­·ã€‚è‡ªå·±ç·¨è­¯ç°¡å–®ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;git clone https://github.com/google/zopfli.git
make zopflipng
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æžœè¦ä¸€å£æ°£å£“ç¸®ä¸€å † PNGï¼Œå¯ä»¥é€™æ¨£ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;zopflipng --lossy_transparent --prefix *.png
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€Ÿåº¦ä¹Ÿè »æ…¢çš„ï¼Œæœ‰å€‹ &lt;code&gt;-q&lt;/code&gt; é¸é …å¯ä»¥åŠ é€Ÿã€‚ä½†å£“ç¸®æ•ˆçŽ‡æ¯” OptiPNG é‚„å¥½ã€‚&lt;/p&gt;
&lt;p&gt;PS å‰›å¥½ä»Šå¤©æ—©ä¸Šçœ‹åˆ° Google åˆå‡ºäº†å¦ä¸€å€‹å£“ç¸®æ¼”ç®—æ³• &lt;a href="https://github.com/google/brotli"&gt;Brotli&lt;/a&gt;ï¼Œä½†é€™å€‹èˆ‡ deflate ä¸ç›¸å®¹ï¼Œæ‡‰è©²ä¸èƒ½ç”¨åœ¨ PNG ä¸Šé¢ã€‚&lt;/p&gt;
&lt;h3 id="pngquant"&gt;pngquant&lt;/h3&gt;
&lt;p&gt;æƒ³è¦æœ‰æçš„ PNG å¯ä»¥ç”¨ &lt;a href="https://pngquant.org/"&gt;pngquant&lt;/a&gt;ã€‚çœ‹å®˜ç¶²æœ‰ç‰¹åˆ¥å¼·èª¿åœ¨é€æ˜Žåº¦çš„è³‡è¨Šæœƒè¢«ä¿ç•™ï¼Œä¸¦èƒ½åƒ JPEG ä¸€æ¨£è¨­å®š qualityã€‚ä¸€èˆ¬ quality å®¹è¨±è¶Šä½Žå£“ç¸®æ¯”éƒ½æœƒè¶Šé«˜ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pngquant -f --ext=.png --quality=70-85 --skip-if-larger *.png
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° pngquant èƒ½å¾ˆå®¹æ˜“é”åˆ° 50% ä»¥ä¸‹çš„å£“ç¸®æ¯”ã€‚å°±æˆ‘çš„ä¾‹å­çœ‹ä¸å¤ªå‡ºç¾èž¢å¹•æˆªåœ–å“ªè£¡å¤±çœŸäº†ï¼Œè€Œä¸”å¤±çœŸäº†â€¦â€¦ä¹Ÿä¸æœƒæ€Žéº¼æ¨£å•¦ã€‚&lt;/p&gt;
&lt;h3 id="pngquant-zopflipng"&gt;pngquant + Zopflipng&lt;/h3&gt;
&lt;p&gt;çœ‹äº†ä¸€ä¸‹ç›¸é—œçš„è¨Žè«–ï¼Œpngquant é‚„æœ‰å†è¢«å£“ç¸®çš„ç©ºé–“ï¼Œæ‰€ä»¥æœ€å¾Œå†å¥—ä¸Š Zopflipng é‚„å¯ä»¥å†è®Šå°ï¼Œé‚„è »é©šäººçš„ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;Filename&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Orig. size&lt;/th&gt;
&lt;th style="text-align: right;"&gt;pngquant&lt;/th&gt;
&lt;th style="text-align: right;"&gt;pngquant + Zopfli&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Compress ratio&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_desktop.png"&gt;blog_desktop.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;180K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;60K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/blog_mobile.png"&gt;blog_mobile.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;72K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;28K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;28K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.39&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/justfont_setting.png"&gt;justfont_setting.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;272K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;84K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;76K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="../blog-internals/pics/oldsite.png"&gt;oldsite.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;604K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;288K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;268K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.44&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;&lt;a href="https://blog.liang2.tw/posts/2015/09/png-optim/pics/oldsite_full.png"&gt;oldsite_full.png&lt;/a&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;816K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;376K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;348K&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.43&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="truepng"&gt;æ²’æœ‰æ¸¬çš„ TruePNG&lt;/h3&gt;
&lt;p&gt;åœ¨åŽŸå§‹ç¶²ç«™ä¸­æœ‰æåˆ° &lt;a href="http://css-ig.net/articles/truepng"&gt;TruePNG&lt;/a&gt; è¡¨ç¾å¾ˆå¥½ï¼Œä½†å®ƒä¸æ˜¯ open source è€Œä¸”å¥½åƒåªèƒ½åœ¨ Windows ä¸Šè·‘ï¼Œé‚£å°±ç®—äº†ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;çµè«–&lt;/h3&gt;
&lt;p&gt;ä»¥å¾Œæ²’äº‹æˆªåœ–éƒ½æœƒç”¨ pngquant å£“ç¸®ä¸€ä¸‹ï¼Œå®Œå…¨ä¸èƒ½æœ‰è‰²å·®çš„è€ƒæ…®å¾ž OptiPNG æ”¹ç‚º Zopfliã€‚&lt;/p&gt;</content><category term="Coding"></category><category term="zh"></category><category term="png"></category></entry><entry><title>è¨­å®šéƒ¨è½æ ¼ç­†è¨˜</title><link href="https://blog.liang2.tw/posts/2015/09/blog-internals/" rel="alternate"></link><published>2015-09-21T00:00:00-05:00</published><updated>2022-05-13T13:10:13-05:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-21:/posts/2015/09/blog-internals/</id><summary type="html">&lt;p&gt;Blog å°æˆ‘ä¾†èªªï¼Œæœ€é‡è¦çš„å°±æ˜¯æ›¸å¯«çš„èˆ’é©åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€é–‹å§‹åœ¨è¨­å®š github CNAME çš„æ™‚å€™å°±è¨‚ç‚º &lt;code&gt;blog.liang2.tw&lt;/code&gt;ï¼Œä½†ä¸€ç›´ä»¥ä¾†éƒ½åªæ˜¯å€‹ä¸€é å¼çš„è‡ªæˆ‘ä»‹ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Blog å°æˆ‘ä¾†èªªï¼Œæœ€é‡è¦çš„å°±æ˜¯æ›¸å¯«çš„èˆ’é©åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€é–‹å§‹åœ¨è¨­å®š github CNAME çš„æ™‚å€™å°±è¨‚ç‚º &lt;code&gt;blog.liang2.tw&lt;/code&gt;ï¼Œä½†ä¸€ç›´ä»¥ä¾†éƒ½åªæ˜¯å€‹ä¸€é å¼çš„è‡ªæˆ‘ä»‹ç´¹&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œç”¨ &lt;a href="http://semantic-ui.com/"&gt;SemanticUI&lt;/a&gt; æ‰‹åˆ»è€Œæˆã€‚ä¸éŽéƒ¨è½æ ¼å¦‚æžœæ¯ç¯‡æ–‡ç« éƒ½é‚„è¦æ‰‹åˆ»çš„è©±ï¼Œå¤§æ¦‚å°±ä¸æœƒæœ‰åŠ›æ°£å†å¯«å…§å®¹äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ç†äº†ä¸€ä¸‹æœ‰å¹¾å€‹ç›®æ¨™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè€ƒæ…®ç”¨ static site å› ç‚ºä¸æƒ³ç¶­è­· serverï¼Œè€Œä¸” blog ä¹Ÿæ²’ä»€è¦ç‚«çš„ï¼Œç¾åœ¨å…‰ç”¨å‰ç«¯å°±å¯ä»¥åšåˆ°å¾ˆå¤šäº’å‹•åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;æœ€å¥½ site generator æ˜¯ç”¨ Python å¯¦ä½œï¼Œé€™æ¨£æƒ³è¦èª¿æ•´å®ƒçš„åŠŸèƒ½æ™‚ï¼Œæ¯”è¼ƒæ‡‚æ€Žéº¼æ”¹&lt;/li&gt;
&lt;li&gt;èƒ½æ”¯æ´ markdown å’Œ reStructuredText æœ€å¥½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¯©å®Œä¹‹å¾Œé¸é …ä¹Ÿæ²’å¹¾å€‹ï¼š&lt;a href="http://docs.getpelican.com/"&gt;Pelican&lt;/a&gt;ã€&lt;a href="http://sphinx-doc.org/"&gt;Sphinx&lt;/a&gt;ï¼Œä½† Sphinx å¯èƒ½å° blog é–‹ç™¼çš„åŠŸèƒ½æ¯”è¼ƒå°‘ï¼Œæœ€å¤šäººç”¨çš„å¤§æ¦‚å°± Pelicanï¼Œæ‰€ä»¥å°±æ±ºå®šç”¨å®ƒäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ç†èµ·ä¾†ä¹Ÿåšäº†ä¸å°‘èª¿æ•´ï¼Œå°±åˆ—é»žå§ï¼š&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#pelican"&gt;Pelican ç°¡ä»‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#all-is-about-the-theme"&gt;All is about the theme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_1"&gt;å­—åž‹&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#webfont"&gt;ä¸­æ–‡ webfont&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;ä¸­æ–‡æŽ’ç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#figure-caption"&gt;Figure caption&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#markdown-or-rst"&gt;Markdown or rst?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#to-do"&gt;To do&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#edit-2015-09-22"&gt;EDIT (2015-09-22)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#edit-2015-09-23"&gt;EDIT (2015-09-23)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id="pelican"&gt;Pelican ç°¡ä»‹&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://docs.getpelican.com/"&gt;Pelican&lt;/a&gt; çµè«–ä¾†èªªä¸é›£ç†è§£ï¼Œè€Œä¸”è¦è‡ªè¨‚ blog theme ä¹Ÿä¸æœƒå¾ˆè¤‡é›œã€‚é¦–å…ˆè·Ÿ Sphinx ä¸€æ¨£ï¼Œç”¨å…§å»ºçš„ &lt;code&gt;pelican-quickstart&lt;/code&gt; é è¨­å€¼å°±èƒ½æž¶å¥½ä¸€å€‹å¯ä»¥å‹•çš„ã€‚ç›®éŒ„å¤§æ¦‚é•·é€™æ¨£&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;my_blog/
â”œâ”€â”€ content/
â”‚Â Â  â”œâ”€â”€ blog_post_1.md
â”‚Â Â  â””â”€â”€ blog_post_2.rst
â”œâ”€â”€ output/
â”œâ”€â”€ develop_server.sh*
â”œâ”€â”€ Makefile
â”œâ”€â”€ fabfile.py
â”œâ”€â”€ pelicanconf.py
â”œâ”€â”€ publishconf.py
â””â”€â”€ requirements.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Blog source éƒ½æ”¾åœ¨ content åº•ä¸‹ï¼Œè¨­å®šæª”åˆ†æˆ local ç”¨çš„ &lt;code&gt;pelicanconf.py&lt;/code&gt; ä»¥åŠ deploy ç”¨çš„ &lt;code&gt;publishconf.py&lt;/code&gt;ã€‚ä¸¦ä¸”æä¾›äº†åƒ Fabricã€Makeã€shell script ç­‰è‡ªå‹•åŒ–è…³æœ¬æŠŠ source ç”¨ theme template render æˆä¸€å€‹éœæ…‹ç¶²ç«™ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;make html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é è¨­æœƒè¼¸å‡ºåˆ° &lt;code&gt;output/&lt;/code&gt;ï¼Œåˆ°æ™‚å€™ deploy å°±æŠŠé€™å€‹è³‡æ–™å¤¾çš„å…§å®¹ä¸Ÿåˆ° server ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ¯ç¯‡æ–‡ç« å¯ä»¥ç”¨ markdown æˆ–è€… reStructuredText(rst) ä¾†å¯«ï¼Œæ¦‚å¿µä¸Šåƒé€™æ¨£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;---
Title: Hello World
Date: 2016-01-16 18:00
Tags: world, programming
Category: test
&lt;span class="gu"&gt;Slug: hello-world&lt;/span&gt;
&lt;span class="gu"&gt;---&lt;/span&gt;

Hello [World]

[&lt;span class="nl"&gt;World&lt;/span&gt;]: &lt;span class="na"&gt;https://en.wikipedia.org/wiki/World&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gh"&gt;Hello World&lt;/span&gt;
&lt;span class="gh"&gt;##############&lt;/span&gt;

&lt;span class="nc"&gt;:date:&lt;/span&gt; 2016-01-16 18:00
&lt;span class="nc"&gt;:tags:&lt;/span&gt; world, programming
&lt;span class="nc"&gt;:category:&lt;/span&gt; test
&lt;span class="nc"&gt;:slug:&lt;/span&gt; hello-world

Hello World_

&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="nt"&gt;_World:&lt;/span&gt; https://en.wikipedia.org/wiki/World
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£å·²ç¶“è¨­å®šå¥½äº†æ¨™é¡Œã€åˆ†é¡žã€æ¨™ç±¤ã€ç™¼å¸ƒæ—¥æœŸé‚„æœ‰ slugï¼ˆæœ‰é»žåƒæ–‡ç« çš„ IDï¼‰ç®—å¾ˆå®Œæ•´äº†ã€‚æœ€ä½Žè¦æ±‚è‡³å°‘æœ‰æ¨™é¡Œã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œèª¿æ•´äº†ä¸€ä¸‹ static file çš„è·¯å¾‘ã€‚æˆ‘æŠŠæ–‡ç« æŒ‰å¹´æœˆåˆ†é–‹ï¼Œæ¯å€‹å­è³‡æ–™å¤¾è£¡æœ‰ç•¶æœˆçš„åœ–ã€æª”æ¡ˆç­‰ç­‰ã€‚URL ä¹Ÿæ˜¯ä»¥å¹´æœˆç‚ºå–®ä½ã€‚å…¶å¯¦æœ€ç†æƒ³çš„æ‡‰è©²æ˜¯æœ‰å€‹ hash ä¹‹é¡žçš„æ±è¥¿ &lt;code&gt;/posts/2015/09/abcd/&lt;/code&gt; ç­‰åŒæ–¼ &lt;code&gt;/posts/2015/09/abcd-my-post/&lt;/code&gt; æ¯”è¼ƒå¥½åˆ†äº«ã€‚æ‰¾äº†ä¸€ä¸‹å¥½åƒæ²’é€™åŠŸèƒ½ï¼Œä¸éŽæ²’æœ‰å®ƒå½±éŸ¿ä¹Ÿä¸åš´é‡ï¼Œæš«ä¸”ä¸ç†ã€‚&lt;/p&gt;
&lt;h3 id="all-is-about-the-theme"&gt;All is about the theme&lt;/h3&gt;
&lt;p&gt;ä¸€é–‹å§‹æœ€èŠ±æ™‚é–“å°±æ˜¯æ‰¾å€‹å¥½ä¸»é¡Œäº†ã€‚å…§å»ºçš„ä¸»é¡Œå¯¦ç”¨æ€§ä¸å·®ï¼Œä½†åˆæ¬¡çœ‹çµæ§‹å¤ªè¤‡é›œï¼Œå†ä¾†æˆ‘å–œæ­¡æ›´ç°¡æ½”çš„ç‰ˆé¢ï¼Œä¹Ÿå¸Œæœ›æœ‰å¯«å¥½ responsive layoutã€‚&lt;/p&gt;
&lt;p&gt;Pelican å¤§éƒ¨ä»½çš„ä¸»é¡Œéƒ½é›†ä¸­åœ¨ &lt;a href="http://pelicanthemes.com/"&gt;http://pelicanthemes.com/&lt;/a&gt;ï¼Œæœ‰ç¸®åœ–å¾ˆå¥½æŒ‘é¸ï¼Œè€Œä¸” theme è·Ÿå…§å®¹æ˜¯åˆ†é–‹çš„ï¼Œæ› theme åªæ˜¯æ”¹ config è£¡ &lt;code&gt;THEME&lt;/code&gt; é€™è®Šæ•¸è€Œå·²ï¼Œä¸å–œæ­¡å°±æ›ã€‚é¸äº†ä¸€é™£å­æŒ‘åˆ° &lt;a href="https://github.com/alexandrevicenzi/flex"&gt;Flex&lt;/a&gt;ï¼Œä»–ä¸æ˜¯æˆ‘æœ€å–œæ­¡çš„ç‰ˆåž‹ï¼Œæˆ‘æ¯”è¼ƒå–œæ­¡å–®æ¬„å¼ç½®ä¸­ï¼Œä½†æ„å¤–åªæœ‰å°‘æ•¸ä¸»é¡Œæ»¿è¶³ä¸Šè¿°æ¢ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Theme template ç”¨ Jinja2ï¼Œä¸€é–‹å§‹åªè¦èª¿æ•´ &lt;code&gt;base&lt;/code&gt;ã€&lt;code&gt;index&lt;/code&gt;ã€&lt;code&gt;article&lt;/code&gt;ã€&lt;code&gt;page&lt;/code&gt; é€™å¹¾é è·Ÿ blog æœ€ç›¸é—œçš„å°±èƒ½æ”¹è®Šä¸»è¦çš„å¤–è§€ã€‚å¥½åœ¨å…©æ¬„å¼çš„ç¶²é  code è®€èµ·ä¾†ä¹Ÿå¾ˆèˆ’é©ã€‚çœ‹äº†ä¸€ä¸‹åªè¦æŠŠ responsive èª¿æ•´ä¸€ä¸‹ï¼Œè®“æ‰‹æ©Ÿå…§æ–‡å¯¬åº¦å¤ ã€å¾ˆå¤§çš„èž¢å¹•ä¸è¦æ»¿ç‰ˆæ•´é«”çœ‹èµ·ä¾†å°±å·®ä¸å¤šã€‚å¤§è‡´ä¸Š theme å°±é€™æ¨£å®šä¸‹ä¾†äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç´°éƒ¨çš„ CSS ä¿®æ­£ï¼ŒFlex æœ‰ç”¨ &lt;a href="http://lesscss.org/"&gt;LESS&lt;/a&gt; å’Œ &lt;a href="http://gulpjs.com/"&gt;gulp&lt;/a&gt; è™•ç†å‰ç«¯çš„è¨­å®šã€‚LESS è®Šæ•¸è·Ÿ nesting rules ä¸æœƒè®“ CSS è®Šå¾—å¾ˆé«’ï¼›æ¯æ¬¡æ”¹å®Œè·‘å€‹ gulp å°±æœ‰æ–°çš„ &lt;code&gt;style.min.css&lt;/code&gt; å¾ˆæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;å”¯ä¸€è¨ŽåŽ­å·¦å´çš„å¤§é ­ç…§ï¼Œæœ‰å¤ ç…©çš„ï¼Œè€Œä¸”é‚„è¦å¢žåŠ  54KB çš„æµé‡ã€‚é‚„å†æƒ³è©²æ”¾ä»€éº¼ä¾†é—œæŽ‰å®ƒï¼Œæ”¾åˆéŸ³å¥½äº†ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;å­—åž‹&lt;/h3&gt;
&lt;p&gt;å› ç‚ºè‡ªç”¨ OSXï¼Œæœ‰æ™‚å€™éƒ½æœƒå¿˜äº†åœ¨ Windows ä¸Šçš„å­—é«”æœ‰å¤šæ‚²å“€ã€‚&lt;/p&gt;
&lt;p&gt;Flex å…§å»ºç”¨ Google webfont ä¾†è™•ç†è‹±æ–‡å­—é«”ï¼Œç‚ºäº†å¼•è¨€é‚„æœ‰å®Œæ•´æ€§å¤šåŠ äº†ä¸€çµ„ serif å­—é«” &lt;a href="https://www.google.com/fonts/specimen/Crimson+Text"&gt;Crimson Text&lt;/a&gt;ã€‚æˆ‘å–œæ­¡é€™ç¨® Garamond é¡žçš„å¤å…¸è¥¯ç·šå­—ã€‚å‰›å‰›ç™¼ç¾å®ƒæ˜¯&lt;a href="https://github.com/skosch/Crimson"&gt;é–‹æºçš„ (SIL 1.1)&lt;/a&gt;ï¼Œniceã€‚ï¼ˆå¤§é™¸ç¶²å‹è¡¨ç¤ºï¼šâ€¦â€¦ï¼‰&lt;/p&gt;
&lt;h4 id="webfont"&gt;ä¸­æ–‡ webfont&lt;/h4&gt;
&lt;p&gt;éº»ç…©çš„å°±æ˜¯ä¸­æ–‡å­—åž‹ã€‚ç›´æŽ¥æ”¾æ£„ç³»çµ±å…§å»ºï¼Œä½†æœ€å¾Œæœ‰æŠŠ Noto Sans CJK å’Œ Source Hans Sans åŠ é€²ä¾†ç•¶å‚™ç”¨ã€‚ä¸€ç›´éƒ½æœ‰æƒ³å˜—è©¦ &lt;a href="http://justfont.com"&gt;justfont&lt;/a&gt; æŽ¨å‡ºçš„ webfont åŠŸèƒ½ã€‚å®ƒé‹ä½œæ™‚æœƒåµŒå…¥ä¸€å€‹ javascriptï¼Œçœ‹é€™é ç¶²é ç”¨åˆ°å“ªäº›ä¸­æ–‡å­—ï¼Œæ‰åŽ»è¦é€™äº›ä¸­æ–‡å­—çš„å­—åž‹ä¾†åŠ é€Ÿè¼‰å…¥ã€‚ä½¿ç”¨ä¸Šå°±è·Ÿ Google webfont ä¸€æ¨£ï¼Œå®˜ç¶²æ•™å­¸è€ƒæ…®äº†å¾ˆå¤šä½¿ç”¨æƒ…æ³ï¼Œå…¶å¯¦æ²’åšä»€éº¼è¨­å®šå°±å¥½äº†ï¼Œæˆ‘ä»¥ç‚ºè¦èª¿å¾ˆå¤šæ±è¥¿æ‰çœ‹å¾—åˆ°æ•ˆæžœï¼Œæœ€å¾Œåªæ”¹äº† &lt;code&gt;font-family&lt;/code&gt; å°±å®Œå·¥ã€‚ä»–çš„è¨­å®šä¹Ÿèƒ½ä¿ç•™åŽŸæœ¬è‹±æ–‡å­—çš„å­—åž‹ã€‚&lt;/p&gt;
&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/justfont_setting.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;Justfont è¨­å®š&lt;/span&gt;&lt;/p&gt;
&lt;/figure&gt;

&lt;p&gt;å…è²»çš„è©¦ç”¨æ²’å•é¡Œä¹‹å¾Œå°±åˆ·ä¸‹åŽ»äº†ã€‚èªªçœŸçš„å…è²»åªèƒ½ç¶å…©å€‹å­—åž‹ï¼Œè¨­å®šå¥½å…§æ–‡ä»¥åŠå…§æ–‡ç²—é«” quota å°±ç”¨å®Œäº†ï¼Œç¾åœ¨ 100,000 page views/year å¤§ç´„ NTD 350/year ä¹Ÿä¸è²´ã€‚æ—¢ç„¶ä»˜è²»äº†ç•¶ç„¶è¦è©¦è©¦ä¿¡é»‘é«”ï¼Œé›»è…¦ç‰ˆçš„åˆ°ç¾åœ¨é‚„è²·ä¸èµ·å•Šã€‚è¨­äº†å…©å€‹å­—é‡ï¼Œä¸€æ¨£åŠ äº†ä¸€å¥—æ¥·é«”ç•¶å¼•è¨€ç”¨ã€‚æ¥·é«”ä¹Ÿé¸äº†æ¯”è¼ƒç§€æ°£çš„ cwTeX æ¥·ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿè¨±æœªä¾†æœƒè©¦è©¦çœ‹ä»¿å®‹é«”ï¼Œä½†æˆ‘æœ‰é»žæ“”å¿ƒèž¢å¹•é¡¯ç¤ºçš„æ•ˆæžœï¼ˆç”¨ Retina è¡¨ç¤ºè§£æžåº¦ç„¡æ„Ÿï¼‰ï¼Œè€Œä¸” justfont æä¾›çš„ï¼ˆä»¿ï¼‰å®‹é«”ä¹Ÿæ²’æœ‰æ¯”ä¿¡é»‘é«”æ›´å–œæ­¡ï¼Œé€™å¯¦é©—æš«ä¸”æ“±ç½®ã€‚&lt;/p&gt;
&lt;h4 id="_2"&gt;ä¸­æ–‡æŽ’ç‰ˆ&lt;/h4&gt;
&lt;p&gt;å—åˆ° COSCUP 2015 Bobby Tung çµ¦çš„æ¼”è¬›&lt;a href="http://www.slideshare.net/bobby3302/w3c-51661297"&gt;ã€Šä¸­æ–‡æŽ’ç‰ˆéœ€æ±‚ä»¥åŠæˆ‘åœ¨W3Cçœ‹åˆ°çš„äº‹æƒ…ã€‹&lt;/a&gt;æ‰€æ„Ÿå¬ï¼Œè¦ºå¾—å¦‚æžœè‡ªå·±ä¸ä¸€é–‹å§‹å¥½å¥½åšç¶²é ä¸­æ–‡æŽ’ç‰ˆï¼Œä¹‹å¾Œè‚¯å®šæ›´æ‡¶å¾—æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æœ€å¾Œé‚„æ˜¯æœ‰æ‰€å¦¥å”å•¦ï¼ˆè·ªï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ®µè½å‰å¾Œé‚„æ˜¯æœ‰ç•™ç™½ï¼Œé€™ä¸»è¦æ˜¯å…¼é¡§è‹±æ–‡æŽ’ç‰ˆï¼Œå› ç‚ºä¸çŸ¥é“æ€Žéº¼åœ¨ä¸åŒèªžè¨€å¥—ä¸åŒçš„ç‰ˆåž‹ï¼Œè‹±æ–‡æ®µè½æ˜¯å‰å¾Œç•™å¤§é–“è·ã€‚å†ä¾†æˆ‘åœ¨ç´”æ–‡å­—çš„æ™‚å€™ä¹Ÿå¾ˆç¿’æ…£æ®µè½å‰å¾Œç©ºä¸€è¡Œï¼Œæ„Ÿè¦ºè¦–è¦ºä¸Šé€™æ¨£æ¯”è¼ƒèˆ’é©ï¼ˆä¹Ÿè¨±æ˜¯è¡Œé«˜ä¸å¤ â€¦â€¦ï¼‰ã€‚ &lt;del&gt;&lt;code&gt;margin&lt;/code&gt; ä¹Ÿæ˜¯è¨­ç‚º &lt;code&gt;1em&lt;/code&gt;ã€‚&lt;/del&gt;ï¼ˆEDIT: è¦‹æ–‡æœ«ï¼‰&lt;/p&gt;
&lt;p&gt;æ®µè½é¦–è¡Œç¸®æŽ’æœ€å¾Œä¹Ÿæ²’æœ‰æ”¾ï¼Œä¸»å› æ˜¯æ–‡å¥éƒ½è »çŸ­çš„ï¼Œæœ‰é»žæ€ªï¼›å†ä¾† markdown parser æœƒæŠŠæˆ‘çš„å…¨å½¢ç©ºç™½åƒæŽ‰ï¼Œé›£ä»¥ç†è§£ï¼ˆä½† rst ä¸æœƒï¼‰ï¼ŒçœŸè¦åŠ åªèƒ½ç”¨&lt;code&gt;&amp;amp;#x3000;&lt;/code&gt;ç¡¬åŠ ã€‚ä¸­è‹±äº¤é›œçš„æ®µè½ä¸­æ–‡å­—æœƒç„¡æ³•å°é½Šï¼Œä¸éŽå°±æš«æ™‚ç®—äº†ï¼Œç¾åœ¨ä¸­è‹±æ–‡çš„å­—é‡èƒ½ä¸€æ¨£å·²ç¶“å¾ˆæ„Ÿå‹•äº†ã€‚&lt;/p&gt;
&lt;p&gt;300 çš„ä¸­æ–‡å­—çš„ç¢ºæœ‰é»žç´°ï¼Œæˆ‘æŠŠå­—èª¿å¤§äº†æˆ 18pxï¼Œé‚„ç‰¹åˆ¥æ‹¿çµ¦æˆ‘çˆ¸åª½çœ‹ï¼Œç¢ºå®šä»–å€‘çœ‹å¾—åˆ°é€™äº›å­— XD&lt;/p&gt;
&lt;p&gt;åšåˆ°é€™è£¡å…¶å¯¦é‚„è »æ»¿æ„äº†ï¼Œé•·å¾—åƒé€™æ¨£ï¼š&lt;/p&gt;
&lt;figure class="align-center" style="width: 250px"&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/blog_mobile.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;æ‰‹æ©Ÿä¸Šçš„æ¨£å­&lt;/span&gt;&lt;/p&gt;
&lt;/figure&gt;

&lt;figure&gt;
  &lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/blog_desktop.png"/&gt;
  &lt;p class="caption center"&gt;&lt;span class="fig"&gt;é›»è…¦èž¢å¹•çš„æ¨£å­&lt;/span&gt;&lt;/p&gt;
&lt;/figure&gt;

&lt;h3 id="figure-caption"&gt;Figure caption&lt;/h3&gt;
&lt;p&gt;åœ–çš„ä¸‹é¢é‚„è »å¸¸æœƒæ”¾ä¸€äº›åœ–èªªã€reference ä¹‹é¡žã€‚ç¯„ä¾‹ä¸Šé¢å°±æœ‰ã€‚åœ¨ markdown ä¸å®¹æ˜“é”æˆé€™æ•ˆæžœï¼Œå› ç‚ºå®ƒçš„èªžæ³•æ²’é€™éº¼è¤‡é›œï¼›ä½† rst æœ¬ä¾†å°±æœ‰æ”¯æ´é€™æ¨£çš„èªžæ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;role&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; fig

&lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="ow"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt; {filename}pics.jpg
    &lt;span class="nc"&gt;:align:&lt;/span&gt; center

    &lt;span class="na"&gt;:fig:&lt;/span&gt;&lt;span class="nv"&gt;`Figure 1:`&lt;/span&gt; The figure caption.

    The legend consists of all elements after the caption.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£å°±æœƒè®Šæˆ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;figure align-center&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;img&lt;/span&gt; &lt;span class="na"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{filename}pics.jpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;figcaption&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;span&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fig&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Figure 1:&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;span&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; The figure caption&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;figcaption&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;legend&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;The legend consists of all elements after the caption.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ markdown åŸºæœ¬ä¸Šå°±æ‰‹æ‰“ä¸Šé¢é‚£ä¸€ä¸² HTMLï¼Œå…¶å¯¦ä¹Ÿé‚„å¥½ï¼Œåªæ˜¯é†œäº†ä¸€é»žã€‚çœŸçš„å¯«å¾—å¾ˆç…©æ™‚å†æƒ³å¯« plugin ä¾†åšé€™ä»¶äº‹ã€‚&lt;/p&gt;
&lt;h3 id="markdown-or-rst"&gt;Markdown or rst?&lt;/h3&gt;
&lt;p&gt;æ—¥å¸¸çš„ç·¨è¼¯æ‡‰è©²é‚„æ˜¯ä»¥ markdown ç‚ºä¸»ï¼Œçœ‹çœ‹ç²¾ç¾Žçš„ &lt;a href="http://macdown.uranusjr.com/"&gt;Macdown&lt;/a&gt; ç·¨è¼¯å™¨å¦‚æ­¤å¥½ç”¨ã€‚ä½†å¦‚æžœæ˜¯å¾ˆè¤‡é›œçš„æª”æ¡ˆï¼ˆåˆ†æžæœ‰å…¬å¼æœ‰åœ–è¡¨ä»€éº¼çš„ï¼‰å¯èƒ½å°±æœƒè€ƒæ…® rstï¼›rst ç¼ºé»žå°±æ˜¯èªžæ³•æœ‰é»žè¤‡é›œï¼Œè€Œä¸”å¾ˆå¤šèªžæ³•ä»°è³´å¥ä¸­ç©ºç™½ï¼Œä½¿å¾—ä¸é©ç”¨ä¸­æ–‡ï¼Œç„¶å¾Œæˆ‘çš„ vim linter æœƒä¸€ç›´æŠ±æ€¨å®ƒæœ‰å¾ˆå¤šæ²’çœ‹éŽçš„ directivesã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽå¾ˆé«˜èˆˆ Pelican æŠŠå…©è€…æ•´åˆçš„å¾ˆå¥½ï¼Œå…©å€‹éƒ½èƒ½ç”¨å°±èƒ½è¦–æƒ…æ³è½‰æ›ï¼Œä½† template ä¹Ÿä¸ç”¨å¯«å…©ä»½ã€‚&lt;/p&gt;
&lt;h3 id="to-do"&gt;To do&lt;/h3&gt;
&lt;p&gt;é€™ä¹‹å¤–é‚„åŠ ä¸Šäº† LaTeX MathJaxã€Smartypants ç­‰å°ç´°ç¯€ï¼Œä¸éŽæ•´é«”ä¾†èªª blog å®¢è£½åŒ–å°±å®Œæˆäº†ã€‚ä¹Ÿè¨±æœªä¾†ç”¨åˆ°ä»€éº¼å†åŠ å§ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æƒ³åˆ°çš„ä¸€äº›å•é¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¨™é¡Œå­—é‡ï¼šæœ¬ä¾†æ˜¯è·Ÿå…§æ–‡åŒå­—é‡ï¼Œä½†æ„Ÿè¦ºé•·æ–‡æœƒæŠ“ä¸åˆ°æ®µè½ï¼Œå…ˆæ”¹æˆç²—é«”ï¼Œå¸Œæœ›çŸ­æ–‡ä¸è¦å› ç‚ºé€™æ¨£è®Šå¾—å¾ˆæ··äº‚ã€‚&lt;/li&gt;
&lt;li&gt;Jupyter notebook includeï¼šé‚„æ²’æœ‰è©¦ç›´æŽ¥åµŒå…¥ nb çš„åŠŸèƒ½ï¼Œæˆ‘æƒ³æ‡‰è©²ä¹Ÿæ˜¯èª¿æ•´ CSS é‚£é¡žçš„å·¥ï¼ˆå‰ç«¯å¥½ç´¯å¥½é›£å•Šâ€¦ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/getpelican/pelican-plugins"&gt;Pelican plugin&lt;/a&gt; è£¡é¢åŒ…å«äº†å¾ˆå¤šæ¨£çš„å¥—ä»¶ï¼Œæˆ‘çŒœå¾ˆå¤šé‡åˆ°çš„å•é¡Œï¼Œå‰äººéƒ½è§£æŽ‰äº†å§ï¼Ÿâ€¦â€¦å§ xdd&lt;/p&gt;
&lt;h3 id="edit-2015-09-22"&gt;EDIT (2015-09-22)&lt;/h3&gt;
&lt;p&gt;çœ‹ä¾†çœ‹åŽ»ï¼Œåˆèª¿æ•´äº†å¾ˆå¤šæ±è¥¿ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå­—é«”å¤§å°èª¿å°æˆ 16px åˆèª¿å›ž 18pxã€‚æœƒé¸æ“‡ 16px æ˜¯å› ç‚ºæˆ‘ç™¼ç¾åœ¨ 13&amp;#34; ç­†é›»ä¸Šé–±è®€æœƒè®Šå¾—å¾ˆæ“ ã€‚èª¿å›žä¾†æ˜¯å› ç‚ºåœ¨å¤§èž¢å¹•ä¸Šçœ‹çœŸçš„å¤ªå°äº†ï¼Œè‡ªå·±éƒ½éœ€è¦æ”¾å¤§ä¾†çœ‹ã€‚è€Œä¸”ç™¼ç¾æœ¬ä¾† 13&amp;#34; ä¸Šå¾ˆæ“ çš„å•é¡Œä¸¦ä¸æ˜¯å­—é«”ï¼Œè€Œæ˜¯ä¸€è¡Œæ–‡å­—çš„å­—æ•¸ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€è¡Œæ–‡å­—å¤ªå¤šæœƒå½±éŸ¿åˆ°é–±è®€çš„æ•ˆçŽ‡ã€‚PTT ä¸€è¡Œæœ€å¤š 39 å€‹ä¸­æ–‡å­—ï¼Œä½†æ‡‰è©²å¾ˆå°‘æ–‡ç« æ˜¯æ‰“æ»¿çš„ï¼Œå¤§ç´„éƒ½æ‰“å€‹äº”åˆ°å…«æˆå¯¬ï¼Œä¹Ÿå°±æ˜¯åœ¨ 20-32 å€‹ä¸­æ–‡å­—ã€‚è‹±æ–‡çš„è©±å¤§ç´„åœ¨ 12-15 å€‹å­—ã€‚æˆ‘è‡ªå·±èª¿äº†å¾ˆå¤šç‰ˆæœ¬ä¹Ÿå·®ä¸å¤šæ˜¯é€™å€‹æ•¸å­—ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ç†æƒ³çš„æ–‡ç« å¯¬åº¦è¦æ»¿è¶³ä¸­ã€è‹±æ–‡çš„å­—æ•¸ã€‚ä¸­æ–‡å­—å¯¬åº¦æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨æ±ºå®šä¸€è¡Œæœ‰å¤šå°‘å€‹ä¸­æ–‡å­—ä¹‹å¾Œï¼Œå°±è¦æƒ³è¾¦æ³•èª¿æ•´è‹±æ–‡å­—é«”è®“ä¸€è¡Œè‹±æ–‡å­—æ•¸å‰›å¥½ã€‚åŽŸæœ¬ä½¿ç”¨çš„ Source Pro Sans ç¨å¾®çª„äº†ä¸€é»žï¼Œæœƒè®“ç´”è‹±æ–‡çš„é é¢çœ‹èµ·ä¾†æœ‰é»žæ“ ï¼Œå­—é‡ 400 çš„æ™‚å€™å°±å¥½å¤šäº†ï¼Œä½†ä¸­æ–‡å°±è®Šå¾—ä¸é©åˆå…§æ–‡ã€‚æœ€å¾Œæ›æˆ Latoï¼Œä¹Ÿæ˜¯å¾ˆæ™®åŠçš„å­—é«”ï¼Œä¸éŽå…¶å¯¦æ²’å¯¬å¤šå°‘ã€‚å¦‚æžœé‚„æ˜¯è¦ºå¾—å¾ˆæ“ å°±åªå¥½æ›æˆ Open Sans äº†ï¼Œä½†æˆ‘è¦ºå¾—å®ƒå°±æœ‰é»žé¬†æ•£ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œå…§æ–‡å¯¬ 738px (41em) æˆ– 828px (46em)ï¼Œå¯¦éš›ä¸€è¡Œæœ€å¤§ç‚º 612px (34em)ã€‚ä¸€è¡Œæœ€å¤š 34 å€‹ä¸­æ–‡å­—ã€å¤§ç´„ 14 å€‹è‹±æ–‡å­—ï¼ˆ80 å€‹å­—å…ƒï¼‰ï¼›ç¨‹å¼ç¢¼ä¸€è¡Œæœ€å¤šåªèƒ½æ”¾ 74 å€‹å­—å…ƒï¼ŒçŸ­äº†ä¸€é»žé»žä½†é‚„å¯ä»¥æŽ¥å—ã€‚&lt;/p&gt;
&lt;p&gt;æ„å¤–çš„å°ç™¼ç¾ï¼Œåœ¨å…§æ–‡è®Šçª„ä¹‹å¾Œï¼Œé‚„å¯ä»¥åŠ ä¸Šå³å´çš„ sidenoteï¼Œåƒæ˜¯ &lt;a href="http://www.daveliepmann.com/tufte-css/"&gt;Tufte CSS&lt;/a&gt; é€™æ¨£ï¼Œæœ‰æ™‚æœƒæ¯” footnote å¥½ç”¨ï¼Œä½†å¯èƒ½åˆè®Šå›žå…§å®¹å¤ªæ“ çš„ç‹€æ…‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¾Œæ˜¯åœ¨æ®µè½å‰å¾Œè·é›¢èª¿æ•´ï¼ŒæŠŠæ¨™é¡ŒæŽ¥å…§æ–‡çš„é–“è·è®Šå°äº†ï¼Œä½†æ®µè½é–“çš„é–“è·èª¿å¤§ã€‚å­¸åˆ°äº†ä¸€äº›ä»¥å‰ä¸æœƒçš„ CSS èªžæ³•ï¼Œåƒ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;margin-top&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.5&lt;/span&gt;&lt;span class="kt"&gt;em&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»£è¡¨é¸å–ç›¸é„°çš„ p å…ƒç´ ï¼Œé€™æ¨£å¯ä»¥é¿å…ç›´æŽ¥æ”¹ p çš„ margin è®“ p èˆ‡ h&lt;em&gt;ã€ulã€pre ç­‰é–“è·å¤ªå¯¬çš„ç‹€æ³ã€‚&lt;/em&gt;&lt;em&gt;å‰ç«¯çœŸçš„å¤ªç¥žå¦™äº†ã€‚&lt;/em&gt;*&lt;/p&gt;
&lt;h3 id="edit-2015-09-23"&gt;EDIT (2015-09-23)&lt;/h3&gt;
&lt;p&gt;å¦å¤– smartypants æœ‰æ™‚å€™æœ‰é»žç…©ï¼Œåƒæ˜¯è¡¨é” 13 å‹æ™‚&lt;/p&gt;
&lt;p class="center"&gt;&lt;span style="font-size: 4em; line-height: 1em;"&gt;13" vs 13&amp;#34;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;ä¸æŠŠ &lt;code&gt;"&lt;/code&gt;ï¼ˆQUOTATION MARK &lt;code&gt;\u0022&lt;/code&gt;ï¼‰ç›´æŽ¥å¯«æˆ &lt;code&gt;&amp;amp;#34;&lt;/code&gt; å°±æœƒè¢«è½‰æ›æˆå·¦é‚Šé‚£æ¨£ &lt;code&gt;â€&lt;/code&gt;ï¼ˆRIGHT DOUBLE QUOTATION MARK &lt;code&gt;\u201D&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¹ŸæŠŠè¡¨æ ¼çš„æ ¼å¼åŠ ä¸Šï¼Œä»¿é€  bootstrap è¡¨æ ¼ overflow æ™‚æœƒè®Šæˆ block å¯ä»¥æ»‘å‹•è‘—çœ‹ã€‚&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;ä»¥å‰éƒ¨è½æ ¼çš„é•·ç›¸ï¼š
&lt;figure&gt;
&lt;img src="https://blog.liang2.tw/posts/2015/09/blog-internals/pics/oldsite.png"/&gt;
&lt;/figure&gt;&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="Coding"></category><category term="zh"></category><category term="pelican"></category><category term="blog"></category><category term="python"></category></entry><entry><title>éƒ¨è½æ ¼ç¬¬ä¸€ç¯‡</title><link href="https://blog.liang2.tw/posts/2015/09/blog-first-post/" rel="alternate"></link><published>2015-09-20T00:00:00-05:00</published><updated>2022-02-20T20:07:45-06:00</updated><author><name>Liang-Bo Wang</name></author><id>tag:blog.liang2.tw,2015-09-20:/posts/2015/09/blog-first-post/</id><summary type="html">&lt;p&gt;æ‰€ä»¥å‘¢ï¼Œé€™å°±æ˜¯æˆ‘æ–°çš„éƒ¨è½æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸€ç›´éƒ½æœ‰è¨˜éŒ„è‡ªå·±çš„ç¿’æ…£ã€‚åœ‹ä¸­æœ‰é€±è¨˜ï¼›é«˜ä¸­æœ‰é€±è¨˜ï¼›å¤§ä¸€çš„æ™‚å€™æœ‰ Facebookï¼Œå¤§äºŒä¹‹å¾Œå‰‡æœ‰å€‹ç‰ˆã€‚
è¨˜ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æ‰€ä»¥å‘¢ï¼Œé€™å°±æ˜¯æˆ‘æ–°çš„éƒ¨è½æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸€ç›´éƒ½æœ‰è¨˜éŒ„è‡ªå·±çš„ç¿’æ…£ã€‚åœ‹ä¸­æœ‰é€±è¨˜ï¼›é«˜ä¸­æœ‰é€±è¨˜ï¼›å¤§ä¸€çš„æ™‚å€™æœ‰ Facebookï¼Œå¤§äºŒä¹‹å¾Œå‰‡æœ‰å€‹ç‰ˆã€‚
è¨˜éŒ„è‡ªå·±å…¶å¯¦åªè¦ç´”æ–‡å­—å°±å¤ äº†ã€‚æ‰€ä»¥ï¼Œé€™å€‹éƒ¨è½æ ¼æš«æ™‚ä¹Ÿä¸æœƒæ‹¿ä¾†åšé€™ä»¶äº‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éŽç´”æ–‡å­—æœ‰æ™‚å€™é‚„æ˜¯è »éº»ç…©çš„ï¼Œåƒç¨‹å¼çš„ç­†è¨˜ï¼Œæˆ–ä¸€äº›åœ–å¤šçš„æ–‡ç« ï¼ˆä¾‹å¦‚ï¼šå®…ç‰©ï¼‰ï¼Œ
ç”¨ç´”æ–‡å­—è¨˜å°±å¾ˆéº»ç…©ï¼Œå¯è®€æ€§éžå¸¸å·®ï¼Œå†ä¾†è‡ªå·±ç·¨è¼¯ã€æŽ’ç‰ˆä¸Šä¹Ÿå¾ˆå›°é›£ï¼Œå¤šå€‹é¢å‘åŠ åœ¨ä¸€èµ·å°±æˆç‚ºå¾ˆå¤§çš„å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ–¼æ˜¯æœ‰äº†å»ºè‡ªå·±éƒ¨è½æ ¼çš„æƒ³æ³•ã€‚&lt;/p&gt;
&lt;h3 id="_1"&gt;æœƒæœ‰ä»€éº¼å…§å®¹ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ç›®å‰è‡³å°‘æœ‰é€™äº›æ±è¥¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¨‹å¼é–‹ç™¼å¿ƒå¾—&lt;/li&gt;
&lt;li&gt;ç ”ç©¶çš„ç­†è¨˜&lt;/li&gt;
&lt;li&gt;ç¤¾ç¾¤ï¼ˆEx PyConï¼‰çš„è¨˜éŒ„&lt;/li&gt;
&lt;li&gt;å®…ç‰©ï¼Œä¸»è¦æ˜¯å‹•ç•«&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–å¯èƒ½æœƒæœ‰ä¸€äº›çš„è‹±æ–‡æ–‡ç« ï¼Œå› ç‚ºæˆ‘ä¹Ÿè¦ç”³è«‹å­¸æ ¡ã€‚é€™æ‡‰è©²å¯ä»¥ç”¨ Tag æˆ–è€… Category ä¾†ç¯©é¸ã€‚ä¸éŽä¸»è¦æ‡‰è©²æ˜¯å€‹æŠ€è¡“æ€§çš„éƒ¨è½æ ¼ã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;éƒ¨è½æ ¼ä¹‹å¾žå‰ç¨®ç¨®è­¬å¦‚é»‘æ­·å²&lt;/h3&gt;
&lt;p&gt;æˆ‘ç›®å‰è¨˜æ†¶ä¸­ï¼Œç¬¬ä¸€å€‹éƒ¨è½æ ¼æ˜¯åœ‹ä¸­ç”¨çš„ MSN/Hotmailã€‚ä½†åœ¨æˆ‘ç„¡æ³•ç™»å…¥ hotmail ä¿¡ç®±å¸³è™Ÿè¢«å‡çµçš„åŒæ™‚ï¼Œå®ƒæ‡‰è©²ä¹Ÿæ¶ˆå¤±åœ¨é€™å€‹ä¸–ç•Œä¸Šäº†ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒå€‹éƒ¨è½æ ¼æ‡‰è©²æ˜¯å‰›ä¸Šé«˜ä¸­çš„&lt;a href="http://blog.yam.com/myway"&gt;é†‰å®¢æ¨“&lt;/a&gt;ï¼Œåœ¨è•ƒè–¯è—¤ä¸Šï¼Œç•¶å¹´ Google é‚„æ²’ç¨å ä¸­æ–‡æœå°‹å¸‚å ´ã€‚æ„å¤–åœ°å®ƒç«Ÿç„¶æ²’æœ‰å€’æŽ‰ï¼Œè€Œä¸”ä¹Ÿæ²’ä»€éº¼äººå–åç‚ºã€Œé†‰å®¢æ¨“ã€ï¼Œæœå°‹é‚„å¯ä»¥åœ¨ç¬¬ä¸€é ï¼Œç°¡ç›´æ˜¯â€¦â€¦å¯ä¸å¯ä»¥å¯«ä¿¡çµ¦ yam æŠŠå®ƒé—œæŽ‰å•Šè¶…å®³ç¾žçš„ã€‚å¸³è™Ÿæ˜¯ &lt;code&gt;myway&lt;/code&gt; ä¹Ÿè »çŒ›çš„ï¼Œç¾åœ¨æ‡‰è©²æ¶ä¸åˆ°é€™éº¼æ½®çš„ ID äº†ã€‚æš±ç¨±æ˜¯&lt;strong&gt;å•è·¯å®¢é˜¿åš&lt;/strong&gt;ï¼Œé€™å¯¦åœ¨æ˜¯â€¦â€¦å¥½å§åˆ°ç¾åœ¨é‚„æ˜¯è »å–œæ­¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ç™¼æ–‡æ™‚é–“æ˜¯ 2007 å¹´ 2 æœˆï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸­äºŒç—…å…¨é–‹çš„æ™‚å€™ï¼ˆå¥½å•¦å…¶å¯¦æ˜¯é«˜ä¸€ï¼‰ã€‚æ–‡ç« æ˜¯è‡ªå·±å¯«çš„çŸ­ç¯‡å°èªªï¼Œé›–ç„¶åªæœ‰ç¬¬ä¸€ç« ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¥½æ¼‚äº®çš„èŠ±å•Šã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¹²ååœ¨èŠ±åœƒå‰ï¼Œè¼•è¼•çš„ç”¨æ‰‹æ’«æ‘¸è‘—ä¸€æœµæœµç››é–‹çš„ç¾Žã€‚å°å°çš„åœ’åœ°ï¼Œç«Ÿæ˜¯å¦‚æ­¤ç¹½ç´›ã€‚ä¸€æŽ’æŽ’æ•´é½Šçš„èŠ±ï¼Œåœ¨è‡ªå·±å°å°åœ°ç›¤ç¶»æ”¾æœ€è€€çœ¼çš„è‰²å½©ã€‚ç•¶æˆ‘å‡è¦–è‘—é€™çˆ­å¥‡é¬¥è±”çš„æ™¯è‰²ï¼Œä¸çŸ¥ä¸è¦ºåœ°ä¾¿ç‚ºç›®çœ©ç¥žè¿·ï¼Œä¸€å¤§ç‰‡çš„èŠ±æµ·åœ¨è…¦æµ·ä¸­æ¼«å»¶é–‹ä¾†ï¼Œæˆ‘åŠªåŠ›æƒ³åƒè‡ªå·±åœ¨å…¶ä¸­å¥”è·‘çš„æ¨£å­ï¼šç”¨æ‰‹å¿«é€Ÿåœ°æ‹‚éŽä¸€æ—ä¸åœå¾žè¦–ç·šä¸­æ¶ˆå¤±çš„èŠ±æœµï¼Œæˆ‘åœ¨å°å¾‘ä¸­æ—‹è½‰è‘—èº«é«”ï¼Œåœ¨è…¦æµ·ä¸­æˆ‘å¯è¼•ç›ˆå¤šäº†ï¼æˆ‘æƒ³åƒè‡ªå·±ä¾¿å€’è‡¥åœ¨é‚£èŠ±æµ·ä¸­ï¼Œå¼µé–‹é›™æ‰‹ä»”ç´°å“å˜—è‘—èŠ±è¾®æº«æŸ”çš„è§¸æ„Ÿï¼Œé‚„æœ‰é‚£æ·¡æ·¡çš„èŠ±é¦™ï¼ŒæŠ¬é ­æœ›è‘—è—å¤©ï¼Œæˆ‘é«˜èˆˆçš„ç¬‘è‘—â€¦â€¦ &lt;/p&gt;
&lt;p&gt;ï¼ˆå¦‚æžœçœŸçš„æƒ³çœ‹çš„è©±å…¨æ–‡åœ¨&lt;a href="http://blog.yam.com/myway/article/8033752"&gt;é€™å…’&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€™ç¯‡å°èªªæœ€å¾Œæœ‰å®Œç¨¿è€Œä¸”æœ‰æŠ•å‡ºåŽ»ï¼Œåœ¨å£«æž—å°é›» K æ›¸ä¸­å¿ƒå¯«å®Œçš„ã€‚ä¸éŽç•¶å¹´æ˜¯ç´™ç­†å¯«åœ¨ç¨¿ç´™ä¸Šï¼Œå¾Œä¾†å°±æ‡¶å¾—æ‰“å­—äº†ã€‚é€™å°èªªæ˜¯åœ¨çœ‹å®Œåœ°ç„å°‘å¥³ç¬¬ä¸€å­£çš„æ™‚å€™å¯«çš„ï¼Œåš´é‡å—åˆ°å®ƒçš„ä¸–ç•Œè§€è·Ÿæ•˜äº‹æ–¹å¼å½±éŸ¿ã€‚&lt;/p&gt;
&lt;p&gt;å’¦èªªå¥½çš„æŠ€è¡“æ€§éƒ¨è½æ ¼å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Let the journey begin.&lt;/p&gt;</content><category term="misc"></category><category term="zh"></category></entry></feed>